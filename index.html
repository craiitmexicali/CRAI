<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="CRAI - Club de Rob√≥tica Avanzada e Ingenier√≠a del Tecnol√≥gico Nacional de M√©xico Campus Mexicali. Desarrollo tecnol√≥gico, proyectos de innovaci√≥n y competencias de rob√≥tica.">
    <meta name="theme-color" content="#1B396A">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://clubcrai.com/">
    <meta property="og:title" content="CRAI - Club de Rob√≥tica Avanzada e Ingenier√≠a | TECNM Mexicali">
    <meta property="og:description" content="Nodo oficial de desarrollo tecnol√≥gico del Tecnol√≥gico Nacional de M√©xico Campus Mexicali. Rob√≥tica de competencia, proyectos de innovaci√≥n y comunidad de ingenier√≠a.">
    <meta property="og:image" content="logotec.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://clubcrai.com/">
    <meta property="twitter:title" content="CRAI - Club de Rob√≥tica Avanzada e Ingenier√≠a | TECNM Mexicali">
    <meta property="twitter:description" content="Nodo oficial de desarrollo tecnol√≥gico del Tecnol√≥gico Nacional de M√©xico Campus Mexicali. Rob√≥tica de competencia, proyectos de innovaci√≥n y comunidad de ingenier√≠a.">
    <meta property="twitter:image" content="logotec.png">
    
    <title>CRAI - Club de Rob√≥tica Avanzada e Ingenier√≠a | TECNM Mexicali</title>

    <!-- === TECNOLOG√çA DE CLASE MUNDIAL (CDNs) === -->
    
    <!-- UI & Styles Framework -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.0/vanilla-tilt.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <!-- Animaciones y Gr√°ficos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Alertas UX Profesional -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Generador de PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>

    <!-- FIREBASE COMPAT V9 (Required for direct browser usage) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <!-- CONFIGURACI√ìN DE DISE√ëO INSTITUCIONAL -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        tec: {
                            blue: '#1B396A',     // Azul TecNM (Principal)
                            dark: '#0f2346',     // Variante Oscura
                            gold: '#D4AF37',     // Dorado B√∫falo (Accento)
                            bg: '#F8FAFC',       // Slate 50 (Fondo App)
                            surface: '#FFFFFF',  // Tarjetas
                            muted: '#64748B'     // Texto secundario
                        }
                    },
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'], // T√≠tulos
                        mono: ['JetBrains Mono', 'monospace'], // Datos T√©cnicos
                    },
                    boxShadow: {
                        'enterprise': '0 20px 25px -5px rgba(27, 57, 106, 0.1), 0 10px 10px -5px rgba(27, 57, 106, 0.04)',
                        'gold-glow': '0 0 15px rgba(212, 175, 55, 0.3)'
                    }
                }
            }
        }
    </script>

    <style>
        /* CSS RESET & CUSTOM UTILITES */
        body { background-color: #F8FAFC; color: #1e293b; overflow-x: hidden; }
        
        /* Padding inferior para nav m√≥vil */
        @media (max-width: 1023px) {
            body { padding-bottom: 70px; }
            footer { margin-bottom: 0; }
        }
        
        /* Navbar Glass Effect */
        .glass-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(27, 57, 106, 0.1);
        }

        /* Loaders */
        .loader-circuit {
            width: 60px; height: 60px; border: 4px solid #e2e8f0;
            border-top-color: #1B396A; border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Tarjetas Tecnol√≥gicas */
        .card-tech {
            transition: all 0.3s ease;
            border: 1px solid rgba(226, 232, 240, 0.8);
        }
        .card-tech:hover {
            transform: translateY(-5px);
            border-color: #1B396A;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        /* Project Card Styles */
        .project-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }
        .project-card:hover {
            transform: translateY(-8px);
            border-color: #1B396A;
            box-shadow: 0 25px 50px -12px rgba(27, 57, 106, 0.25);
        }
        .project-card:hover .project-image-icon {
            transform: scale(1.1) rotate(5deg);
        }
        .project-card:hover .project-overlay {
            opacity: 1;
        }
        .project-card:hover .project-actions {
            transform: translateY(0);
            opacity: 1;
        }
        .project-overlay {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .project-actions {
            transform: translateY(10px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        /* Category Filter Buttons */
        .category-filter-btn {
            background: #f1f5f9;
            color: #64748b;
            border: 2px solid transparent;
        }
        .category-filter-btn:hover {
            background: #e2e8f0;
            color: #1B396A;
        }
        .category-filter-btn.active {
            background: linear-gradient(135deg, #1B396A 0%, #2d4a7c 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(27, 57, 106, 0.3);
        }
        
        /* View Toggle Buttons */
        .view-btn {
            color: #94a3b8;
        }
        .view-btn:hover {
            color: #1B396A;
            background: #e2e8f0;
        }
        .view-btn.active {
            color: #1B396A;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Project List View */
        .project-list-item {
            transition: all 0.3s ease;
            border: 1px solid rgba(226, 232, 240, 0.8);
        }
        .project-list-item:hover {
            border-color: #1B396A;
            box-shadow: 0 10px 30px -10px rgba(27, 57, 106, 0.15);
            transform: translateX(5px);
        }

        /* Tab Styles for Reservations, Competitions */
        .reservation-tab, .comp-tab {
            background: #f1f5f9;
            color: #64748b;
        }
        .reservation-tab:hover, .comp-tab:hover {
            background: #e2e8f0;
            color: #1B396A;
        }
        .reservation-tab.active {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }
        .comp-tab.active {
            background: linear-gradient(135deg, #ea580c 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(234, 88, 12, 0.3);
        }

        /* Inventory Filter Styles */
        .inv-filter {
            background: #f1f5f9;
            color: #64748b;
            transition: all 0.3s ease;
        }
        .inv-filter:hover {
            background: #e2e8f0;
        }

        /* Wiki Category Cards */
        .wiki-category-card.active {
            border-color: #9333ea;
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
        }

        /* Tournament/Competition Badge */
        .tournament-badge {
            background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
            animation: badgePulse 2s ease-in-out infinite;
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.4);
        }
        .tournament-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(249, 115, 22, 0.5);
        }
        @keyframes badgePulse {
            0%, 100% { box-shadow: 0 4px 15px rgba(249, 115, 22, 0.4); }
            50% { box-shadow: 0 4px 25px rgba(249, 115, 22, 0.6); }
        }
        .tournament-badge-small {
            background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
            box-shadow: 0 2px 8px rgba(249, 115, 22, 0.3);
        }

        /* Achievement/Logros Badges System */
        .achievement-badge {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .achievement-badge:hover {
            transform: scale(1.2);
            z-index: 10;
        }
        .achievement-badge.mythic {
            background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 50%, #06b6d4 100%);
            animation: mythicGlow 1.5s ease-in-out infinite, mythicRotate 8s linear infinite;
            border: 2px solid white;
        }
        .achievement-badge.legendary {
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
            animation: legendaryGlow 2s ease-in-out infinite;
        }
        .achievement-badge.epic {
            background: linear-gradient(135deg, #9333ea 0%, #7c3aed 100%);
        }
        .achievement-badge.rare {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }
        .achievement-badge.common {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        @keyframes mythicGlow {
            0%, 100% { box-shadow: 0 0 15px rgba(236, 72, 153, 0.7), 0 0 30px rgba(139, 92, 246, 0.5); }
            33% { box-shadow: 0 0 15px rgba(139, 92, 246, 0.7), 0 0 30px rgba(6, 182, 212, 0.5); }
            66% { box-shadow: 0 0 15px rgba(6, 182, 212, 0.7), 0 0 30px rgba(236, 72, 153, 0.5); }
        }
        @keyframes mythicRotate {
            from { filter: hue-rotate(0deg); }
            to { filter: hue-rotate(360deg); }
        }
        @keyframes legendaryGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 30px rgba(255, 140, 0, 0.4); }
        }
        .achievements-container {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: center;
        }
        
        /* Marco Especial M√≠tico para Completistas - EL MEJOR DE TODOS */
        .mythic-frame {
            position: relative;
            --rainbow-glow: 0 0 20px rgba(236, 72, 153, 0.5), 
                           0 0 40px rgba(139, 92, 246, 0.4), 
                           0 0 60px rgba(6, 182, 212, 0.3),
                           0 0 80px rgba(34, 197, 94, 0.2);
        }
        .mythic-frame::before {
            content: '';
            position: absolute;
            inset: -6px;
            border-radius: inherit;
            padding: 4px;
            background: linear-gradient(135deg, 
                #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3,
                #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3, #ff0000);
            background-size: 1400% 1400%;
            animation: rainbowBorder 4s linear infinite, rainbowPulse 2s ease-in-out infinite;
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            z-index: -1;
            filter: brightness(1.2) saturate(1.3);
        }
        .mythic-frame::after {
            content: '';
            position: absolute;
            inset: -15px;
            border-radius: inherit;
            background: 
                radial-gradient(circle at 15% 15%, #ff6b6b 2px, transparent 2px),
                radial-gradient(circle at 85% 25%, #feca57 2px, transparent 2px),
                radial-gradient(circle at 25% 75%, #48dbfb 2px, transparent 2px),
                radial-gradient(circle at 75% 85%, #ff9ff3 2px, transparent 2px),
                radial-gradient(circle at 50% 10%, #1dd1a1 2px, transparent 2px),
                radial-gradient(circle at 10% 50%, #5f27cd 2px, transparent 2px),
                radial-gradient(circle at 90% 60%, #ff6b6b 1.5px, transparent 1.5px),
                radial-gradient(circle at 40% 90%, #feca57 1.5px, transparent 1.5px);
            background-size: 100% 100%;
            animation: rainbowSparkles 3s ease-in-out infinite, rainbowRotate 15s linear infinite;
            pointer-events: none;
            z-index: 1;
            opacity: 0.8;
        }
        /* Aura exterior del marco arco√≠ris */
        .mythic-frame .rainbow-aura {
            position: absolute;
            inset: -25px;
            border-radius: inherit;
            background: conic-gradient(from 0deg, 
                rgba(255,0,0,0.15), rgba(255,127,0,0.15), rgba(255,255,0,0.15), 
                rgba(0,255,0,0.15), rgba(0,0,255,0.15), rgba(75,0,130,0.15), 
                rgba(148,0,211,0.15), rgba(255,0,0,0.15));
            animation: rainbowSpin 8s linear infinite;
            filter: blur(15px);
            pointer-events: none;
            z-index: -2;
        }
        @keyframes rainbowBorder {
            0% { background-position: 0% 50%; }
            25% { background-position: 50% 0%; }
            50% { background-position: 100% 50%; }
            75% { background-position: 50% 100%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes rainbowPulse {
            0%, 100% { filter: brightness(1.2) saturate(1.3); }
            50% { filter: brightness(1.5) saturate(1.5); }
        }
        @keyframes rainbowSparkles {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            33% { opacity: 1; transform: scale(1.05); }
            66% { opacity: 0.8; transform: scale(1.02); }
        }
        @keyframes rainbowRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes rainbowSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Marco C√≥smico para Pol√≠matas - ULTRA ANIMADO */
        .cosmic-frame {
            position: relative;
            --cosmic-glow: rgba(139, 92, 246, 0.6);
        }
        .cosmic-frame::before {
            content: '';
            position: absolute;
            inset: -5px;
            border-radius: inherit;
            padding: 4px;
            background: linear-gradient(45deg, #1e1b4b, #4c1d95, #7c3aed, #c026d3, #ec4899, #7c3aed, #4c1d95, #1e1b4b);
            background-size: 800% 800%;
            animation: cosmicBorder 6s ease infinite, cosmicPulse 2s ease-in-out infinite;
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            z-index: -1;
            filter: blur(0.5px);
        }
        .cosmic-frame::after {
            content: '';
            position: absolute;
            inset: -12px;
            border-radius: inherit;
            background: 
                radial-gradient(circle at 10% 10%, #fff 1px, transparent 1px),
                radial-gradient(circle at 90% 20%, #fff 1.5px, transparent 1.5px),
                radial-gradient(circle at 30% 80%, #fff 1px, transparent 1px),
                radial-gradient(circle at 70% 70%, #fff 2px, transparent 2px),
                radial-gradient(circle at 50% 50%, #fff 1px, transparent 1px),
                radial-gradient(circle at 20% 60%, #c084fc 1.5px, transparent 1.5px),
                radial-gradient(circle at 80% 40%, #a855f7 1px, transparent 1px),
                radial-gradient(circle at 60% 20%, #e879f9 1px, transparent 1px);
            background-size: 100% 100%;
            animation: cosmicStars 3s ease-in-out infinite, cosmicRotate 20s linear infinite;
            pointer-events: none;
            z-index: 1;
        }
        /* Nebulosa extra para cosmic frame */
        .cosmic-frame .cosmic-nebula,
        .cosmic-frame > *:first-child::before {
            content: '';
            position: absolute;
            inset: -20px;
            border-radius: 50%;
            background: radial-gradient(ellipse at center, rgba(139, 92, 246, 0.15) 0%, transparent 70%);
            animation: nebulaPulse 4s ease-in-out infinite;
            pointer-events: none;
            z-index: -2;
        }
        @keyframes cosmicBorder {
            0% { background-position: 0% 50%; }
            25% { background-position: 50% 100%; }
            50% { background-position: 100% 50%; }
            75% { background-position: 50% 0%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes cosmicPulse {
            0%, 100% { filter: blur(0.5px) brightness(1); }
            50% { filter: blur(1px) brightness(1.3); }
        }
        @keyframes cosmicStars {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.02); }
        }
        @keyframes cosmicRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes nebulaPulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
        }
        
        /* Marco Global para Clase Mundial - ULTRA ANIMADO */
        .global-frame {
            position: relative;
            --global-glow: rgba(6, 182, 212, 0.6);
        }
        .global-frame::before {
            content: '';
            position: absolute;
            inset: -5px;
            border-radius: inherit;
            padding: 4px;
            background: linear-gradient(90deg, #0891b2, #06b6d4, #22d3ee, #67e8f9, #a5f3fc, #67e8f9, #22d3ee, #06b6d4, #0891b2);
            background-size: 600% 100%;
            animation: globalBorder 4s linear infinite, globalGlow 2s ease-in-out infinite;
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            z-index: -1;
        }
        /* √ìrbita con sat√©lites */
        .global-frame::after {
            content: 'üõ∞Ô∏è';
            position: absolute;
            width: 100%;
            height: 100%;
            top: 50%;
            left: 50%;
            font-size: 14px;
            animation: satelliteOrbit 8s linear infinite;
            transform-origin: 0 0;
            pointer-events: none;
            z-index: 3;
        }
        /* Mundo giratorio principal */
        .global-frame .global-earth {
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 20px;
            animation: earthSpin 10s linear infinite, earthFloat 3s ease-in-out infinite;
            z-index: 4;
            filter: drop-shadow(0 0 8px rgba(6, 182, 212, 0.8));
        }
        /* Anillo de √≥rbita */
        .global-frame .orbit-ring {
            position: absolute;
            inset: -15px;
            border: 2px dashed rgba(6, 182, 212, 0.3);
            border-radius: 50%;
            animation: orbitRingSpin 15s linear infinite;
            pointer-events: none;
        }
        @keyframes globalBorder {
            0% { background-position: 0% 50%; }
            100% { background-position: 600% 50%; }
        }
        @keyframes globalGlow {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 3px var(--global-glow)); }
            50% { filter: brightness(1.2) drop-shadow(0 0 8px var(--global-glow)); }
        }
        @keyframes satelliteOrbit {
            0% { transform: rotate(0deg) translateX(calc(50% + 20px)) rotate(0deg); }
            100% { transform: rotate(360deg) translateX(calc(50% + 20px)) rotate(-360deg); }
        }
        @keyframes earthSpin {
            from { transform: rotateY(0deg); }
            to { transform: rotateY(360deg); }
        }
        @keyframes earthFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-3px) scale(1.1); }
        }
        @keyframes orbitRingSpin {
            from { transform: rotateX(60deg) rotateZ(0deg); }
            to { transform: rotateX(60deg) rotateZ(360deg); }
        }
        
        /* Marco Frutiger Aero - Estilo nost√°lgico Windows Vista/7 */
        .frutiger-frame {
            position: relative;
            --frutiger-glow: rgba(0, 255, 255, 0.6);
        }
        .frutiger-frame::before {
            content: '';
            position: absolute;
            inset: -6px;
            border-radius: inherit;
            padding: 5px;
            background: url('frutiger.gif') center/cover no-repeat;
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            z-index: -1;
            filter: brightness(1.2) saturate(1.3);
            animation: frutigerPulse 3s ease-in-out infinite;
        }
        .frutiger-frame::after {
            content: '';
            position: absolute;
            inset: -8px;
            border-radius: inherit;
            border: 3px solid transparent;
            background: linear-gradient(135deg, #00ffff, #00d4ff, #00a8cc, #00ffff) border-box;
            background-size: 400% 400%;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            animation: frutigerBorder 4s ease infinite;
            z-index: -2;
        }
        @keyframes frutigerPulse {
            0%, 100% { filter: brightness(1.2) saturate(1.3); transform: scale(1); }
            50% { filter: brightness(1.4) saturate(1.5); transform: scale(1.02); }
        }
        @keyframes frutigerBorder {
            0%, 100% { background-position: 0% 50%; box-shadow: 0 0 15px rgba(0, 255, 255, 0.5), 0 0 30px rgba(0, 212, 255, 0.3); }
            50% { background-position: 100% 50%; box-shadow: 0 0 25px rgba(0, 255, 255, 0.7), 0 0 50px rgba(0, 212, 255, 0.4); }
        }
        /* Efecto de burbujas/gotas para frutiger */
        .frutiger-bubbles {
            position: absolute;
            inset: -15px;
            pointer-events: none;
            overflow: hidden;
            border-radius: inherit;
        }
        .frutiger-bubbles::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4) 0%, transparent 50%),
                        radial-gradient(circle at 70% 60%, rgba(0,255,255,0.2) 0%, transparent 40%);
            animation: bubbleFloat 6s ease-in-out infinite;
        }
        @keyframes bubbleFloat {
            0%, 100% { transform: translate(-10%, -10%) rotate(0deg); }
            50% { transform: translate(10%, 10%) rotate(180deg); }
        }
        
        /* Overlay de Fundador - Se agrega ENCIMA del marco existente sin reemplazarlo */
        .founder-overlay {
            position: relative;
        }
        /* Corona flotante del fundador - siempre visible */
        .founder-overlay .founder-crown {
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #d97706);
            border-radius: 50%;
            border: 2px solid #fcd34d;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.8), 0 0 30px rgba(245, 158, 11, 0.5), inset 0 0 10px rgba(255, 255, 255, 0.3);
            animation: crownFloat 2s ease-in-out infinite, crownGlow 1.5s ease-in-out infinite;
            z-index: 100;
            pointer-events: none;
        }
        .founder-overlay .founder-crown i {
            filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.8));
            color: #fff !important;
        }
        /* Part√≠culas doradas flotantes */
        .founder-overlay .founder-sparkles {
            position: absolute;
            inset: -10px;
            border-radius: inherit;
            background: 
                radial-gradient(circle at 10% 15%, #ffd700 2px, transparent 2px),
                radial-gradient(circle at 90% 20%, #ffed4a 1.5px, transparent 1.5px),
                radial-gradient(circle at 20% 85%, #f59e0b 1.5px, transparent 1.5px),
                radial-gradient(circle at 80% 80%, #fbbf24 2px, transparent 2px),
                radial-gradient(circle at 5% 50%, #fcd34d 1.5px, transparent 1.5px),
                radial-gradient(circle at 95% 55%, #ffd700 1.5px, transparent 1.5px);
            background-size: 100% 100%;
            animation: founderSparkles 2s ease-in-out infinite, founderRotate 15s linear infinite;
            pointer-events: none;
            z-index: 50;
            opacity: 0.8;
        }
        /* Aura dorada suave */
        .founder-overlay .founder-aura {
            position: absolute;
            inset: -20px;
            border-radius: inherit;
            background: radial-gradient(ellipse at center, rgba(255, 215, 0, 0.15) 0%, transparent 70%);
            animation: founderAuraPulse 3s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }
        /* Rayos de luz sutiles */
        .founder-overlay .light-rays {
            position: absolute;
            inset: -25px;
            background: conic-gradient(from 0deg, 
                transparent, rgba(255, 215, 0, 0.1), transparent, 
                rgba(255, 215, 0, 0.08), transparent, rgba(255, 215, 0, 0.1), 
                transparent, rgba(255, 215, 0, 0.08), transparent);
            animation: raysRotate 12s linear infinite;
            pointer-events: none;
            z-index: -2;
            border-radius: inherit;
        }
        @keyframes founderSparkles {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.03); }
        }
        @keyframes founderRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes crownFloat {
            0%, 100% { transform: translateX(-50%) translateY(0) rotate(-5deg); }
            50% { transform: translateX(-50%) translateY(-6px) rotate(5deg); }
        }
        @keyframes crownGlow {
            0%, 100% { filter: drop-shadow(0 0 8px gold) drop-shadow(0 0 15px rgba(255, 215, 0, 0.5)); }
            50% { filter: drop-shadow(0 0 15px gold) drop-shadow(0 0 30px rgba(255, 215, 0, 0.7)); }
        }
        @keyframes founderAuraPulse {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }
        @keyframes raysRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Animaciones adicionales para tarjetas m√≠ticas */
        @keyframes shootingStar {
            0% { transform: translateX(-100px) translateY(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateX(400px) translateY(20px); opacity: 0; }
        }
        @keyframes flyAround {
            0% { top: 20%; left: -10%; transform: rotate(15deg); }
            25% { top: 10%; left: 50%; transform: rotate(0deg); }
            50% { top: 30%; left: 110%; transform: rotate(-15deg); }
            75% { top: 60%; left: 50%; transform: rotate(0deg); }
            100% { top: 20%; left: -10%; transform: rotate(15deg); }
        }
        @keyframes cloudMove {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(400%); }
        }
        
        /* Animaci√≥n de gradiente para headers */
        .animate-gradient-x {
            background-size: 200% 200%;
            animation: gradientX 3s ease infinite;
        }
        @keyframes gradientX {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        /* Animaci√≥n lenta de spin */
        .animate-spin-slow {
            animation: spin 8s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Animaci√≥n de burbujas flotantes para Frutiger Aero */
        .animate-float-bubble {
            animation: floatBubble 4s ease-in-out infinite;
        }
        @keyframes floatBubble {
            0% { 
                transform: translateY(0) scale(1); 
                opacity: 0.6;
            }
            50% { 
                transform: translateY(-50px) scale(1.1); 
                opacity: 0.8;
            }
            100% { 
                transform: translateY(-100px) scale(0.8); 
                opacity: 0;
            }
        }
        
        /* Photo Gallery Styles */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
        }
        .gallery-item {
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        .gallery-item:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .gallery-item::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.5) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .gallery-item:hover::after {
            opacity: 1;
        }

        /* Editable Areas Hover (Para el CMS Admin) */
        .cms-editable:hover {
            outline: 2px dashed #D4AF37;
            cursor: context-menu;
            position: relative;
        }
        .cms-editable:hover::after {
            content: "‚úé Editar"; position: absolute; top: -20px; right: 0;
            background: #D4AF37; color: white; font-size: 10px; padding: 2px 6px;
            font-family: monospace; border-radius: 4px; pointer-events: none;
        }

        /* Hide Scrollbar for specific containers */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { 
            -ms-overflow-style: none; 
            scrollbar-width: none; 
        }
        
        /* Project Detail Modal Styles */
        .project-detail-modal {
            -webkit-overflow-scrolling: touch;
        }
        .project-detail-modal::-webkit-scrollbar {
            width: 6px;
        }
        .project-detail-modal::-webkit-scrollbar-track {
            background: transparent;
        }
        .project-detail-modal::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.15);
            border-radius: 3px;
        }
        .project-detail-modal::-webkit-scrollbar-thumb:hover {
            background: rgba(0,0,0,0.25);
        }
        
        /* Smooth scroll sections */
        .scroll-mt-4 {
            scroll-margin-top: 1rem;
        }
        
        /* Line clamp utility */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Safe area for mobile */
        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            .project-detail-container .swal2-popup {
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
        
        /* Notification animations */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideInDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Watermark Logo */
        .watermark-logo {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 80px;
            height: auto;
            opacity: 0.15;
            z-index: 40;
            pointer-events: none;
            filter: grayscale(100%);
            transition: all 0.5s ease;
        }
        .watermark-logo:hover {
            opacity: 0.4;
            filter: grayscale(0%);
        }

        /* Advanced Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(2deg); }
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(212, 175, 55, 0.3); }
            50% { box-shadow: 0 0 40px rgba(212, 175, 55, 0.6); }
        }
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes slide-in-left {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes slide-in-right {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(40px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes text-shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        .animate-float { animation: float 6s ease-in-out infinite; }
        .animate-pulse-glow { animation: pulse-glow 3s ease-in-out infinite; }
        .animate-gradient { background-size: 200% auto; animation: gradient-shift 4s ease infinite; }
        .animate-slide-left { animation: slide-in-left 0.8s ease-out forwards; }
        .animate-slide-right { animation: slide-in-right 0.8s ease-out forwards; }
        .animate-fade-up { animation: fade-in-up 0.6s ease-out forwards; }
        .text-shimmer {
            background: linear-gradient(90deg, #D4AF37, #FFD700, #D4AF37);
            background-size: 200% auto;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: text-shimmer 3s linear infinite;
        }

        /* Glassmorphism Cards */
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Gradient Border Effect */
        .gradient-border {
            position: relative;
            background: white;
        }
        .gradient-border::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(135deg, #1B396A, #D4AF37, #1B396A);
            border-radius: inherit;
            z-index: -1;
            animation: gradient-shift 4s ease infinite;
            background-size: 200% auto;
        }

        /* Particle Effect Background */
        .particles-bg {
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(27, 57, 106, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(212, 175, 55, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(27, 57, 106, 0.05) 0%, transparent 30%);
        }

        /* Tech Grid Pattern */
        .tech-grid {
            background-image: 
                linear-gradient(rgba(27, 57, 106, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(27, 57, 106, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        /* Stat Counter Effect */
        .stat-card {
            position: relative;
            overflow: hidden;
        }
        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.1), transparent);
            transition: left 0.5s ease;
        }
        .stat-card:hover::after {
            left: 100%;
        }

        /* ========== MOBILE RESPONSIVE STYLES ========== */
        
        /* Mobile Menu */
        .mobile-menu {
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .mobile-menu.active {
            transform: translateX(0);
        }
        .mobile-menu-overlay {
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .mobile-menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Hamburger Animation */
        .hamburger-line {
            transition: all 0.3s ease;
        }
        .hamburger.active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        .hamburger.active .hamburger-line:nth-child(2) {
            opacity: 0;
        }
        .hamburger.active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -5px);
        }

        /* Mobile Text Sizes */
        @media (max-width: 640px) {
            .hero-title-mobile {
                font-size: 2.5rem !important;
                line-height: 1 !important;
            }
            .section-title-mobile {
                font-size: 1.75rem !important;
            }
        }

        /* Fix for iOS input zoom */
        @media (max-width: 768px) {
            input, select, textarea {
                font-size: 16px !important;
            }
        }

        /* Mobile card improvements */
        @media (max-width: 768px) {
            .card-tech, .project-card {
                transform: none !important;
            }
            .card-tech:hover, .project-card:hover {
                transform: none !important;
            }
        }

        /* Bottom Navigation for Mobile */
        .mobile-bottom-nav {
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="antialiased selection:bg-tec-blue selection:text-white">

    <!-- === PANTALLA DE CARGA DEL SISTEMA === -->
    <div id="sys-loader" class="fixed inset-0 z-[10000] bg-white flex flex-col items-center justify-center font-sans">
        <div class="relative">
            <div class="loader-circuit"></div>
            <div class="absolute inset-0 flex items-center justify-center font-bold text-tec-blue text-xs">ITM</div>
        </div>
        <h2 class="mt-4 text-tec-blue font-black tracking-[0.3em] text-sm animate-pulse">CARGANDO RECURSOS...</h2>
        <p class="text-[10px] text-slate-400 mt-2 font-mono" id="loader-log">Inicializando Firebase SDK...</p>
    </div>

    <!-- === NAVEGACI√ìN PRINCIPAL (GLASSMOPHISM) === -->
    <header class="fixed top-0 w-full z-50 glass-header h-20 transition-all duration-300">
        <div class="container mx-auto px-6 h-full flex items-center justify-between">
            
            <!-- Logo Din√°mico -->
            <div class="flex items-center gap-2 sm:gap-4 cursor-pointer" onclick="Router.to('landing')">
                <img src="logotec.png" alt="TecNM" class="h-8 sm:h-12 w-auto object-contain">
                <div class="h-6 sm:h-8 w-px bg-slate-300 hidden sm:block"></div>
                <div class="flex items-center gap-2 sm:gap-3">
                    <img src="robot.gif" alt="CRAI" class="h-8 w-8 sm:h-10 sm:w-10 object-contain rounded">
                    <div class="leading-none hidden sm:block">
                        <span class="block text-xl font-black text-tec-blue tracking-tighter">CRAI <span class="text-tec-gold">SYS</span></span>
                        <span class="block text-[8px] font-bold text-slate-500 uppercase tracking-widest">TecNM Mexicali</span>
                    </div>
                </div>
            </div>

            <!-- Navegaci√≥n P√∫blica -->
            <nav class="hidden lg:flex gap-8 text-[11px] font-bold uppercase tracking-widest text-slate-500">
                <a href="#projects" onclick="Router.to('public-projects')" class="hover:text-tec-blue transition-colors cursor-pointer">Proyectos</a>
                <a href="#events" onclick="Router.to('public-events')" class="hover:text-tec-gold transition-colors cursor-pointer">Eventos</a>
                <a href="#donate" onclick="Router.to('public-donate')" class="hover:text-tec-gold transition-colors cursor-pointer">Donaciones y Patrocinios</a>
                <a href="#join" onclick="Router.to('public-join')" class="hover:text-tec-blue transition-colors cursor-pointer">Unirse al Club</a>
                <a href="#" onclick="Router.to('members')" class="hover:text-tec-gold transition-colors cursor-pointer">Miembros</a>
            </nav>

            <!-- √Årea de Usuario / Auth -->
            <div class="flex items-center gap-2 sm:gap-4">
                <!-- Icono de Notificaciones (solo usuarios logueados) -->
                <div id="notifications-btn" class="hidden relative">
                    <button onclick="NotificationSystem.toggle()" class="relative w-10 h-10 bg-slate-100 hover:bg-slate-200 rounded-xl flex items-center justify-center transition-all group">
                        <i data-lucide="bell" class="w-5 h-5 text-slate-600 group-hover:text-tec-blue transition"></i>
                        <span id="notification-badge" class="hidden absolute -top-1 -right-1 min-w-[18px] h-[18px] bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center px-1 animate-pulse">0</span>
                    </button>
                </div>
                
                <div id="user-pill" class="hidden items-center gap-2 sm:gap-3 bg-slate-100 px-2 sm:px-4 py-2 rounded-full border border-slate-200 cursor-pointer hover:bg-slate-200 transition" onclick="Auth.toggleProfile()">
                    <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                    <span class="text-xs font-bold text-tec-blue hidden sm:inline" id="pill-username">Cargando...</span>
                </div>
                
                <button id="login-btn" onclick="Modal.open('auth')" class="flex bg-tec-blue hover:bg-tec-dark text-white px-4 sm:px-6 py-2 rounded font-bold text-xs shadow-lg transition-all items-center gap-2">
                    <i data-lucide="log-in" class="w-4 h-4"></i>
                    <span class="hidden sm:inline">ACCESO OFICIAL</span>
                </button>

                <!-- Hamburger Menu Button (Mobile) -->
                <button id="hamburger-btn" onclick="MobileMenu.toggle()" class="lg:hidden flex flex-col justify-center items-center w-10 h-10 rounded-lg bg-slate-100 hover:bg-slate-200 transition hamburger">
                    <span class="hamburger-line w-5 h-0.5 bg-tec-blue mb-1"></span>
                    <span class="hamburger-line w-5 h-0.5 bg-tec-blue mb-1"></span>
                    <span class="hamburger-line w-5 h-0.5 bg-tec-blue"></span>
                </button>
            </div>
        </div>
    </header>

    <!-- Panel de Notificaciones -->
    <div id="notifications-panel" class="hidden fixed top-20 right-4 sm:right-6 w-[calc(100vw-32px)] sm:w-96 max-h-[70vh] bg-white rounded-2xl shadow-2xl border border-slate-200 z-[55] overflow-hidden animate-[fadeIn_0.2s]">
        <!-- Header del Panel -->
        <div class="bg-gradient-to-r from-tec-blue to-indigo-600 p-4 text-white">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                        <i data-lucide="bell" class="w-5 h-5"></i>
                    </div>
                    <div>
                        <h3 class="font-bold">Notificaciones</h3>
                        <p class="text-blue-200 text-xs" id="notifications-count">0 nuevas</p>
                    </div>
                </div>
                <button onclick="NotificationSystem.markAllAsRead()" class="text-xs bg-white/20 hover:bg-white/30 px-3 py-1.5 rounded-lg font-bold transition">
                    Marcar todas
                </button>
            </div>
        </div>
        
        <!-- Lista de Notificaciones -->
        <div id="notifications-list" class="max-h-[calc(70vh-140px)] overflow-y-auto">
            <div class="p-8 text-center text-slate-400">
                <i data-lucide="bell-off" class="w-12 h-12 mx-auto mb-3 opacity-50"></i>
                <p class="text-sm font-medium">Sin notificaciones</p>
                <p class="text-xs">Te avisaremos cuando haya actividad</p>
            </div>
        </div>
        
        <!-- Footer del Panel -->
        <div class="p-3 border-t border-slate-100 bg-slate-50">
            <button onclick="NotificationSystem.clearAll()" class="w-full py-2 text-xs font-bold text-slate-500 hover:text-red-500 transition flex items-center justify-center gap-2">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
                Limpiar todas las notificaciones
            </button>
        </div>
    </div>
    
    <!-- Overlay para cerrar notificaciones -->
    <div id="notifications-overlay" class="hidden fixed inset-0 z-[54]" onclick="NotificationSystem.close()"></div>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu-overlay" class="mobile-menu-overlay fixed inset-0 bg-black/50 z-[60]" onclick="MobileMenu.close()"></div>

    <!-- Mobile Menu Drawer -->
    <div id="mobile-menu" class="mobile-menu fixed top-0 right-0 h-full w-72 sm:w-80 bg-white z-[70] shadow-2xl">
        <div class="flex flex-col h-full">
            <!-- Header -->
            <div class="p-4 border-b border-slate-100 flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <img src="robot.gif" alt="CRAI" class="h-8 w-8 object-contain rounded">
                    <span class="font-black text-tec-blue">CRAI</span>
                </div>
                <button onclick="MobileMenu.close()" class="w-10 h-10 rounded-lg bg-slate-100 flex items-center justify-center hover:bg-slate-200 transition">
                    <i data-lucide="x" class="w-5 h-5 text-slate-600"></i>
                </button>
            </div>

            <!-- Navigation Links -->
            <nav class="flex-1 p-4 overflow-y-auto">
                <div class="space-y-2">
                    <a href="#" onclick="MobileMenu.navigateTo('landing')" class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 font-bold text-sm transition">
                        <i data-lucide="home" class="w-5 h-5 text-tec-blue"></i>
                        Inicio
                    </a>
                    <a href="#" onclick="MobileMenu.navigateTo('public-projects')" class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 font-bold text-sm transition">
                        <i data-lucide="folder" class="w-5 h-5 text-tec-blue"></i>
                        Proyectos
                    </a>
                    <a href="#" onclick="MobileMenu.navigateTo('public-events')" class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 font-bold text-sm transition">
                        <i data-lucide="calendar" class="w-5 h-5 text-tec-gold"></i>
                        Eventos
                    </a>
                    <a href="#" onclick="MobileMenu.navigateTo('public-donate')" class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 font-bold text-sm transition">
                        <i data-lucide="heart" class="w-5 h-5 text-tec-gold"></i>
                        Donaciones y Patrocinios
                    </a>
                    <a href="#" onclick="MobileMenu.navigateTo('public-join')" class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 font-bold text-sm transition">
                        <i data-lucide="user-plus" class="w-5 h-5 text-tec-blue"></i>
                        Unirse al Club
                    </a>
                    <a href="#" onclick="MobileMenu.navigateTo('members')" class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 font-bold text-sm transition">
                        <i data-lucide="users" class="w-5 h-5 text-tec-gold"></i>
                        Miembros
                    </a>
                </div>

                <!-- Divider -->
                <div class="my-4 border-t border-slate-100"></div>

                <!-- User Section (when logged in) -->
                <div id="mobile-menu-user" class="hidden">
                    <p class="px-4 text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">Mi Cuenta</p>
                    <a href="#" onclick="MobileMenu.navigateTo('dashboard')" class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 font-bold text-sm transition">
                        <i data-lucide="layout-dashboard" class="w-5 h-5 text-tec-blue"></i>
                        Dashboard
                    </a>
                    <a href="#" onclick="MobileMenu.navigateTo('resources')" class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 font-bold text-sm transition">
                        <i data-lucide="book-open" class="w-5 h-5 text-tec-blue"></i>
                        Recursos
                    </a>
                    <button onclick="Auth.logout(); MobileMenu.close();" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-red-500 hover:bg-red-50 font-bold text-sm transition mt-2">
                        <i data-lucide="log-out" class="w-5 h-5"></i>
                        Cerrar Sesi√≥n
                    </button>
                </div>
            </nav>

            <!-- Login Button (when not logged in) -->
            <div id="mobile-menu-login" class="p-4 border-t border-slate-100">
                <button onclick="Modal.open('auth'); MobileMenu.close();" class="w-full bg-tec-blue hover:bg-tec-dark text-white px-6 py-3 rounded-xl font-bold text-sm shadow-lg transition-all flex items-center justify-center gap-2">
                    <i data-lucide="log-in" class="w-5 h-5"></i>
                    ACCESO OFICIAL
                </button>
            </div>
        </div>
    </div>

    <!-- === CONTENEDOR PRINCIPAL SPA (Views Injection) === -->
    <main id="app-root" class="pt-20 min-h-screen relative overflow-hidden">
        
        <!-- ==============================
             VISTA 1: HERO & LANDING (P√öBLICO)
             (Preparado para inyecci√≥n CMS)
             ============================== -->
        <section id="view-landing" class="view-section active animate-fade-in">
            
            <!-- Hero Area -->
            <div class="relative bg-gradient-to-br from-slate-50 via-white to-blue-50/30 min-h-[90vh] flex items-center border-b border-slate-100 overflow-hidden">
                <!-- Animated Background Elements -->
                <div class="absolute inset-0">
                    <!-- Grid Pattern -->
                    <div class="absolute inset-0 opacity-[0.03]" style="background-image: linear-gradient(#1B396A 1px, transparent 1px), linear-gradient(90deg, #1B396A 1px, transparent 1px); background-size: 60px 60px;"></div>
                    
                    <!-- Animated Gradient Orbs -->
                    <div class="absolute top-0 right-0 w-[700px] h-[700px] bg-gradient-to-br from-tec-blue/10 to-purple-500/5 rounded-full blur-3xl animate-pulse"></div>
                    <div class="absolute -bottom-40 -left-40 w-[600px] h-[600px] bg-gradient-to-tr from-tec-gold/10 to-orange-500/5 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-gradient-to-r from-blue-500/5 via-transparent to-tec-gold/5 rounded-full blur-3xl"></div>
                    
                    <!-- Floating Geometric Shapes -->
                    <div class="absolute top-20 left-[10%] w-4 h-4 border-2 border-tec-gold/30 rotate-45 animate-float"></div>
                    <div class="absolute top-40 right-[15%] w-3 h-3 bg-tec-blue/20 rounded-full animate-float" style="animation-delay: 0.5s;"></div>
                    <div class="absolute bottom-32 left-[20%] w-2 h-2 bg-tec-gold/30 rounded-full animate-ping"></div>
                    <div class="absolute top-1/3 left-[5%] w-6 h-6 border border-tec-blue/20 rounded-lg rotate-12 animate-float" style="animation-delay: 1s;"></div>
                    <div class="absolute bottom-1/4 right-[8%] w-5 h-5 border-2 border-tec-gold/20 rounded-full animate-float" style="animation-delay: 1.5s;"></div>
                </div>
                
                <div class="container mx-auto px-4 sm:px-6 py-12 lg:py-0 relative z-10">
                    <div class="grid lg:grid-cols-2 gap-8 lg:gap-12 items-center">
                        <!-- Content Side -->
                        <div class="space-y-6 sm:space-y-8">
                            <!-- Badge Animated -->
                            <div class="inline-flex items-center gap-2 sm:gap-3 bg-white/90 backdrop-blur-md px-4 py-2.5 rounded-full border border-slate-200/80 shadow-lg shadow-slate-200/50 hover:shadow-xl transition-shadow duration-300">
                                <span class="relative flex h-2.5 w-2.5">
                                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-500 opacity-75"></span>
                                    <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"></span>
                                </span>
                                <span class="text-[10px] sm:text-[11px] font-bold uppercase tracking-wider text-slate-600">Convocatoria 2026</span>
                                <span class="text-[8px] sm:text-[9px] bg-gradient-to-r from-tec-blue to-blue-600 text-white px-2.5 py-1 rounded-full font-bold animate-pulse">ABIERTA</span>
                            </div>
                            
                            <!-- T√≠tulo Principal con Animaciones -->
                            <div>
                                <h1 class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-black leading-[0.9] tracking-tight">
                                    <span class="block text-tec-blue animate-fade-up" style="animation-delay: 0.1s;">CRAI</span>
                                    <span class="block text-transparent bg-clip-text bg-gradient-to-r from-tec-gold via-yellow-500 to-orange-500 animate-fade-up" style="animation-delay: 0.2s;">CLUB DE ROB√ìTICA</span>
                                    <span class="block text-slate-800 animate-fade-up" style="animation-delay: 0.3s;">AVANZADA</span>
                                </h1>
                                <div class="flex items-center gap-3 mt-4 sm:mt-6 animate-fade-up" style="animation-delay: 0.4s;">
                                    <div class="w-10 sm:w-16 h-[2px] bg-gradient-to-r from-tec-gold via-orange-500 to-transparent"></div>
                                    <span class="text-xs sm:text-sm font-semibold text-slate-400 uppercase tracking-wider">& Inteligencia Artificial</span>
                                </div>
                            </div>
                            
                            <!-- Descripci√≥n -->
                            <p id="cms-hero-desc" class="text-sm sm:text-base lg:text-lg text-slate-600 leading-relaxed max-w-xl cms-editable animate-fade-up" data-cms-key="hero_desc" style="animation-delay: 0.5s;">
                                Nodo oficial de desarrollo tecnol√≥gico del <strong class="text-tec-blue font-semibold">Edificio T</strong>. Impulsando la rob√≥tica de competencia y la inteligencia artificial aplicada en el <strong class="text-tec-blue font-semibold">TecNM Mexicali</strong>.
                            </p>

                            <!-- Botones con Efectos -->
                            <div class="flex flex-wrap gap-3 pt-2 animate-fade-up" style="animation-delay: 0.6s;">
                                <button onclick="Router.to('public-projects')" class="group relative px-5 sm:px-7 py-3 sm:py-3.5 bg-gradient-to-r from-tec-blue to-blue-600 text-white rounded-xl font-bold text-xs sm:text-sm shadow-lg shadow-tec-blue/30 hover:shadow-xl hover:shadow-tec-blue/40 hover:-translate-y-0.5 transition-all duration-300 flex items-center gap-2 overflow-hidden">
                                    <div class="absolute inset-0 bg-gradient-to-r from-blue-600 to-tec-dark opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                                    <i data-lucide="rocket" class="w-4 h-4 relative z-10 group-hover:animate-bounce"></i>
                                    <span class="relative z-10">VER PROYECTOS</span>
                                </button>
                                <button onclick="Router.to('public-donate')" class="group px-5 sm:px-7 py-3 sm:py-3.5 bg-white border-2 border-slate-200 text-slate-700 rounded-xl font-bold text-xs sm:text-sm hover:border-tec-gold hover:text-tec-gold hover:shadow-lg hover:-translate-y-0.5 transition-all duration-300 flex items-center gap-2">
                                    <i data-lucide="heart" class="w-4 h-4 group-hover:text-red-500 group-hover:scale-110 transition-all"></i>
                                    <span>PATROCINAR</span>
                                </button>
                                <button onclick="Router.to('public-join')" class="group relative px-5 sm:px-7 py-3 sm:py-3.5 bg-gradient-to-r from-tec-gold via-yellow-500 to-orange-500 text-black rounded-xl font-bold text-xs sm:text-sm shadow-lg shadow-tec-gold/30 hover:shadow-xl hover:shadow-orange-500/40 hover:-translate-y-0.5 transition-all duration-300 flex items-center gap-2 overflow-hidden">
                                    <i data-lucide="user-plus" class="w-4 h-4 relative z-10"></i>
                                    <span class="relative z-10">√öNETE</span>
                                </button>
                            </div>

                            <!-- Stats Row Mejorados -->
                            <div class="flex flex-wrap gap-4 sm:gap-6 pt-6 sm:pt-8 border-t border-slate-200/50 animate-fade-up" style="animation-delay: 0.7s;">
                                <div class="group flex items-center gap-3 bg-white/50 backdrop-blur-sm p-3 rounded-2xl border border-slate-100 hover:border-tec-blue/30 hover:shadow-lg transition-all duration-300">
                                    <div class="w-12 h-12 bg-gradient-to-br from-tec-blue/20 to-blue-500/10 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i data-lucide="users" class="w-6 h-6 text-tec-blue"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl sm:text-3xl font-black text-tec-blue" id="members-count-stat">0</p>
                                        <p class="text-[10px] sm:text-xs text-slate-500 font-medium">Miembros Activos</p>
                                    </div>
                                </div>
                                <div class="group flex items-center gap-3 bg-white/50 backdrop-blur-sm p-3 rounded-2xl border border-slate-100 hover:border-green-500/30 hover:shadow-lg transition-all duration-300">
                                    <div class="w-12 h-12 bg-gradient-to-br from-green-100 to-emerald-100 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i data-lucide="clock" class="w-6 h-6 text-green-600"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl sm:text-3xl font-black text-green-600" id="cms-stat-3" data-cms-key="stat_3">24/7</p>
                                        <p class="text-[10px] sm:text-xs text-slate-500 font-medium">Acceso al Lab</p>
                                    </div>
                                </div>
                                <div class="group flex items-center gap-3 bg-white/50 backdrop-blur-sm p-3 rounded-2xl border border-slate-100 hover:border-tec-gold/30 hover:shadow-lg transition-all duration-300">
                                    <div class="w-12 h-12 bg-gradient-to-br from-tec-gold/20 to-orange-500/10 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i data-lucide="trophy" class="w-6 h-6 text-tec-gold"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl sm:text-3xl font-black text-tec-gold">10+</p>
                                        <p class="text-[10px] sm:text-xs text-slate-500 font-medium">Competencias</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Visual Side - Dise√±o Premium -->
                        <div class="hidden lg:block relative animate-fade-up" style="animation-delay: 0.3s;">
                            <!-- Main Image Container with Effects -->
                            <div class="relative group">
                                <!-- Animated Background Glow -->
                                <div class="absolute -inset-6 bg-gradient-to-r from-tec-blue/20 via-purple-500/10 to-tec-gold/20 rounded-[2rem] blur-2xl opacity-60 group-hover:opacity-80 transition-opacity duration-500 animate-pulse"></div>
                                
                                <!-- Decorative Frame Lines -->
                                <div class="absolute -inset-3 rounded-[2rem] border-2 border-dashed border-tec-blue/10 group-hover:border-tec-blue/20 group-hover:rotate-1 transition-all duration-500"></div>
                                <div class="absolute -inset-6 rounded-[2.5rem] border border-tec-gold/10 group-hover:border-tec-gold/20 group-hover:-rotate-1 transition-all duration-500"></div>
                                
                                <!-- Main Image -->
                                <div class="relative overflow-hidden rounded-3xl">
                                    <img src="https://images.unsplash.com/photo-1485827404703-89b55fcc595e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" 
                                         class="relative w-full h-[520px] object-cover transition-transform duration-700 group-hover:scale-105" 
                                         alt="Laboratorio CRAI">
                                    
                                    <!-- Multi-layer Overlays -->
                                    <div class="absolute inset-0 bg-gradient-to-t from-slate-900/70 via-slate-900/20 to-transparent"></div>
                                    <div class="absolute inset-0 bg-gradient-to-br from-tec-blue/20 via-transparent to-tec-gold/10 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                                    
                                    <!-- Animated Scan Line -->
                                    <div class="absolute inset-0 overflow-hidden">
                                        <div class="absolute w-full h-[2px] bg-gradient-to-r from-transparent via-tec-gold/50 to-transparent top-0 animate-scan"></div>
                                    </div>
                                    
                                    <!-- Corner Accents -->
                                    <div class="absolute top-4 left-4 w-8 h-8 border-l-2 border-t-2 border-white/40 rounded-tl-lg"></div>
                                    <div class="absolute top-4 right-4 w-8 h-8 border-r-2 border-t-2 border-white/40 rounded-tr-lg"></div>
                                    <div class="absolute bottom-4 left-4 w-8 h-8 border-l-2 border-b-2 border-white/40 rounded-bl-lg"></div>
                                    <div class="absolute bottom-4 right-4 w-8 h-8 border-r-2 border-b-2 border-white/40 rounded-br-lg"></div>
                                    
                                    <!-- Bottom Info Bar -->
                                    <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-slate-900/90 to-transparent">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                                <span class="text-white/90 text-xs font-medium">Sistema Activo</span>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <span class="text-white/60 text-[10px] font-mono">LAT: 32.6519¬∞N</span>
                                                <span class="text-white/60 text-[10px] font-mono">LON: 115.4683¬∞W</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Floating Elements Around Image -->
                                <!-- Tech Badge Top Right -->
                                <div class="absolute -top-5 -right-5 bg-white/95 backdrop-blur-xl p-4 rounded-2xl shadow-2xl border border-slate-100 transform hover:scale-105 hover:-rotate-2 transition-all duration-300">
                                    <div class="flex items-center gap-3">
                                        <div class="relative">
                                            <div class="w-12 h-12 bg-gradient-to-br from-tec-blue via-blue-600 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                                                <i data-lucide="bot" class="w-6 h-6 text-white"></i>
                                            </div>
                                            <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white animate-pulse"></div>
                                        </div>
                                        <div>
                                            <p class="text-[9px] text-tec-gold font-bold uppercase tracking-wider">AI Powered</p>
                                            <p class="text-slate-800 font-bold text-sm">Lab Activo</p>
                                            <div class="flex gap-1 mt-1">
                                                <div class="w-1 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                                <div class="w-1 h-3 bg-green-400 rounded-full animate-pulse" style="animation-delay: 0.1s;"></div>
                                                <div class="w-1 h-3 bg-green-300 rounded-full animate-pulse" style="animation-delay: 0.2s;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Project Card Bottom Left -->
                                <div class="absolute -bottom-8 -left-8 bg-white/95 backdrop-blur-xl p-5 rounded-2xl shadow-2xl border border-slate-100 max-w-[300px] transform hover:scale-105 hover:rotate-1 transition-all duration-300">
                                    <div class="flex items-center gap-4 mb-4">
                                        <div class="relative">
                                            <div class="w-14 h-14 bg-gradient-to-br from-tec-gold via-yellow-500 to-orange-500 rounded-xl flex items-center justify-center shadow-lg">
                                                <i data-lucide="cpu" class="w-7 h-7 text-white"></i>
                                            </div>
                                            <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-tec-blue rounded-full border-2 border-white flex items-center justify-center">
                                                <i data-lucide="check" class="w-3 h-3 text-white"></i>
                                            </div>
                                        </div>
                                        <div>
                                            <p class="text-[9px] text-tec-gold font-bold uppercase tracking-wider">Proyecto Destacado</p>
                                            <p class="text-slate-800 font-bold text-base">Brazo Rob√≥tico V9</p>
                                            <p class="text-[10px] text-slate-500">√öltima actualizaci√≥n: Hace 2h</p>
                                        </div>
                                    </div>
                                    <!-- Team & Progress -->
                                    <div class="space-y-3">
                                        <div class="flex items-center justify-between">
                                            <div class="flex -space-x-2">
                                                <img src="https://ui-avatars.com/api/?name=JG&background=1B396A&color=fff&size=28" class="w-7 h-7 rounded-full border-2 border-white" alt="">
                                                <img src="https://ui-avatars.com/api/?name=MR&background=D4AF37&color=fff&size=28" class="w-7 h-7 rounded-full border-2 border-white" alt="">
                                                <img src="https://ui-avatars.com/api/?name=LP&background=22c55e&color=fff&size=28" class="w-7 h-7 rounded-full border-2 border-white" alt="">
                                                <div class="w-7 h-7 bg-slate-100 rounded-full border-2 border-white flex items-center justify-center text-[9px] font-bold text-slate-600">+5</div>
                                            </div>
                                            <span class="text-xs font-bold text-tec-blue flex items-center gap-1">
                                                <i data-lucide="trending-up" class="w-3 h-3"></i>
                                                78%
                                            </span>
                                        </div>
                                        <!-- Progress Bar Animated -->
                                        <div class="relative h-2 bg-slate-100 rounded-full overflow-hidden">
                                            <div class="absolute inset-y-0 left-0 w-[78%] bg-gradient-to-r from-tec-blue via-blue-500 to-tec-gold rounded-full">
                                                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-shimmer"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Floating Mini Stats -->
                                <div class="absolute top-1/3 -left-4 bg-white/90 backdrop-blur-sm px-3 py-2 rounded-xl shadow-lg border border-slate-100 transform hover:scale-110 transition-transform">
                                    <div class="flex items-center gap-2">
                                        <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                            <i data-lucide="zap" class="w-4 h-4 text-green-600"></i>
                                        </div>
                                        <div>
                                            <p class="text-xs font-bold text-slate-800">99.9%</p>
                                            <p class="text-[8px] text-slate-500">Uptime</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Code Snippet Badge -->
                                <div class="absolute top-1/2 -right-3 bg-slate-900/95 backdrop-blur-sm px-3 py-2 rounded-lg shadow-lg border border-slate-700 font-mono text-[10px] text-green-400 transform hover:scale-110 transition-transform">
                                    <span class="text-slate-500">&gt;</span> robot.init()<span class="animate-pulse">_</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scroll Indicator Mejorado -->
                <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 flex flex-col items-center gap-2">
                    <span class="text-[9px] text-slate-400 uppercase tracking-widest font-medium">Scroll</span>
                    <div class="w-5 h-8 border-2 border-slate-300 rounded-full flex justify-center p-1">
                        <div class="w-1 h-2 bg-tec-gold rounded-full animate-bounce"></div>
                    </div>
                </div>
            </div>
            
            <style>
                @keyframes scan {
                    0% { top: 0; opacity: 0; }
                    50% { opacity: 1; }
                    100% { top: 100%; opacity: 0; }
                }
                .animate-scan {
                    animation: scan 3s ease-in-out infinite;
                }
                @keyframes shimmer {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(100%); }
                }
                .animate-shimmer {
                    animation: shimmer 2s infinite;
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0) rotate(0deg); }
                    50% { transform: translateY(-10px) rotate(5deg); }
                }
                .animate-float {
                    animation: float 4s ease-in-out infinite;
                }
            </style>

            <!-- ========== SECCI√ìN: ¬øQU√â ES CRAI? ========== -->
            <div class="relative bg-white py-24 overflow-hidden">
                <!-- Decoraci√≥n sutil -->
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-tec-gold/30 to-transparent"></div>
                <div class="absolute -top-40 -right-40 w-80 h-80 bg-tec-blue/5 rounded-full blur-3xl"></div>
                <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-tec-gold/5 rounded-full blur-3xl"></div>
                
                <div class="container mx-auto px-6 relative z-10">
                    <div class="grid lg:grid-cols-2 gap-16 items-center">
                        <!-- Contenido -->
                        <div class="space-y-6">
                            <div class="inline-flex items-center gap-2 bg-tec-blue/10 text-tec-blue px-4 py-2 rounded-full">
                                <i data-lucide="info" class="w-4 h-4"></i>
                                <span class="text-xs font-bold uppercase tracking-wider">Acerca de Nosotros</span>
                            </div>
                            
                            <h2 class="text-3xl sm:text-4xl lg:text-5xl font-black text-tec-dark leading-tight">
                                ¬øQu√© es el <span class="text-tec-blue">CRAI</span>?
                            </h2>
                            
                            <p class="text-base sm:text-lg text-slate-600 leading-relaxed">
                                El <strong class="text-tec-blue">Centro de Rob√≥tica Avanzada e Ingenier√≠a</strong> es un club estudiantil del 
                                Tecnol√≥gico Nacional de M√©xico Campus Mexicali, dedicado a impulsar la innovaci√≥n tecnol√≥gica 
                                y el desarrollo de proyectos de rob√≥tica de competencia.
                            </p>
                            
                            <p class="text-slate-500 leading-relaxed">
                                Fundado por estudiantes apasionados por la tecnolog√≠a, nuestro objetivo es crear un espacio donde 
                                las ideas se transforman en realidad. Desde robots aut√≥nomos hasta sistemas de inteligencia artificial, 
                                trabajamos en proyectos que desaf√≠an los l√≠mites de lo posible.
                            </p>
                            
                            <div class="flex flex-wrap gap-4 pt-4">
                                <div class="flex items-center gap-2 text-sm text-slate-600">
                                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                                    </div>
                                    <span>Proyectos Reales</span>
                                </div>
                                <div class="flex items-center gap-2 text-sm text-slate-600">
                                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                                    </div>
                                    <span>Competencias Nacionales</span>
                                </div>
                                <div class="flex items-center gap-2 text-sm text-slate-600">
                                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                                    </div>
                                    <span>Formaci√≥n Integral</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Visual -->
                        <div class="relative">
                            <div class="relative bg-gradient-to-br from-tec-blue to-tec-dark rounded-3xl p-8 shadow-2xl">
                                <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iMC4wNSI+PHBhdGggZD0iTTIwIDIwaDIwdjIwSDIweiIvPjwvZz48L2c+PC9zdmc+')] rounded-3xl opacity-50"></div>
                                
                                <div class="relative space-y-6 text-white">
                                    <div class="flex items-center gap-4">
                                        <div class="w-16 h-16 bg-white/10 rounded-2xl flex items-center justify-center">
                                            <i data-lucide="target" class="w-8 h-8 text-tec-gold"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-bold text-lg">Nuestra Misi√≥n</h4>
                                            <p class="text-blue-200 text-sm">Formar ingenieros competitivos</p>
                                        </div>
                                    </div>
                                    
                                    <p class="text-blue-100 leading-relaxed">
                                        Desarrollar talento t√©cnico de alto nivel mediante la participaci√≥n activa en proyectos 
                                        de rob√≥tica, fomentando el trabajo en equipo, la innovaci√≥n y la excelencia acad√©mica.
                                    </p>
                                    
                                    <div class="pt-4 border-t border-white/10">
                                        <div class="flex items-center gap-4">
                                            <div class="w-12 h-12 bg-tec-gold rounded-xl flex items-center justify-center">
                                                <i data-lucide="eye" class="w-6 h-6 text-white"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold">Nuestra Visi√≥n</h4>
                                                <p class="text-blue-200 text-sm">Ser referente nacional en rob√≥tica universitaria</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Elementos decorativos flotantes -->
                            <div class="absolute -top-4 -right-4 w-20 h-20 bg-tec-gold rounded-2xl flex items-center justify-center shadow-lg animate-float">
                                <i data-lucide="cpu" class="w-10 h-10 text-white"></i>
                            </div>
                            <div class="absolute -bottom-4 -left-4 w-16 h-16 bg-white rounded-2xl flex items-center justify-center shadow-lg animate-float" style="animation-delay: -2s;">
                                <i data-lucide="cog" class="w-8 h-8 text-tec-blue"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== SECCI√ìN: √ÅREAS DEL CLUB ========== -->
            <div class="relative bg-slate-50 py-24 overflow-hidden">
                <div class="absolute inset-0 opacity-50" style="background-image: radial-gradient(#1B396A 0.5px, transparent 0.5px); background-size: 20px 20px;"></div>
                
                <div class="container mx-auto px-6 relative z-10">
                    <div class="text-center max-w-3xl mx-auto mb-16">
                        <div class="inline-flex items-center gap-2 bg-tec-gold/10 text-tec-gold px-4 py-2 rounded-full mb-4">
                            <i data-lucide="layers" class="w-4 h-4"></i>
                            <span class="text-xs font-bold uppercase tracking-wider">Estructura Organizacional</span>
                        </div>
                        <h2 class="text-3xl sm:text-4xl lg:text-5xl font-black text-tec-dark mb-4">
                            Nuestras <span class="text-tec-blue">√Åreas</span>
                        </h2>
                        <p class="text-slate-500 text-base sm:text-lg">
                            El CRAI est√° organizado en 5 √°reas t√©cnicas especializadas, cada una enfocada en aspectos clave de la rob√≥tica.
                        </p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- √Årea 1: Gesti√≥n -->
                        <div class="group bg-white rounded-2xl p-6 shadow-sm hover:shadow-xl transition-all duration-300 border border-slate-100 hover:border-purple-200">
                            <div class="w-14 h-14 bg-purple-100 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                <i data-lucide="briefcase" class="w-7 h-7 text-purple-600"></i>
                            </div>
                            <h3 class="text-xl font-bold text-tec-dark mb-2">Gesti√≥n y Vinculaci√≥n</h3>
                            <p class="text-slate-500 text-sm leading-relaxed mb-4">
                                Administraci√≥n del club, b√∫squeda de patrocinios, organizaci√≥n de eventos y relaciones p√∫blicas con otras instituciones.
                            </p>
                            <div class="flex flex-wrap gap-2">
                                <span class="text-[10px] bg-purple-50 text-purple-600 px-2 py-1 rounded-full">Finanzas</span>
                                <span class="text-[10px] bg-purple-50 text-purple-600 px-2 py-1 rounded-full">Eventos</span>
                                <span class="text-[10px] bg-purple-50 text-purple-600 px-2 py-1 rounded-full">Marketing</span>
                            </div>
                        </div>
                        
                        <!-- √Årea 2: Telecom -->
                        <div class="group bg-white rounded-2xl p-6 shadow-sm hover:shadow-xl transition-all duration-300 border border-slate-100 hover:border-blue-200">
                            <div class="w-14 h-14 bg-blue-100 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                <i data-lucide="wifi" class="w-7 h-7 text-blue-600"></i>
                            </div>
                            <h3 class="text-xl font-bold text-tec-dark mb-2">Telecomunicaciones y Redes</h3>
                            <p class="text-slate-500 text-sm leading-relaxed mb-4">
                                Sistemas de comunicaci√≥n inal√°mbrica, protocolos de red, IoT y conectividad entre dispositivos rob√≥ticos.
                            </p>
                            <div class="flex flex-wrap gap-2">
                                <span class="text-[10px] bg-blue-50 text-blue-600 px-2 py-1 rounded-full">IoT</span>
                                <span class="text-[10px] bg-blue-50 text-blue-600 px-2 py-1 rounded-full">RF</span>
                                <span class="text-[10px] bg-blue-50 text-blue-600 px-2 py-1 rounded-full">Protocolos</span>
                            </div>
                        </div>
                        
                        <!-- √Årea 3: Software -->
                        <div class="group bg-white rounded-2xl p-6 shadow-sm hover:shadow-xl transition-all duration-300 border border-slate-100 hover:border-green-200">
                            <div class="w-14 h-14 bg-green-100 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                <i data-lucide="brain" class="w-7 h-7 text-green-600"></i>
                            </div>
                            <h3 class="text-xl font-bold text-tec-dark mb-2">Software, Autonom√≠a e IA</h3>
                            <p class="text-slate-500 text-sm leading-relaxed mb-4">
                                Desarrollo de algoritmos, visi√≥n por computadora, machine learning, navegaci√≥n aut√≥noma y sistemas de control.
                            </p>
                            <div class="flex flex-wrap gap-2">
                                <span class="text-[10px] bg-green-50 text-green-600 px-2 py-1 rounded-full">Python</span>
                                <span class="text-[10px] bg-green-50 text-green-600 px-2 py-1 rounded-full">ROS</span>
                                <span class="text-[10px] bg-green-50 text-green-600 px-2 py-1 rounded-full">OpenCV</span>
                            </div>
                        </div>
                        
                        <!-- √Årea 4: Electr√≥nica -->
                        <div class="group bg-white rounded-2xl p-6 shadow-sm hover:shadow-xl transition-all duration-300 border border-slate-100 hover:border-orange-200">
                            <div class="w-14 h-14 bg-orange-100 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                <i data-lucide="cpu" class="w-7 h-7 text-orange-600"></i>
                            </div>
                            <h3 class="text-xl font-bold text-tec-dark mb-2">Electr√≥nica y Control</h3>
                            <p class="text-slate-500 text-sm leading-relaxed mb-4">
                                Dise√±o de circuitos, PCBs, sistemas embebidos, sensores, actuadores y control de motores.
                            </p>
                            <div class="flex flex-wrap gap-2">
                                <span class="text-[10px] bg-orange-50 text-orange-600 px-2 py-1 rounded-full">Arduino</span>
                                <span class="text-[10px] bg-orange-50 text-orange-600 px-2 py-1 rounded-full">KiCad</span>
                                <span class="text-[10px] bg-orange-50 text-orange-600 px-2 py-1 rounded-full">STM32</span>
                            </div>
                        </div>
                        
                        <!-- √Årea 5: Mec√°nico -->
                        <div class="group bg-white rounded-2xl p-6 shadow-sm hover:shadow-xl transition-all duration-300 border border-slate-100 hover:border-red-200">
                            <div class="w-14 h-14 bg-red-100 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                <i data-lucide="cog" class="w-7 h-7 text-red-600"></i>
                            </div>
                            <h3 class="text-xl font-bold text-tec-dark mb-2">Dise√±o Mec√°nico y Manufactura</h3>
                            <p class="text-slate-500 text-sm leading-relaxed mb-4">
                                Modelado CAD, an√°lisis estructural, impresi√≥n 3D, corte l√°ser y manufactura de piezas rob√≥ticas.
                            </p>
                            <div class="flex flex-wrap gap-2">
                                <span class="text-[10px] bg-red-50 text-red-600 px-2 py-1 rounded-full">SolidWorks</span>
                                <span class="text-[10px] bg-red-50 text-red-600 px-2 py-1 rounded-full">Fusion</span>
                                <span class="text-[10px] bg-red-50 text-red-600 px-2 py-1 rounded-full">CNC</span>
                            </div>
                        </div>
                        
                        <!-- CTA Unirse -->
                        <div class="bg-gradient-to-br from-tec-blue to-tec-dark rounded-2xl p-6 text-white flex flex-col justify-center">
                            <div class="w-14 h-14 bg-white/10 rounded-2xl flex items-center justify-center mb-4">
                                <i data-lucide="rocket" class="w-7 h-7 text-tec-gold"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-2">¬øListo para unirte?</h3>
                            <p class="text-blue-200 text-sm mb-4">
                                Encuentra tu √°rea de pasi√≥n y forma parte del equipo CRAI.
                            </p>
                            <button onclick="Router.to('public-join')" class="w-full py-3 bg-tec-gold text-white rounded-xl font-bold text-sm hover:bg-yellow-500 transition-all">
                                Solicitar Membres√≠a
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== SECCI√ìN: POR QU√â UNIRTE ========== -->
            <div class="relative bg-white py-24 overflow-hidden">
                <div class="container mx-auto px-6">
                    <div class="grid lg:grid-cols-2 gap-16 items-center">
                        <!-- Visual Grid -->
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-4">
                                <div class="bg-gradient-to-br from-tec-blue to-blue-600 rounded-2xl p-6 text-white">
                                    <i data-lucide="trophy" class="w-10 h-10 mb-4 text-tec-gold"></i>
                                    <h4 class="font-bold text-lg mb-2">Competencias</h4>
                                    <p class="text-blue-100 text-sm">Participa en torneos nacionales e internacionales de rob√≥tica</p>
                                </div>
                                <div class="bg-slate-100 rounded-2xl p-6">
                                    <i data-lucide="users" class="w-10 h-10 mb-4 text-tec-blue"></i>
                                    <h4 class="font-bold text-lg text-tec-dark mb-2">Networking</h4>
                                    <p class="text-slate-500 text-sm">Conecta con profesionales y empresas del sector</p>
                                </div>
                            </div>
                            <div class="space-y-4 mt-8">
                                <div class="bg-slate-100 rounded-2xl p-6">
                                    <i data-lucide="graduation-cap" class="w-10 h-10 mb-4 text-tec-gold"></i>
                                    <h4 class="font-bold text-lg text-tec-dark mb-2">Aprendizaje</h4>
                                    <p class="text-slate-500 text-sm">Talleres, cursos y mentor√≠a de estudiantes avanzados</p>
                                </div>
                                <div class="bg-gradient-to-br from-tec-gold to-yellow-500 rounded-2xl p-6 text-white">
                                    <i data-lucide="briefcase" class="w-10 h-10 mb-4"></i>
                                    <h4 class="font-bold text-lg mb-2">Experiencia</h4>
                                    <p class="text-yellow-100 text-sm">Construye un portafolio real para tu carrera profesional</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contenido -->
                        <div class="space-y-6">
                            <div class="inline-flex items-center gap-2 bg-green-100 text-green-700 px-4 py-2 rounded-full">
                                <i data-lucide="sparkles" class="w-4 h-4"></i>
                                <span class="text-xs font-bold uppercase tracking-wider">Beneficios</span>
                            </div>
                            
                            <h2 class="text-4xl lg:text-5xl font-black text-tec-dark leading-tight">
                                ¬øPor qu√© <span class="text-tec-blue">unirte</span> al CRAI?
                            </h2>
                            
                            <p class="text-lg text-slate-600 leading-relaxed">
                                Ser parte del CRAI no es solo unirse a un club, es entrar a una comunidad de innovadores 
                                donde cada proyecto te acerca m√°s a tu futuro profesional.
                            </p>
                            
                            <ul class="space-y-4">
                                <li class="flex items-start gap-4">
                                    <div class="w-8 h-8 bg-tec-blue/10 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5">
                                        <i data-lucide="check" class="w-4 h-4 text-tec-blue"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-tec-dark">Acceso al laboratorio 24/7</h4>
                                        <p class="text-slate-500 text-sm">Equipamiento profesional: impresoras 3D, herramientas, componentes</p>
                                    </div>
                                </li>
                                <li class="flex items-start gap-4">
                                    <div class="w-8 h-8 bg-tec-blue/10 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5">
                                        <i data-lucide="check" class="w-4 h-4 text-tec-blue"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-tec-dark">Proyectos con impacto real</h4>
                                        <p class="text-slate-500 text-sm">Trabaja en robots funcionales que compiten a nivel nacional</p>
                                    </div>
                                </li>
                                <li class="flex items-start gap-4">
                                    <div class="w-8 h-8 bg-tec-blue/10 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5">
                                        <i data-lucide="check" class="w-4 h-4 text-tec-blue"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-tec-dark">Certificaciones y reconocimientos</h4>
                                        <p class="text-slate-500 text-sm">Obt√©n constancias oficiales de participaci√≥n del TecNM</p>
                                    </div>
                                </li>
                            </ul>
                            
                            <div class="pt-4">
                                <button onclick="Router.to('public-join')" class="px-8 py-4 bg-tec-blue text-white rounded-xl font-bold text-sm hover:bg-tec-dark transition-all inline-flex items-center gap-2 shadow-lg shadow-tec-blue/30">
                                    <i data-lucide="user-plus" class="w-5 h-5"></i>
                                    Comenzar mi Aplicaci√≥n
                                    <i data-lucide="arrow-right" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== SECCI√ìN: PATROCINADORES ========== -->
            <div class="relative bg-gradient-to-br from-tec-gold/5 via-white to-tec-blue/5 py-24 overflow-hidden">
                <!-- Decoraci√≥n -->
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-tec-gold via-tec-blue to-tec-gold"></div>
                <div class="absolute -top-20 right-0 w-96 h-96 bg-tec-gold/10 rounded-full blur-3xl"></div>
                <div class="absolute -bottom-20 left-0 w-80 h-80 bg-tec-blue/10 rounded-full blur-3xl"></div>
                
                <div class="container mx-auto px-6 relative z-10">
                    <!-- Header -->
                    <div class="text-center max-w-3xl mx-auto mb-16">
                        <div class="inline-flex items-center gap-2 bg-tec-gold/10 text-tec-gold px-4 py-2 rounded-full mb-4">
                            <i data-lucide="handshake" class="w-4 h-4"></i>
                            <span class="text-xs font-bold uppercase tracking-wider">Alianzas Estrat√©gicas</span>
                        </div>
                        <h2 class="text-4xl lg:text-5xl font-black text-tec-dark mb-4">
                            S√© Parte del <span class="text-tec-gold">Futuro</span>
                        </h2>
                        <p class="text-slate-500 text-lg leading-relaxed">
                            Invertir en el CRAI es invertir en la pr√≥xima generaci√≥n de ingenieros mexicanos. 
                            Tu apoyo impulsa la innovaci√≥n y el talento tecnol√≥gico del pa√≠s.
                        </p>
                    </div>
                    
                    <!-- Beneficios para Patrocinadores -->
                    <div class="grid lg:grid-cols-3 gap-8 mb-16">
                        <!-- Beneficio 1 -->
                        <div class="bg-white rounded-2xl p-8 shadow-lg border border-slate-100 hover:shadow-2xl transition-all duration-300 group">
                            <div class="w-16 h-16 bg-gradient-to-br from-tec-gold to-yellow-500 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform shadow-lg shadow-tec-gold/30">
                                <i data-lucide="eye" class="w-8 h-8 text-white"></i>
                            </div>
                            <h3 class="text-xl font-bold text-tec-dark mb-3">Visibilidad de Marca</h3>
                            <p class="text-slate-500 text-sm leading-relaxed mb-4">
                                Tu logo en todos nuestros robots, uniformes, eventos y competencias nacionales. 
                                Presencia en redes sociales con alcance a miles de estudiantes y profesionales.
                            </p>
                            <ul class="space-y-2 text-sm text-slate-600">
                                <li class="flex items-center gap-2">
                                    <i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i>
                                    Logo en robots de competencia
                                </li>
                                <li class="flex items-center gap-2">
                                    <i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i>
                                    Menci√≥n en eventos y premiaciones
                                </li>
                                <li class="flex items-center gap-2">
                                    <i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i>
                                    Publicaciones en redes sociales
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Beneficio 2 -->
                        <div class="bg-white rounded-2xl p-8 shadow-lg border border-slate-100 hover:shadow-2xl transition-all duration-300 group">
                            <div class="w-16 h-16 bg-gradient-to-br from-tec-blue to-blue-600 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform shadow-lg shadow-tec-blue/30">
                                <i data-lucide="users" class="w-8 h-8 text-white"></i>
                            </div>
                            <h3 class="text-xl font-bold text-tec-dark mb-3">Acceso a Talento</h3>
                            <p class="text-slate-500 text-sm leading-relaxed mb-4">
                                Conecta directamente con los mejores estudiantes de ingenier√≠a. 
                                Oportunidad de reclutar talento capacitado y con experiencia pr√°ctica real.
                            </p>
                            <ul class="space-y-2 text-sm text-slate-600">
                                <li class="flex items-center gap-2">
                                    <i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i>
                                    Bolsa de trabajo exclusiva
                                </li>
                                <li class="flex items-center gap-2">
                                    <i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i>
                                    Pr√°cticas profesionales
                                </li>
                                <li class="flex items-center gap-2">
                                    <i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i>
                                    Eventos de networking
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Beneficio 3 -->
                        <div class="bg-white rounded-2xl p-8 shadow-lg border border-slate-100 hover:shadow-2xl transition-all duration-300 group">
                            <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform shadow-lg shadow-green-500/30">
                                <i data-lucide="heart" class="w-8 h-8 text-white"></i>
                            </div>
                            <h3 class="text-xl font-bold text-tec-dark mb-3">Impacto Social</h3>
                            <p class="text-slate-500 text-sm leading-relaxed mb-4">
                                Contribuye al desarrollo tecnol√≥gico de M√©xico. Tu inversi√≥n forma a los ingenieros 
                                que construir√°n el futuro de la industria nacional.
                            </p>
                            <ul class="space-y-2 text-sm text-slate-600">
                                <li class="flex items-center gap-2">
                                    <i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i>
                                    Responsabilidad social empresarial
                                </li>
                                <li class="flex items-center gap-2">
                                    <i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i>
                                    Deducci√≥n de impuestos
                                </li>
                                <li class="flex items-center gap-2">
                                    <i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i>
                                    Certificado de donaci√≥n
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Niveles de Patrocinio -->
                    <div class="bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-200">
                        <div class="bg-gradient-to-r from-tec-blue to-tec-dark p-8 text-white text-center">
                            <h3 class="text-2xl font-bold mb-2">Niveles de Patrocinio</h3>
                            <p class="text-blue-200">Elige el nivel que mejor se adapte a tu empresa</p>
                        </div>
                        
                        <div class="grid md:grid-cols-3 divide-y md:divide-y-0 md:divide-x divide-slate-200">
                            <!-- Nivel Bronce -->
                            <div class="p-8 text-center hover:bg-slate-50 transition-colors">
                                <div class="w-16 h-16 bg-amber-700/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="award" class="w-8 h-8 text-amber-700"></i>
                                </div>
                                <h4 class="text-xl font-bold text-amber-700 mb-2">Bronce</h4>
                                <p class="text-3xl font-black text-tec-dark mb-4">$5,000<span class="text-sm font-normal text-slate-400">/a√±o</span></p>
                                <ul class="space-y-3 text-sm text-slate-600 text-left mb-6">
                                    <li class="flex items-center gap-2">
                                        <i data-lucide="check" class="w-4 h-4 text-green-500"></i>
                                        Logo en sitio web
                                    </li>
                                    <li class="flex items-center gap-2">
                                        <i data-lucide="check" class="w-4 h-4 text-green-500"></i>
                                        Menci√≥n en redes sociales
                                    </li>
                                    <li class="flex items-center gap-2">
                                        <i data-lucide="check" class="w-4 h-4 text-green-500"></i>
                                        Certificado de patrocinador
                                    </li>
                                    <li class="flex items-center gap-2 text-slate-300">
                                        <i data-lucide="x" class="w-4 h-4"></i>
                                        Logo en robots
                                    </li>
                                </ul>
                                <button onclick="Router.to('public-donate')" class="w-full py-3 border-2 border-amber-700 text-amber-700 rounded-xl font-bold text-sm hover:bg-amber-700 hover:text-white transition-all">
                                    Seleccionar
                                </button>
                            </div>
                            
                            <!-- Nivel Plata -->
                            <div class="p-8 text-center bg-gradient-to-b from-slate-50 to-white relative">
                                <div class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-tec-gold text-white text-xs font-bold px-4 py-1 rounded-full">
                                    POPULAR
                                </div>
                                <div class="w-16 h-16 bg-slate-300/30 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="award" class="w-8 h-8 text-slate-500"></i>
                                </div>
                                <h4 class="text-xl font-bold text-slate-600 mb-2">Plata</h4>
                                <p class="text-3xl font-black text-tec-dark mb-4">$15,000<span class="text-sm font-normal text-slate-400">/a√±o</span></p>
                                <ul class="space-y-3 text-sm text-slate-600 text-left mb-6">
                                    <li class="flex items-center gap-2">
                                        <i data-lucide="check" class="w-4 h-4 text-green-500"></i>
                                        Todo lo de Bronce
                                    </li>
                                    <li class="flex items-center gap-2">
                                        <i data-lucide="check" class="w-4 h-4 text-green-500"></i>
                                        Logo en uniformes del equipo
                                    </li>
                                    <li class="flex items-center gap-2">
                                        <i data-lucide="check" class="w-4 h-4 text-green-500"></i>
                                        Stand en eventos del club
                                    </li>
                                    <li class="flex items-center gap-2">
                                        <i data-lucide="check" class="w-4 h-4 text-green-500"></i>
                                        Acceso a bolsa de talento
                                    </li>
                                </ul>
                                <button onclick="Router.to('public-donate')" class="w-full py-3 bg-gradient-to-r from-slate-500 to-slate-600 text-white rounded-xl font-bold text-sm hover:from-slate-600 hover:to-slate-700 transition-all shadow-lg">
                                    Seleccionar
                                </button>
                            </div>
                            
                            <!-- Nivel Oro -->
                            <div class="p-8 text-center hover:bg-yellow-50/50 transition-colors">
                                <div class="w-16 h-16 bg-tec-gold/20 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse-glow">
                                    <i data-lucide="crown" class="w-8 h-8 text-tec-gold"></i>
                                </div>
                                <h4 class="text-xl font-bold text-tec-gold mb-2">Oro</h4>
                                <p class="text-3xl font-black text-tec-dark mb-4">$30,000+<span class="text-sm font-normal text-slate-400">/a√±o</span></p>
                                <ul class="space-y-3 text-sm text-slate-600 text-left mb-6">
                                    <li class="flex items-center gap-2">
                                        <i data-lucide="check" class="w-4 h-4 text-green-500"></i>
                                        Todo lo de Plata
                                    </li>
                                    <li class="flex items-center gap-2">
                                        <i data-lucide="check" class="w-4 h-4 text-green-500"></i>
                                        <strong>Logo principal en robots</strong>
                                    </li>
                                    <li class="flex items-center gap-2">
                                        <i data-lucide="check" class="w-4 h-4 text-green-500"></i>
                                        Nombrar robot o proyecto
                                    </li>
                                    <li class="flex items-center gap-2">
                                        <i data-lucide="check" class="w-4 h-4 text-green-500"></i>
                                        Charlas exclusivas en tu empresa
                                    </li>
                                </ul>
                                <button onclick="Router.to('public-donate')" class="w-full py-3 bg-gradient-to-r from-tec-gold to-yellow-500 text-white rounded-xl font-bold text-sm hover:from-yellow-500 hover:to-yellow-600 transition-all shadow-lg shadow-tec-gold/30">
                                    Seleccionar
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Patrocinio en Especie -->
                    <div class="mt-16 bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50 rounded-3xl shadow-xl overflow-hidden border border-emerald-200">
                        <div class="bg-gradient-to-r from-emerald-600 via-teal-600 to-emerald-600 p-8 text-white text-center relative overflow-hidden">
                            <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iMC4xIj48cGF0aCBkPSJNMzYgMzR2LTRoLTJ2NGgtNHYyaDR2NGgydi00aDR2LTJoLTR6bTAtMzBWMGgtMnY0aC00djJoNHY0aDJWNmg0VjRoLTR6TTYgMzR2LTRINHY0SDB2Mmg0djRoMnYtNGg0di0ySDZ6TTYgNFYwSDR2NEgwdjJoNHY0aDJWNmg0VjRINnoiLz48L2c+PC9nPjwvc3ZnPg==')] opacity-30"></div>
                            <div class="relative z-10">
                                <div class="inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm rounded-full px-4 py-1.5 mb-4">
                                    <i data-lucide="package" class="w-4 h-4"></i>
                                    <span class="text-xs font-bold uppercase tracking-wider">Alternativa Flexible</span>
                                </div>
                                <h3 class="text-3xl font-black mb-2">Patrocinio en Especie</h3>
                                <p class="text-emerald-100 max-w-2xl mx-auto">¬øNo puedes donar dinero? ¬°No hay problema! Acepta materiales, componentes, servicios o equipos que necesitamos para nuestros proyectos.</p>
                            </div>
                        </div>
                        
                        <div class="p-8">
                            <!-- Qu√© aceptamos -->
                            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
                                <!-- Componentes Electr√≥nicos -->
                                <div class="bg-white rounded-2xl p-6 shadow-md border border-emerald-100 hover:shadow-lg hover:border-emerald-300 transition-all group">
                                    <div class="w-14 h-14 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-lg shadow-emerald-500/30">
                                        <i data-lucide="cpu" class="w-7 h-7 text-white"></i>
                                    </div>
                                    <h4 class="font-bold text-tec-dark mb-2">Componentes Electr√≥nicos</h4>
                                    <ul class="text-xs text-slate-500 space-y-1.5">
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Microcontroladores (Arduino, ESP32, STM32)</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Sensores y actuadores</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Motores DC, servos, steppers</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Cables, conectores, PCBs</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Bater√≠as y fuentes de poder</li>
                                    </ul>
                                </div>
                                
                                <!-- Materiales de Fabricaci√≥n -->
                                <div class="bg-white rounded-2xl p-6 shadow-md border border-emerald-100 hover:shadow-lg hover:border-emerald-300 transition-all group">
                                    <div class="w-14 h-14 bg-gradient-to-br from-orange-500 to-red-500 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-lg shadow-orange-500/30">
                                        <i data-lucide="hammer" class="w-7 h-7 text-white"></i>
                                    </div>
                                    <h4 class="font-bold text-tec-dark mb-2">Materiales de Fabricaci√≥n</h4>
                                    <ul class="text-xs text-slate-500 space-y-1.5">
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Filamento para impresi√≥n 3D (PLA, PETG, ABS)</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> L√°minas de acr√≠lico y MDF</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Perfiles de aluminio</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Torniller√≠a y herrajes</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Adhesivos industriales</li>
                                    </ul>
                                </div>
                                
                                <!-- Herramientas y Equipos -->
                                <div class="bg-white rounded-2xl p-6 shadow-md border border-emerald-100 hover:shadow-lg hover:border-emerald-300 transition-all group">
                                    <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-lg shadow-blue-500/30">
                                        <i data-lucide="wrench" class="w-7 h-7 text-white"></i>
                                    </div>
                                    <h4 class="font-bold text-tec-dark mb-2">Herramientas y Equipos</h4>
                                    <ul class="text-xs text-slate-500 space-y-1.5">
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Mult√≠metros y osciloscopios</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Estaciones de soldadura</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Herramientas manuales</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Impresoras 3D</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Computadoras/laptops</li>
                                    </ul>
                                </div>
                                
                                <!-- Servicios -->
                                <div class="bg-white rounded-2xl p-6 shadow-md border border-emerald-100 hover:shadow-lg hover:border-emerald-300 transition-all group">
                                    <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-lg shadow-purple-500/30">
                                        <i data-lucide="handshake" class="w-7 h-7 text-white"></i>
                                    </div>
                                    <h4 class="font-bold text-tec-dark mb-2">Servicios</h4>
                                    <ul class="text-xs text-slate-500 space-y-1.5">
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Corte l√°ser / CNC</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Impresi√≥n 3D profesional</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Fabricaci√≥n de PCBs</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Transporte a competencias</li>
                                        <li class="flex items-start gap-1.5"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Hospedaje/alimentaci√≥n</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- Beneficios del patrocinio en especie -->
                            <div class="bg-white rounded-2xl p-6 border border-emerald-200 mb-8">
                                <h4 class="font-bold text-tec-dark text-lg mb-4 flex items-center gap-2">
                                    <i data-lucide="gift" class="w-5 h-5 text-emerald-600"></i>
                                    Beneficios para el Patrocinador en Especie
                                </h4>
                                <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div class="flex items-start gap-3 p-3 bg-emerald-50 rounded-xl">
                                        <div class="w-8 h-8 bg-emerald-500 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i data-lucide="file-badge" class="w-4 h-4 text-white"></i>
                                        </div>
                                        <div>
                                            <p class="font-bold text-sm text-tec-dark">Carta de Donaci√≥n</p>
                                            <p class="text-xs text-slate-500">Documento oficial para deducci√≥n fiscal</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3 p-3 bg-emerald-50 rounded-xl">
                                        <div class="w-8 h-8 bg-emerald-500 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i data-lucide="image" class="w-4 h-4 text-white"></i>
                                        </div>
                                        <div>
                                            <p class="font-bold text-sm text-tec-dark">Logo Visible</p>
                                            <p class="text-xs text-slate-500">Tu marca en web, redes y robots</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3 p-3 bg-emerald-50 rounded-xl">
                                        <div class="w-8 h-8 bg-emerald-500 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i data-lucide="camera" class="w-4 h-4 text-white"></i>
                                        </div>
                                        <div>
                                            <p class="font-bold text-sm text-tec-dark">Reconocimiento P√∫blico</p>
                                            <p class="text-xs text-slate-500">Menci√≥n en eventos y competencias</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3 p-3 bg-emerald-50 rounded-xl">
                                        <div class="w-8 h-8 bg-emerald-500 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i data-lucide="users" class="w-4 h-4 text-white"></i>
                                        </div>
                                        <div>
                                            <p class="font-bold text-sm text-tec-dark">Networking</p>
                                            <p class="text-xs text-slate-500">Conexi√≥n con talento estudiantil</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Niveles de Patrocinio en Especie -->
                            <div class="bg-gradient-to-br from-slate-50 to-emerald-50 rounded-2xl p-6 border border-emerald-200 mb-8">
                                <h4 class="font-bold text-tec-dark text-lg mb-6 text-center flex items-center justify-center gap-2">
                                    <i data-lucide="trophy" class="w-5 h-5 text-tec-gold"></i>
                                    Niveles de Patrocinio seg√∫n Valor de Aportaci√≥n
                                </h4>
                                <div class="grid md:grid-cols-3 gap-6">
                                    <!-- Nivel Bronce -->
                                    <div class="bg-white rounded-2xl overflow-hidden shadow-md border-2 border-amber-700/30 hover:border-amber-700 transition-all group">
                                        <div class="bg-gradient-to-r from-amber-700 to-amber-600 p-4 text-white text-center">
                                            <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-2">
                                                <i data-lucide="medal" class="w-6 h-6"></i>
                                            </div>
                                            <h5 class="font-bold text-lg">Nivel Bronce</h5>
                                            <p class="text-amber-200 text-xs">Hasta $5,000 MXN en valor</p>
                                        </div>
                                        <div class="p-4">
                                            <ul class="text-xs text-slate-600 space-y-2">
                                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-emerald-500 flex-shrink-0 mt-0.5"></i> Menci√≥n en redes sociales</li>
                                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-emerald-500 flex-shrink-0 mt-0.5"></i> Carta de agradecimiento oficial</li>
                                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-emerald-500 flex-shrink-0 mt-0.5"></i> Logo en secci√≥n de patrocinadores (peque√±o)</li>
                                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-emerald-500 flex-shrink-0 mt-0.5"></i> Certificado digital de patrocinio</li>
                                            </ul>
                                        </div>
                                    </div>
                                    
                                    <!-- Nivel Plata -->
                                    <div class="bg-white rounded-2xl overflow-hidden shadow-lg border-2 border-slate-400/50 hover:border-slate-400 transition-all group transform md:scale-105">
                                        <div class="bg-gradient-to-r from-slate-500 to-slate-400 p-4 text-white text-center">
                                            <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-2">
                                                <i data-lucide="award" class="w-6 h-6"></i>
                                            </div>
                                            <h5 class="font-bold text-lg">Nivel Plata</h5>
                                            <p class="text-slate-200 text-xs">$5,001 - $15,000 MXN en valor</p>
                                        </div>
                                        <div class="p-4">
                                            <ul class="text-xs text-slate-600 space-y-2">
                                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-emerald-500 flex-shrink-0 mt-0.5"></i> Todo lo del nivel Bronce</li>
                                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-emerald-500 flex-shrink-0 mt-0.5"></i> Logo prominente en sitio web</li>
                                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-emerald-500 flex-shrink-0 mt-0.5"></i> Logo en uniformes del equipo</li>
                                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-emerald-500 flex-shrink-0 mt-0.5"></i> Menci√≥n en presentaciones oficiales</li>
                                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-emerald-500 flex-shrink-0 mt-0.5"></i> Visita guiada al laboratorio</li>
                                            </ul>
                                        </div>
                                    </div>
                                    
                                    <!-- Nivel Oro -->
                                    <div class="bg-white rounded-2xl overflow-hidden shadow-xl border-2 border-tec-gold/50 hover:border-tec-gold transition-all group">
                                        <div class="bg-gradient-to-r from-tec-gold to-yellow-500 p-4 text-tec-dark text-center">
                                            <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mx-auto mb-2">
                                                <i data-lucide="crown" class="w-6 h-6"></i>
                                            </div>
                                            <h5 class="font-bold text-lg">Nivel Oro</h5>
                                            <p class="text-yellow-800 text-xs">M√°s de $15,000 MXN en valor</p>
                                        </div>
                                        <div class="p-4">
                                            <ul class="text-xs text-slate-600 space-y-2">
                                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-emerald-500 flex-shrink-0 mt-0.5"></i> Todo lo del nivel Plata</li>
                                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-emerald-500 flex-shrink-0 mt-0.5"></i> Logo en robots de competencia</li>
                                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-emerald-500 flex-shrink-0 mt-0.5"></i> Menci√≥n especial en competencias</li>
                                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-emerald-500 flex-shrink-0 mt-0.5"></i> Acceso a talento para reclutamiento</li>
                                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-emerald-500 flex-shrink-0 mt-0.5"></i> Invitaci√≥n VIP a eventos y demos</li>
                                                <li class="flex items-start gap-2"><i data-lucide="check-circle" class="w-4 h-4 text-emerald-500 flex-shrink-0 mt-0.5"></i> Reportes de impacto personalizados</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Beneficios Extra Exclusivos -->
                            <div class="bg-gradient-to-r from-tec-blue to-indigo-800 rounded-2xl p-6 text-white mb-8">
                                <h4 class="font-bold text-xl mb-6 text-center flex items-center justify-center gap-2">
                                    <i data-lucide="sparkles" class="w-6 h-6 text-tec-gold"></i>
                                    Beneficios Extra para Patrocinadores Estrat√©gicos
                                </h4>
                                <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20 hover:bg-white/20 transition-all">
                                        <div class="flex items-center gap-3 mb-2">
                                            <div class="w-10 h-10 bg-tec-gold rounded-lg flex items-center justify-center">
                                                <i data-lucide="user-search" class="w-5 h-5 text-tec-dark"></i>
                                            </div>
                                            <h5 class="font-bold text-sm">Acceso a Talento</h5>
                                        </div>
                                        <p class="text-xs text-blue-200">Prioridad para reclutar a nuestros miembros m√°s destacados en rob√≥tica, programaci√≥n y electr√≥nica.</p>
                                    </div>
                                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20 hover:bg-white/20 transition-all">
                                        <div class="flex items-center gap-3 mb-2">
                                            <div class="w-10 h-10 bg-tec-gold rounded-lg flex items-center justify-center">
                                                <i data-lucide="presentation" class="w-5 h-5 text-tec-dark"></i>
                                            </div>
                                            <h5 class="font-bold text-sm">Demostraciones Privadas</h5>
                                        </div>
                                        <p class="text-xs text-blue-200">Invitaci√≥n a demos exclusivas de proyectos antes de presentaciones p√∫blicas.</p>
                                    </div>
                                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20 hover:bg-white/20 transition-all">
                                        <div class="flex items-center gap-3 mb-2">
                                            <div class="w-10 h-10 bg-tec-gold rounded-lg flex items-center justify-center">
                                                <i data-lucide="building" class="w-5 h-5 text-tec-dark"></i>
                                            </div>
                                            <h5 class="font-bold text-sm">Visitas a tu Empresa</h5>
                                        </div>
                                        <p class="text-xs text-blue-200">Nuestro equipo puede visitar tu empresa para presentaciones o colaboraciones t√©cnicas.</p>
                                    </div>
                                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20 hover:bg-white/20 transition-all">
                                        <div class="flex items-center gap-3 mb-2">
                                            <div class="w-10 h-10 bg-tec-gold rounded-lg flex items-center justify-center">
                                                <i data-lucide="code-2" class="w-5 h-5 text-tec-dark"></i>
                                            </div>
                                            <h5 class="font-bold text-sm">Proyectos Colaborativos</h5>
                                        </div>
                                        <p class="text-xs text-blue-200">Posibilidad de desarrollar proyectos conjuntos o prototipos relacionados con tu industria.</p>
                                    </div>
                                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20 hover:bg-white/20 transition-all">
                                        <div class="flex items-center gap-3 mb-2">
                                            <div class="w-10 h-10 bg-tec-gold rounded-lg flex items-center justify-center">
                                                <i data-lucide="video" class="w-5 h-5 text-tec-dark"></i>
                                            </div>
                                            <h5 class="font-bold text-sm">Contenido de Marca</h5>
                                        </div>
                                        <p class="text-xs text-blue-200">Videos y fotos profesionales con tu marca para uso en tus propios canales.</p>
                                    </div>
                                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20 hover:bg-white/20 transition-all">
                                        <div class="flex items-center gap-3 mb-2">
                                            <div class="w-10 h-10 bg-tec-gold rounded-lg flex items-center justify-center">
                                                <i data-lucide="mic" class="w-5 h-5 text-tec-dark"></i>
                                            </div>
                                            <h5 class="font-bold text-sm">Talleres y Charlas</h5>
                                        </div>
                                        <p class="text-xs text-blue-200">Tu empresa puede impartir talleres o pl√°ticas t√©cnicas a nuestros miembros.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Proceso de Patrocinio -->
                            <div class="bg-white rounded-2xl p-6 border border-emerald-200 mb-8">
                                <h4 class="font-bold text-tec-dark text-lg mb-6 text-center flex items-center justify-center gap-2">
                                    <i data-lucide="route" class="w-5 h-5 text-emerald-600"></i>
                                    ¬øC√≥mo funciona el proceso?
                                </h4>
                                <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div class="text-center p-4">
                                        <div class="w-14 h-14 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-3 text-white font-bold text-xl shadow-lg">1</div>
                                        <h5 class="font-bold text-sm text-tec-dark mb-1">Cont√°ctanos</h5>
                                        <p class="text-xs text-slate-500">Env√≠anos un correo o mensaje con lo que deseas donar</p>
                                    </div>
                                    <div class="text-center p-4">
                                        <div class="w-14 h-14 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-3 text-white font-bold text-xl shadow-lg">2</div>
                                        <h5 class="font-bold text-sm text-tec-dark mb-1">Evaluamos</h5>
                                        <p class="text-xs text-slate-500">Revisamos la aportaci√≥n y definimos el nivel de beneficios</p>
                                    </div>
                                    <div class="text-center p-4">
                                        <div class="w-14 h-14 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-3 text-white font-bold text-xl shadow-lg">3</div>
                                        <h5 class="font-bold text-sm text-tec-dark mb-1">Coordinamos</h5>
                                        <p class="text-xs text-slate-500">Acordamos fecha y lugar de entrega o env√≠o</p>
                                    </div>
                                    <div class="text-center p-4">
                                        <div class="w-14 h-14 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-3 text-white font-bold text-xl shadow-lg">4</div>
                                        <h5 class="font-bold text-sm text-tec-dark mb-1">¬°Reconocemos!</h5>
                                        <p class="text-xs text-slate-500">Publicamos el agradecimiento y activamos los beneficios</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- CTA Patrocinio en Especie -->
                            <div class="text-center bg-gradient-to-r from-emerald-600 to-teal-600 rounded-2xl p-6 text-white">
                                <h4 class="text-xl font-bold mb-2">¬øTienes algo que donar?</h4>
                                <p class="text-emerald-100 text-sm mb-4 max-w-lg mx-auto">Cont√°ctanos para coordinar la entrega. Aceptamos materiales nuevos o en buen estado.</p>
                                <div class="flex flex-col sm:flex-row gap-3 justify-center flex-wrap">
                                    <a id="wishlist-btn-1" href="#" onclick="event.preventDefault(); Util.openWishlist();" class="inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-tec-gold text-tec-dark rounded-xl font-bold text-sm hover:bg-yellow-400 transition-all shadow-lg cursor-pointer">
                                        <i data-lucide="gift" class="w-4 h-4"></i>
                                        Ver Lista de Deseos
                                    </a>
                                    <a onclick="event.preventDefault(); Util.sendEmail('contacto@clubcrai.com', 'Patrocinio en Especie - CRAI', 'Hola, me gustar√≠a donar los siguientes materiales/servicios:\n\n');" class="inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-white text-emerald-700 rounded-xl font-bold text-sm hover:bg-emerald-50 transition-all cursor-pointer">
                                        <i data-lucide="mail" class="w-4 h-4"></i>
                                        Enviar Correo
                                    </a>
                                    <a href="https://wa.me/526861234567?text=Hola%2C%20me%20interesa%20hacer%20un%20patrocinio%20en%20especie%20para%20CRAI" target="_blank" class="inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-emerald-800 text-white rounded-xl font-bold text-sm hover:bg-emerald-900 transition-all">
                                        <i data-lucide="message-circle" class="w-4 h-4"></i>
                                        WhatsApp
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CTA Final Patrocinadores -->
                    <div class="mt-16 text-center">
                        <div class="inline-block bg-gradient-to-r from-tec-blue to-tec-dark rounded-2xl p-8 text-white max-w-2xl">
                            <div class="flex items-center justify-center gap-4 mb-4">
                                <i data-lucide="building-2" class="w-10 h-10 text-tec-gold"></i>
                                <h4 class="text-2xl font-bold">¬øEres una empresa?</h4>
                            </div>
                            <p class="text-blue-200 mb-6">
                                Cont√°ctanos para crear un plan de patrocinio personalizado que se adapte a las necesidades de tu empresa.
                            </p>
                            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                                <a onclick="Util.sendEmail('contacto@clubcrai.com', 'Patrocinio Empresarial - CRAI', 'Hola, me interesa conocer los planes de patrocinio para empresas.\n\n');" class="px-6 py-3 bg-white text-tec-blue rounded-xl font-bold text-sm hover:bg-slate-100 transition-all inline-flex items-center justify-center gap-2 cursor-pointer">
                                    <i data-lucide="mail" class="w-5 h-5"></i>
                                    contacto@clubcrai.com
                                </a>
                                <button onclick="Router.to('public-donate')" class="px-6 py-3 bg-tec-gold text-white rounded-xl font-bold text-sm hover:bg-yellow-500 transition-all inline-flex items-center justify-center gap-2">
                                    <i data-lucide="heart" class="w-5 h-5"></i>
                                    Donar Ahora
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Patrocinadores Actuales (Placeholder) -->
                    <div class="mt-20">
                        <p class="text-center text-sm text-slate-400 uppercase tracking-wider mb-8">Empresas que conf√≠an en nosotros</p>
                        <div class="flex flex-wrap justify-center items-center gap-8 opacity-50">
                            <div class="w-32 h-16 bg-slate-200 rounded-lg flex items-center justify-center text-slate-400 text-xs font-bold">
                                Tu Logo Aqu√≠
                            </div>
                            <div class="w-32 h-16 bg-slate-200 rounded-lg flex items-center justify-center text-slate-400 text-xs font-bold">
                                Tu Logo Aqu√≠
                            </div>
                            <div class="w-32 h-16 bg-slate-200 rounded-lg flex items-center justify-center text-slate-400 text-xs font-bold">
                                Tu Logo Aqu√≠
                            </div>
                            <div class="w-32 h-16 bg-slate-200 rounded-lg flex items-center justify-center text-slate-400 text-xs font-bold">
                                Tu Logo Aqu√≠
                            </div>
                        </div>
                        <p class="text-center text-xs text-slate-400 mt-4">¬°S√© el primero en aparecer aqu√≠!</p>
                    </div>
                </div>
            </div>

            <!-- ========== SECCI√ìN: CONTACTO R√ÅPIDO ========== -->
            <div class="relative bg-gradient-to-br from-slate-900 via-tec-dark to-tec-blue py-20 overflow-hidden">
                <div class="absolute inset-0">
                    <div class="absolute top-0 left-0 w-full h-full bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iMC4wMiI+PHBhdGggZD0iTTM2IDM0djItSDI0di0yaDEyek0zNiAyNHYySDI0di0yaDEyeiIvPjwvZz48L2c+PC9zdmc+')] opacity-50"></div>
                </div>
                
                <div class="container mx-auto px-6 relative z-10">
                    <div class="max-w-4xl mx-auto">
                        <div class="grid md:grid-cols-3 gap-8 text-center">
                            <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10">
                                <div class="w-14 h-14 bg-tec-gold rounded-2xl flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="map-pin" class="w-7 h-7 text-white"></i>
                                </div>
                                <h4 class="font-bold text-white mb-2">Ubicaci√≥n</h4>
                                <p class="text-blue-200 text-sm">Edificio M, Lab. Metal-Mec√°nica<br>TecNM Campus Mexicali</p>
                            </div>
                            
                            <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10">
                                <div class="w-14 h-14 bg-tec-gold rounded-2xl flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="mail" class="w-7 h-7 text-white"></i>
                                </div>
                                <h4 class="font-bold text-white mb-2">Correo</h4>
                                <p class="text-blue-200 text-sm">contacto@clubcrai.com<br>Respuesta en 24-48 hrs</p>
                            </div>
                            
                            <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10">
                                <div class="w-14 h-14 bg-tec-gold rounded-2xl flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="clock" class="w-7 h-7 text-white"></i>
                                </div>
                                <h4 class="font-bold text-white mb-2">Horario</h4>
                                <p class="text-blue-200 text-sm">Lunes a Viernes<br>9:00 AM - 9:00 PM</p>
                            </div>
                        </div>
                        
                        <div class="text-center mt-12">
                            <p class="text-blue-200 mb-4">S√≠guenos en redes sociales</p>
                            <div class="flex justify-center gap-4">
                                <a href="https://www.instagram.com/crai.itm/" target="_blank" class="w-12 h-12 bg-white/10 hover:bg-white/20 rounded-xl flex items-center justify-center transition-all">
                                    <i data-lucide="instagram" class="w-6 h-6 text-white"></i>
                                </a>
                                <a href="https://www.facebook.com/profile.php?id=61583401749916" target="_blank" class="w-12 h-12 bg-white/10 hover:bg-white/20 rounded-xl flex items-center justify-center transition-all">
                                    <i data-lucide="facebook" class="w-6 h-6 text-white"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==============================
             VISTA: PROYECTOS EN PROCESO (P√∫blico)
             ============================== -->
        <!-- ==============================
             VISTA 2: PROYECTOS (Grid)
             ============================== -->
        <section id="view-public-projects" class="view-section hidden min-h-screen">
            
            <!-- Hero Section Proyectos -->
            <div class="relative bg-gradient-to-br from-tec-blue via-blue-800 to-indigo-900 py-24 overflow-hidden">
                <div class="absolute inset-0">
                    <!-- Patr√≥n de circuitos animado -->
                    <div class="absolute inset-0 opacity-10">
                        <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <pattern id="circuit-pattern" x="0" y="0" width="100" height="100" patternUnits="userSpaceOnUse">
                                    <circle cx="50" cy="50" r="2" fill="white"/>
                                    <path d="M50 0 V50 H100" stroke="white" stroke-width="1" fill="none"/>
                                    <path d="M0 50 H25" stroke="white" stroke-width="1" fill="none"/>
                                    <circle cx="25" cy="50" r="3" fill="none" stroke="white" stroke-width="1"/>
                                </pattern>
                            </defs>
                            <rect width="100%" height="100%" fill="url(#circuit-pattern)"/>
                        </svg>
                    </div>
                    <div class="absolute -top-40 -right-40 w-[600px] h-[600px] bg-tec-gold/20 rounded-full blur-3xl"></div>
                    <div class="absolute -bottom-20 -left-20 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl"></div>
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-blue-400/10 rounded-full blur-3xl"></div>
                </div>
                
                <div class="container mx-auto px-6 relative z-10">
                    <div class="max-w-5xl mx-auto text-center">
                        <!-- Badge -->
                        <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur-sm text-white px-4 py-2 rounded-full mb-6">
                            <i data-lucide="cpu" class="w-4 h-4 text-tec-gold"></i>
                            <span class="font-bold text-xs uppercase tracking-wider">Portafolio de Proyectos</span>
                        </div>
                        
                        <h1 class="text-5xl md:text-6xl lg:text-7xl font-black text-white mb-6 drop-shadow-lg leading-tight">
                            Innovaci√≥n <span class="text-tec-gold">en Acci√≥n</span>
                        </h1>
                        
                        <p class="text-xl text-blue-100 max-w-3xl mx-auto mb-10 leading-relaxed">
                            Explora los proyectos que definen nuestra pasi√≥n por la rob√≥tica. Desde robots de combate hasta sistemas aut√≥nomos con IA.
                        </p>
                        
                        <!-- Stats r√°pidos -->
                        <div class="flex flex-wrap justify-center gap-8 mb-10">
                            <div class="text-center">
                                <div class="text-4xl font-black text-tec-gold" id="projects-count-stat">12+</div>
                                <div class="text-xs text-blue-200 uppercase tracking-wider">Proyectos</div>
                            </div>
                            <div class="h-12 w-px bg-white/20 hidden md:block"></div>
                            <div class="text-center">
                                <div class="text-4xl font-black text-white">5</div>
                                <div class="text-xs text-blue-200 uppercase tracking-wider">Categor√≠as</div>
                            </div>
                            <div class="h-12 w-px bg-white/20 hidden md:block"></div>
                            <div class="text-center">
                                <div class="text-4xl font-black text-white">3</div>
                                <div class="text-xs text-blue-200 uppercase tracking-wider">Competencias</div>
                            </div>
                        </div>

                        <!-- Buscador -->
                        <div class="max-w-2xl mx-auto">
                            <div class="relative">
                                <input type="text" id="project-search" placeholder="Buscar proyectos por nombre, categor√≠a o tecnolog√≠a..." 
                                    class="w-full px-6 py-4 pl-14 bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-tec-gold focus:border-transparent transition text-sm">
                                <i data-lucide="search" class="absolute left-5 top-1/2 -translate-y-1/2 w-5 h-5 text-blue-200"></i>
                                <button onclick="ProjectsFilter.clearSearch()" class="absolute right-4 top-1/2 -translate-y-1/2 text-blue-200 hover:text-white transition hidden" id="clear-search-btn">
                                    <i data-lucide="x" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Wave decorativo -->
                <div class="absolute bottom-0 left-0 right-0">
                    <svg viewBox="0 0 1440 120" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full">
                        <path d="M0 120L60 105C120 90 240 60 360 45C480 30 600 30 720 37.5C840 45 960 60 1080 67.5C1200 75 1320 75 1380 75L1440 75V120H1380C1320 120 1200 120 1080 120C960 120 840 120 720 120C600 120 480 120 360 120C240 120 120 120 60 120H0Z" fill="#F8FAFC"/>
                    </svg>
                </div>
            </div>

            <!-- Contenido Principal -->
            <div class="bg-slate-50 pb-20">
                <div class="container mx-auto px-6">
                    
                    <!-- Banner de Proyectos en Proceso -->
                    <div class="mb-8 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-2xl p-6 text-white relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"></div>
                        <div class="relative z-10 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                                    <i data-lucide="activity" class="w-6 h-6"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg flex items-center gap-2">
                                        <span class="w-2 h-2 bg-green-300 rounded-full animate-pulse"></span>
                                        Proyectos en Desarrollo
                                    </h3>
                                    <p class="text-emerald-100 text-sm">¬øQuieres ver en qu√© estamos trabajando ahora mismo?</p>
                                </div>
                            </div>
                            <button onclick="ProjectsFilter.setStatusFilter('in_progress'); document.getElementById('projects-filters-container')?.scrollIntoView({behavior: 'smooth'})" class="px-6 py-3 bg-white text-emerald-700 rounded-xl font-bold text-sm hover:bg-emerald-50 transition shadow-lg flex items-center gap-2">
                                <i data-lucide="eye" class="w-4 h-4"></i>
                                Ver Proyectos en Proceso
                            </button>
                        </div>
                    </div>
                    
                    <!-- Filtros por Categor√≠a -->
                    <div id="projects-filters-container" class="py-8 -mt-8 relative z-20">
                        <div class="bg-white rounded-2xl shadow-xl shadow-slate-200/50 p-6">
                            <!-- Filtros de Estado (Destacado) -->
                            <div class="flex flex-wrap items-center gap-3 mb-4 pb-4 border-b border-slate-100">
                                <span class="text-sm font-bold text-slate-600 flex items-center gap-2">
                                    <i data-lucide="activity" class="w-4 h-4 text-emerald-500"></i>
                                    Estado:
                                </span>
                                <button onclick="ProjectsFilter.setStatusFilter('all')" class="status-filter-btn bg-tec-blue text-white px-4 py-2 rounded-xl text-xs font-bold transition-all duration-300 flex items-center gap-2 hover:shadow-lg" data-status="all">
                                    <i data-lucide="layers" class="w-4 h-4"></i> Todos
                                </button>
                                <button onclick="ProjectsFilter.setStatusFilter('in_progress')" class="status-filter-btn bg-slate-100 text-slate-600 px-4 py-2 rounded-xl text-xs font-bold transition-all duration-300 flex items-center gap-2 hover:shadow-lg relative group" data-status="in_progress">
                                    <span class="absolute -top-1 -right-1 w-3 h-3 bg-emerald-500 rounded-full animate-pulse group-hover:scale-110"></span>
                                    <i data-lucide="loader" class="w-4 h-4"></i> En Proceso
                                </button>
                                <button onclick="ProjectsFilter.setStatusFilter('completed')" class="status-filter-btn bg-slate-100 text-slate-600 px-4 py-2 rounded-xl text-xs font-bold transition-all duration-300 flex items-center gap-2 hover:shadow-lg" data-status="completed">
                                    <i data-lucide="check-circle" class="w-4 h-4"></i> Completados
                                </button>
                            </div>
                            
                            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-tec-blue/10 rounded-xl flex items-center justify-center">
                                        <i data-lucide="filter" class="w-5 h-5 text-tec-blue"></i>
                                    </div>
                                    <div>
                                        <p class="font-bold text-tec-dark">Filtrar por Categor√≠a</p>
                                        <p class="text-xs text-slate-400">Explora proyectos por √°rea de especializaci√≥n</p>
                                    </div>
                                </div>
                                
                                <div class="flex flex-wrap gap-2" id="category-filters">
                                    <button onclick="ProjectsFilter.setCategory('all')" class="category-filter-btn active px-4 py-2 rounded-xl text-xs font-bold transition-all duration-300 flex items-center gap-2" data-category="all">
                                        <i data-lucide="layers" class="w-4 h-4"></i> Todos
                                    </button>
                                    <button onclick="ProjectsFilter.setCategory('Combate')" class="category-filter-btn px-4 py-2 rounded-xl text-xs font-bold transition-all duration-300 flex items-center gap-2" data-category="Combate">
                                        <i data-lucide="sword" class="w-4 h-4"></i> Combate
                                    </button>
                                    <button onclick="ProjectsFilter.setCategory('Drones')" class="category-filter-btn px-4 py-2 rounded-xl text-xs font-bold transition-all duration-300 flex items-center gap-2" data-category="Drones">
                                        <i data-lucide="plane" class="w-4 h-4"></i> Drones
                                    </button>
                                    <button onclick="ProjectsFilter.setCategory('Industrial')" class="category-filter-btn px-4 py-2 rounded-xl text-xs font-bold transition-all duration-300 flex items-center gap-2" data-category="Industrial">
                                        <i data-lucide="factory" class="w-4 h-4"></i> Industrial
                                    </button>
                                    <button onclick="ProjectsFilter.setCategory('Autonomo')" class="category-filter-btn px-4 py-2 rounded-xl text-xs font-bold transition-all duration-300 flex items-center gap-2" data-category="Autonomo">
                                        <i data-lucide="bot" class="w-4 h-4"></i> Aut√≥nomo
                                    </button>
                                    <button onclick="ProjectsFilter.setCategory('Software')" class="category-filter-btn px-4 py-2 rounded-xl text-xs font-bold transition-all duration-300 flex items-center gap-2" data-category="Software">
                                        <i data-lucide="code" class="w-4 h-4"></i> Software
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Ordenar y Vista -->
                            <div class="flex flex-wrap items-center justify-between mt-4 pt-4 border-t border-slate-100 gap-4">
                                <div class="flex items-center gap-2">
                                    <span class="text-xs text-slate-400">Ordenar:</span>
                                    <select id="project-sort" onchange="ProjectsFilter.sort(this.value)" class="text-xs font-bold text-tec-dark bg-slate-50 border-0 rounded-lg px-3 py-2 focus:ring-2 focus:ring-tec-blue cursor-pointer">
                                        <option value="newest">M√°s Recientes</option>
                                        <option value="oldest">M√°s Antiguos</option>
                                        <option value="name">Nombre A-Z</option>
                                    </select>
                                </div>
                                
                                <div class="flex items-center gap-4">
                                    <span class="text-xs text-slate-500" id="results-count">Mostrando todos los proyectos</span>
                                    <div class="flex items-center gap-1 bg-slate-100 rounded-lg p-1">
                                        <button onclick="ProjectsFilter.setView('grid')" class="view-btn active p-2 rounded-md transition" data-view="grid" title="Vista Cuadr√≠cula">
                                            <i data-lucide="grid-3x3" class="w-4 h-4"></i>
                                        </button>
                                        <button onclick="ProjectsFilter.setView('list')" class="view-btn p-2 rounded-md transition" data-view="list" title="Vista Lista">
                                            <i data-lucide="list" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Proyecto Destacado (Se llena din√°micamente si hay) -->
                    <div id="featured-project-container" class="mb-12 hidden">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-8 h-8 bg-tec-gold/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="star" class="w-4 h-4 text-tec-gold"></i>
                            </div>
                            <h2 class="text-2xl font-black text-tec-dark">Proyecto Destacado</h2>
                        </div>
                        <div id="featured-project" class="bg-gradient-to-br from-tec-blue to-indigo-800 rounded-3xl overflow-hidden shadow-2xl">
                            <!-- Se llena por JS -->
                        </div>
                    </div>
                    
                    <!-- T√≠tulo de la Secci√≥n -->
                    <div class="flex items-center justify-between mb-8">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-tec-blue/10 rounded-lg flex items-center justify-center">
                                <i data-lucide="folder-open" class="w-4 h-4 text-tec-blue"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl font-black text-tec-dark">Todos los Proyectos</h2>
                                <p class="text-xs text-slate-400">Explora nuestro cat√°logo completo de innovaciones</p>
                            </div>
                        </div>
                        
                        <!-- Indicador de login para archivos -->
                        <div class="hidden lg:flex items-center gap-2 text-xs text-slate-400 bg-slate-100 px-3 py-2 rounded-lg">
                            <i data-lucide="info" class="w-4 h-4"></i>
                            <span>Los archivos de proyecto requieren <button onclick="Modal.open('auth')" class="text-tec-blue font-bold hover:underline">inicio de sesi√≥n</button></span>
                        </div>
                    </div>

                    <!-- Grid/List Container (Llenado por JS) -->
                    <div id="public-projects-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 transition-all duration-300">
                        <!-- SKELETON LOADER -->
                        <div class="bg-white rounded-2xl h-[420px] p-5 animate-pulse shadow-sm border border-slate-100">
                            <div class="h-52 bg-slate-200 rounded-xl mb-4"></div>
                            <div class="h-4 bg-slate-200 w-1/3 mb-3 rounded-full"></div>
                            <div class="h-6 bg-slate-200 w-3/4 mb-2 rounded"></div>
                            <div class="h-4 bg-slate-200 w-full mb-2 rounded"></div>
                            <div class="h-4 bg-slate-200 w-2/3 rounded"></div>
                        </div>
                        <div class="bg-white rounded-2xl h-[420px] p-5 animate-pulse shadow-sm border border-slate-100 hidden md:block">
                            <div class="h-52 bg-slate-200 rounded-xl mb-4"></div>
                            <div class="h-4 bg-slate-200 w-1/3 mb-3 rounded-full"></div>
                            <div class="h-6 bg-slate-200 w-3/4 mb-2 rounded"></div>
                            <div class="h-4 bg-slate-200 w-full mb-2 rounded"></div>
                            <div class="h-4 bg-slate-200 w-2/3 rounded"></div>
                        </div>
                        <div class="bg-white rounded-2xl h-[420px] p-5 animate-pulse shadow-sm border border-slate-100 hidden lg:block">
                            <div class="h-52 bg-slate-200 rounded-xl mb-4"></div>
                            <div class="h-4 bg-slate-200 w-1/3 mb-3 rounded-full"></div>
                            <div class="h-6 bg-slate-200 w-3/4 mb-2 rounded"></div>
                            <div class="h-4 bg-slate-200 w-full mb-2 rounded"></div>
                            <div class="h-4 bg-slate-200 w-2/3 rounded"></div>
                        </div>
                    </div>

                    <!-- Estado vac√≠o -->
                    <div id="no-projects-message" class="hidden text-center py-20">
                        <div class="w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i data-lucide="search-x" class="w-12 h-12 text-slate-300"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-400 mb-2">No se encontraron proyectos</h3>
                        <p class="text-sm text-slate-400 mb-6">Intenta con otros filtros o t√©rminos de b√∫squeda</p>
                        <button onclick="ProjectsFilter.reset()" class="px-6 py-3 bg-tec-blue text-white rounded-xl font-bold text-sm hover:bg-tec-dark transition">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline mr-2"></i> Restablecer Filtros
                        </button>
                    </div>

                    <!-- Load More -->
                    <div id="load-more-container" class="text-center mt-12 hidden">
                        <button onclick="ProjectsFilter.loadMore()" class="px-8 py-4 bg-white border-2 border-tec-blue text-tec-blue rounded-xl font-bold text-sm hover:bg-tec-blue hover:text-white transition-all duration-300 shadow-lg shadow-slate-200/50 flex items-center gap-2 mx-auto">
                            <i data-lucide="plus" class="w-4 h-4"></i> Cargar M√°s Proyectos
                        </button>
                    </div>
                    
                    <!-- CTA Final -->
                    <div class="mt-20 bg-gradient-to-r from-tec-blue to-indigo-700 rounded-3xl p-10 md:p-14 relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"></div>
                        <div class="absolute bottom-0 left-0 w-48 h-48 bg-tec-gold/20 rounded-full translate-y-1/2 -translate-x-1/2 blur-2xl"></div>
                        
                        <div class="relative z-10 flex flex-col lg:flex-row items-center justify-between gap-8">
                            <div class="text-center lg:text-left">
                                <h3 class="text-3xl md:text-4xl font-black text-white mb-3">¬øTe interesa patrocinar nuestro pr√≥ximo proyecto?</h3>
                                <p class="text-blue-100 max-w-xl">Tu apoyo impulsa la innovaci√≥n. Patrocina un proyecto y forma parte de nuestra historia en rob√≥tica y tecnolog√≠a.</p>
                            </div>
                            <div class="flex flex-col sm:flex-row gap-4">
                                <a onclick="Router.to('public-donate')" class="px-8 py-4 bg-tec-gold text-tec-dark rounded-xl font-bold text-sm hover:bg-yellow-400 transition-all duration-300 shadow-lg flex items-center gap-2 justify-center cursor-pointer">
                                    <i data-lucide="heart-handshake" class="w-4 h-4"></i> Ser Patrocinador
                                </a>
                                <a onclick="Util.sendEmail('contacto@clubcrai.com', 'Patrocinio de Proyecto - CRAI', 'Hola, me interesa patrocinar un proyecto del club CRAI.\n\n');" class="px-8 py-4 bg-white/10 backdrop-blur text-white border border-white/20 rounded-xl font-bold text-sm hover:bg-white/20 transition-all duration-300 flex items-center gap-2 justify-center cursor-pointer">
                                    <i data-lucide="mail" class="w-4 h-4"></i> Cont√°ctanos
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==============================
             VISTA 3: DONACIONES & SPONSORS
             ============================== -->
        <section id="view-public-donate" class="view-section hidden min-h-screen">
            <!-- Hero de Donaciones -->
            <div class="relative bg-gradient-to-br from-tec-gold via-yellow-500 to-orange-500 py-24 overflow-hidden">
                <div class="absolute inset-0">
                    <div class="absolute top-0 left-0 w-full h-full bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iMC4xIj48cGF0aCBkPSJNMzYgMzR2LTJIMjR2Mmgxem0wLTEwdjJIMjR2LTJoMTJ6Ii8+PC9nPjwvZz48L3N2Zz4=')] opacity-30"></div>
                    <div class="absolute -top-20 -right-20 w-96 h-96 bg-white/20 rounded-full blur-3xl"></div>
                    <div class="absolute -bottom-40 -left-20 w-80 h-80 bg-orange-600/30 rounded-full blur-3xl"></div>
                </div>
                
                <div class="container mx-auto px-6 relative z-10">
                    <div class="max-w-4xl mx-auto text-center">
                        <div class="inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm text-white px-4 py-2 rounded-full mb-6">
                            <i data-lucide="heart" class="w-4 h-4 animate-pulse"></i>
                            <span class="font-bold text-xs uppercase tracking-wider">Apoya el Futuro</span>
                        </div>
                        
                        <h1 class="text-3xl sm:text-5xl md:text-6xl font-black text-white mb-6 drop-shadow-lg">
                            Impulsa la <span class="text-tec-dark">Innovaci√≥n</span>
                        </h1>
                        
                        <p class="text-base sm:text-xl text-white/90 max-w-2xl mx-auto mb-8 leading-relaxed">
                            Cada donaci√≥n nos acerca a representar a M√©xico en competencias internacionales de rob√≥tica
                        </p>
                        
                        <div class="flex flex-wrap justify-center gap-3 sm:gap-6 text-white">
                            <div class="flex items-center gap-2 bg-white/10 backdrop-blur px-3 sm:px-4 py-2 rounded-full">
                                <i data-lucide="trophy" class="w-4 sm:w-5 h-4 sm:h-5"></i>
                                <span class="font-bold text-xs sm:text-sm">Competencias</span>
                            </div>
                            <div class="flex items-center gap-2 bg-white/10 backdrop-blur px-3 sm:px-4 py-2 rounded-full">
                                <i data-lucide="cpu" class="w-4 sm:w-5 h-4 sm:h-5"></i>
                                <span class="font-bold text-xs sm:text-sm">Materiales</span>
                            </div>
                            <div class="flex items-center gap-2 bg-white/10 backdrop-blur px-3 sm:px-4 py-2 rounded-full">
                                <i data-lucide="users" class="w-4 sm:w-5 h-4 sm:h-5"></i>
                                <span class="font-bold text-xs sm:text-sm">Capacitaci√≥n</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Wave separator -->
                <div class="absolute bottom-0 left-0 w-full overflow-hidden">
                    <svg viewBox="0 0 1200 120" preserveAspectRatio="none" class="w-full h-16 text-white fill-current">
                        <path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V120H0V95.8C57.1,118.92,156.63,69.08,321.39,56.44Z"></path>
                    </svg>
                </div>
            </div>

            <!-- Contenido Principal -->
            <div class="bg-white py-20">
                <div class="container mx-auto px-6">
                    
                    <!-- Secci√≥n: Por qu√© donar -->
                    <div class="max-w-6xl mx-auto mb-16 sm:mb-20">
                        <div class="text-center mb-10 sm:mb-12">
                            <h2 class="text-2xl sm:text-3xl font-black text-tec-dark mb-4">¬øEn Qu√© Se Usa Tu Donaci√≥n?</h2>
                            <p class="text-slate-500 max-w-2xl mx-auto text-sm sm:text-base">100% de las donaciones van directamente a proyectos y competencias</p>
                        </div>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 sm:gap-6">
                            <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-2xl text-center group hover:shadow-xl transition-all hover:-translate-y-1">
                                <div class="w-16 h-16 bg-blue-500 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform shadow-lg shadow-blue-500/30">
                                    <i data-lucide="cpu" class="w-8 h-8 text-white"></i>
                                </div>
                                <h4 class="font-bold text-slate-800 mb-2">Electr√≥nica</h4>
                                <p class="text-xs text-slate-500">Microcontroladores, sensores y componentes</p>
                            </div>
                            
                            <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-2xl text-center group hover:shadow-xl transition-all hover:-translate-y-1">
                                <div class="w-16 h-16 bg-green-500 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform shadow-lg shadow-green-500/30">
                                    <i data-lucide="cog" class="w-8 h-8 text-white"></i>
                                </div>
                                <h4 class="font-bold text-slate-800 mb-2">Mec√°nica</h4>
                                <p class="text-xs text-slate-500">Motores, transmisiones y chasis</p>
                            </div>
                            
                            <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-2xl text-center group hover:shadow-xl transition-all hover:-translate-y-1">
                                <div class="w-16 h-16 bg-purple-500 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform shadow-lg shadow-purple-500/30">
                                    <i data-lucide="printer" class="w-8 h-8 text-white"></i>
                                </div>
                                <h4 class="font-bold text-slate-800 mb-2">Manufactura</h4>
                                <p class="text-xs text-slate-500">Filamento 3D y materiales CNC</p>
                            </div>
                            
                            <div class="bg-gradient-to-br from-orange-50 to-orange-100 p-6 rounded-2xl text-center group hover:shadow-xl transition-all hover:-translate-y-1">
                                <div class="w-16 h-16 bg-orange-500 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform shadow-lg shadow-orange-500/30">
                                    <i data-lucide="plane" class="w-8 h-8 text-white"></i>
                                </div>
                                <h4 class="font-bold text-slate-800 mb-2">Competencias</h4>
                                <p class="text-xs text-slate-500">Vi√°ticos e inscripciones</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- M√©todos de Donaci√≥n -->
                    <div class="max-w-5xl mx-auto">
                        <div class="grid lg:grid-cols-2 gap-8">
                            
                            <!-- Tarjeta: Transferencia -->
                            <div class="bg-gradient-to-br from-tec-dark to-slate-900 text-white p-8 rounded-3xl shadow-2xl relative overflow-hidden group">
                                <div class="absolute -right-10 -top-10 w-40 h-40 bg-tec-blue/30 rounded-full blur-2xl group-hover:bg-tec-gold/30 transition-colors duration-500"></div>
                                <div class="absolute -left-10 -bottom-10 w-32 h-32 bg-tec-gold/20 rounded-full blur-2xl"></div>
                                
                                <div class="relative z-10">
                                    <div class="flex items-center gap-3 mb-6">
                                        <div class="w-12 h-12 bg-tec-gold rounded-xl flex items-center justify-center">
                                            <i data-lucide="building-2" class="w-6 h-6 text-tec-dark"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-xl font-black">Transferencia Bancaria</h3>
                                            <p class="text-xs text-slate-400">SPEI / Dep√≥sito en ventanilla</p>
                                        </div>
                                    </div>
                                    
                                    <div class="space-y-4 mb-6">
                                        <div class="bg-white/10 backdrop-blur-sm p-4 rounded-xl border border-white/10">
                                            <p class="text-[10px] text-slate-400 uppercase tracking-wider mb-1">Banco</p>
                                            <p class="font-bold text-lg">BBVA M√©xico</p>
                                        </div>
                                        
                                        <div class="bg-white/10 backdrop-blur-sm p-4 rounded-xl border border-white/10">
                                            <p class="text-[10px] text-slate-400 uppercase tracking-wider mb-1">CLABE Interbancaria</p>
                                            <p class="font-mono text-lg tracking-wider" id="cms-bank-account">012 905 0123 4567 8901</p>
                                        </div>
                                        
                                        <div class="bg-white/10 backdrop-blur-sm p-4 rounded-xl border border-white/10">
                                            <p class="text-[10px] text-slate-400 uppercase tracking-wider mb-1">Beneficiario</p>
                                            <p class="font-bold">Patronato del TecNM Mexicali A.C.</p>
                                            <p class="text-xs text-tec-gold mt-1">Referencia: CRAI + Tu nombre</p>
                                        </div>
                                    </div>
                                    
                                    <button onclick="navigator.clipboard.writeText('012905012345678901'); Util.notify('CLABE copiada', 'success')" class="w-full py-3 bg-white/10 hover:bg-white/20 border border-white/20 rounded-xl font-bold text-sm transition flex items-center justify-center gap-2">
                                        <i data-lucide="copy" class="w-4 h-4"></i>
                                        Copiar CLABE
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Tarjeta: PayPal -->
                            <div class="bg-gradient-to-br from-[#003087] to-[#001f5c] text-white p-8 rounded-3xl shadow-2xl relative overflow-hidden group">
                                <div class="absolute -right-10 -top-10 w-40 h-40 bg-[#0070ba]/30 rounded-full blur-2xl"></div>
                                <div class="absolute -left-10 -bottom-10 w-32 h-32 bg-[#00457c]/30 rounded-full blur-2xl"></div>
                                
                                <div class="relative z-10">
                                    <div class="flex items-center gap-3 mb-6">
                                        <div class="w-12 h-12 bg-white rounded-xl flex items-center justify-center">
                                            <img src="https://upload.wikimedia.org/wikipedia/commons/b/b5/PayPal.svg" class="h-5 w-auto">
                                        </div>
                                        <div>
                                            <h3 class="text-xl font-black">PayPal</h3>
                                            <p class="text-xs text-blue-200">Tarjeta de cr√©dito/d√©bito</p>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-white/10 backdrop-blur-sm p-6 rounded-xl border border-white/10 mb-6">
                                        <div class="flex items-center justify-center gap-4 mb-4">
                                            <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" class="h-6 filter brightness-0 invert opacity-70">
                                            <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" class="h-8 opacity-70">
                                            <img src="https://upload.wikimedia.org/wikipedia/commons/f/fa/American_Express_logo_%282018%29.svg" class="h-6 filter brightness-0 invert opacity-70">
                                        </div>
                                        <p class="text-center text-sm text-blue-200">Acepta todas las tarjetas principales</p>
                                    </div>
                                    
                                    <div class="space-y-3">
                                        <button onclick="Util.fakePayPal()" class="w-full py-4 bg-[#ffc439] hover:bg-[#f0b800] text-[#003087] rounded-xl font-black text-sm transition flex items-center justify-center gap-2 shadow-lg">
                                            <img src="https://upload.wikimedia.org/wikipedia/commons/b/b5/PayPal.svg" class="h-5 w-auto">
                                            Donar con PayPal
                                        </button>
                                        
                                        <p class="text-center text-[10px] text-blue-300">
                                            <i data-lucide="shield-check" class="w-3 h-3 inline mr-1"></i>
                                            Transacci√≥n segura y encriptada
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Montos Sugeridos -->
                        <div class="mt-12 text-center">
                            <p class="text-sm text-slate-500 mb-6">Montos sugeridos de donaci√≥n</p>
                            <div class="flex flex-wrap justify-center gap-4">
                                <button onclick="Util.notify('Gracias por considerar $100 MXN', 'info')" class="px-8 py-4 bg-slate-100 hover:bg-tec-gold hover:text-white rounded-xl font-black text-lg text-slate-700 transition-all hover:scale-105 hover:shadow-lg">
                                    $100
                                </button>
                                <button onclick="Util.notify('Gracias por considerar $250 MXN', 'info')" class="px-8 py-4 bg-slate-100 hover:bg-tec-gold hover:text-white rounded-xl font-black text-lg text-slate-700 transition-all hover:scale-105 hover:shadow-lg">
                                    $250
                                </button>
                                <button onclick="Util.notify('Gracias por considerar $500 MXN', 'info')" class="px-8 py-4 bg-slate-100 hover:bg-tec-gold hover:text-white rounded-xl font-black text-lg text-slate-700 transition-all hover:scale-105 hover:shadow-lg">
                                    $500
                                </button>
                                <button onclick="Util.notify('¬°Incre√≠ble! $1,000 MXN marca la diferencia', 'success')" class="px-8 py-4 bg-tec-gold text-white rounded-xl font-black text-lg transition-all hover:scale-105 hover:shadow-lg shadow-tec-gold/30">
                                    $1,000
                                </button>
                                <button onclick="Util.notify('Tu generosidad no tiene l√≠mites üíõ', 'success')" class="px-8 py-4 border-2 border-tec-gold text-tec-gold hover:bg-tec-gold hover:text-white rounded-xl font-black text-lg transition-all hover:scale-105">
                                    Otro
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Secci√≥n: Socios Comerciales -->
                    <div class="max-w-5xl mx-auto mt-24">
                        <div class="bg-gradient-to-r from-slate-50 to-slate-100 rounded-3xl p-10 border border-slate-200">
                            <div class="grid lg:grid-cols-2 gap-10 items-center">
                                <div>
                                    <div class="inline-flex items-center gap-2 bg-tec-blue/10 text-tec-blue px-3 py-1 rounded-full mb-4">
                                        <i data-lucide="building" class="w-4 h-4"></i>
                                        <span class="text-xs font-bold uppercase">Para Empresas</span>
                                    </div>
                                    <h3 class="text-3xl font-black text-tec-dark mb-4">Convi√©rtete en Patrocinador</h3>
                                    <p class="text-slate-500 mb-6">Tu marca en nuestros robots, uniformes y eventos. Accede a talento de ingenier√≠a directamente.</p>
                                    
                                    <ul class="space-y-3 mb-6">
                                        <li class="flex items-center gap-3 text-sm text-slate-600">
                                            <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center">
                                                <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                                            </div>
                                            Logo en robots de competencia
                                        </li>
                                        <li class="flex items-center gap-3 text-sm text-slate-600">
                                            <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center">
                                                <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                                            </div>
                                            Menci√≥n en redes sociales
                                        </li>
                                        <li class="flex items-center gap-3 text-sm text-slate-600">
                                            <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center">
                                                <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                                            </div>
                                            Acceso a bolsa de talento
                                        </li>
                                        <li class="flex items-center gap-3 text-sm text-slate-600">
                                            <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center">
                                                <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                                            </div>
                                            Deducci√≥n de impuestos
                                        </li>
                                    </ul>
                                    
                                    <a onclick="Util.sendEmail('contacto@clubcrai.com', 'Solicitud Media Kit - CRAI', 'Hola, me gustar√≠a recibir el Media Kit de patrocinio del club CRAI.\n\nEmpresa:\nContacto:\nTel√©fono:\n');" class="inline-flex items-center gap-2 px-6 py-3 bg-tec-blue text-white rounded-xl font-bold text-sm hover:bg-tec-dark transition cursor-pointer">
                                        <i data-lucide="mail" class="w-4 h-4"></i>
                                        Solicitar Media Kit
                                    </a>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="h-28 bg-white border-2 border-dashed border-slate-300 rounded-xl flex items-center justify-center hover:border-tec-gold transition-colors cursor-pointer group">
                                        <div class="text-center">
                                            <i data-lucide="image-plus" class="w-8 h-8 text-slate-300 mx-auto mb-2 group-hover:text-tec-gold transition-colors"></i>
                                            <p class="text-xs text-slate-400 font-bold">Tu Logo Aqu√≠</p>
                                        </div>
                                    </div>
                                    <div class="h-28 bg-white border-2 border-dashed border-slate-300 rounded-xl flex items-center justify-center hover:border-tec-gold transition-colors cursor-pointer group">
                                        <div class="text-center">
                                            <i data-lucide="image-plus" class="w-8 h-8 text-slate-300 mx-auto mb-2 group-hover:text-tec-gold transition-colors"></i>
                                            <p class="text-xs text-slate-400 font-bold">Tu Logo Aqu√≠</p>
                                        </div>
                                    </div>
                                    <div class="h-28 bg-white border-2 border-dashed border-slate-300 rounded-xl flex items-center justify-center hover:border-tec-gold transition-colors cursor-pointer group">
                                        <div class="text-center">
                                            <i data-lucide="image-plus" class="w-8 h-8 text-slate-300 mx-auto mb-2 group-hover:text-tec-gold transition-colors"></i>
                                            <p class="text-xs text-slate-400 font-bold">Tu Logo Aqu√≠</p>
                                        </div>
                                    </div>
                                    <div class="h-28 bg-white border-2 border-dashed border-slate-300 rounded-xl flex items-center justify-center hover:border-tec-gold transition-colors cursor-pointer group">
                                        <div class="text-center">
                                            <i data-lucide="image-plus" class="w-8 h-8 text-slate-300 mx-auto mb-2 group-hover:text-tec-gold transition-colors"></i>
                                            <p class="text-xs text-slate-400 font-bold">Tu Logo Aqu√≠</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Patrocinio en Especie -->
                    <div class="max-w-5xl mx-auto mt-16">
                        <div class="bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50 rounded-3xl shadow-xl overflow-hidden border border-emerald-200">
                            <div class="bg-gradient-to-r from-emerald-600 via-teal-600 to-emerald-600 p-6 sm:p-8 text-white text-center relative overflow-hidden">
                                <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iMC4xIj48cGF0aCBkPSJNMzYgMzR2LTRoLTJ2NGgtNHYyaDR2NGgydi00aDR2LTJoLTR6bTAtMzBWMGgtMnY0aC00djJoNHY0aDJWNmg0VjRoLTR6TTYgMzR2LTRINHY0SDB2Mmg0djRoMnYtNGg0di0ySDZ6TTYgNFYwSDR2NEgwdjJoNHY0aDJWNmg0VjRINnoiLz48L2c+PC9nPjwvc3ZnPg==')] opacity-30"></div>
                                <div class="relative z-10">
                                    <div class="inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm rounded-full px-4 py-1.5 mb-4">
                                        <i data-lucide="package" class="w-4 h-4"></i>
                                        <span class="text-xs font-bold uppercase tracking-wider">Alternativa Flexible</span>
                                    </div>
                                    <h3 class="text-2xl sm:text-3xl font-black mb-2">Patrocinio en Especie</h3>
                                    <p class="text-emerald-100 max-w-2xl mx-auto text-sm sm:text-base">¬øNo puedes donar dinero? ¬°No hay problema! Acepta materiales, componentes, servicios o equipos.</p>
                                </div>
                            </div>
                            
                            <div class="p-6 sm:p-8">
                                <!-- Qu√© aceptamos -->
                                <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8">
                                    <!-- Componentes Electr√≥nicos -->
                                    <div class="bg-white rounded-2xl p-5 shadow-md border border-emerald-100 hover:shadow-lg hover:border-emerald-300 transition-all group">
                                        <div class="w-12 h-12 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl flex items-center justify-center mb-3 group-hover:scale-110 transition-transform shadow-lg shadow-emerald-500/30">
                                            <i data-lucide="cpu" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <h4 class="font-bold text-tec-dark text-sm mb-2">Componentes Electr√≥nicos</h4>
                                        <ul class="text-[11px] text-slate-500 space-y-1">
                                            <li class="flex items-start gap-1"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Microcontroladores</li>
                                            <li class="flex items-start gap-1"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Sensores y motores</li>
                                            <li class="flex items-start gap-1"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Bater√≠as y cables</li>
                                        </ul>
                                    </div>
                                    
                                    <!-- Materiales -->
                                    <div class="bg-white rounded-2xl p-5 shadow-md border border-emerald-100 hover:shadow-lg hover:border-emerald-300 transition-all group">
                                        <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-red-500 rounded-xl flex items-center justify-center mb-3 group-hover:scale-110 transition-transform shadow-lg shadow-orange-500/30">
                                            <i data-lucide="hammer" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <h4 class="font-bold text-tec-dark text-sm mb-2">Materiales</h4>
                                        <ul class="text-[11px] text-slate-500 space-y-1">
                                            <li class="flex items-start gap-1"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Filamento 3D</li>
                                            <li class="flex items-start gap-1"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Acr√≠lico y MDF</li>
                                            <li class="flex items-start gap-1"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Aluminio y torniller√≠a</li>
                                        </ul>
                                    </div>
                                    
                                    <!-- Herramientas -->
                                    <div class="bg-white rounded-2xl p-5 shadow-md border border-emerald-100 hover:shadow-lg hover:border-emerald-300 transition-all group">
                                        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center mb-3 group-hover:scale-110 transition-transform shadow-lg shadow-blue-500/30">
                                            <i data-lucide="wrench" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <h4 class="font-bold text-tec-dark text-sm mb-2">Herramientas</h4>
                                        <ul class="text-[11px] text-slate-500 space-y-1">
                                            <li class="flex items-start gap-1"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Mult√≠metros</li>
                                            <li class="flex items-start gap-1"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Cautines y pistolas</li>
                                            <li class="flex items-start gap-1"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Impresoras 3D</li>
                                        </ul>
                                    </div>
                                    
                                    <!-- Servicios -->
                                    <div class="bg-white rounded-2xl p-5 shadow-md border border-emerald-100 hover:shadow-lg hover:border-emerald-300 transition-all group">
                                        <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center mb-3 group-hover:scale-110 transition-transform shadow-lg shadow-purple-500/30">
                                            <i data-lucide="handshake" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <h4 class="font-bold text-tec-dark text-sm mb-2">Servicios</h4>
                                        <ul class="text-[11px] text-slate-500 space-y-1">
                                            <li class="flex items-start gap-1"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Corte l√°ser/CNC</li>
                                            <li class="flex items-start gap-1"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Transporte</li>
                                            <li class="flex items-start gap-1"><i data-lucide="check" class="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0"></i> Hospedaje</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <!-- Beneficios del patrocinador -->
                                <div class="bg-white rounded-2xl p-5 border border-emerald-200 mb-6">
                                    <h4 class="font-bold text-tec-dark text-sm mb-4 flex items-center gap-2">
                                        <i data-lucide="gift" class="w-4 h-4 text-emerald-600"></i>
                                        Beneficios para el Patrocinador
                                    </h4>
                                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3">
                                        <div class="flex items-center gap-2 p-2 bg-emerald-50 rounded-lg">
                                            <div class="w-6 h-6 bg-emerald-500 rounded flex items-center justify-center flex-shrink-0">
                                                <i data-lucide="file-badge" class="w-3 h-3 text-white"></i>
                                            </div>
                                            <p class="text-[10px] text-tec-dark font-bold">Carta de Donaci√≥n</p>
                                        </div>
                                        <div class="flex items-center gap-2 p-2 bg-emerald-50 rounded-lg">
                                            <div class="w-6 h-6 bg-emerald-500 rounded flex items-center justify-center flex-shrink-0">
                                                <i data-lucide="image" class="w-3 h-3 text-white"></i>
                                            </div>
                                            <p class="text-[10px] text-tec-dark font-bold">Logo Visible</p>
                                        </div>
                                        <div class="flex items-center gap-2 p-2 bg-emerald-50 rounded-lg">
                                            <div class="w-6 h-6 bg-emerald-500 rounded flex items-center justify-center flex-shrink-0">
                                                <i data-lucide="camera" class="w-3 h-3 text-white"></i>
                                            </div>
                                            <p class="text-[10px] text-tec-dark font-bold">Reconocimiento</p>
                                        </div>
                                        <div class="flex items-center gap-2 p-2 bg-emerald-50 rounded-lg">
                                            <div class="w-6 h-6 bg-emerald-500 rounded flex items-center justify-center flex-shrink-0">
                                                <i data-lucide="users" class="w-3 h-3 text-white"></i>
                                            </div>
                                            <p class="text-[10px] text-tec-dark font-bold">Networking</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Niveles de Patrocinio -->
                                <div class="bg-gradient-to-br from-slate-50 to-emerald-50 rounded-2xl p-5 border border-emerald-200 mb-6">
                                    <h4 class="font-bold text-tec-dark text-sm mb-4 text-center flex items-center justify-center gap-2">
                                        <i data-lucide="trophy" class="w-4 h-4 text-tec-gold"></i>
                                        Niveles seg√∫n Valor de Aportaci√≥n
                                    </h4>
                                    <div class="grid md:grid-cols-3 gap-4">
                                        <!-- Bronce -->
                                        <div class="bg-white rounded-xl overflow-hidden shadow-sm border border-amber-700/20">
                                            <div class="bg-gradient-to-r from-amber-700 to-amber-600 p-3 text-white text-center">
                                                <i data-lucide="medal" class="w-5 h-5 mx-auto mb-1"></i>
                                                <h5 class="font-bold text-sm">Bronce</h5>
                                                <p class="text-amber-200 text-[10px]">Hasta $5,000 MXN</p>
                                            </div>
                                            <div class="p-3">
                                                <ul class="text-[10px] text-slate-600 space-y-1">
                                                    <li class="flex items-start gap-1"><i data-lucide="check-circle" class="w-3 h-3 text-emerald-500 flex-shrink-0"></i> Menci√≥n en redes</li>
                                                    <li class="flex items-start gap-1"><i data-lucide="check-circle" class="w-3 h-3 text-emerald-500 flex-shrink-0"></i> Carta oficial</li>
                                                    <li class="flex items-start gap-1"><i data-lucide="check-circle" class="w-3 h-3 text-emerald-500 flex-shrink-0"></i> Logo en web</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <!-- Plata -->
                                        <div class="bg-white rounded-xl overflow-hidden shadow-md border border-slate-400/30 transform md:scale-105">
                                            <div class="bg-gradient-to-r from-slate-500 to-slate-400 p-3 text-white text-center">
                                                <i data-lucide="award" class="w-5 h-5 mx-auto mb-1"></i>
                                                <h5 class="font-bold text-sm">Plata</h5>
                                                <p class="text-slate-200 text-[10px]">$5,001 - $15,000 MXN</p>
                                            </div>
                                            <div class="p-3">
                                                <ul class="text-[10px] text-slate-600 space-y-1">
                                                    <li class="flex items-start gap-1"><i data-lucide="check-circle" class="w-3 h-3 text-emerald-500 flex-shrink-0"></i> Todo de Bronce</li>
                                                    <li class="flex items-start gap-1"><i data-lucide="check-circle" class="w-3 h-3 text-emerald-500 flex-shrink-0"></i> Logo en uniformes</li>
                                                    <li class="flex items-start gap-1"><i data-lucide="check-circle" class="w-3 h-3 text-emerald-500 flex-shrink-0"></i> Visita al lab</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <!-- Oro -->
                                        <div class="bg-white rounded-xl overflow-hidden shadow-lg border border-tec-gold/30">
                                            <div class="bg-gradient-to-r from-tec-gold to-yellow-500 p-3 text-tec-dark text-center">
                                                <i data-lucide="crown" class="w-5 h-5 mx-auto mb-1"></i>
                                                <h5 class="font-bold text-sm">Oro</h5>
                                                <p class="text-yellow-800 text-[10px]">+$15,000 MXN</p>
                                            </div>
                                            <div class="p-3">
                                                <ul class="text-[10px] text-slate-600 space-y-1">
                                                    <li class="flex items-start gap-1"><i data-lucide="check-circle" class="w-3 h-3 text-emerald-500 flex-shrink-0"></i> Todo de Plata</li>
                                                    <li class="flex items-start gap-1"><i data-lucide="check-circle" class="w-3 h-3 text-emerald-500 flex-shrink-0"></i> Logo en robots</li>
                                                    <li class="flex items-start gap-1"><i data-lucide="check-circle" class="w-3 h-3 text-emerald-500 flex-shrink-0"></i> Acceso a talento</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Beneficios Extra -->
                                <div class="bg-gradient-to-r from-tec-blue to-indigo-800 rounded-2xl p-5 text-white mb-6">
                                    <h4 class="font-bold text-sm mb-4 text-center flex items-center justify-center gap-2">
                                        <i data-lucide="sparkles" class="w-4 h-4 text-tec-gold"></i>
                                        Beneficios Extra para Patrocinadores Estrat√©gicos
                                    </h4>
                                    <div class="grid grid-cols-2 lg:grid-cols-3 gap-3">
                                        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3 border border-white/20">
                                            <div class="flex items-center gap-2 mb-1">
                                                <div class="w-7 h-7 bg-tec-gold rounded flex items-center justify-center">
                                                    <i data-lucide="user-search" class="w-3 h-3 text-tec-dark"></i>
                                                </div>
                                                <h5 class="font-bold text-[11px]">Acceso a Talento</h5>
                                            </div>
                                            <p class="text-[10px] text-blue-200">Recluta a nuestros miembros destacados</p>
                                        </div>
                                        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3 border border-white/20">
                                            <div class="flex items-center gap-2 mb-1">
                                                <div class="w-7 h-7 bg-tec-gold rounded flex items-center justify-center">
                                                    <i data-lucide="presentation" class="w-3 h-3 text-tec-dark"></i>
                                                </div>
                                                <h5 class="font-bold text-[11px]">Demos Privadas</h5>
                                            </div>
                                            <p class="text-[10px] text-blue-200">Acceso exclusivo a proyectos</p>
                                        </div>
                                        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3 border border-white/20">
                                            <div class="flex items-center gap-2 mb-1">
                                                <div class="w-7 h-7 bg-tec-gold rounded flex items-center justify-center">
                                                    <i data-lucide="code-2" class="w-3 h-3 text-tec-dark"></i>
                                                </div>
                                                <h5 class="font-bold text-[11px]">Proyectos Conjuntos</h5>
                                            </div>
                                            <p class="text-[10px] text-blue-200">Colabora en prototipos</p>
                                        </div>
                                        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3 border border-white/20">
                                            <div class="flex items-center gap-2 mb-1">
                                                <div class="w-7 h-7 bg-tec-gold rounded flex items-center justify-center">
                                                    <i data-lucide="video" class="w-3 h-3 text-tec-dark"></i>
                                                </div>
                                                <h5 class="font-bold text-[11px]">Contenido de Marca</h5>
                                            </div>
                                            <p class="text-[10px] text-blue-200">Videos y fotos profesionales</p>
                                        </div>
                                        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3 border border-white/20">
                                            <div class="flex items-center gap-2 mb-1">
                                                <div class="w-7 h-7 bg-tec-gold rounded flex items-center justify-center">
                                                    <i data-lucide="building" class="w-3 h-3 text-tec-dark"></i>
                                                </div>
                                                <h5 class="font-bold text-[11px]">Visitas a Empresa</h5>
                                            </div>
                                            <p class="text-[10px] text-blue-200">Presentaciones t√©cnicas</p>
                                        </div>
                                        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3 border border-white/20">
                                            <div class="flex items-center gap-2 mb-1">
                                                <div class="w-7 h-7 bg-tec-gold rounded flex items-center justify-center">
                                                    <i data-lucide="mic" class="w-3 h-3 text-tec-dark"></i>
                                                </div>
                                                <h5 class="font-bold text-[11px]">Talleres y Charlas</h5>
                                            </div>
                                            <p class="text-[10px] text-blue-200">Imparte en el club</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Proceso -->
                                <div class="bg-white rounded-2xl p-5 border border-emerald-200 mb-6">
                                    <h4 class="font-bold text-tec-dark text-sm mb-4 text-center flex items-center justify-center gap-2">
                                        <i data-lucide="route" class="w-4 h-4 text-emerald-600"></i>
                                        ¬øC√≥mo funciona?
                                    </h4>
                                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3">
                                        <div class="text-center p-2">
                                            <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-2 text-white font-bold text-sm shadow-lg">1</div>
                                            <h5 class="font-bold text-[11px] text-tec-dark">Cont√°ctanos</h5>
                                            <p class="text-[10px] text-slate-500">Env√≠a tu propuesta</p>
                                        </div>
                                        <div class="text-center p-2">
                                            <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-2 text-white font-bold text-sm shadow-lg">2</div>
                                            <h5 class="font-bold text-[11px] text-tec-dark">Evaluamos</h5>
                                            <p class="text-[10px] text-slate-500">Definimos beneficios</p>
                                        </div>
                                        <div class="text-center p-2">
                                            <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-2 text-white font-bold text-sm shadow-lg">3</div>
                                            <h5 class="font-bold text-[11px] text-tec-dark">Coordinamos</h5>
                                            <p class="text-[10px] text-slate-500">Fecha y entrega</p>
                                        </div>
                                        <div class="text-center p-2">
                                            <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-2 text-white font-bold text-sm shadow-lg">4</div>
                                            <h5 class="font-bold text-[11px] text-tec-dark">¬°Reconocemos!</h5>
                                            <p class="text-[10px] text-slate-500">Activamos beneficios</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- CTA -->
                                <div class="text-center bg-gradient-to-r from-emerald-600 to-teal-600 rounded-2xl p-5 text-white">
                                    <h4 class="text-lg font-bold mb-2">¬øTienes algo que donar?</h4>
                                    <p class="text-emerald-100 text-xs sm:text-sm mb-4">Cont√°ctanos para coordinar la entrega. Recibir√°s carta de donaci√≥n oficial.</p>
                                    <div class="flex flex-col sm:flex-row gap-3 justify-center flex-wrap">
                                        <a id="wishlist-btn-2" href="#" onclick="event.preventDefault(); Util.openWishlist();" class="inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-tec-gold text-tec-dark rounded-xl font-bold text-sm hover:bg-yellow-400 transition-all shadow-lg cursor-pointer">
                                            <i data-lucide="gift" class="w-4 h-4"></i>
                                            Ver Lista de Deseos
                                        </a>
                                        <a onclick="event.preventDefault(); Util.sendEmail('contacto@clubcrai.com', 'Patrocinio en Especie - CRAI', 'Hola, me gustar√≠a donar los siguientes materiales/servicios:\n\n');" class="inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-white text-emerald-700 rounded-xl font-bold text-sm hover:bg-emerald-50 transition-all cursor-pointer">
                                            <i data-lucide="mail" class="w-4 h-4"></i>
                                            Enviar Correo
                                        </a>
                                        <a href="https://wa.me/526861234567?text=Hola%2C%20quiero%20hacer%20patrocinio%20en%20especie" target="_blank" class="inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-emerald-800 text-white rounded-xl font-bold text-sm hover:bg-emerald-900 transition-all">
                                            <i data-lucide="message-circle" class="w-4 h-4"></i>
                                            WhatsApp
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CTA Final -->
                    <div class="max-w-3xl mx-auto mt-20 text-center">
                        <div class="bg-gradient-to-r from-tec-gold/10 via-yellow-50 to-tec-gold/10 rounded-3xl p-10 border border-tec-gold/20">
                            <div class="w-20 h-20 bg-tec-gold/20 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i data-lucide="heart" class="w-10 h-10 text-tec-gold"></i>
                            </div>
                            <h3 class="text-2xl font-black text-tec-dark mb-4">Cada Peso Cuenta</h3>
                            <p class="text-slate-500 mb-6 max-w-xl mx-auto">
                                No importa la cantidad, tu apoyo nos motiva a seguir construyendo el futuro de la rob√≥tica en M√©xico. ¬°Gracias por creer en nosotros!
                            </p>
                            <div class="flex flex-wrap justify-center gap-4">
                                <a href="https://www.instagram.com/crai.itm/" target="_blank" class="inline-flex items-center gap-2 px-5 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full font-bold text-xs hover:opacity-90 transition">
                                    <i data-lucide="instagram" class="w-4 h-4"></i>
                                    S√≠guenos
                                </a>
                                <a href="https://www.facebook.com/profile.php?id=61583401749916" target="_blank" class="inline-flex items-center gap-2 px-5 py-2 bg-blue-600 text-white rounded-full font-bold text-xs hover:opacity-90 transition">
                                    <i data-lucide="facebook" class="w-4 h-4"></i>
                                    Facebook
                                </a>
                                <a onclick="Util.sendEmail('contacto@clubcrai.com', 'Contacto - CRAI', 'Hola, me gustar√≠a ponerme en contacto con el club CRAI.\n\n');" class="inline-flex items-center gap-2 px-5 py-2 bg-slate-700 text-white rounded-full font-bold text-xs hover:opacity-90 transition cursor-pointer">
                                    <i data-lucide="mail" class="w-4 h-4"></i>
                                    Contacto
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Formulario de Solicitud de Patrocinio -->
                    <div class="max-w-2xl mx-auto mt-20">
                        <div class="bg-gradient-to-br from-tec-blue to-tec-dark rounded-3xl p-8 sm:p-10 text-white relative overflow-hidden">
                            <div class="absolute -right-20 -top-20 w-60 h-60 bg-tec-gold/20 rounded-full blur-3xl"></div>
                            <div class="absolute -left-10 -bottom-10 w-40 h-40 bg-blue-400/20 rounded-full blur-2xl"></div>
                            
                            <div class="relative z-10">
                                <div class="text-center mb-8">
                                    <div class="w-16 h-16 bg-tec-gold/20 backdrop-blur rounded-2xl flex items-center justify-center mx-auto mb-4">
                                        <i data-lucide="building-2" class="w-8 h-8 text-tec-gold"></i>
                                    </div>
                                    <h3 class="text-2xl font-black mb-2">¬øEres una Empresa?</h3>
                                    <p class="text-blue-200 text-sm">Solicita informaci√≥n sobre nuestros planes de patrocinio</p>
                                </div>
                                
                                <form onsubmit="Sponsorship.submit(event)" onfocusin="Sponsorship.init(this)" class="space-y-4" data-loaded="">
                                    <!-- Honeypot anti-spam (oculto para humanos, visible para bots) -->
                                    <div style="position: absolute; left: -9999px;" aria-hidden="true">
                                        <input type="text" id="sponsor-website" name="website" tabindex="-1" autocomplete="off">
                                    </div>
                                    
                                    <div class="grid sm:grid-cols-2 gap-4">
                                        <div>
                                            <label class="text-[10px] uppercase font-bold text-blue-300 mb-1 block">Nombre de Contacto *</label>
                                            <input type="text" id="sponsor-name" required placeholder="Tu nombre" class="w-full p-3 bg-white/10 backdrop-blur border border-white/20 rounded-xl text-sm text-white placeholder-blue-200/50 outline-none focus:border-tec-gold focus:bg-white/15 transition">
                                        </div>
                                        <div>
                                            <label class="text-[10px] uppercase font-bold text-blue-300 mb-1 block">Empresa *</label>
                                            <input type="text" id="sponsor-company" required placeholder="Nombre de la empresa" class="w-full p-3 bg-white/10 backdrop-blur border border-white/20 rounded-xl text-sm text-white placeholder-blue-200/50 outline-none focus:border-tec-gold focus:bg-white/15 transition">
                                        </div>
                                    </div>
                                    
                                    <div class="grid sm:grid-cols-2 gap-4">
                                        <div>
                                            <label class="text-[10px] uppercase font-bold text-blue-300 mb-1 block">Correo Electr√≥nico *</label>
                                            <input type="email" id="sponsor-email" required placeholder="correo@empresa.com" class="w-full p-3 bg-white/10 backdrop-blur border border-white/20 rounded-xl text-sm text-white placeholder-blue-200/50 outline-none focus:border-tec-gold focus:bg-white/15 transition">
                                        </div>
                                        <div>
                                            <label class="text-[10px] uppercase font-bold text-blue-300 mb-1 block">Tel√©fono</label>
                                            <input type="tel" id="sponsor-phone" placeholder="686 123 4567" class="w-full p-3 bg-white/10 backdrop-blur border border-white/20 rounded-xl text-sm text-white placeholder-blue-200/50 outline-none focus:border-tec-gold focus:bg-white/15 transition">
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="text-[10px] uppercase font-bold text-blue-300 mb-1 block">Tipo de Patrocinio de Inter√©s</label>
                                        <select id="sponsor-type" class="w-full p-3 bg-white/10 backdrop-blur border border-white/20 rounded-xl text-sm text-white outline-none focus:border-tec-gold cursor-pointer">
                                            <option value="monetario" class="text-slate-800">Patrocinio Monetario</option>
                                            <option value="especie" class="text-slate-800">Patrocinio en Especie (materiales/equipos)</option>
                                            <option value="servicios" class="text-slate-800">Servicios (maquinado, impresi√≥n, etc.)</option>
                                            <option value="mixto" class="text-slate-800">Mixto (combinaci√≥n)</option>
                                            <option value="otro" class="text-slate-800">Otro / No estoy seguro</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="text-[10px] uppercase font-bold text-blue-300 mb-1 block">Mensaje (opcional)</label>
                                        <textarea id="sponsor-message" rows="3" placeholder="Cu√©ntanos sobre tu empresa y c√≥mo te gustar√≠a apoyarnos..." class="w-full p-3 bg-white/10 backdrop-blur border border-white/20 rounded-xl text-sm text-white placeholder-blue-200/50 outline-none focus:border-tec-gold focus:bg-white/15 transition resize-none"></textarea>
                                    </div>
                                    
                                    <button type="submit" class="w-full py-4 bg-tec-gold hover:bg-yellow-500 text-tec-dark font-black text-sm uppercase tracking-wider rounded-xl shadow-lg shadow-tec-gold/30 transition transform active:scale-95 flex items-center justify-center gap-2">
                                        <i data-lucide="send" class="w-4 h-4"></i>
                                        Enviar Solicitud de Patrocinio
                                    </button>
                                    
                                    <p class="text-center text-[10px] text-blue-300">
                                        <i data-lucide="shield-check" class="w-3 h-3 inline mr-1"></i>
                                        Nos pondremos en contacto contigo en menos de 48 horas
                                    </p>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==============================
             VISTA 4: √öNETE (Reclutamiento)
             ============================== -->
        <section id="view-public-join" class="view-section hidden min-h-screen">
            <!-- Hero -->
            <div class="relative bg-gradient-to-br from-red-600 via-red-900 to-slate-900 py-24 overflow-hidden">
                <div class="absolute inset-0">
                    <div class="absolute top-0 left-0 w-full h-full bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iMC4wNSI+PHBhdGggZD0iTTM2IDM0djItSDI0di0yaDEyek0zNiAyNHYySDI0di0yaDEyeiIvPjwvZz48L2c+PC9zdmc+')] opacity-50"></div>
                    <div class="absolute -top-40 -right-40 w-96 h-96 bg-tec-gold/20 rounded-full blur-3xl animate-pulse"></div>
                    <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-blue-500/20 rounded-full blur-3xl"></div>
                </div>
                
                <div class="container mx-auto px-6 relative z-10">
                    <div class="max-w-4xl mx-auto text-center">
                        <div class="inline-flex items-center gap-2 bg-tec-gold/20 backdrop-blur-sm text-tec-gold px-4 py-2 rounded-full mb-6">
                            <i data-lucide="rocket" class="w-4 h-4"></i>
                            <span class="font-bold text-xs uppercase tracking-wider">√önete al Equipo</span>
                        </div>
                        
                        <h1 class="text-3xl sm:text-5xl md:text-6xl font-black text-white mb-6">
                            ¬øQuieres Ser <span class="text-tec-gold">B√∫falo</span>?
                        </h1>
                        
                        <p class="text-base sm:text-xl text-blue-100 max-w-2xl mx-auto leading-relaxed mb-8">
                            No necesitas ser experto. Buscamos compromiso, pasi√≥n y ganas de aprender. 
                            Nosotros te ense√±amos todo lo que necesitas saber.
                        </p>
                        
                        <div class="flex flex-wrap justify-center gap-2 sm:gap-4">
                            <div class="flex items-center gap-2 bg-white/10 backdrop-blur px-3 sm:px-4 py-2 rounded-full">
                                <i data-lucide="book-open" class="w-4 h-4 text-tec-gold"></i>
                                <span class="text-white text-xs sm:text-sm font-medium">Capacitaci√≥n</span>
                            </div>
                            <div class="flex items-center gap-2 bg-white/10 backdrop-blur px-3 sm:px-4 py-2 rounded-full">
                                <i data-lucide="clock" class="w-4 h-4 text-tec-gold"></i>
                                <span class="text-white text-xs sm:text-sm font-medium">24/7 Lab</span>
                            </div>
                            <div class="flex items-center gap-2 bg-white/10 backdrop-blur px-3 sm:px-4 py-2 rounded-full">
                                <i data-lucide="trophy" class="w-4 h-4 text-tec-gold"></i>
                                <span class="text-white text-xs sm:text-sm font-medium">Competencias</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Wave -->
                <div class="absolute bottom-0 left-0 w-full overflow-hidden">
                    <svg viewBox="0 0 1200 120" preserveAspectRatio="none" class="w-full h-16 text-slate-50 fill-current">
                        <path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V120H0V95.8C57.1,118.92,156.63,69.08,321.39,56.44Z"></path>
                    </svg>
                </div>
            </div>
            
            <!-- Contenido Principal -->
            <div class="bg-slate-50 py-20">
                <div class="container mx-auto px-6">
                    <div class="max-w-6xl mx-auto">
                        
                        <!-- √Åreas del Club -->
                        <div class="text-center mb-12 sm:mb-16">
                            <h2 class="text-2xl sm:text-3xl font-black text-tec-dark mb-4">Elige Tu √Årea de Inter√©s</h2>
                            <p class="text-slate-500 max-w-2xl mx-auto text-sm sm:text-base">Tenemos 5 √°reas especializadas. Selecciona la que m√°s te apasione.</p>
                        </div>
                        
                        <!-- √Åreas Detalladas -->
                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-12 sm:mb-16">
                            <!-- Gesti√≥n -->
                            <div class="area-card cursor-pointer bg-white rounded-2xl p-5 sm:p-6 border-2 border-transparent hover:border-purple-400 transition-all group shadow-md hover:shadow-xl" data-area="gestion" onclick="JoinForm.selectArea('gestion')">
                                <div class="flex items-start gap-4">
                                    <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shrink-0 group-hover:scale-110 transition-transform shadow-lg shadow-purple-500/30">
                                        <i data-lucide="briefcase" class="w-7 h-7 text-white"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-slate-800 text-base mb-1">Gesti√≥n y Vinculaci√≥n</h4>
                                        <p class="text-xs text-purple-600 font-medium mb-2">El coraz√≥n organizacional del club</p>
                                    </div>
                                </div>
                                <div class="mt-4 pt-4 border-t border-slate-100">
                                    <p class="text-xs text-slate-600 mb-3">Encargados de la operaci√≥n, comunicaci√≥n y crecimiento del club:</p>
                                    <ul class="text-[11px] text-slate-500 space-y-1.5">
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-purple-500 mt-0.5 flex-shrink-0"></i> B√∫squeda y gesti√≥n de patrocinadores</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-purple-500 mt-0.5 flex-shrink-0"></i> Organizaci√≥n de eventos y competencias</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-purple-500 mt-0.5 flex-shrink-0"></i> Manejo de redes sociales y marketing</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-purple-500 mt-0.5 flex-shrink-0"></i> Log√≠stica de viajes y hospedaje</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-purple-500 mt-0.5 flex-shrink-0"></i> Vinculaci√≥n con empresas e instituciones</li>
                                    </ul>
                                </div>
                                <div class="mt-4 flex items-center justify-between">
                                    <span class="text-[10px] bg-purple-100 text-purple-700 px-2 py-1 rounded-full font-medium">Ideal para: IGE, Industrial, Administraci√≥n</span>
                                    <i data-lucide="arrow-right" class="w-4 h-4 text-purple-400 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>
                            
                            <!-- Telecomunicaciones -->
                            <div class="area-card cursor-pointer bg-white rounded-2xl p-5 sm:p-6 border-2 border-transparent hover:border-blue-400 transition-all group shadow-md hover:shadow-xl" data-area="telecom" onclick="JoinForm.selectArea('telecom')">
                                <div class="flex items-start gap-4">
                                    <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shrink-0 group-hover:scale-110 transition-transform shadow-lg shadow-blue-500/30">
                                        <i data-lucide="wifi" class="w-7 h-7 text-white"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-slate-800 text-base mb-1">Telecomunicaciones</h4>
                                        <p class="text-xs text-blue-600 font-medium mb-2">Conectividad y control remoto</p>
                                    </div>
                                </div>
                                <div class="mt-4 pt-4 border-t border-slate-100">
                                    <p class="text-xs text-slate-600 mb-3">Especialistas en comunicaci√≥n inal√°mbrica y sistemas de control:</p>
                                    <ul class="text-[11px] text-slate-500 space-y-1.5">
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-blue-500 mt-0.5 flex-shrink-0"></i> Dise√±o de sistemas de control remoto (RF, WiFi, Bluetooth)</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-blue-500 mt-0.5 flex-shrink-0"></i> Telemetr√≠a y transmisi√≥n de datos en tiempo real</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-blue-500 mt-0.5 flex-shrink-0"></i> Configuraci√≥n de redes y protocolos IoT</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-blue-500 mt-0.5 flex-shrink-0"></i> Sistemas de video inal√°mbrico (FPV)</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-blue-500 mt-0.5 flex-shrink-0"></i> Antenas y optimizaci√≥n de se√±al</li>
                                    </ul>
                                </div>
                                <div class="mt-4 flex items-center justify-between">
                                    <span class="text-[10px] bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-medium">Ideal para: Electr√≥nica, Sistemas, El√©ctrica</span>
                                    <i data-lucide="arrow-right" class="w-4 h-4 text-blue-400 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>
                            
                            <!-- Software -->
                            <div class="area-card cursor-pointer bg-white rounded-2xl p-5 sm:p-6 border-2 border-transparent hover:border-green-400 transition-all group shadow-md hover:shadow-xl" data-area="software" onclick="JoinForm.selectArea('software')">
                                <div class="flex items-start gap-4">
                                    <div class="w-14 h-14 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center shrink-0 group-hover:scale-110 transition-transform shadow-lg shadow-green-500/30">
                                        <i data-lucide="code" class="w-7 h-7 text-white"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-slate-800 text-base mb-1">Software y Programaci√≥n</h4>
                                        <p class="text-xs text-green-600 font-medium mb-2">El cerebro de nuestros robots</p>
                                    </div>
                                </div>
                                <div class="mt-4 pt-4 border-t border-slate-100">
                                    <p class="text-xs text-slate-600 mb-3">Programadores y desarrolladores de algoritmos inteligentes:</p>
                                    <ul class="text-[11px] text-slate-500 space-y-1.5">
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-green-500 mt-0.5 flex-shrink-0"></i> Programaci√≥n de microcontroladores (C/C++, Python)</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-green-500 mt-0.5 flex-shrink-0"></i> Algoritmos de navegaci√≥n aut√≥noma y visi√≥n por computadora</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-green-500 mt-0.5 flex-shrink-0"></i> Inteligencia artificial y machine learning</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-green-500 mt-0.5 flex-shrink-0"></i> Desarrollo de interfaces y aplicaciones de control</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-green-500 mt-0.5 flex-shrink-0"></i> ROS (Robot Operating System)</li>
                                    </ul>
                                </div>
                                <div class="mt-4 flex items-center justify-between">
                                    <span class="text-[10px] bg-green-100 text-green-700 px-2 py-1 rounded-full font-medium">Ideal para: Sistemas, Mecatr√≥nica, Electr√≥nica</span>
                                    <i data-lucide="arrow-right" class="w-4 h-4 text-green-400 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>
                            
                            <!-- Electr√≥nica -->
                            <div class="area-card cursor-pointer bg-white rounded-2xl p-5 sm:p-6 border-2 border-transparent hover:border-orange-400 transition-all group shadow-md hover:shadow-xl" data-area="electronica" onclick="JoinForm.selectArea('electronica')">
                                <div class="flex items-start gap-4">
                                    <div class="w-14 h-14 bg-gradient-to-br from-orange-500 to-amber-600 rounded-xl flex items-center justify-center shrink-0 group-hover:scale-110 transition-transform shadow-lg shadow-orange-500/30">
                                        <i data-lucide="cpu" class="w-7 h-7 text-white"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-slate-800 text-base mb-1">Electr√≥nica y Control</h4>
                                        <p class="text-xs text-orange-600 font-medium mb-2">Circuitos y sistemas de potencia</p>
                                    </div>
                                </div>
                                <div class="mt-4 pt-4 border-t border-slate-100">
                                    <p class="text-xs text-slate-600 mb-3">Expertos en hardware y sistemas electr√≥nicos:</p>
                                    <ul class="text-[11px] text-slate-500 space-y-1.5">
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-orange-500 mt-0.5 flex-shrink-0"></i> Dise√±o y fabricaci√≥n de PCBs</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-orange-500 mt-0.5 flex-shrink-0"></i> Selecci√≥n e integraci√≥n de sensores</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-orange-500 mt-0.5 flex-shrink-0"></i> Electr√≥nica de potencia y drivers de motores</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-orange-500 mt-0.5 flex-shrink-0"></i> Sistemas de alimentaci√≥n y gesti√≥n de bater√≠as</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-orange-500 mt-0.5 flex-shrink-0"></i> Soldadura SMD y prototipado r√°pido</li>
                                    </ul>
                                </div>
                                <div class="mt-4 flex items-center justify-between">
                                    <span class="text-[10px] bg-orange-100 text-orange-700 px-2 py-1 rounded-full font-medium">Ideal para: Electr√≥nica, Mecatr√≥nica, El√©ctrica</span>
                                    <i data-lucide="arrow-right" class="w-4 h-4 text-orange-400 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>
                            
                            <!-- Mec√°nico -->
                            <div class="area-card cursor-pointer bg-white rounded-2xl p-5 sm:p-6 border-2 border-transparent hover:border-red-400 transition-all group shadow-md hover:shadow-xl md:col-span-2 lg:col-span-1" data-area="mecanico" onclick="JoinForm.selectArea('mecanico')">
                                <div class="flex items-start gap-4">
                                    <div class="w-14 h-14 bg-gradient-to-br from-red-500 to-rose-600 rounded-xl flex items-center justify-center shrink-0 group-hover:scale-110 transition-transform shadow-lg shadow-red-500/30">
                                        <i data-lucide="cog" class="w-7 h-7 text-white"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-slate-800 text-base mb-1">Dise√±o Mec√°nico</h4>
                                        <p class="text-xs text-red-600 font-medium mb-2">Estructura y manufactura</p>
                                    </div>
                                </div>
                                <div class="mt-4 pt-4 border-t border-slate-100">
                                    <p class="text-xs text-slate-600 mb-3">Dise√±adores y fabricantes de estructuras rob√≥ticas:</p>
                                    <ul class="text-[11px] text-slate-500 space-y-1.5">
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-red-500 mt-0.5 flex-shrink-0"></i> Dise√±o CAD 3D (SolidWorks, Fusion 360, OnShape)</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-red-500 mt-0.5 flex-shrink-0"></i> An√°lisis de esfuerzos y simulaci√≥n (FEA)</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-red-500 mt-0.5 flex-shrink-0"></i> Impresi√≥n 3D y manufactura aditiva</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-red-500 mt-0.5 flex-shrink-0"></i> Corte l√°ser, CNC y mecanizado tradicional</li>
                                        <li class="flex items-start gap-2"><i data-lucide="check" class="w-3 h-3 text-red-500 mt-0.5 flex-shrink-0"></i> Dise√±o de mecanismos y transmisiones</li>
                                    </ul>
                                </div>
                                <div class="mt-4 flex items-center justify-between">
                                    <span class="text-[10px] bg-red-100 text-red-700 px-2 py-1 rounded-full font-medium">Ideal para: Mecatr√≥nica, Mec√°nica, Industrial</span>
                                    <i data-lucide="arrow-right" class="w-4 h-4 text-red-400 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Formulario Principal -->
                        <div class="bg-white rounded-3xl shadow-xl overflow-hidden">
                            <div class="grid lg:grid-cols-5">
                                
                                <!-- Sidebar Info -->
                                <div class="lg:col-span-2 bg-gradient-to-br from-tec-blue to-tec-dark p-6 sm:p-10 text-white">
                                    <h3 class="text-xl sm:text-2xl font-black mb-4 sm:mb-6">Lo Que Ofrecemos</h3>
                                    
                                    <div class="space-y-6">
                                        <div class="flex gap-4">
                                            <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center shrink-0">
                                                <i data-lucide="graduation-cap" class="w-5 h-5"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-sm mb-1">Capacitaci√≥n T√©cnica</h4>
                                                <p class="text-xs text-blue-200">Talleres semanales de rob√≥tica, programaci√≥n, CAD y electr√≥nica.</p>
                                            </div>
                                        </div>
                                        
                                        <div class="flex gap-4">
                                            <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center shrink-0">
                                                <i data-lucide="users" class="w-5 h-5"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-sm mb-1">Comunidad Activa</h4>
                                                <p class="text-xs text-blue-200">Networking con estudiantes de todas las ingenier√≠as.</p>
                                            </div>
                                        </div>
                                        
                                        <div class="flex gap-4">
                                            <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center shrink-0">
                                                <i data-lucide="trophy" class="w-5 h-5"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-sm mb-1">Competencias</h4>
                                                <p class="text-xs text-blue-200">Participaci√≥n en torneos nacionales e internacionales.</p>
                                            </div>
                                        </div>
                                        
                                        <div class="flex gap-4">
                                            <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center shrink-0">
                                                <i data-lucide="briefcase" class="w-5 h-5"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-sm mb-1">Experiencia Laboral</h4>
                                                <p class="text-xs text-blue-200">Proyectos reales que mejoran tu CV y perfil profesional.</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6 sm:mt-10 pt-6 sm:pt-8 border-t border-white/20">
                                        <p class="text-xs text-blue-200 mb-4">Proceso de selecci√≥n:</p>
                                        <div class="flex items-center justify-between sm:justify-start sm:gap-3">
                                            <div class="flex items-center gap-1">
                                                <div class="w-7 h-7 sm:w-8 sm:h-8 bg-tec-gold rounded-full flex items-center justify-center text-tec-dark font-black text-[10px] sm:text-xs">1</div>
                                                <span class="text-[9px] sm:text-[10px]">Solicitud</span>
                                            </div>
                                            <i data-lucide="chevron-right" class="w-3 h-3 sm:w-4 sm:h-4 text-white/40"></i>
                                            <div class="flex items-center gap-1">
                                                <div class="w-7 h-7 sm:w-8 sm:h-8 bg-white/20 rounded-full flex items-center justify-center font-black text-[10px] sm:text-xs">2</div>
                                                <span class="text-[9px] sm:text-[10px]">Entrevista</span>
                                            </div>
                                            <i data-lucide="chevron-right" class="w-3 h-3 sm:w-4 sm:h-4 text-white/40"></i>
                                            <div class="flex items-center gap-1">
                                                <div class="w-7 h-7 sm:w-8 sm:h-8 bg-white/20 rounded-full flex items-center justify-center font-black text-[10px] sm:text-xs">3</div>
                                                <span class="text-[9px] sm:text-[10px]">¬°Bienvenido!</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Formulario -->
                                <div class="lg:col-span-3 p-5 sm:p-10">
                                    <form id="join-form" class="space-y-5 sm:space-y-6">
                                        <div class="text-center mb-6 sm:mb-8">
                                            <h3 class="text-xl sm:text-2xl font-black text-tec-dark mb-2">Formulario de Aspirante</h3>
                                            <p class="text-sm text-slate-400">Completa todos los campos para enviar tu solicitud</p>
                                        </div>
                                        
                                        <!-- Datos Personales -->
                                        <div class="space-y-4">
                                            <p class="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                                                <i data-lucide="user" class="w-4 h-4"></i>
                                                Datos Personales
                                            </p>
                                            
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4">
                                                <input type="text" id="join-name" placeholder="Nombre Completo *" required class="w-full bg-slate-50 border border-slate-200 p-3 sm:p-4 rounded-xl text-sm focus:border-tec-blue focus:ring-2 focus:ring-tec-blue/20 outline-none transition">
                                                <input type="email" id="join-email" placeholder="Correo Electr√≥nico *" required class="w-full bg-slate-50 border border-slate-200 p-3 sm:p-4 rounded-xl text-sm focus:border-tec-blue focus:ring-2 focus:ring-tec-blue/20 outline-none transition">
                                            </div>
                                            
                                            <div class="grid grid-cols-2 md:grid-cols-3 gap-3 sm:gap-4">
                                                <input type="text" id="join-control" placeholder="No. Control *" required class="w-full bg-slate-50 border border-slate-200 p-3 sm:p-4 rounded-xl text-sm focus:border-tec-blue focus:ring-2 focus:ring-tec-blue/20 outline-none transition">
                                                <input type="text" id="join-semester" placeholder="Semestre *" required class="w-full bg-slate-50 border border-slate-200 p-3 sm:p-4 rounded-xl text-sm focus:border-tec-blue focus:ring-2 focus:ring-tec-blue/20 outline-none transition">
                                                <input type="tel" id="join-phone" placeholder="Tel√©fono" class="col-span-2 md:col-span-1 w-full bg-slate-50 border border-slate-200 p-3 sm:p-4 rounded-xl text-sm focus:border-tec-blue focus:ring-2 focus:ring-tec-blue/20 outline-none transition">
                                            </div>
                                            
                                            <select id="join-career" required class="w-full bg-slate-50 border border-slate-200 p-3 sm:p-4 rounded-xl text-sm focus:border-tec-blue focus:ring-2 focus:ring-tec-blue/20 outline-none text-slate-500">
                                                <option value="" disabled selected>Selecciona tu Carrera *</option>
                                                <option value="Mecatronica">Ing. Mecatr√≥nica</option>
                                                <option value="Electronica">Ing. Electr√≥nica</option>
                                                <option value="Sistemas">Ing. Sistemas Computacionales</option>
                                                <option value="Mecanica">Ing. Mec√°nica</option>
                                                <option value="Industrial">Ing. Industrial</option>
                                                <option value="Electrica">Ing. El√©ctrica</option>
                                                <option value="Quimica">Ing. Qu√≠mica</option>
                                                <option value="Gestion">Ing. Gesti√≥n Empresarial</option>
                                                <option value="Otra">Otra</option>
                                            </select>
                                        </div>
                                        
                                        <!-- √Årea de Inter√©s -->
                                        <div class="space-y-4">
                                            <p class="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                                                <i data-lucide="target" class="w-4 h-4"></i>
                                                √Årea de Inter√©s
                                            </p>
                                            
                                            <div id="selected-area-display" class="bg-slate-50 border border-slate-200 p-4 rounded-xl">
                                                <p class="text-sm text-slate-400">Selecciona un √°rea arriba ‚Üë</p>
                                            </div>
                                            <input type="hidden" id="join-area" value="">
                                        </div>
                                        
                                        <!-- Skills -->
                                        <div class="space-y-4">
                                            <p class="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                                                <i data-lucide="zap" class="w-4 h-4"></i>
                                                Habilidades que tienes (opcional)
                                            </p>
                                            
                                            <!-- Input para agregar habilidades una por una -->
                                            <div class="flex gap-2">
                                                <input type="text" id="skill-input" maxlength="30" placeholder="Ej: Arduino, Python, SolidWorks..." class="flex-1 bg-slate-50 border border-slate-200 p-3 rounded-xl text-sm focus:border-tec-blue focus:ring-2 focus:ring-tec-blue/20 outline-none transition" onkeypress="if(event.key==='Enter'){event.preventDefault();JoinForm.addSkill();}">
                                                <button type="button" onclick="JoinForm.addSkill()" class="px-4 py-2 bg-tec-blue text-white rounded-xl text-sm font-medium hover:bg-tec-blue/90 transition flex items-center gap-1">
                                                    <i data-lucide="plus" class="w-4 h-4"></i>
                                                    <span class="hidden sm:inline">Agregar</span>
                                                </button>
                                            </div>
                                            
                                            <!-- Contenedor de chips/tags de habilidades -->
                                            <div id="skills-container" class="flex flex-wrap gap-2 min-h-[40px] p-3 bg-slate-50 border border-dashed border-slate-200 rounded-xl">
                                                <p id="skills-placeholder" class="text-xs text-slate-400 w-full text-center py-1">Las habilidades que agregues aparecer√°n aqu√≠</p>
                                            </div>
                                            <p class="text-[10px] text-slate-400">M√°ximo 30 caracteres por habilidad. Presiona Enter o el bot√≥n para agregar.</p>
                                        </div>
                                        
                                        <!-- Motivaci√≥n -->
                                        <div class="space-y-4">
                                            <p class="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                                                <i data-lucide="message-square" class="w-4 h-4"></i>
                                                Cu√©ntanos sobre ti
                                            </p>
                                            
                                            <textarea id="join-reason" rows="3" placeholder="¬øPor qu√© quieres unirte al CRAI? ¬øQu√© proyectos te gustar√≠a desarrollar? *" required class="w-full bg-slate-50 border border-slate-200 p-3 sm:p-4 rounded-xl text-sm focus:border-tec-blue focus:ring-2 focus:ring-tec-blue/20 outline-none transition resize-none"></textarea>
                                        </div>
                                        
                                        <!-- Disponibilidad -->
                                        <div class="space-y-4">
                                            <p class="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                                                <i data-lucide="calendar" class="w-4 h-4"></i>
                                                Disponibilidad Horaria
                                            </p>
                                            
                                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                                <label class="flex items-center gap-2 p-3 bg-slate-50 rounded-lg cursor-pointer hover:bg-slate-100 transition">
                                                    <input type="checkbox" id="join-morning" class="w-4 h-4 text-tec-blue rounded">
                                                    <span class="text-xs text-slate-600">Ma√±ana</span>
                                                </label>
                                                <label class="flex items-center gap-2 p-3 bg-slate-50 rounded-lg cursor-pointer hover:bg-slate-100 transition">
                                                    <input type="checkbox" id="join-afternoon" class="w-4 h-4 text-tec-blue rounded">
                                                    <span class="text-xs text-slate-600">Tarde</span>
                                                </label>
                                                <label class="flex items-center gap-2 p-3 bg-slate-50 rounded-lg cursor-pointer hover:bg-slate-100 transition">
                                                    <input type="checkbox" id="join-evening" class="w-4 h-4 text-tec-blue rounded">
                                                    <span class="text-xs text-slate-600">Noche</span>
                                                </label>
                                                <label class="flex items-center gap-2 p-3 bg-slate-50 rounded-lg cursor-pointer hover:bg-slate-100 transition">
                                                    <input type="checkbox" id="join-weekend" class="w-4 h-4 text-tec-blue rounded">
                                                    <span class="text-xs text-slate-600">Fines de semana</span>
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <!-- Submit -->
                                        <div class="pt-4 sm:pt-6">
                                            <button type="button" onclick="JoinForm.submit()" class="w-full py-3 sm:py-4 bg-gradient-to-r from-tec-gold to-yellow-500 text-tec-dark font-black text-sm uppercase tracking-wider rounded-xl hover:from-yellow-500 hover:to-yellow-600 transition-all shadow-lg shadow-tec-gold/30 flex items-center justify-center gap-2">
                                                <i data-lucide="send" class="w-5 h-5"></i>
                                                Enviar Solicitud
                                            </button>
                                            <p class="text-center text-[10px] text-slate-400 mt-4">
                                                <i data-lucide="mail" class="w-3 h-3 inline mr-1"></i>
                                                Tu solicitud ser√° enviada a contacto@clubcrai.com
                                            </p>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- FAQ -->
                        <div class="mt-20">
                            <h3 class="text-2xl font-black text-tec-dark text-center mb-10">Preguntas Frecuentes</h3>
                            <div class="grid md:grid-cols-2 gap-6 max-w-4xl mx-auto">
                                <div class="bg-white p-6 rounded-2xl shadow-sm">
                                    <h4 class="font-bold text-slate-800 mb-2 flex items-center gap-2">
                                        <i data-lucide="help-circle" class="w-5 h-5 text-tec-gold"></i>
                                        ¬øNecesito experiencia previa?
                                    </h4>
                                    <p class="text-sm text-slate-500">No. Aceptamos estudiantes de cualquier semestre y nivel de experiencia. Ofrecemos capacitaci√≥n desde cero.</p>
                                </div>
                                <div class="bg-white p-6 rounded-2xl shadow-sm">
                                    <h4 class="font-bold text-slate-800 mb-2 flex items-center gap-2">
                                        <i data-lucide="help-circle" class="w-5 h-5 text-tec-gold"></i>
                                        ¬øCu√°nto tiempo debo dedicar?
                                    </h4>
                                    <p class="text-sm text-slate-500">M√≠nimo 6-8 horas semanales entre reuniones, talleres y trabajo en proyectos.</p>
                                </div>
                                <div class="bg-white p-6 rounded-2xl shadow-sm">
                                    <h4 class="font-bold text-slate-800 mb-2 flex items-center gap-2">
                                        <i data-lucide="help-circle" class="w-5 h-5 text-tec-gold"></i>
                                        ¬øHay costo de membres√≠a?
                                    </h4>
                                    <p class="text-sm text-slate-500">No hay cuota fija. Ocasionalmente se solicitan cooperaciones para competencias o materiales espec√≠ficos.</p>
                                </div>
                                <div class="bg-white p-6 rounded-2xl shadow-sm">
                                    <h4 class="font-bold text-slate-800 mb-2 flex items-center gap-2">
                                        <i data-lucide="help-circle" class="w-5 h-5 text-tec-gold"></i>
                                        ¬øCu√°ndo abren convocatorias?
                                    </h4>
                                    <p class="text-sm text-slate-500">Al inicio de cada semestre (enero y agosto). S√≠guenos en redes para enterarte.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- (Las vistas privadas vendr√°n en la Parte 2) -->
        
        <!-- ESTA SECCI√ìN SE CONTINUAR√Å EN LA SIGUIENTE PARTE CON VISTAS PRIVADAS Y MODALES -->

        <!-- ==============================
             VISTA 5: MIEMBROS DEL EQUIPO
             ============================== -->
        <section id="view-members" class="view-section hidden min-h-screen bg-gradient-to-b from-slate-50 via-white to-slate-50">
            <!-- Hero de Miembros -->
            <div class="relative bg-gradient-to-br from-tec-blue via-tec-dark to-slate-900 py-20 overflow-hidden">
                <!-- Decoraci√≥n animada -->
                <div class="absolute inset-0">
                    <div class="absolute top-0 left-0 w-full h-full bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iMC4wMyI+PHBhdGggZD0iTTM2IDM0djItSDI0di0yaDEyek0zNiAyNHYySDI0di0yaDEyeiIvPjwvZz48L2c+PC9zdmc+')] opacity-50"></div>
                    <div class="absolute -top-20 -right-20 w-80 h-80 bg-tec-gold/10 rounded-full blur-3xl animate-pulse"></div>
                    <div class="absolute -bottom-20 -left-20 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl"></div>
                </div>
                
                <div class="container mx-auto px-6 relative z-10">
                    <div class="max-w-4xl mx-auto text-center">
                        <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur-sm text-white px-4 py-2 rounded-full mb-6">
                            <i data-lucide="heart" class="w-4 h-4 text-red-400"></i>
                            <span class="font-bold text-xs uppercase tracking-wider">El Coraz√≥n del Club</span>
                        </div>
                        
                        <h1 class="text-5xl md:text-6xl font-black text-white mb-6">
                            Nuestro <span class="text-tec-gold">Equipo</span>
                        </h1>
                        
                        <p class="text-xl text-blue-100 max-w-2xl mx-auto leading-relaxed">
                            Conoce a las mentes brillantes que dan vida a cada proyecto. 
                            Estudiantes apasionados por la rob√≥tica, la innovaci√≥n y el trabajo en equipo.
                        </p>
                        
                        <div class="flex justify-center gap-6 mt-10">
                            <div class="text-center">
                                <p class="text-4xl font-black text-tec-gold" id="members-count-hero">0</p>
                                <p class="text-xs text-blue-200 uppercase tracking-wider mt-1">Miembros</p>
                            </div>
                            <div class="w-px bg-white/20"></div>
                            <div class="text-center">
                                <p class="text-4xl font-black text-white">5</p>
                                <p class="text-xs text-blue-200 uppercase tracking-wider mt-1">√Åreas</p>
                            </div>
                            <div class="w-px bg-white/20"></div>
                            <div class="text-center">
                                <p class="text-4xl font-black text-white">‚àû</p>
                                <p class="text-xs text-blue-200 uppercase tracking-wider mt-1">Ideas</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Wave divider -->
                <div class="absolute bottom-0 left-0 right-0">
                    <svg viewBox="0 0 1440 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 120L60 105C120 90 240 60 360 45C480 30 600 30 720 37.5C840 45 960 60 1080 67.5C1200 75 1320 75 1380 75L1440 75V120H1380C1320 120 1200 120 1080 120C960 120 840 120 720 120C600 120 480 120 360 120C240 120 120 120 60 120H0Z" fill="#f8fafc"/>
                    </svg>
                </div>
            </div>
            
            <!-- Contenido de Miembros -->
            <div class="container mx-auto px-6 py-16">
                <!-- Filtros por √Årea -->
                <div class="flex flex-wrap justify-center gap-3 mb-12">
                    <button onclick="Members.filter('all')" class="member-filter active px-5 py-2.5 rounded-full text-xs font-bold bg-tec-blue text-white shadow-lg shadow-tec-blue/30 transition-all" data-filter="all">
                        <i data-lucide="users" class="w-4 h-4 inline mr-1"></i> Todos
                    </button>
                    <button onclick="Members.filter('gestion')" class="member-filter px-5 py-2.5 rounded-full text-xs font-bold bg-white text-slate-600 border border-slate-200 hover:border-purple-300 hover:bg-purple-50 transition-all" data-filter="gestion">
                        <i data-lucide="briefcase" class="w-4 h-4 inline mr-1 text-purple-500"></i> Gesti√≥n
                    </button>
                    <button onclick="Members.filter('telecom')" class="member-filter px-5 py-2.5 rounded-full text-xs font-bold bg-white text-slate-600 border border-slate-200 hover:border-blue-300 hover:bg-blue-50 transition-all" data-filter="telecom">
                        <i data-lucide="wifi" class="w-4 h-4 inline mr-1 text-blue-500"></i> Telecom
                    </button>
                    <button onclick="Members.filter('software')" class="member-filter px-5 py-2.5 rounded-full text-xs font-bold bg-white text-slate-600 border border-slate-200 hover:border-green-300 hover:bg-green-50 transition-all" data-filter="software">
                        <i data-lucide="brain" class="w-4 h-4 inline mr-1 text-green-500"></i> Software/IA
                    </button>
                    <button onclick="Members.filter('electronica')" class="member-filter px-5 py-2.5 rounded-full text-xs font-bold bg-white text-slate-600 border border-slate-200 hover:border-orange-300 hover:bg-orange-50 transition-all" data-filter="electronica">
                        <i data-lucide="cpu" class="w-4 h-4 inline mr-1 text-orange-500"></i> Electr√≥nica
                    </button>
                    <button onclick="Members.filter('mecanico')" class="member-filter px-5 py-2.5 rounded-full text-xs font-bold bg-white text-slate-600 border border-slate-200 hover:border-red-300 hover:bg-red-50 transition-all" data-filter="mecanico">
                        <i data-lucide="cog" class="w-4 h-4 inline mr-1 text-red-500"></i> Mec√°nico
                    </button>
                </div>
                
                <!-- Grid de Miembros -->
                <div id="members-grid" class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <div class="p-6 glass-card rounded-2xl shadow-sm animate-pulse">
                        <div class="w-20 h-20 rounded-full bg-slate-200 mb-4 mx-auto"></div>
                        <div class="h-4 bg-slate-200 w-3/4 mb-2 rounded mx-auto"></div>
                        <div class="h-3 bg-slate-200 w-1/2 rounded mx-auto"></div>
                    </div>
                </div>
                
                <!-- CTA Unirse -->
                <div class="mt-16 text-center">
                    <div class="inline-block bg-gradient-to-r from-tec-blue/5 via-tec-gold/5 to-tec-blue/5 rounded-2xl p-8 border border-slate-200">
                        <h4 class="text-xl font-bold text-tec-dark mb-2">¬øQuieres ser parte del equipo?</h4>
                        <p class="text-slate-500 text-sm mb-6">Estamos buscando estudiantes apasionados por la tecnolog√≠a</p>
                        <button onclick="Router.to('public-join')" class="px-8 py-3 bg-tec-gold text-white rounded-xl font-bold text-sm hover:bg-yellow-500 transition-all inline-flex items-center gap-2">
                            <i data-lucide="rocket" class="w-4 h-4"></i>
                            Solicitar Membres√≠a
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==============================
             VISTA 5.5: EVENTOS P√öBLICOS
             ============================== -->
        <section id="view-public-events" class="view-section hidden min-h-screen bg-gradient-to-b from-slate-50 via-white to-slate-50">
            <!-- Hero de Eventos -->
            <div class="relative bg-gradient-to-br from-cyan-600 via-teal-500 to-emerald-600 py-20 overflow-hidden">
                <!-- Decoraci√≥n animada -->
                <div class="absolute inset-0">
                    <div class="absolute top-0 left-0 w-full h-full bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iMC4wMyI+PHBhdGggZD0iTTM2IDM0djItSDI0di0yaDEyek0zNiAyNHYySDI0di0yaDEyeiIvPjwvZz48L2c+PC9zdmc+')] opacity-50"></div>
                    <div class="absolute -top-20 -right-20 w-80 h-80 bg-white/10 rounded-full blur-3xl animate-pulse"></div>
                    <div class="absolute -bottom-20 -left-20 w-96 h-96 bg-teal-400/20 rounded-full blur-3xl"></div>
                </div>
                
                <div class="container mx-auto px-6 relative z-10">
                    <div class="max-w-4xl mx-auto text-center">
                        <div class="inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm text-white px-4 py-2 rounded-full mb-6">
                            <i data-lucide="calendar" class="w-4 h-4"></i>
                            <span class="font-bold text-xs uppercase tracking-wider">Competencias & Eventos</span>
                        </div>
                        
                        <h1 class="text-5xl md:text-6xl font-black text-white mb-6 drop-shadow-lg">
                            Eventos <span class="text-tec-dark">CRAI</span>
                        </h1>
                        
                        <p class="text-xl text-white/90 max-w-2xl mx-auto leading-relaxed drop-shadow">
                            Descubre las competencias de rob√≥tica organizadas por el CRAI. 
                            Participa como equipo o de forma individual y demuestra tus habilidades.
                        </p>
                        
                        <div class="flex justify-center gap-6 mt-10">
                            <div class="text-center bg-white/10 backdrop-blur-sm rounded-xl p-4">
                                <p class="text-4xl font-black text-white" id="public-events-count">0</p>
                                <p class="text-xs text-white/80 uppercase tracking-wider mt-1">Eventos Activos</p>
                            </div>
                            <div class="text-center bg-white/10 backdrop-blur-sm rounded-xl p-4">
                                <p class="text-4xl font-black text-white" id="public-events-registrations">0</p>
                                <p class="text-xs text-white/80 uppercase tracking-wider mt-1">Participantes</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Wave divider -->
                <div class="absolute bottom-0 left-0 right-0">
                    <svg viewBox="0 0 1440 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 120L60 105C120 90 240 60 360 45C480 30 600 30 720 37.5C840 45 960 60 1080 67.5C1200 75 1320 75 1380 75L1440 75V120H1380C1320 120 1200 120 1080 120C960 120 840 120 720 120C600 120 480 120 360 120C240 120 120 120 60 120H0Z" fill="#f8fafc"/>
                    </svg>
                </div>
            </div>
            
            <!-- Contenido de Eventos -->
            <div class="container mx-auto px-6 py-16">
                <!-- Filtros de Eventos -->
                <div class="flex flex-wrap justify-center gap-3 mb-12">
                    <button onclick="PublicEvents.filter('all')" class="public-event-filter active px-5 py-2.5 rounded-full text-xs font-bold bg-cyan-600 text-white shadow-lg shadow-cyan-600/30 transition-all" data-filter="all">
                        <i data-lucide="layers" class="w-4 h-4 inline mr-1"></i> Todos
                    </button>
                    <button onclick="PublicEvents.filter('upcoming')" class="public-event-filter px-5 py-2.5 rounded-full text-xs font-bold bg-white text-slate-600 border border-slate-200 hover:border-green-300 hover:bg-green-50 transition-all" data-filter="upcoming">
                        <i data-lucide="clock" class="w-4 h-4 inline mr-1 text-green-500"></i> Pr√≥ximos
                    </button>
                    <button onclick="PublicEvents.filter('open')" class="public-event-filter px-5 py-2.5 rounded-full text-xs font-bold bg-white text-slate-600 border border-slate-200 hover:border-blue-300 hover:bg-blue-50 transition-all" data-filter="open">
                        <i data-lucide="door-open" class="w-4 h-4 inline mr-1 text-blue-500"></i> Inscripciones Abiertas
                    </button>
                    <button onclick="PublicEvents.filter('past')" class="public-event-filter px-5 py-2.5 rounded-full text-xs font-bold bg-white text-slate-600 border border-slate-200 hover:border-slate-400 hover:bg-slate-100 transition-all" data-filter="past">
                        <i data-lucide="history" class="w-4 h-4 inline mr-1 text-slate-500"></i> Pasados
                    </button>
                </div>
                
                <!-- Grid de Eventos -->
                <div id="public-events-grid" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                    <!-- Los eventos se cargan din√°micamente -->
                </div>
                
                <!-- Estado vac√≠o -->
                <div id="public-events-empty" class="hidden text-center py-20">
                    <div class="w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i data-lucide="calendar-x" class="w-12 h-12 text-slate-300"></i>
                    </div>
                    <h3 class="text-xl font-bold text-slate-400 mb-2">No hay eventos disponibles</h3>
                    <p class="text-slate-400 text-sm">Pronto anunciaremos nuevas competencias. ¬°Mantente atento!</p>
                </div>
                
                <!-- Loading -->
                <div id="public-events-loading" class="text-center py-20">
                    <div class="inline-flex items-center gap-3 text-slate-400">
                        <i data-lucide="loader-2" class="w-6 h-6 animate-spin"></i>
                        <span class="font-bold">Cargando eventos...</span>
                    </div>
                </div>
                
                <!-- CTA Organizar -->
                <div class="mt-16 text-center">
                    <div class="inline-block bg-gradient-to-r from-cyan-50 via-teal-50 to-cyan-50 rounded-2xl p-8 border border-cyan-200">
                        <h4 class="text-xl font-bold text-tec-dark mb-2">¬øQuieres organizar un evento con nosotros?</h4>
                        <p class="text-slate-500 text-sm mb-6">Si eres instituci√≥n educativa o empresa y quieres colaborar</p>
                        <a href="mailto:crai@tecnm.edu.mx" class="px-8 py-3 bg-tec-blue text-white rounded-xl font-bold text-sm hover:bg-tec-dark transition-all inline-flex items-center gap-2">
                            <i data-lucide="mail" class="w-4 h-4"></i>
                            Cont√°ctanos
                        </a>
                    </div>
                </div>
            </div>
        </section>

<!-- ==============================
             VISTA 6: DASHBOARD PRIVADO (Member & Admin)
             ============================== -->
        <section id="view-dashboard" class="view-section hidden bg-slate-100 min-h-screen pt-4 pb-20">
            <div class="container mx-auto px-6 h-full">
                
                <div class="flex flex-col lg:flex-row gap-8 h-full">
                    
                    <!-- SIDEBAR / PERFIL -->
                    <aside class="w-full lg:w-1/4">
                        <div class="bg-white rounded-2xl shadow-enterprise p-6 sticky top-24 border border-slate-100">
                            <div class="flex flex-col items-center text-center border-b border-slate-100 pb-6 mb-6">
                                <div class="w-24 h-24 rounded-full bg-slate-100 mb-4 p-1 border-2 border-tec-gold relative overflow-hidden">
                                    <img id="dash-avatar" src="https://ui-avatars.com/api/?name=Admin+User&background=1B396A&color=fff" class="w-full h-full rounded-full object-cover" alt="Avatar">
                                </div>
                                <h3 class="font-bold text-tec-blue text-lg leading-tight" id="dash-username">Cargando...</h3>
                                <p class="text-xs text-slate-500 uppercase tracking-widest font-bold mt-1" id="dash-role">MIEMBRO OFICIAL</p>
                                <span class="mt-3 px-3 py-1 bg-green-50 text-green-700 text-[10px] font-black rounded-full flex items-center gap-2 border border-green-100">
                                    <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span> ONLINE
                                </span>
                            </div>

                            <!-- Men√∫ de Acciones -->
                            <nav class="space-y-2">
                                <button onclick="Router.switchTab('profile')" class="w-full text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-tec-gold/10 hover:text-tec-gold font-bold text-xs flex items-center gap-3 transition group">
                                    <div class="p-1 bg-tec-gold/20 text-tec-gold rounded group-hover:scale-110 transition"><i data-lucide="user-cog" class="w-3 h-3"></i></div>
                                    <span>Mi Perfil</span>
                                </button>
                                
                                <button onclick="Router.switchTab('overview')" class="w-full text-left px-4 py-3 rounded-xl bg-blue-50 text-tec-blue font-bold text-xs flex items-center gap-3 transition">
                                    <i data-lucide="layout-grid" class="w-4 h-4"></i> Panel General
                                </button>
                                
                                <!-- Nuevas herramientas de gesti√≥n -->
                                <button onclick="Router.navigate('tasks')" class="w-full text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-indigo-50 hover:text-indigo-700 font-bold text-xs flex items-center gap-3 transition group">
                                    <div class="p-1 bg-indigo-100 text-indigo-600 rounded group-hover:scale-110 transition"><i data-lucide="kanban" class="w-3 h-3"></i></div>
                                    <span>Gestor de Tareas</span>
                                </button>
                                
                                <button onclick="Router.navigate('calendar')" class="w-full text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-cyan-50 hover:text-cyan-700 font-bold text-xs flex items-center gap-3 transition group">
                                    <div class="p-1 bg-cyan-100 text-cyan-600 rounded group-hover:scale-110 transition"><i data-lucide="calendar-days" class="w-3 h-3"></i></div>
                                    <span>Calendario</span>
                                </button>
                                
                                <button onclick="Router.navigate('communications')" class="w-full text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-rose-50 hover:text-rose-700 font-bold text-xs flex items-center gap-3 transition group">
                                    <div class="p-1 bg-rose-100 text-rose-600 rounded group-hover:scale-110 transition"><i data-lucide="radio" class="w-3 h-3"></i></div>
                                    <span>Comunicaciones</span>
                                    <span class="ml-auto text-[9px] bg-rose-500 text-white px-1.5 py-0.5 rounded-full font-black" id="unread-announcements">0</span>
                                </button>
                                
                                <!-- BOT√ìN CMS (Solo visible para admins via JS Logic) -->
                                <button id="btn-cms-mode" onclick="Modal.open('cms')" class="w-full text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 font-bold text-xs flex items-center gap-3 transition group hidden">
                                    <div class="p-1 bg-tec-gold text-white rounded group-hover:rotate-12 transition"><i data-lucide="edit-3" class="w-3 h-3"></i></div>
                                    <span class="group-hover:text-tec-gold transition">Editar Sitio (CMS)</span>
                                </button>

                                <!-- BOT√ìN EVENTOS P√öBLICOS (Solo visible para admins via JS Logic) -->
                                <button id="btn-manage-events" onclick="PublicEvents.openManager()" class="w-full text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-cyan-50 hover:text-cyan-700 font-bold text-xs flex items-center gap-3 transition group hidden">
                                    <div class="p-1 bg-cyan-100 text-cyan-600 rounded group-hover:scale-110 transition"><i data-lucide="calendar-check" class="w-3 h-3"></i></div>
                                    <span>Gestionar Eventos P√∫blicos</span>
                                </button>

                                <button onclick="Modal.open('upload')" class="w-full text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 font-bold text-xs flex items-center gap-3 transition">
                                    <i data-lucide="folder-plus" class="w-4 h-4"></i> Subir Proyecto
                                </button>
                                
                                <button onclick="Dashboard.showMyProjects()" class="w-full text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-green-50 hover:text-green-700 font-bold text-xs flex items-center gap-3 transition group">
                                    <div class="p-1 bg-green-100 text-green-600 rounded group-hover:scale-110 transition"><i data-lucide="folder-heart" class="w-3 h-3"></i></div>
                                    <span>Mis Proyectos</span>
                                </button>
                                
                                <button onclick="Router.navigate('resources')" class="w-full text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-slate-50 font-bold text-xs flex items-center gap-3 transition">
                                    <i data-lucide="book-open" class="w-4 h-4"></i> Ver Recursos
                                </button>
                                
                                <!-- Separador -->
                                <div class="my-3 border-t border-slate-100"></div>
                                <p class="px-2 text-[9px] font-bold text-slate-400 uppercase tracking-wider mb-2">Herramientas del Club</p>
                                
                                <button onclick="Router.navigate('wiki')" class="w-full text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-purple-50 hover:text-purple-700 font-bold text-xs flex items-center gap-3 transition group">
                                    <div class="p-1 bg-purple-100 text-purple-600 rounded group-hover:scale-110 transition"><i data-lucide="book-open" class="w-3 h-3"></i></div>
                                    <span>Wiki T√©cnica</span>
                                </button>
                                
                                <button onclick="Router.navigate('inventory')" class="w-full text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-green-50 hover:text-green-700 font-bold text-xs flex items-center gap-3 transition group">
                                    <div class="p-1 bg-green-100 text-green-600 rounded group-hover:scale-110 transition"><i data-lucide="package" class="w-3 h-3"></i></div>
                                    <span>Inventario</span>
                                </button>
                                
                                <button onclick="Router.navigate('competitions')" class="w-full text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-orange-50 hover:text-orange-700 font-bold text-xs flex items-center gap-3 transition group">
                                    <div class="p-1 bg-orange-100 text-orange-600 rounded group-hover:scale-110 transition"><i data-lucide="trophy" class="w-3 h-3"></i></div>
                                    <span>Competencias</span>
                                </button>
                                
                                <button onclick="Router.navigate('reservations')" class="w-full text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-blue-50 hover:text-blue-700 font-bold text-xs flex items-center gap-3 transition group">
                                    <div class="p-1 bg-blue-100 text-blue-600 rounded group-hover:scale-110 transition"><i data-lucide="calendar-plus" class="w-3 h-3"></i></div>
                                    <span>Reservar Equipo</span>
                                </button>
                                
                                <!-- BOT√ìN SOLICITUDES (Solo visible para fundadores/l√≠deres/maestros) -->
                                <button id="btn-applications" onclick="Applications.show()" class="w-full text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-amber-50 hover:text-amber-700 font-bold text-xs flex items-center gap-3 transition group hidden">
                                    <div class="p-1 bg-amber-100 text-amber-600 rounded group-hover:scale-110 transition"><i data-lucide="inbox" class="w-3 h-3"></i></div>
                                    <span>Solicitudes</span>
                                    <span class="ml-auto text-[9px] bg-amber-500 text-white px-1.5 py-0.5 rounded-full font-black" id="pending-applications-count">0</span>
                                </button>
                                
                                <!-- BOT√ìN GESTI√ìN DE MIEMBROS (Solo visible para admin/fundador) -->
                                <button id="btn-admin-members" onclick="Router.navigate('admin-members')" class="w-full text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-red-50 hover:text-red-700 font-bold text-xs flex items-center gap-3 transition group hidden">
                                    <div class="p-1 bg-red-100 text-red-600 rounded group-hover:scale-110 transition"><i data-lucide="users-cog" class="w-3 h-3"></i></div>
                                    <span>Gesti√≥n de Miembros</span>
                                </button>
                            </nav>

                            <div class="mt-8 pt-6 border-t border-slate-100">
                                <button onclick="Auth.logout()" class="w-full border border-red-100 text-red-500 hover:bg-red-50 px-4 py-3 rounded-xl font-bold text-xs flex items-center justify-center gap-2 transition">
                                    <i data-lucide="log-out" class="w-4 h-4"></i> CERRAR SESI√ìN
                                </button>
                            </div>
                        </div>
                    </aside>

                    <!-- CONTENIDO PRINCIPAL DASHBOARD -->
                    <main class="w-full lg:w-3/4 flex flex-col gap-6">
                        
                        <!-- TAB: OVERVIEW -->
                        <div id="tab-overview" class="flex flex-col gap-4 sm:gap-6 h-full">
                            <!-- Welcome Banner -->
                            <div class="bg-gradient-to-r from-tec-blue to-tec-dark rounded-2xl p-4 sm:p-8 text-white relative overflow-hidden shadow-lg">
                                <div class="relative z-10">
                                    <div class="flex items-start justify-between">
                                        <div>
                                            <h2 class="text-xl sm:text-2xl font-bold mb-2">Centro de Comando B√∫falo</h2>
                                            <p class="text-blue-100 text-[10px] sm:text-xs max-w-lg">Bienvenido al sistema de gesti√≥n central. Desde aqu√≠ puedes colaborar con el equipo, gestionar proyectos y actualizar la plataforma p√∫blica.</p>
                                        </div>
                                        <!-- Bot√≥n de Reporte PDF (solo para l√≠deres/fundadores/maestros) -->
                                        <button id="btn-generate-report" onclick="ClubReport.generate()" class="hidden flex-shrink-0 bg-white/20 hover:bg-white/30 backdrop-blur px-4 py-2.5 rounded-xl text-xs font-bold transition flex items-center gap-2" title="Generar Reporte PDF">
                                            <i data-lucide="file-text" class="w-4 h-4"></i>
                                            <span class="hidden sm:inline">Reporte PDF</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="absolute right-0 bottom-0 opacity-10">
                                    <i data-lucide="cpu" class="w-40 h-40 transform translate-x-10 translate-y-10"></i>
                                </div>
                            </div>

                            <!-- Estad√≠sticas R√°pidas -->
                            <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
                                <div class="bg-white rounded-xl p-4 border border-slate-200 shadow-sm">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                            <i data-lucide="users" class="w-5 h-5 text-blue-600"></i>
                                        </div>
                                        <span class="text-[10px] text-green-500 font-bold">+12%</span>
                                    </div>
                                    <p class="text-2xl font-black text-slate-800" id="stat-members">--</p>
                                    <p class="text-[10px] text-slate-500 uppercase font-bold">Miembros</p>
                                </div>
                                <div class="bg-white rounded-xl p-4 border border-slate-200 shadow-sm">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                            <i data-lucide="folder" class="w-5 h-5 text-green-600"></i>
                                        </div>
                                        <span class="text-[10px] text-green-500 font-bold">Activo</span>
                                    </div>
                                    <p class="text-2xl font-black text-slate-800" id="stat-projects">--</p>
                                    <p class="text-[10px] text-slate-500 uppercase font-bold">Proyectos</p>
                                </div>
                                <div class="bg-white rounded-xl p-4 border border-slate-200 shadow-sm">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                            <i data-lucide="trophy" class="w-5 h-5 text-purple-600"></i>
                                        </div>
                                        <span class="text-[10px] text-purple-500 font-bold">2026</span>
                                    </div>
                                    <p class="text-2xl font-black text-slate-800" id="stat-competitions">--</p>
                                    <p class="text-[10px] text-slate-500 uppercase font-bold">Competencias</p>
                                </div>
                                <div class="bg-white rounded-xl p-4 border border-slate-200 shadow-sm">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                                            <i data-lucide="book-open" class="w-5 h-5 text-orange-600"></i>
                                        </div>
                                        <span class="text-[10px] text-orange-500 font-bold">Wiki</span>
                                    </div>
                                    <p class="text-2xl font-black text-slate-800" id="stat-wiki">--</p>
                                    <p class="text-[10px] text-slate-500 uppercase font-bold">Art√≠culos</p>
                                </div>
                            </div>

                            <!-- Accesos R√°pidos -->
                            <div class="bg-white rounded-2xl shadow-enterprise border border-slate-200 p-4 sm:p-6">
                                <h4 class="font-bold text-slate-700 text-sm mb-4 flex items-center gap-2">
                                    <i data-lucide="zap" class="w-4 h-4 text-tec-gold"></i>
                                    Acciones R√°pidas
                                </h4>
                                <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                    <button onclick="Modal.open('upload')" class="flex flex-col items-center gap-2 p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl hover:shadow-md transition group">
                                        <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                                            <i data-lucide="plus" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <span class="text-xs font-bold text-slate-700">Nuevo Proyecto</span>
                                    </button>
                                    <button onclick="Router.navigate('reservations')" class="flex flex-col items-center gap-2 p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-xl hover:shadow-md transition group">
                                        <div class="w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                                            <i data-lucide="calendar" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <span class="text-xs font-bold text-slate-700">Reservar Equipo</span>
                                    </button>
                                    <button onclick="Router.navigate('wiki')" class="flex flex-col items-center gap-2 p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl hover:shadow-md transition group">
                                        <div class="w-12 h-12 bg-purple-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                                            <i data-lucide="file-plus" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <span class="text-xs font-bold text-slate-700">Crear Art√≠culo</span>
                                    </button>
                                    <button onclick="Router.navigate('inventory')" class="flex flex-col items-center gap-2 p-4 bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl hover:shadow-md transition group">
                                        <div class="w-12 h-12 bg-orange-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                                            <i data-lucide="search" class="w-6 h-6 text-white"></i>
                                        </div>
                                        <span class="text-xs font-bold text-slate-700">Ver Inventario</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Grid de 2 columnas: Chat y Pr√≥ximos Eventos -->
                            <div class="grid lg:grid-cols-2 gap-4 sm:gap-6">
                                <!-- CHAT EN TIEMPO REAL -->
                                <div class="bg-white rounded-2xl shadow-enterprise border border-slate-200 flex flex-col overflow-hidden h-[350px] sm:h-[400px]">
                                    <div class="p-3 sm:p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                                        <h4 class="font-bold text-slate-700 text-xs sm:text-sm flex items-center gap-2">
                                            <i data-lucide="message-square" class="w-4 h-4 text-tec-blue"></i>
                                            <span class="hidden sm:inline">CHAT DE LABORATORIO</span>
                                            <span class="sm:hidden">CHAT</span>
                                        </h4>
                                        <div class="flex items-center gap-2">
                                            <span class="text-[9px] sm:text-[10px] text-green-600 bg-green-100 px-2 py-0.5 rounded font-mono font-bold animate-pulse">LIVE</span>
                                            <button onclick="Router.navigate('communications')" class="text-[10px] text-tec-blue hover:text-tec-gold font-bold hidden sm:block" title="Abrir Centro de Comunicaciones">
                                                <i data-lucide="maximize-2" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Messages Area -->
                                    <div id="chat-messages" class="flex-1 p-3 sm:p-4 overflow-y-auto space-y-3 bg-slate-50/50 scroll-smooth">
                                        <div class="text-center text-slate-300 text-xs py-10 font-mono">Cargando historial de transmisiones...</div>
                                    </div>

                                    <!-- Input Area -->
                                    <form id="chat-form" class="p-3 sm:p-4 bg-white border-t border-slate-100 flex gap-2 sm:gap-3 relative" onsubmit="Chat.send(event)">
                                        <input type="text" id="chat-input" placeholder="Escribe un mensaje..." autocomplete="off" class="w-full bg-slate-100 border-0 rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-sm focus:ring-2 focus:ring-tec-blue outline-none transition" disabled>
                                        <button type="submit" id="chat-send-btn" class="bg-tec-blue text-white p-2 sm:p-3 rounded-xl hover:bg-tec-gold hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed">
                                            <i data-lucide="send" class="w-4 sm:w-5 h-4 sm:h-5"></i>
                                        </button>
                                    </form>
                                </div>

                                <!-- Pr√≥ximos Eventos / Actividad -->
                                <div class="bg-white rounded-2xl shadow-enterprise border border-slate-200 flex flex-col overflow-hidden h-[350px] sm:h-[400px]">
                                    <div class="p-3 sm:p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                                        <h4 class="font-bold text-slate-700 text-xs sm:text-sm flex items-center gap-2">
                                            <i data-lucide="calendar" class="w-4 h-4 text-tec-gold"></i>
                                            PR√ìXIMOS EVENTOS
                                        </h4>
                                        <div class="flex items-center gap-2">
                                            <button onclick="Router.navigate('calendar')" class="text-[10px] text-tec-blue hover:text-tec-gold font-bold">Ver calendario ‚Üí</button>
                                        </div>
                                    </div>
                                    
                                    <div id="upcoming-events" class="flex-1 p-3 sm:p-4 overflow-y-auto space-y-3">
                                        <!-- Eventos se cargan din√°micamente -->
                                        <div class="text-center py-8">
                                            <div class="animate-spin w-6 h-6 border-2 border-tec-blue border-t-transparent rounded-full mx-auto mb-2"></div>
                                            <p class="text-xs text-slate-400">Cargando eventos...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Actividad Reciente -->
                            <div class="bg-white rounded-2xl shadow-enterprise border border-slate-200 p-4 sm:p-6">
                                <h4 class="font-bold text-slate-700 text-sm mb-4 flex items-center gap-2">
                                    <i data-lucide="activity" class="w-4 h-4 text-green-500"></i>
                                    Actividad Reciente
                                </h4>
                                <div class="space-y-3" id="recent-activity">
                                    <!-- Actividad se carga din√°micamente -->
                                    <div class="text-center py-4">
                                        <div class="animate-spin w-5 h-5 border-2 border-tec-blue border-t-transparent rounded-full mx-auto mb-2"></div>
                                        <p class="text-xs text-slate-400">Cargando actividad...</p>
                                    </div>
                                </div>
                            </div>

                            <!-- MIS LOGROS -->
                            <div id="dashboard-achievements" class="hidden">
                                <!-- Se carga din√°micamente con Achievements.renderDashboardSection() -->
                            </div>

                        </div>

                        <!-- TAB: MI PERFIL -->
                        <div id="tab-profile" class="hidden flex flex-col gap-6">
                            <!-- Header del Perfil -->
                            <div class="bg-gradient-to-r from-tec-gold via-yellow-500 to-orange-500 rounded-2xl p-6 sm:p-8 text-white relative overflow-hidden shadow-lg">
                                <div class="relative z-10">
                                    <h2 class="text-xl sm:text-2xl font-bold mb-2 flex items-center gap-3">
                                        <i data-lucide="user-cog" class="w-6 h-6 sm:w-8 sm:h-8"></i>
                                        Mi Perfil
                                    </h2>
                                    <p class="text-yellow-100 text-xs max-w-lg">Configura tu informaci√≥n p√∫blica, foto de perfil, √°rea de especializaci√≥n y habilidades.</p>
                                </div>
                                <div class="absolute right-0 bottom-0 opacity-10">
                                    <i data-lucide="user" class="w-40 h-40 transform translate-x-10 translate-y-10"></i>
                                </div>
                            </div>
                            
                            <!-- Perfil y datos del miembro -->
                            <div class="bg-white rounded-2xl shadow-enterprise border border-slate-200 p-6">
                                <div class="flex items-center justify-between mb-6">
                                    <div>
                                        <h4 class="font-bold text-slate-800 text-lg flex items-center gap-2">
                                            <i data-lucide="user-cog" class="w-5 h-5 text-tec-blue"></i>
                                            Panel de Miembro
                                        </h4>
                                        <p class="text-xs text-slate-500">Configura tu perfil p√∫blico y √°rea de especializaci√≥n</p>
                                    </div>
                                    <span class="text-[9px] bg-tec-gold/10 text-tec-gold px-2 py-1 rounded-full font-bold uppercase">Firebase Sync</span>
                                </div>
                                
                                <form class="space-y-5" onsubmit="Database.saveProfile(event)">
                                    <!-- Secci√≥n Foto de Perfil -->
                                    <div class="flex items-start gap-6 pb-5 border-b border-slate-100">
                                        <div class="flex-shrink-0">
                                            <div id="photo-drop-zone" class="w-24 h-24 rounded-xl bg-slate-100 overflow-hidden border-2 border-dashed border-slate-300 hover:border-tec-blue cursor-pointer transition-all group relative" onclick="document.getElementById('profile-photo-file').click()" ondragover="Profile.handleDragOver(event)" ondragleave="Profile.handleDragLeave(event)" ondrop="Profile.handleDrop(event)">
                                                <img id="profile-preview" src="https://ui-avatars.com/api/?name=User&background=1B396A&color=fff" class="w-full h-full object-cover">
                                                <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                                                    <i data-lucide="camera" class="w-6 h-6 text-white"></i>
                                                </div>
                                            </div>
                                            <input id="profile-photo-file" type="file" accept="image/*" class="hidden" onchange="Profile.handleFileSelect(event)">
                                        </div>
                                        <div class="flex-1 space-y-3">
                                            <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide">Foto de Perfil</label>
                                            <div class="flex flex-col gap-2">
                                                <button type="button" onclick="document.getElementById('profile-photo-file').click()" class="w-full flex items-center justify-center gap-2 bg-tec-blue/10 hover:bg-tec-blue/20 text-tec-blue px-4 py-2.5 rounded-lg text-xs font-bold transition">
                                                    <i data-lucide="upload" class="w-4 h-4"></i>
                                                    Subir Imagen
                                                </button>
                                                <p class="text-[10px] text-slate-400 text-center">Arrastra una imagen o haz clic para seleccionar</p>
                                                <p class="text-[10px] text-slate-400 text-center">M√°x. 1MB ‚Ä¢ JPG, PNG, GIF, WebP</p>
                                            </div>
                                            <!-- Campo oculto para guardar el Base64 -->
                                            <input id="profile-photo" type="hidden" value="">
                                        </div>
                                    </div>

                                    <!-- Informaci√≥n B√°sica -->
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-1 block">Nombre Completo *</label>
                                            <input id="profile-name" type="text" placeholder="Tu nombre completo" class="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-sm font-bold text-tec-dark focus:border-tec-blue outline-none" required>
                                        </div>
                                        <div>
                                            <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-1 block">T√≠tulo / Rol en el Club</label>
                                            <div id="profile-title-display" class="w-full bg-slate-100 border border-slate-200 rounded-lg p-3 text-sm text-slate-500 flex items-center justify-between">
                                                <span id="profile-title-text">Sin t√≠tulo asignado</span>
                                                <span class="text-[9px] bg-slate-200 text-slate-500 px-2 py-0.5 rounded-full">Solo admin puede cambiar</span>
                                            </div>
                                            <input id="profile-title" type="hidden" value="">
                                        </div>
                                    </div>

                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-1 block">No. Control</label>
                                            <input id="profile-control" type="text" placeholder="Ej: 21490000" class="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-sm text-slate-700 focus:border-tec-blue outline-none">
                                        </div>
                                    </div>

                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-1 block">Semestre</label>
                                            <select id="profile-semester" class="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-sm text-slate-700 focus:border-tec-blue outline-none">
                                                <option value="">Selecciona...</option>
                                                <option value="1">1er Semestre</option>
                                                <option value="2">2do Semestre</option>
                                                <option value="3">3er Semestre</option>
                                                <option value="4">4to Semestre</option>
                                                <option value="5">5to Semestre</option>
                                                <option value="6">6to Semestre</option>
                                                <option value="7">7mo Semestre</option>
                                                <option value="8">8vo Semestre</option>
                                                <option value="9">9no Semestre</option>
                                                <option value="egresado">Egresado</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-1 block">Carrera</label>
                                            <select id="profile-career" class="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-sm text-slate-700 focus:border-tec-blue outline-none">
                                                <option value="">Selecciona...</option>
                                                <option value="Mecatr√≥nica">Ing. Mecatr√≥nica</option>
                                                <option value="Electr√≥nica">Ing. Electr√≥nica</option>
                                                <option value="Sistemas">Ing. Sistemas Computacionales</option>
                                                <option value="Mec√°nica">Ing. Mec√°nica</option>
                                                <option value="Industrial">Ing. Industrial</option>
                                                <option value="El√©ctrica">Ing. El√©ctrica</option>
                                                <option value="Otra">Otra</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- √Årea del Club -->
                                    <div>
                                        <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-2 block">√Årea del Club CRAI *</label>
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                                            <label class="area-option flex items-center gap-3 p-3 bg-slate-50 border border-slate-200 rounded-lg cursor-pointer hover:border-tec-blue hover:bg-blue-50/50 transition has-[:checked]:border-tec-blue has-[:checked]:bg-blue-50">
                                                <input type="radio" name="profile-area" value="gestion" class="accent-tec-blue">
                                                <div class="flex-1">
                                                    <span class="text-xs font-bold text-slate-700 block">Gesti√≥n y Vinculaci√≥n</span>
                                                    <span class="text-[9px] text-slate-400">Administraci√≥n, patrocinios, eventos</span>
                                                </div>
                                                <i data-lucide="briefcase" class="w-4 h-4 text-purple-500"></i>
                                            </label>
                                            <label class="area-option flex items-center gap-3 p-3 bg-slate-50 border border-slate-200 rounded-lg cursor-pointer hover:border-tec-blue hover:bg-blue-50/50 transition has-[:checked]:border-tec-blue has-[:checked]:bg-blue-50">
                                                <input type="radio" name="profile-area" value="telecom" class="accent-tec-blue">
                                                <div class="flex-1">
                                                    <span class="text-xs font-bold text-slate-700 block">Telecomunicaciones y Redes</span>
                                                    <span class="text-[9px] text-slate-400">Comunicaci√≥n, protocolos, IoT</span>
                                                </div>
                                                <i data-lucide="wifi" class="w-4 h-4 text-blue-500"></i>
                                            </label>
                                            <label class="area-option flex items-center gap-3 p-3 bg-slate-50 border border-slate-200 rounded-lg cursor-pointer hover:border-tec-blue hover:bg-blue-50/50 transition has-[:checked]:border-tec-blue has-[:checked]:bg-blue-50">
                                                <input type="radio" name="profile-area" value="software" class="accent-tec-blue">
                                                <div class="flex-1">
                                                    <span class="text-xs font-bold text-slate-700 block">Software, Autonom√≠a e IA</span>
                                                    <span class="text-[9px] text-slate-400">Programaci√≥n, visi√≥n, ML</span>
                                                </div>
                                                <i data-lucide="brain" class="w-4 h-4 text-green-500"></i>
                                            </label>
                                            <label class="area-option flex items-center gap-3 p-3 bg-slate-50 border border-slate-200 rounded-lg cursor-pointer hover:border-tec-blue hover:bg-blue-50/50 transition has-[:checked]:border-tec-blue has-[:checked]:bg-blue-50">
                                                <input type="radio" name="profile-area" value="electronica" class="accent-tec-blue">
                                                <div class="flex-1">
                                                    <span class="text-xs font-bold text-slate-700 block">Electr√≥nica y Control</span>
                                                    <span class="text-[9px] text-slate-400">Circuitos, PCB, sensores</span>
                                                </div>
                                                <i data-lucide="cpu" class="w-4 h-4 text-orange-500"></i>
                                            </label>
                                            <label class="area-option flex items-center gap-3 p-3 bg-slate-50 border border-slate-200 rounded-lg cursor-pointer hover:border-tec-blue hover:bg-blue-50/50 transition has-[:checked]:border-tec-blue has-[:checked]:bg-blue-50">
                                                <input type="radio" name="profile-area" value="mecanico" class="accent-tec-blue">
                                                <div class="flex-1">
                                                    <span class="text-xs font-bold text-slate-700 block">Dise√±o Mec√°nico y Manufactura</span>
                                                    <span class="text-[9px] text-slate-400">CAD, impresi√≥n 3D, CNC</span>
                                                </div>
                                                <i data-lucide="cog" class="w-4 h-4 text-red-500"></i>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Skills / Tecnolog√≠as -->
                                    <div>
                                        <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-2 block">Skills y Tecnolog√≠as</label>
                                        <div class="flex flex-wrap gap-2 mb-2" id="profile-skills-container"></div>
                                        <div class="flex gap-2">
                                            <input id="profile-skill-input" type="text" placeholder="Escribe un skill y presiona Enter" class="flex-1 bg-slate-50 border border-slate-200 rounded-lg p-2.5 text-xs focus:border-tec-blue outline-none" onkeypress="Profile.addSkillOnEnter(event)">
                                            <button type="button" onclick="Profile.addSkill()" class="px-3 py-2 bg-tec-gold text-white rounded-lg text-xs font-bold hover:bg-yellow-600 transition">
                                                <i data-lucide="plus" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                        <p class="text-[10px] text-slate-400 mt-1">Ej: Python, Arduino, SolidWorks, ROS, OpenCV, KiCad...</p>
                                    </div>

                                    <!-- Bio / Descripci√≥n -->
                                    <div>
                                        <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-1 block">Bio / Descripci√≥n</label>
                                        <textarea id="profile-bio" rows="3" placeholder="Cu√©ntanos sobre ti, tus proyectos favoritos, metas en el club..." class="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-sm text-slate-700 focus:border-tec-blue outline-none resize-none"></textarea>
                                    </div>

                                    <!-- Redes Sociales -->
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-1 flex items-center gap-1">
                                                <i data-lucide="github" class="w-3 h-3"></i> GitHub
                                            </label>
                                            <input id="profile-github" type="text" placeholder="usuario" class="w-full bg-slate-50 border border-slate-200 rounded-lg p-2.5 text-xs text-slate-700 focus:border-tec-blue outline-none">
                                        </div>
                                        <div>
                                            <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-1 flex items-center gap-1">
                                                <i data-lucide="linkedin" class="w-3 h-3"></i> LinkedIn
                                            </label>
                                            <input id="profile-linkedin" type="text" placeholder="URL o usuario" class="w-full bg-slate-50 border border-slate-200 rounded-lg p-2.5 text-xs text-slate-700 focus:border-tec-blue outline-none">
                                        </div>
                                    </div>

                                    <!-- Bot√≥n Guardar -->
                                    <div class="flex items-center justify-between pt-4 border-t border-slate-100">
                                        <p class="text-[10px] text-slate-400 flex items-center gap-1">
                                            <i data-lucide="shield-check" class="w-3 h-3"></i>
                                            Los datos se sincronizan con Firebase
                                        </p>
                                        <button type="submit" class="px-6 py-3 bg-gradient-to-r from-tec-blue to-tec-dark text-white rounded-xl text-xs font-bold uppercase tracking-wider hover:shadow-lg transition-all flex items-center gap-2">
                                            <i data-lucide="save" class="w-4 h-4"></i>
                                            Guardar Perfil
                                        </button>
                                    </div>
                                </form>
                            </div>

                        </div>

                        <!-- TAB: MIS PROYECTOS -->
                        <div id="tab-my-projects" class="hidden flex flex-col gap-6">
                            <!-- Header -->
                            <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl p-6 sm:p-8 text-white relative overflow-hidden shadow-lg">
                                <div class="relative z-10">
                                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                                        <div>
                                            <h2 class="text-xl sm:text-2xl font-bold mb-2 flex items-center gap-3">
                                                <i data-lucide="folder-heart" class="w-6 h-6 sm:w-8 sm:h-8"></i>
                                                Mis Proyectos
                                            </h2>
                                            <p class="text-green-100 text-xs max-w-lg">Gestiona los proyectos que has creado o en los que participas. Puedes editarlos y actualizarlos en cualquier momento.</p>
                                        </div>
                                        <button onclick="Modal.open('upload')" class="flex items-center gap-2 bg-white/20 hover:bg-white/30 backdrop-blur px-4 py-3 rounded-xl font-bold text-sm transition">
                                            <i data-lucide="plus" class="w-5 h-5"></i>
                                            Nuevo Proyecto
                                        </button>
                                    </div>
                                </div>
                                <div class="absolute right-0 bottom-0 opacity-10">
                                    <i data-lucide="folder" class="w-40 h-40 transform translate-x-10 translate-y-10"></i>
                                </div>
                            </div>

                            <!-- Filtros y estad√≠sticas -->
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 bg-white rounded-xl p-4 shadow-sm border border-slate-100">
                                <div class="flex items-center gap-4">
                                    <div class="flex items-center gap-2">
                                        <span class="text-2xl font-black text-tec-blue" id="my-projects-count">0</span>
                                        <span class="text-xs text-slate-500">proyectos</span>
                                    </div>
                                    <div class="w-px h-8 bg-slate-200 hidden sm:block"></div>
                                    <div class="flex items-center gap-2">
                                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                                        <span class="text-xs text-slate-500">T√∫ como autor o participante</span>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <select id="my-projects-filter" onchange="Dashboard.filterMyProjects(this.value)" class="text-xs font-bold text-slate-600 bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 outline-none">
                                        <option value="all">Todos los proyectos</option>
                                        <option value="author">Creados por m√≠</option>
                                        <option value="participant">Como participante</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Lista de proyectos -->
                            <div id="my-projects-list" class="space-y-4">
                                <div class="text-center py-12">
                                    <div class="animate-spin w-8 h-8 border-3 border-tec-blue border-t-transparent rounded-full mx-auto mb-4"></div>
                                    <p class="text-sm text-slate-400">Cargando tus proyectos...</p>
                                </div>
                            </div>

                            <!-- Estado vac√≠o -->
                            <div id="my-projects-empty" class="hidden text-center py-12 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200">
                                <div class="w-16 h-16 bg-slate-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="folder-plus" class="w-8 h-8 text-slate-300"></i>
                                </div>
                                <h3 class="font-bold text-slate-600 mb-2">No tienes proyectos a√∫n</h3>
                                <p class="text-sm text-slate-400 mb-4">Comienza compartiendo tu primer proyecto con el equipo CRAI</p>
                                <button onclick="Modal.open('upload')" class="inline-flex items-center gap-2 px-6 py-3 bg-tec-blue text-white rounded-xl font-bold text-sm hover:bg-tec-dark transition">
                                    <i data-lucide="plus" class="w-4 h-4"></i>
                                    Crear Proyecto
                                </button>
                            </div>
                        </div>

                        <!-- TAB: SOLICITUDES (Solo para fundadores/l√≠deres/maestros) -->
                        <div id="tab-applications" class="hidden flex flex-col gap-6">
                            <!-- Header -->
                            <div class="bg-gradient-to-r from-amber-500 to-orange-600 rounded-2xl p-6 sm:p-8 text-white relative overflow-hidden shadow-lg">
                                <div class="relative z-10">
                                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                                        <div>
                                            <h2 class="text-xl sm:text-2xl font-bold mb-2 flex items-center gap-3">
                                                <i data-lucide="inbox" class="w-6 h-6 sm:w-8 sm:h-8"></i>
                                                Solicitudes
                                            </h2>
                                            <p class="text-amber-100 text-xs max-w-lg">Gestiona solicitudes de aspirantes y empresas interesadas en patrocinar.</p>
                                        </div>
                                        <div class="flex items-center gap-3">
                                            <div class="text-center bg-white/20 backdrop-blur px-4 py-2 rounded-xl">
                                                <p class="text-2xl font-black" id="applications-pending-stat">0</p>
                                                <p class="text-[10px] text-amber-100">Pendientes</p>
                                            </div>
                                            <div class="text-center bg-white/20 backdrop-blur px-4 py-2 rounded-xl">
                                                <p class="text-2xl font-black" id="applications-total-stat">0</p>
                                                <p class="text-[10px] text-amber-100">Total</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="absolute right-0 bottom-0 opacity-10">
                                    <i data-lucide="users" class="w-40 h-40 transform translate-x-10 translate-y-10"></i>
                                </div>
                            </div>

                            <!-- Tabs: Ingreso vs Patrocinios -->
                            <div class="flex gap-2 bg-white rounded-xl p-2 shadow-sm border border-slate-100">
                                <button onclick="Applications.switchTab('ingreso')" id="app-tab-ingreso" class="app-type-tab flex-1 px-4 py-3 rounded-lg text-sm font-bold bg-tec-blue text-white flex items-center justify-center gap-2 transition">
                                    <i data-lucide="user-plus" class="w-4 h-4"></i>
                                    Solicitudes de Ingreso
                                    <span class="text-[10px] bg-white/20 px-2 py-0.5 rounded-full" id="app-count-ingreso">0</span>
                                </button>
                                <button onclick="Applications.switchTab('patrocinio')" id="app-tab-patrocinio" class="app-type-tab flex-1 px-4 py-3 rounded-lg text-sm font-bold bg-slate-100 text-slate-600 hover:bg-tec-gold/10 hover:text-tec-gold flex items-center justify-center gap-2 transition">
                                    <i data-lucide="building-2" class="w-4 h-4"></i>
                                    Solicitudes de Patrocinio
                                    <span class="text-[10px] bg-slate-200 px-2 py-0.5 rounded-full" id="app-count-patrocinio">0</span>
                                </button>
                            </div>

                            <!-- Filtros -->
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 bg-white rounded-xl p-4 shadow-sm border border-slate-100">
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="Applications.filter('all')" class="app-filter-btn px-4 py-2 rounded-lg text-xs font-bold bg-tec-blue text-white" data-filter="all">Todas</button>
                                    <button onclick="Applications.filter('pending')" class="app-filter-btn px-4 py-2 rounded-lg text-xs font-bold bg-slate-100 text-slate-600 hover:bg-amber-100 hover:text-amber-700" data-filter="pending">Pendientes</button>
                                    <button onclick="Applications.filter('reviewed')" class="app-filter-btn px-4 py-2 rounded-lg text-xs font-bold bg-slate-100 text-slate-600 hover:bg-blue-100 hover:text-blue-700" data-filter="reviewed">Revisadas</button>
                                    <button onclick="Applications.filter('accepted')" class="app-filter-btn px-4 py-2 rounded-lg text-xs font-bold bg-slate-100 text-slate-600 hover:bg-green-100 hover:text-green-700" data-filter="accepted">Aceptadas</button>
                                    <button onclick="Applications.filter('rejected')" class="app-filter-btn px-4 py-2 rounded-lg text-xs font-bold bg-slate-100 text-slate-600 hover:bg-red-100 hover:text-red-700" data-filter="rejected">Rechazadas</button>
                                </div>
                                <button onclick="Applications.load()" class="flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-xs font-bold text-slate-600 transition">
                                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                    Actualizar
                                </button>
                            </div>

                            <!-- Lista de solicitudes -->
                            <div id="applications-list" class="space-y-4">
                                <div class="text-center py-12">
                                    <div class="animate-spin w-8 h-8 border-3 border-amber-500 border-t-transparent rounded-full mx-auto mb-4"></div>
                                    <p class="text-sm text-slate-400">Cargando solicitudes...</p>
                                </div>
                            </div>

                            <!-- Estado vac√≠o -->
                            <div id="applications-empty" class="hidden text-center py-12 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200">
                                <div class="w-16 h-16 bg-amber-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="inbox" class="w-8 h-8 text-amber-400"></i>
                                </div>
                                <h3 class="font-bold text-slate-600 mb-2">No hay solicitudes</h3>
                                <p class="text-sm text-slate-400" id="applications-empty-text">Las nuevas solicitudes aparecer√°n aqu√≠</p>
                            </div>
                        </div>

                    </main>
                </div>
            </div>
        </section>

        <!-- ==============================
             VISTA: RECURSOS
             ============================== -->
        <section id="view-resources" class="view-section hidden py-20 bg-slate-50 min-h-screen">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-black text-tec-dark mb-4">Repositorio de Recursos</h2>
                    <p class="text-slate-500 max-w-2xl mx-auto">Documentaci√≥n, tutoriales, archivos y materiales compartidos por los miembros del club.</p>
                </div>

                <!-- Bot√≥n para subir recurso (solo usuarios autenticados) -->
                <div id="resources-upload-btn" class="hidden mb-8 text-center">
                    <button onclick="Modal.open('resource-upload')" class="inline-flex items-center gap-2 px-6 py-3 bg-tec-blue text-white rounded-xl font-bold text-sm hover:bg-tec-dark transition">
                        <i data-lucide="plus-circle" class="w-5 h-5"></i>
                        Subir Nuevo Recurso
                    </button>
                </div>

                <!-- Filtros -->
                <div class="flex flex-wrap gap-2 justify-center mb-8">
                    <button onclick="Resources.filter('all')" class="resource-filter active px-4 py-2 rounded-full text-xs font-bold bg-tec-blue text-white" data-filter="all">Todos</button>
                    <button onclick="Resources.filter('documento')" class="resource-filter px-4 py-2 rounded-full text-xs font-bold bg-slate-200 text-slate-600 hover:bg-tec-blue hover:text-white transition" data-filter="documento">Documentos</button>
                    <button onclick="Resources.filter('tutorial')" class="resource-filter px-4 py-2 rounded-full text-xs font-bold bg-slate-200 text-slate-600 hover:bg-tec-blue hover:text-white transition" data-filter="tutorial">Tutoriales</button>
                    <button onclick="Resources.filter('codigo')" class="resource-filter px-4 py-2 rounded-full text-xs font-bold bg-slate-200 text-slate-600 hover:bg-tec-blue hover:text-white transition" data-filter="codigo">C√≥digo</button>
                    <button onclick="Resources.filter('diseno')" class="resource-filter px-4 py-2 rounded-full text-xs font-bold bg-slate-200 text-slate-600 hover:bg-tec-blue hover:text-white transition" data-filter="diseno">Dise√±os CAD</button>
                    <button onclick="Resources.filter('otro')" class="resource-filter px-4 py-2 rounded-full text-xs font-bold bg-slate-200 text-slate-600 hover:bg-tec-blue hover:text-white transition" data-filter="otro">Otros</button>
                </div>

                <!-- Grid de Recursos -->
                <div id="resources-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="col-span-full text-center py-12">
                        <i data-lucide="folder-open" class="w-16 h-16 text-slate-300 mx-auto mb-4"></i>
                        <p class="text-slate-400">Cargando recursos...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==============================
             VISTA: GESTI√ìN DE MIEMBROS (ADMIN)
             ============================== -->
        <section id="view-admin-members" class="view-section hidden min-h-screen bg-slate-50">
            <!-- Hero -->
            <div class="relative bg-gradient-to-br from-red-600 via-red-700 to-rose-800 py-16 overflow-hidden">
                <div class="absolute inset-0">
                    <div class="absolute top-0 right-0 w-96 h-96 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"></div>
                </div>
                <div class="container mx-auto px-6 relative z-10">
                    <div class="max-w-4xl mx-auto text-center">
                        <div class="inline-flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur rounded-full text-white text-xs font-bold mb-4">
                            <i data-lucide="shield" class="w-4 h-4"></i>
                            Panel de Administraci√≥n
                        </div>
                        <h1 class="text-3xl sm:text-4xl font-black text-white mb-4">Gesti√≥n de Miembros</h1>
                        <p class="text-red-100 text-sm max-w-xl mx-auto">Administra las cuentas de los miembros del club. Puedes editar informaci√≥n o eliminar cuentas.</p>
                    </div>
                </div>
            </div>

            <!-- Contenido -->
            <div class="container mx-auto px-6 py-8">
                <!-- Barra de b√∫squeda y estad√≠sticas -->
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 mb-6">
                    <div class="flex flex-col sm:flex-row gap-4 items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center">
                                <i data-lucide="users" class="w-6 h-6 text-red-600"></i>
                            </div>
                            <div>
                                <p class="text-2xl font-black text-slate-800" id="admin-members-count">0</p>
                                <p class="text-xs text-slate-500 uppercase font-bold">Miembros Registrados</p>
                            </div>
                        </div>
                        <div class="flex-1 max-w-md">
                            <div class="relative">
                                <i data-lucide="search" class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input type="text" id="admin-members-search" placeholder="Buscar por nombre, email o carrera..." 
                                    class="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:border-red-500 focus:ring-2 focus:ring-red-500/20 outline-none transition"
                                    onkeyup="AdminMembers.search(this.value)">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lista de miembros -->
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-4 border-b border-slate-200 bg-slate-50">
                        <p class="text-xs font-bold text-slate-500 uppercase tracking-wider">Lista de Miembros</p>
                    </div>
                    <div id="admin-members-list" class="divide-y divide-slate-100">
                        <div class="p-8 text-center">
                            <div class="animate-spin w-8 h-8 border-4 border-red-500 border-t-transparent rounded-full mx-auto mb-4"></div>
                            <p class="text-slate-400 text-sm">Cargando miembros...</p>
                        </div>
                    </div>
                </div>

                <!-- Bot√≥n volver -->
                <div class="mt-6 text-center">
                    <button onclick="Router.to('dashboard')" class="inline-flex items-center gap-2 px-6 py-3 bg-slate-200 text-slate-700 rounded-xl font-bold text-sm hover:bg-slate-300 transition">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i>
                        Volver al Dashboard
                    </button>
                </div>
            </div>
        </section>

        <!-- ==============================
             VISTA: RESERVACIONES DE EQUIPO
             ============================== -->
        <section id="view-reservations" class="view-section hidden min-h-screen">
            <!-- Hero -->
            <div class="relative bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-800 py-20 overflow-hidden">
                <div class="absolute inset-0">
                    <div class="absolute top-0 right-0 w-96 h-96 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"></div>
                    <div class="absolute bottom-0 left-0 w-64 h-64 bg-blue-400/20 rounded-full translate-y-1/2 -translate-x-1/2 blur-2xl"></div>
                </div>
                <div class="container mx-auto px-6 relative z-10">
                    <div class="max-w-4xl mx-auto text-center">
                        <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur px-4 py-2 rounded-full mb-6">
                            <i data-lucide="calendar-check" class="w-4 h-4 text-blue-200"></i>
                            <span class="text-xs font-bold text-white uppercase tracking-wider">Sistema de Reservas</span>
                        </div>
                        <h1 class="text-4xl md:text-5xl font-black text-white mb-4">Reservar Equipo y Espacios</h1>
                        <p class="text-blue-100 text-lg max-w-2xl mx-auto">Agenda el uso de herramientas, m√°quinas y espacios del laboratorio para tus proyectos</p>
                    </div>
                </div>
            </div>

            <div class="bg-slate-50 py-12">
                <div class="container mx-auto px-6">
                    <!-- Tabs de navegaci√≥n -->
                    <div class="flex flex-wrap gap-2 justify-center mb-8">
                        <button onclick="Reservations.setTab('calendar')" class="reservation-tab active px-6 py-3 rounded-xl text-sm font-bold transition-all flex items-center gap-2" data-tab="calendar">
                            <i data-lucide="calendar" class="w-4 h-4"></i> Calendario
                        </button>
                        <button onclick="Reservations.setTab('my-reservations')" class="reservation-tab px-6 py-3 rounded-xl text-sm font-bold transition-all flex items-center gap-2" data-tab="my-reservations">
                            <i data-lucide="list" class="w-4 h-4"></i> Mis Reservas
                        </button>
                        <button onclick="Reservations.setTab('equipment')" class="reservation-tab px-6 py-3 rounded-xl text-sm font-bold transition-all flex items-center gap-2" data-tab="equipment">
                            <i data-lucide="wrench" class="w-4 h-4"></i> Equipos Disponibles
                        </button>
                    </div>

                    <!-- Contenido del Tab: Calendario -->
                    <div id="tab-calendar" class="reservation-tab-content">
                        <div class="grid lg:grid-cols-3 gap-8">
                            <!-- Calendario -->
                            <div class="lg:col-span-2 bg-white rounded-2xl shadow-lg p-6">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="font-bold text-xl text-tec-dark flex items-center gap-2">
                                        <i data-lucide="calendar" class="w-5 h-5 text-blue-500"></i>
                                        <span id="calendar-month-year">Enero 2026</span>
                                    </h3>
                                    <div class="flex gap-2">
                                        <button onclick="Reservations.prevMonth()" class="p-2 hover:bg-slate-100 rounded-lg transition">
                                            <i data-lucide="chevron-left" class="w-5 h-5 text-slate-600"></i>
                                        </button>
                                        <button onclick="Reservations.nextMonth()" class="p-2 hover:bg-slate-100 rounded-lg transition">
                                            <i data-lucide="chevron-right" class="w-5 h-5 text-slate-600"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- D√≠as de la semana -->
                                <div class="grid grid-cols-7 gap-1 mb-2">
                                    <div class="text-center text-xs font-bold text-slate-400 py-2">DOM</div>
                                    <div class="text-center text-xs font-bold text-slate-400 py-2">LUN</div>
                                    <div class="text-center text-xs font-bold text-slate-400 py-2">MAR</div>
                                    <div class="text-center text-xs font-bold text-slate-400 py-2">MI√â</div>
                                    <div class="text-center text-xs font-bold text-slate-400 py-2">JUE</div>
                                    <div class="text-center text-xs font-bold text-slate-400 py-2">VIE</div>
                                    <div class="text-center text-xs font-bold text-slate-400 py-2">S√ÅB</div>
                                </div>
                                
                                <!-- Grid del calendario -->
                                <div id="calendar-grid" class="grid grid-cols-7 gap-1">
                                    <!-- Se llena por JS -->
                                </div>
                            </div>
                            
                            <!-- Panel de reserva -->
                            <div class="bg-white rounded-2xl shadow-lg p-6">
                                <h3 class="font-bold text-lg text-tec-dark mb-4 flex items-center gap-2">
                                    <i data-lucide="plus-circle" class="w-5 h-5 text-blue-500"></i>
                                    Nueva Reserva
                                </h3>
                                <form id="reservation-form" class="space-y-4">
                                    <div>
                                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Fecha Seleccionada</label>
                                        <input type="date" id="res-date" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-blue-500 outline-none">
                                    </div>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Hora Inicio</label>
                                            <select id="res-start" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-blue-500 outline-none">
                                                <option value="">Seleccionar</option>
                                                <option value="08:00">08:00 AM</option>
                                                <option value="09:00">09:00 AM</option>
                                                <option value="10:00">10:00 AM</option>
                                                <option value="11:00">11:00 AM</option>
                                                <option value="12:00">12:00 PM</option>
                                                <option value="13:00">01:00 PM</option>
                                                <option value="14:00">02:00 PM</option>
                                                <option value="15:00">03:00 PM</option>
                                                <option value="16:00">04:00 PM</option>
                                                <option value="17:00">05:00 PM</option>
                                                <option value="18:00">06:00 PM</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Hora Fin</label>
                                            <select id="res-end" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-blue-500 outline-none">
                                                <option value="">Seleccionar</option>
                                                <option value="09:00">09:00 AM</option>
                                                <option value="10:00">10:00 AM</option>
                                                <option value="11:00">11:00 AM</option>
                                                <option value="12:00">12:00 PM</option>
                                                <option value="13:00">01:00 PM</option>
                                                <option value="14:00">02:00 PM</option>
                                                <option value="15:00">03:00 PM</option>
                                                <option value="16:00">04:00 PM</option>
                                                <option value="17:00">05:00 PM</option>
                                                <option value="18:00">06:00 PM</option>
                                                <option value="19:00">07:00 PM</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Equipo/Espacio</label>
                                        <select id="res-equipment" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-blue-500 outline-none">
                                            <option value="">Seleccionar equipo...</option>
                                            <option value="impresora-3d-1">üñ®Ô∏è Impresora 3D #1 (Ender 3)</option>
                                            <option value="impresora-3d-2">üñ®Ô∏è Impresora 3D #2 (Prusa)</option>
                                            <option value="cnc-router">‚öôÔ∏è CNC Router</option>
                                            <option value="laser-cutter">‚úÇÔ∏è Cortadora L√°ser</option>
                                            <option value="soldadura">üî• Estaci√≥n de Soldadura</option>
                                            <option value="osciloscopio">üìä Osciloscopio</option>
                                            <option value="fuente-poder">‚ö° Fuente de Poder Variable</option>
                                            <option value="multimetro-pro">üìè Mult√≠metro Profesional</option>
                                            <option value="dremel">üîß Dremel / Rotativa</option>
                                            <option value="mesa-trabajo-1">ü™ë Mesa de Trabajo #1</option>
                                            <option value="mesa-trabajo-2">ü™ë Mesa de Trabajo #2</option>
                                            <option value="area-pruebas">ü§ñ √Årea de Pruebas Robot</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Prop√≥sito</label>
                                        <textarea id="res-purpose" rows="2" required placeholder="Describe brevemente para qu√© usar√°s el equipo..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-blue-500 outline-none resize-none"></textarea>
                                    </div>
                                    <button type="submit" onclick="Reservations.create(event)" class="w-full py-3 bg-blue-600 text-white rounded-xl font-bold text-sm hover:bg-blue-700 transition flex items-center justify-center gap-2">
                                        <i data-lucide="calendar-plus" class="w-4 h-4"></i>
                                        Reservar
                                    </button>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Reservas del d√≠a seleccionado -->
                        <div class="mt-8 bg-white rounded-2xl shadow-lg p-6">
                            <h3 class="font-bold text-lg text-tec-dark mb-4 flex items-center gap-2">
                                <i data-lucide="clock" class="w-5 h-5 text-blue-500"></i>
                                Reservas de Hoy
                            </h3>
                            <div id="today-reservations" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <p class="col-span-full text-slate-400 text-sm text-center py-8">No hay reservas para hoy</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contenido del Tab: Mis Reservas -->
                    <div id="tab-my-reservations" class="reservation-tab-content hidden">
                        <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                            <div class="p-6 border-b border-slate-100">
                                <h3 class="font-bold text-lg text-tec-dark flex items-center gap-2">
                                    <i data-lucide="bookmark" class="w-5 h-5 text-blue-500"></i>
                                    Mis Reservaciones
                                </h3>
                            </div>
                            <div id="my-reservations-list" class="divide-y divide-slate-100">
                                <p class="text-slate-400 text-sm text-center py-12">Cargando tus reservaciones...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contenido del Tab: Equipos -->
                    <div id="tab-equipment" class="reservation-tab-content hidden">
                        <div class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="equipment-grid">
                            <!-- Se llena por JS -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==============================
             VISTA: INVENTARIO
             ============================== -->
        <section id="view-inventory" class="view-section hidden min-h-screen">
            <!-- Hero -->
            <div class="relative bg-gradient-to-br from-green-600 via-green-700 to-emerald-800 py-20 overflow-hidden">
                <div class="absolute inset-0">
                    <div class="absolute top-0 right-0 w-96 h-96 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"></div>
                    <div class="absolute bottom-0 left-0 w-64 h-64 bg-green-400/20 rounded-full translate-y-1/2 -translate-x-1/2 blur-2xl"></div>
                </div>
                <div class="container mx-auto px-6 relative z-10">
                    <div class="max-w-4xl mx-auto text-center">
                        <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur px-4 py-2 rounded-full mb-6">
                            <i data-lucide="package" class="w-4 h-4 text-green-200"></i>
                            <span class="text-xs font-bold text-white uppercase tracking-wider">Control de Inventario</span>
                        </div>
                        <h1 class="text-4xl md:text-5xl font-black text-white mb-4">Inventario del Club</h1>
                        <p class="text-green-100 text-lg max-w-2xl mx-auto">Consulta y gestiona componentes electr√≥nicos, materiales y herramientas disponibles</p>
                    </div>
                </div>
            </div>

            <div class="bg-slate-50 py-12">
                <div class="container mx-auto px-6">
                    <!-- Estad√≠sticas r√°pidas -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                        <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-100">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="package" class="w-5 h-5 text-green-600"></i>
                                </div>
                                <div>
                                    <p class="text-2xl font-black text-tec-dark" id="inv-total-items">0</p>
                                    <p class="text-xs text-slate-400">Total Items</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-100">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="cpu" class="w-5 h-5 text-blue-600"></i>
                                </div>
                                <div>
                                    <p class="text-2xl font-black text-tec-dark" id="inv-electronics">0</p>
                                    <p class="text-xs text-slate-400">Electr√≥nicos</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-100">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="alert-triangle" class="w-5 h-5 text-orange-600"></i>
                                </div>
                                <div>
                                    <p class="text-2xl font-black text-tec-dark" id="inv-low-stock">0</p>
                                    <p class="text-xs text-slate-400">Stock Bajo</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-100">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="tags" class="w-5 h-5 text-purple-600"></i>
                                </div>
                                <div>
                                    <p class="text-2xl font-black text-tec-dark" id="inv-categories">0</p>
                                    <p class="text-xs text-slate-400">Categor√≠as</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Barra de b√∫squeda y filtros -->
                    <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
                        <div class="flex flex-col lg:flex-row gap-4">
                            <div class="flex-1 relative">
                                <input type="text" id="inv-search" placeholder="Buscar componentes, materiales..." class="w-full pl-12 pr-4 py-3 border border-slate-200 rounded-xl text-sm focus:border-green-500 outline-none" onkeyup="Inventory.search(this.value)">
                                <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="Inventory.filter('all')" class="inv-filter active px-4 py-2 rounded-lg text-xs font-bold transition-all" data-filter="all">Todos</button>
                                <button onclick="Inventory.filter('electronico')" class="inv-filter px-4 py-2 rounded-lg text-xs font-bold transition-all" data-filter="electronico">Electr√≥nicos</button>
                                <button onclick="Inventory.filter('mecanico')" class="inv-filter px-4 py-2 rounded-lg text-xs font-bold transition-all" data-filter="mecanico">Mec√°nicos</button>
                                <button onclick="Inventory.filter('herramienta')" class="inv-filter px-4 py-2 rounded-lg text-xs font-bold transition-all" data-filter="herramienta">Herramientas</button>
                                <button onclick="Inventory.filter('material')" class="inv-filter px-4 py-2 rounded-lg text-xs font-bold transition-all" data-filter="material">Materiales</button>
                                <button onclick="Inventory.filter('consumible')" class="inv-filter px-4 py-2 rounded-lg text-xs font-bold transition-all" data-filter="consumible">Consumibles</button>
                            </div>
                        </div>
                        
                        <!-- Bot√≥n agregar (solo admin) -->
                        <div id="inv-admin-btn" class="hidden mt-4 pt-4 border-t border-slate-100">
                            <button onclick="Modal.open('add-inventory')" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-bold hover:bg-green-700 transition flex items-center gap-2">
                                <i data-lucide="plus" class="w-4 h-4"></i> Agregar Item
                            </button>
                        </div>
                    </div>
                    
                    <!-- Tabla de inventario -->
                    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-slate-50 border-b border-slate-200">
                                    <tr>
                                        <th class="text-left px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Item</th>
                                        <th class="text-left px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Categor√≠a</th>
                                        <th class="text-center px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Stock</th>
                                        <th class="text-left px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Ubicaci√≥n</th>
                                        <th class="text-center px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Estado</th>
                                        <th class="text-right px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="inventory-table" class="divide-y divide-slate-100">
                                    <tr><td colspan="6" class="px-6 py-12 text-center text-slate-400">Cargando inventario...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==============================
             VISTA: WIKI T√âCNICA
             ============================== -->
        <section id="view-wiki" class="view-section hidden min-h-screen">
            <!-- Hero -->
            <div class="relative bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 py-20 overflow-hidden">
                <div class="absolute inset-0">
                    <div class="absolute top-0 right-0 w-96 h-96 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"></div>
                    <div class="absolute bottom-0 left-0 w-64 h-64 bg-purple-400/20 rounded-full translate-y-1/2 -translate-x-1/2 blur-2xl"></div>
                </div>
                <div class="container mx-auto px-6 relative z-10">
                    <div class="max-w-4xl mx-auto text-center">
                        <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur px-4 py-2 rounded-full mb-6">
                            <i data-lucide="book-open" class="w-4 h-4 text-purple-200"></i>
                            <span class="text-xs font-bold text-white uppercase tracking-wider">Base de Conocimiento</span>
                        </div>
                        <h1 class="text-4xl md:text-5xl font-black text-white mb-4">Wiki T√©cnica CRAI</h1>
                        <p class="text-purple-100 text-lg max-w-2xl mx-auto">Tutoriales, gu√≠as, documentaci√≥n y conocimiento t√©cnico compartido por el club</p>
                        
                        <!-- Buscador -->
                        <div class="max-w-xl mx-auto mt-8">
                            <div class="relative">
                                <input type="text" id="wiki-search" placeholder="Buscar en la wiki..." class="w-full pl-12 pr-4 py-4 bg-white/10 backdrop-blur border border-white/20 rounded-xl text-white placeholder-purple-200 focus:outline-none focus:ring-2 focus:ring-white/50" onkeyup="Wiki.search(this.value)">
                                <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-purple-200"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-slate-50 py-12">
                <div class="container mx-auto px-6">
                    <!-- Categor√≠as de la Wiki -->
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                        <button onclick="Wiki.filterCategory('arduino')" class="wiki-category-card group bg-white rounded-2xl p-6 shadow-sm hover:shadow-lg transition-all text-left border-2 border-transparent hover:border-blue-500">
                            <div class="w-14 h-14 bg-blue-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                <i data-lucide="cpu" class="w-7 h-7 text-blue-600"></i>
                            </div>
                            <h3 class="font-bold text-tec-dark mb-1">Arduino & Microcontroladores</h3>
                            <p class="text-xs text-slate-400">Programaci√≥n, sensores, actuadores</p>
                            <span class="inline-block mt-3 text-[10px] font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded-full" id="wiki-count-arduino">0 art√≠culos</span>
                        </button>
                        
                        <button onclick="Wiki.filterCategory('electronica')" class="wiki-category-card group bg-white rounded-2xl p-6 shadow-sm hover:shadow-lg transition-all text-left border-2 border-transparent hover:border-green-500">
                            <div class="w-14 h-14 bg-green-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                <i data-lucide="zap" class="w-7 h-7 text-green-600"></i>
                            </div>
                            <h3 class="font-bold text-tec-dark mb-1">Electr√≥nica</h3>
                            <p class="text-xs text-slate-400">Circuitos, PCB, componentes</p>
                            <span class="inline-block mt-3 text-[10px] font-bold text-green-600 bg-green-50 px-2 py-1 rounded-full" id="wiki-count-electronica">0 art√≠culos</span>
                        </button>
                        
                        <button onclick="Wiki.filterCategory('mecanica')" class="wiki-category-card group bg-white rounded-2xl p-6 shadow-sm hover:shadow-lg transition-all text-left border-2 border-transparent hover:border-orange-500">
                            <div class="w-14 h-14 bg-orange-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                <i data-lucide="cog" class="w-7 h-7 text-orange-600"></i>
                            </div>
                            <h3 class="font-bold text-tec-dark mb-1">Mec√°nica & CAD</h3>
                            <p class="text-xs text-slate-400">Dise√±o 3D, manufactura, materiales</p>
                            <span class="inline-block mt-3 text-[10px] font-bold text-orange-600 bg-orange-50 px-2 py-1 rounded-full" id="wiki-count-mecanica">0 art√≠culos</span>
                        </button>
                        
                        <button onclick="Wiki.filterCategory('programacion')" class="wiki-category-card group bg-white rounded-2xl p-6 shadow-sm hover:shadow-lg transition-all text-left border-2 border-transparent hover:border-purple-500">
                            <div class="w-14 h-14 bg-purple-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                <i data-lucide="code" class="w-7 h-7 text-purple-600"></i>
                            </div>
                            <h3 class="font-bold text-tec-dark mb-1">Programaci√≥n & IA</h3>
                            <p class="text-xs text-slate-400">Python, ROS, visi√≥n artificial</p>
                            <span class="inline-block mt-3 text-[10px] font-bold text-purple-600 bg-purple-50 px-2 py-1 rounded-full" id="wiki-count-programacion">0 art√≠culos</span>
                        </button>
                    </div>
                    
                    <!-- Filtro activo y bot√≥n crear -->
                    <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-slate-500">Mostrando:</span>
                            <span id="wiki-active-filter" class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-bold">Todos los art√≠culos</span>
                            <button onclick="Wiki.filterCategory('all')" class="text-xs text-slate-400 hover:text-slate-600 underline hidden" id="wiki-clear-filter">Limpiar filtro</button>
                        </div>
                        <button onclick="Modal.open('add-wiki')" id="wiki-add-btn" class="hidden px-4 py-2 bg-purple-600 text-white rounded-lg text-sm font-bold hover:bg-purple-700 transition flex items-center gap-2">
                            <i data-lucide="plus" class="w-4 h-4"></i> Crear Art√≠culo
                        </button>
                    </div>
                    
                    <!-- Grid de art√≠culos -->
                    <div id="wiki-articles" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="col-span-full text-center py-16">
                            <i data-lucide="book-open" class="w-16 h-16 text-slate-300 mx-auto mb-4"></i>
                            <p class="text-slate-400">Cargando art√≠culos...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==============================
             VISTA: COMPETENCIAS
             ============================== -->
        <section id="view-competitions" class="view-section hidden min-h-screen">
            <!-- Hero -->
            <div class="relative bg-gradient-to-br from-orange-500 via-orange-600 to-red-600 py-20 overflow-hidden">
                <div class="absolute inset-0">
                    <div class="absolute top-0 right-0 w-96 h-96 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"></div>
                    <div class="absolute bottom-0 left-0 w-64 h-64 bg-yellow-400/20 rounded-full translate-y-1/2 -translate-x-1/2 blur-2xl"></div>
                </div>
                <div class="container mx-auto px-6 relative z-10">
                    <div class="max-w-4xl mx-auto text-center">
                        <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur px-4 py-2 rounded-full mb-6">
                            <i data-lucide="trophy" class="w-4 h-4 text-yellow-200"></i>
                            <span class="text-xs font-bold text-white uppercase tracking-wider">Eventos & Torneos</span>
                        </div>
                        <h1 class="text-4xl md:text-5xl font-black text-white mb-4">Competencias de Rob√≥tica</h1>
                        <p class="text-orange-100 text-lg max-w-2xl mx-auto">Calendario de eventos, inscripciones y registro de participaciones del club</p>
                        
                        <!-- Stats r√°pidas -->
                        <div class="flex flex-wrap justify-center gap-8 mt-10">
                            <div class="text-center">
                                <p class="text-4xl font-black text-white" id="comp-upcoming">0</p>
                                <p class="text-xs text-orange-200 uppercase tracking-wider">Pr√≥ximas</p>
                            </div>
                            <div class="h-12 w-px bg-white/20 hidden md:block"></div>
                            <div class="text-center">
                                <p class="text-4xl font-black text-tec-gold" id="comp-registered">0</p>
                                <p class="text-xs text-orange-200 uppercase tracking-wider">Confirmados</p>
                            </div>
                            <div class="h-12 w-px bg-white/20 hidden md:block"></div>
                            <div class="text-center">
                                <p class="text-4xl font-black text-yellow-300" id="comp-pending">0</p>
                                <p class="text-xs text-orange-200 uppercase tracking-wider">Pendientes</p>
                            </div>
                            <div class="h-12 w-px bg-white/20 hidden md:block"></div>
                            <div class="text-center">
                                <p class="text-4xl font-black text-white" id="comp-total">0</p>
                                <p class="text-xs text-orange-200 uppercase tracking-wider">Total Eventos</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-slate-50 py-12">
                <div class="container mx-auto px-6">
                    <!-- Tabs -->
                    <div class="flex flex-wrap gap-2 justify-center mb-8">
                        <button onclick="Competitions.setTab('upcoming')" class="comp-tab active px-6 py-3 rounded-xl text-sm font-bold transition-all flex items-center gap-2" data-tab="upcoming">
                            <i data-lucide="calendar" class="w-4 h-4"></i> Pr√≥ximos Eventos
                        </button>
                        <button onclick="Competitions.setTab('past')" class="comp-tab px-6 py-3 rounded-xl text-sm font-bold transition-all flex items-center gap-2" data-tab="past">
                            <i data-lucide="history" class="w-4 h-4"></i> Historial
                        </button>
                        <button onclick="Competitions.setTab('my-registrations')" class="comp-tab px-6 py-3 rounded-xl text-sm font-bold transition-all flex items-center gap-2" data-tab="my-registrations">
                            <i data-lucide="user-check" class="w-4 h-4"></i> Mis Inscripciones
                        </button>
                    </div>
                    
                    <!-- Bot√≥n agregar competencia (admin) -->
                    <div id="comp-admin-btn" class="hidden mb-6 text-center">
                        <button onclick="Modal.open('add-competition')" class="px-6 py-3 bg-orange-600 text-white rounded-xl font-bold text-sm hover:bg-orange-700 transition flex items-center gap-2 mx-auto">
                            <i data-lucide="plus" class="w-4 h-4"></i> Agregar Competencia
                        </button>
                    </div>

                    <!-- Contenido: Pr√≥ximos Eventos -->
                    <div id="tab-upcoming" class="comp-tab-content">
                        <div id="upcoming-competitions" class="space-y-6">
                            <div class="text-center py-16">
                                <i data-lucide="trophy" class="w-16 h-16 text-slate-300 mx-auto mb-4"></i>
                                <p class="text-slate-400">Cargando competencias...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contenido: Historial -->
                    <div id="tab-past" class="comp-tab-content hidden">
                        <div id="past-competitions" class="space-y-4">
                            <p class="text-slate-400 text-center py-12">Cargando historial...</p>
                        </div>
                    </div>
                    
                    <!-- Contenido: Mis Inscripciones -->
                    <div id="tab-my-registrations" class="comp-tab-content hidden">
                        <div id="my-competition-registrations" class="space-y-4">
                            <p class="text-slate-400 text-center py-12">Inicia sesi√≥n para ver tus inscripciones</p>
                        </div>
                    </div>
                    
                </div>
            </div>
        </section>

        <!-- ==============================
             VISTA: GESTOR DE TAREAS (KANBAN)
             ============================== -->
        <section id="view-tasks" class="view-section hidden min-h-screen">
            <!-- Hero -->
            <div class="relative bg-gradient-to-br from-indigo-600 via-indigo-700 to-purple-800 py-16 overflow-hidden">
                <div class="absolute inset-0">
                    <div class="absolute top-0 right-0 w-96 h-96 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"></div>
                    <div class="absolute bottom-0 left-0 w-64 h-64 bg-indigo-400/20 rounded-full translate-y-1/2 -translate-x-1/2 blur-2xl"></div>
                </div>
                <div class="container mx-auto px-6 relative z-10">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                        <div>
                            <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur px-4 py-2 rounded-full mb-4">
                                <i data-lucide="kanban" class="w-4 h-4 text-indigo-200"></i>
                                <span class="text-xs font-bold text-white uppercase tracking-wider">Gesti√≥n de Proyectos</span>
                            </div>
                            <h1 class="text-3xl md:text-4xl font-black text-white mb-2">Tablero de Tareas</h1>
                            <p class="text-indigo-100 text-sm max-w-xl">Organiza, asigna y da seguimiento a todas las tareas del equipo en tiempo real</p>
                        </div>
                        <div class="flex gap-3">
                            <select id="task-project-filter" onchange="Tasks.filterByProject(this.value)" class="bg-white/10 backdrop-blur border border-white/20 text-white rounded-xl px-4 py-2.5 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-white/50">
                                <option value="all" class="text-slate-800">Todos los proyectos</option>
                            </select>
                            <button onclick="Modal.open('add-task')" class="px-5 py-2.5 bg-white text-indigo-700 rounded-xl font-bold text-sm hover:bg-indigo-50 transition flex items-center gap-2 shadow-lg">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                Nueva Tarea
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tablero Kanban -->
            <div class="bg-slate-100 py-8 min-h-[calc(100vh-200px)]">
                <div class="container mx-auto px-4">
                    <!-- Estad√≠sticas r√°pidas -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-white rounded-xl p-4 border border-slate-200 shadow-sm">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="list-todo" class="w-5 h-5 text-slate-600"></i>
                                </div>
                                <div>
                                    <p class="text-2xl font-black text-slate-800" id="stat-todo">0</p>
                                    <p class="text-[10px] text-slate-500 uppercase font-bold">Por Hacer</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-4 border border-slate-200 shadow-sm">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="loader" class="w-5 h-5 text-blue-600"></i>
                                </div>
                                <div>
                                    <p class="text-2xl font-black text-slate-800" id="stat-progress">0</p>
                                    <p class="text-[10px] text-slate-500 uppercase font-bold">En Progreso</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-4 border border-slate-200 shadow-sm">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="eye" class="w-5 h-5 text-yellow-600"></i>
                                </div>
                                <div>
                                    <p class="text-2xl font-black text-slate-800" id="stat-review">0</p>
                                    <p class="text-[10px] text-slate-500 uppercase font-bold">En Revisi√≥n</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-4 border border-slate-200 shadow-sm">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="check-circle" class="w-5 h-5 text-green-600"></i>
                                </div>
                                <div>
                                    <p class="text-2xl font-black text-slate-800" id="stat-done">0</p>
                                    <p class="text-[10px] text-slate-500 uppercase font-bold">Completadas</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Filtro por √Årea -->
                    <div class="bg-white rounded-xl p-4 mb-6 border border-slate-200 shadow-sm">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                            <div class="flex items-center gap-2">
                                <i data-lucide="filter" class="w-5 h-5 text-indigo-600"></i>
                                <span class="font-bold text-slate-700 text-sm">Filtrar por √Årea:</span>
                            </div>
                            <div class="flex flex-wrap gap-2" id="task-area-filters">
                                <button onclick="Tasks.filterByArea('all')" class="task-area-btn px-3 py-1.5 rounded-lg text-xs font-bold transition bg-indigo-600 text-white" data-area="all">
                                    Todas
                                </button>
                                <button onclick="Tasks.filterByArea('gestion')" class="task-area-btn px-3 py-1.5 rounded-lg text-xs font-bold transition bg-slate-100 text-slate-600 hover:bg-purple-100 hover:text-purple-700" data-area="gestion">
                                    <i data-lucide="briefcase" class="w-3 h-3 inline mr-1"></i>Gesti√≥n
                                </button>
                                <button onclick="Tasks.filterByArea('telecom')" class="task-area-btn px-3 py-1.5 rounded-lg text-xs font-bold transition bg-slate-100 text-slate-600 hover:bg-blue-100 hover:text-blue-700" data-area="telecom">
                                    <i data-lucide="wifi" class="w-3 h-3 inline mr-1"></i>Telecom
                                </button>
                                <button onclick="Tasks.filterByArea('software')" class="task-area-btn px-3 py-1.5 rounded-lg text-xs font-bold transition bg-slate-100 text-slate-600 hover:bg-green-100 hover:text-green-700" data-area="software">
                                    <i data-lucide="code" class="w-3 h-3 inline mr-1"></i>Software
                                </button>
                                <button onclick="Tasks.filterByArea('electronica')" class="task-area-btn px-3 py-1.5 rounded-lg text-xs font-bold transition bg-slate-100 text-slate-600 hover:bg-orange-100 hover:text-orange-700" data-area="electronica">
                                    <i data-lucide="cpu" class="w-3 h-3 inline mr-1"></i>Electr√≥nica
                                </button>
                                <button onclick="Tasks.filterByArea('mecanico')" class="task-area-btn px-3 py-1.5 rounded-lg text-xs font-bold transition bg-slate-100 text-slate-600 hover:bg-red-100 hover:text-red-700" data-area="mecanico">
                                    <i data-lucide="cog" class="w-3 h-3 inline mr-1"></i>Mec√°nico
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Columnas Kanban -->
                    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 pb-20">
                        <!-- Columna: Por Hacer -->
                        <div class="bg-slate-200/50 rounded-2xl p-4 flex flex-col">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-slate-400 rounded-full"></div>
                                    <h3 class="font-bold text-slate-700 text-sm">POR HACER</h3>
                                    <span class="text-xs bg-slate-300 text-slate-600 px-2 py-0.5 rounded-full font-bold" id="count-todo">0</span>
                                </div>
                                <button onclick="Modal.open('add-task'); document.getElementById('task-status').value='todo'" class="text-slate-400 hover:text-slate-600 transition">
                                    <i data-lucide="plus" class="w-5 h-5"></i>
                                </button>
                            </div>
                            <div id="column-todo" class="space-y-3 min-h-[150px] max-h-[400px] overflow-y-auto flex-1" ondragover="Tasks.allowDrop(event)" ondrop="Tasks.drop(event, 'todo')">
                                <div class="empty-state text-center py-8 text-slate-300">
                                    <i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                                    <p class="text-[10px]">Sin tareas</p>
                                </div>
                            </div>
                        </div>

                        <!-- Columna: En Progreso -->
                        <div class="bg-blue-50 rounded-2xl p-4 flex flex-col">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse"></div>
                                    <h3 class="font-bold text-blue-700 text-sm">EN PROGRESO</h3>
                                    <span class="text-xs bg-blue-200 text-blue-700 px-2 py-0.5 rounded-full font-bold" id="count-progress">0</span>
                                </div>
                            </div>
                            <div id="column-progress" class="space-y-3 min-h-[150px] max-h-[400px] overflow-y-auto flex-1" ondragover="Tasks.allowDrop(event)" ondrop="Tasks.drop(event, 'progress')">
                                <div class="empty-state text-center py-8 text-slate-300">
                                    <i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                                    <p class="text-[10px]">Sin tareas</p>
                                </div>
                            </div>
                        </div>

                        <!-- Columna: En Revisi√≥n -->
                        <div class="bg-yellow-50 rounded-2xl p-4 flex flex-col">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                    <h3 class="font-bold text-yellow-700 text-sm">EN REVISI√ìN</h3>
                                    <span class="text-xs bg-yellow-200 text-yellow-700 px-2 py-0.5 rounded-full font-bold" id="count-review">0</span>
                                </div>
                            </div>
                            <div id="column-review" class="space-y-3 min-h-[150px] max-h-[400px] overflow-y-auto flex-1" ondragover="Tasks.allowDrop(event)" ondrop="Tasks.drop(event, 'review')">
                                <div class="empty-state text-center py-8 text-slate-300">
                                    <i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                                    <p class="text-[10px]">Sin tareas</p>
                                </div>
                            </div>
                        </div>

                        <!-- Columna: Completado -->
                        <div class="bg-green-50 rounded-2xl p-4 flex flex-col">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                    <h3 class="font-bold text-green-700 text-sm">COMPLETADO</h3>
                                    <span class="text-xs bg-green-200 text-green-700 px-2 py-0.5 rounded-full font-bold" id="count-done">0</span>
                                </div>
                                <button onclick="Tasks.clearCompleted()" class="text-xs text-green-600 hover:text-green-800 font-bold">
                                    Limpiar
                                </button>
                            </div>
                            <div id="column-done" class="space-y-3 min-h-[150px] max-h-[400px] overflow-y-auto flex-1" ondragover="Tasks.allowDrop(event)" ondrop="Tasks.drop(event, 'done')">
                                <div class="empty-state text-center py-8 text-slate-300">
                                    <i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                                    <p class="text-[10px]">Sin tareas</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==============================
             VISTA: CALENDARIO DE EVENTOS
             ============================== -->
        <section id="view-calendar" class="view-section hidden min-h-screen">
            <!-- Hero -->
            <div class="relative bg-gradient-to-br from-cyan-600 via-cyan-700 to-teal-800 py-16 overflow-hidden">
                <div class="absolute inset-0">
                    <div class="absolute top-0 right-0 w-96 h-96 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"></div>
                    <div class="absolute bottom-0 left-0 w-64 h-64 bg-cyan-400/20 rounded-full translate-y-1/2 -translate-x-1/2 blur-2xl"></div>
                </div>
                <div class="container mx-auto px-6 relative z-10">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                        <div>
                            <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur px-4 py-2 rounded-full mb-4">
                                <i data-lucide="calendar-days" class="w-4 h-4 text-cyan-200"></i>
                                <span class="text-xs font-bold text-white uppercase tracking-wider">Planificaci√≥n</span>
                            </div>
                            <h1 class="text-3xl md:text-4xl font-black text-white mb-2">Calendario del Club</h1>
                            <p class="text-cyan-100 text-sm max-w-xl">Visualiza reuniones, entrenamientos, competencias y eventos importantes</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="Calendar.prevMonth()" class="p-2.5 bg-white/10 backdrop-blur border border-white/20 text-white rounded-xl hover:bg-white/20 transition">
                                <i data-lucide="chevron-left" class="w-5 h-5"></i>
                            </button>
                            <button onclick="Calendar.today()" class="px-4 py-2.5 bg-white/10 backdrop-blur border border-white/20 text-white rounded-xl font-bold text-sm hover:bg-white/20 transition">
                                Hoy
                            </button>
                            <button onclick="Calendar.nextMonth()" class="p-2.5 bg-white/10 backdrop-blur border border-white/20 text-white rounded-xl hover:bg-white/20 transition">
                                <i data-lucide="chevron-right" class="w-5 h-5"></i>
                            </button>
                            <button onclick="Modal.open('add-calendar-event')" class="px-5 py-2.5 bg-white text-cyan-700 rounded-xl font-bold text-sm hover:bg-cyan-50 transition flex items-center gap-2 shadow-lg">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                Agregar Evento
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendario -->
            <div class="bg-slate-50 py-8">
                <div class="container mx-auto px-4">
                    <div class="grid lg:grid-cols-4 gap-6">
                        <!-- Calendario Principal -->
                        <div class="lg:col-span-3 bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
                            <!-- Header del Calendario -->
                            <div class="bg-gradient-to-r from-slate-800 to-slate-900 p-6 text-white">
                                <h2 id="events-calendar-month-year" class="text-2xl font-black">Enero 2026</h2>
                                <p class="text-slate-300 text-sm">Eventos y actividades del club</p>
                            </div>
                            
                            <!-- D√≠as de la semana -->
                            <div class="grid grid-cols-7 bg-slate-100 border-b border-slate-200">
                                <div class="p-3 text-center text-xs font-bold text-slate-500 uppercase">Dom</div>
                                <div class="p-3 text-center text-xs font-bold text-slate-500 uppercase">Lun</div>
                                <div class="p-3 text-center text-xs font-bold text-slate-500 uppercase">Mar</div>
                                <div class="p-3 text-center text-xs font-bold text-slate-500 uppercase">Mi√©</div>
                                <div class="p-3 text-center text-xs font-bold text-slate-500 uppercase">Jue</div>
                                <div class="p-3 text-center text-xs font-bold text-slate-500 uppercase">Vie</div>
                                <div class="p-3 text-center text-xs font-bold text-slate-500 uppercase">S√°b</div>
                            </div>
                            
                            <!-- Grid de d√≠as -->
                            <div id="events-calendar-grid" class="grid grid-cols-7">
                                <!-- Se genera din√°micamente -->
                            </div>
                        </div>

                        <!-- Panel Lateral: Eventos del d√≠a seleccionado -->
                        <div class="lg:col-span-1 space-y-4">
                            <!-- Leyenda -->
                            <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-5">
                                <h3 class="font-bold text-slate-700 text-sm mb-4 flex items-center gap-2">
                                    <i data-lucide="palette" class="w-4 h-4 text-cyan-600"></i>
                                    Tipos de Evento
                                </h3>
                                <div class="space-y-2 text-xs">
                                    <div class="flex items-center gap-2">
                                        <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                        <span class="text-slate-600">Competencia</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                        <span class="text-slate-600">Reuni√≥n</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                        <span class="text-slate-600">Taller/Capacitaci√≥n</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-3 h-3 bg-purple-500 rounded-full"></div>
                                        <span class="text-slate-600">Entrega/Deadline</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                        <span class="text-slate-600">Evento Social</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Eventos del d√≠a -->
                            <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-5">
                                <h3 class="font-bold text-slate-700 text-sm mb-4 flex items-center gap-2">
                                    <i data-lucide="calendar-check" class="w-4 h-4 text-cyan-600"></i>
                                    <span id="selected-day-title">Selecciona un d√≠a</span>
                                </h3>
                                <div id="selected-day-events" class="space-y-3 max-h-[400px] overflow-y-auto">
                                    <p class="text-slate-400 text-xs text-center py-6">Haz clic en un d√≠a para ver sus eventos</p>
                                </div>
                            </div>

                            <!-- Pr√≥ximos eventos -->
                            <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-5">
                                <h3 class="font-bold text-slate-700 text-sm mb-4 flex items-center gap-2">
                                    <i data-lucide="clock" class="w-4 h-4 text-cyan-600"></i>
                                    Pr√≥ximos 7 d√≠as
                                </h3>
                                <div id="upcoming-week-events" class="space-y-2 max-h-[250px] overflow-y-auto">
                                    <p class="text-slate-400 text-xs text-center py-4">Cargando eventos...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==============================
             VISTA: CENTRO DE COMUNICACIONES (CHAT + ANUNCIOS)
             ============================== -->
        <section id="view-communications" class="view-section hidden min-h-screen">
            <!-- Hero -->
            <div class="relative bg-gradient-to-br from-rose-600 via-pink-600 to-purple-700 py-16 overflow-hidden">
                <div class="absolute inset-0">
                    <div class="absolute top-0 right-0 w-96 h-96 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"></div>
                    <div class="absolute bottom-0 left-0 w-64 h-64 bg-pink-400/20 rounded-full translate-y-1/2 -translate-x-1/2 blur-2xl"></div>
                </div>
                <div class="container mx-auto px-6 relative z-10">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                        <div>
                            <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur px-4 py-2 rounded-full mb-4">
                                <i data-lucide="radio" class="w-4 h-4 text-pink-200"></i>
                                <span class="text-xs font-bold text-white uppercase tracking-wider">Comunicaciones</span>
                            </div>
                            <h1 class="text-3xl md:text-4xl font-black text-white mb-2">Centro de Comunicaciones</h1>
                            <p class="text-pink-100 text-sm max-w-xl">Chat en tiempo real, anuncios importantes y notificaciones del equipo</p>
                        </div>
                        <button id="btn-new-announcement" onclick="Modal.open('add-announcement')" class="hidden px-5 py-2.5 bg-white text-pink-700 rounded-xl font-bold text-sm hover:bg-pink-50 transition flex items-center gap-2 shadow-lg">
                            <i data-lucide="megaphone" class="w-4 h-4"></i>
                            Nuevo Anuncio
                        </button>
                    </div>
                </div>
            </div>

            <div class="bg-slate-100 py-8 min-h-[calc(100vh-200px)]">
                <div class="container mx-auto px-4">
                    <div class="grid lg:grid-cols-3 gap-6">
                        
                        <!-- Panel de Anuncios -->
                        <div class="lg:col-span-1 space-y-4">
                            <div class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
                                <div class="bg-gradient-to-r from-rose-500 to-pink-600 p-4 text-white">
                                    <h3 class="font-bold flex items-center gap-2">
                                        <i data-lucide="megaphone" class="w-5 h-5"></i>
                                        Anuncios Importantes
                                    </h3>
                                    <p class="text-pink-100 text-xs mt-1">Comunicados oficiales del club</p>
                                </div>
                                <div id="announcements-list" class="p-4 space-y-4 max-h-[500px] overflow-y-auto">
                                    <div class="text-center py-8">
                                        <div class="animate-spin w-6 h-6 border-2 border-pink-500 border-t-transparent rounded-full mx-auto mb-2"></div>
                                        <p class="text-xs text-slate-400">Cargando anuncios...</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Miembros Online -->
                            <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-5">
                                <h3 class="font-bold text-slate-700 text-sm mb-4 flex items-center gap-2">
                                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                    Miembros Conectados
                                </h3>
                                <div id="online-members" class="flex flex-wrap gap-2">
                                    <p class="text-slate-400 text-xs">Cargando...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Principal Expandido -->
                        <div class="lg:col-span-2">
                            <div class="bg-white rounded-2xl shadow-lg border border-slate-200 flex flex-col h-[600px]">
                                <!-- Header del Chat -->
                                <div class="bg-gradient-to-r from-slate-800 to-slate-900 p-5 text-white rounded-t-2xl flex items-center justify-between">
                                    <div class="flex items-center gap-4">
                                        <div class="w-12 h-12 bg-tec-gold rounded-xl flex items-center justify-center">
                                            <i data-lucide="message-circle" class="w-6 h-6"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-bold text-lg">Chat General del Laboratorio</h3>
                                            <p class="text-slate-400 text-xs flex items-center gap-2">
                                                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                                <span id="chat-online-count">0</span> miembros conectados
                                            </p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-[10px] text-green-400 bg-green-400/20 px-3 py-1 rounded-full font-mono font-bold animate-pulse flex items-center gap-1">
                                            <span class="w-1.5 h-1.5 bg-green-400 rounded-full"></span> LIVE
                                        </span>
                                    </div>
                                </div>
                                
                                <!-- Tabs del Chat -->
                                <div class="flex border-b border-slate-200 bg-slate-50">
                                    <button onclick="Communications.switchChatTab('general')" class="chat-tab-btn active flex-1 px-4 py-3 text-sm font-bold text-tec-blue border-b-2 border-tec-blue transition">
                                        <i data-lucide="users" class="w-4 h-4 inline mr-1"></i> General
                                    </button>
                                    <button onclick="Communications.switchChatTab('projects')" class="chat-tab-btn flex-1 px-4 py-3 text-sm font-bold text-slate-500 hover:text-slate-700 border-b-2 border-transparent transition">
                                        <i data-lucide="folder" class="w-4 h-4 inline mr-1"></i> Proyectos
                                    </button>
                                    <button onclick="Communications.switchChatTab('random')" class="chat-tab-btn flex-1 px-4 py-3 text-sm font-bold text-slate-500 hover:text-slate-700 border-b-2 border-transparent transition">
                                        <i data-lucide="coffee" class="w-4 h-4 inline mr-1"></i> Random
                                    </button>
                                </div>

                                <!-- √Årea de Mensajes -->
                                <div id="comm-chat-messages" class="flex-1 p-4 overflow-y-auto space-y-4 bg-slate-50/50 scroll-smooth">
                                    <div class="text-center text-slate-300 text-xs py-10 font-mono">Cargando mensajes...</div>
                                </div>

                                <!-- Input del Chat -->
                                <form id="comm-chat-form" class="p-4 bg-white border-t border-slate-200 flex gap-3" onsubmit="Communications.sendMessage(event)">
                                    <div class="relative flex-1">
                                        <input type="text" id="comm-chat-input" placeholder="Escribe un mensaje..." autocomplete="off" class="w-full bg-slate-100 border-0 rounded-xl pl-4 pr-12 py-3 text-sm focus:ring-2 focus:ring-tec-blue outline-none transition" disabled>
                                        <button type="button" onclick="Communications.toggleEmoji()" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition">
                                            <i data-lucide="smile" class="w-5 h-5"></i>
                                        </button>
                                    </div>
                                    <button type="button" onclick="Communications.attachFile()" class="bg-slate-100 text-slate-600 p-3 rounded-xl hover:bg-slate-200 transition">
                                        <i data-lucide="paperclip" class="w-5 h-5"></i>
                                    </button>
                                    <button type="submit" class="bg-gradient-to-r from-tec-blue to-indigo-600 text-white px-6 py-3 rounded-xl hover:shadow-lg transition font-bold text-sm flex items-center gap-2">
                                        <i data-lucide="send" class="w-4 h-4"></i>
                                        Enviar
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main> <!-- FIN DEL APP-ROOT / MAIN SPA -->

    <!-- MODAL: Subir Recurso -->
    <div id="modal-resource-upload" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-fade-in">
            <div class="bg-gradient-to-r from-tec-blue to-tec-dark p-6 text-white">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold flex items-center gap-2">
                        <i data-lucide="file-plus" class="w-6 h-6"></i>
                        Subir Recurso
                    </h3>
                    <button onclick="Modal.close('resource-upload')" class="text-white/70 hover:text-white">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <form class="p-6 space-y-4" onsubmit="Resources.upload(event)">
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">T√≠tulo del Recurso *</label>
                    <input id="resource-title" type="text" required placeholder="Ej: Manual de Arduino B√°sico" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-blue outline-none">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Descripci√≥n</label>
                    <textarea id="resource-desc" rows="2" placeholder="Breve descripci√≥n del contenido..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-blue outline-none resize-none"></textarea>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Categor√≠a *</label>
                    <select id="resource-category" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-blue outline-none">
                        <option value="">Selecciona una categor√≠a...</option>
                        <option value="documento">üìÑ Documento (PDF, Word, etc.)</option>
                        <option value="tutorial">üìö Tutorial / Gu√≠a</option>
                        <option value="codigo">üíª C√≥digo / Repositorio</option>
                        <option value="diseno">üîß Dise√±o CAD / 3D</option>
                        <option value="otro">üì¶ Otro</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">√Årea del Club *</label>
                    <select id="resource-area" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-blue outline-none">
                        <option value="">Selecciona un √°rea...</option>
                        <option value="gestion">üíº Gesti√≥n y Vinculaci√≥n</option>
                        <option value="telecom">üì° Telecomunicaciones y Redes</option>
                        <option value="software">üíª Software, Autonom√≠a e IA</option>
                        <option value="electronica">‚ö° Electr√≥nica y Control</option>
                        <option value="mecanico">‚öôÔ∏è Dise√±o Mec√°nico y Manufactura</option>
                        <option value="general">üéØ General / Todos</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Detalles adicionales</label>
                    <textarea id="resource-details" rows="3" placeholder="Instrucciones de uso, requisitos, informaci√≥n adicional..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-blue outline-none resize-none"></textarea>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">URL del Recurso *</label>
                    <input id="resource-url" type="url" required placeholder="https://drive.google.com/... o https://github.com/..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-blue outline-none">
                    <p class="text-[10px] text-slate-400 mt-1">Sube tu archivo a Google Drive, GitHub, Dropbox, etc. y pega el enlace aqu√≠.</p>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="Modal.close('resource-upload')" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50 transition">Cancelar</button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-tec-blue text-white rounded-xl font-bold text-sm hover:bg-tec-dark transition flex items-center justify-center gap-2">
                        <i data-lucide="upload" class="w-4 h-4"></i>
                        Publicar Recurso
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: Editar Recurso -->
    <div id="modal-edit-resource" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-fade-in max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-amber-500 to-orange-600 p-6 text-white sticky top-0">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold flex items-center gap-2">
                        <i data-lucide="edit" class="w-6 h-6"></i>
                        Editar Recurso
                    </h3>
                    <button onclick="Modal.close('edit-resource')" class="text-white/70 hover:text-white">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <form class="p-6 space-y-4" onsubmit="Resources.saveEdit(event)">
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">T√≠tulo del Recurso *</label>
                    <input id="edit-resource-title" type="text" required placeholder="Ej: Manual de Arduino B√°sico" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-amber-500 outline-none">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Descripci√≥n</label>
                    <textarea id="edit-resource-desc" rows="2" placeholder="Breve descripci√≥n del contenido..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-amber-500 outline-none resize-none"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Categor√≠a *</label>
                        <select id="edit-resource-category" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-amber-500 outline-none">
                            <option value="">Selecciona...</option>
                            <option value="documento">üìÑ Documento</option>
                            <option value="tutorial">üìö Tutorial</option>
                            <option value="codigo">üíª C√≥digo</option>
                            <option value="diseno">üîß Dise√±o CAD</option>
                            <option value="otro">üì¶ Otro</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">√Årea *</label>
                        <select id="edit-resource-area" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-amber-500 outline-none">
                            <option value="gestion">üíº Gesti√≥n</option>
                            <option value="telecom">üì° Telecom</option>
                            <option value="software">üíª Software</option>
                            <option value="electronica">‚ö° Electr√≥nica</option>
                            <option value="mecanico">‚öôÔ∏è Mec√°nico</option>
                            <option value="general">üéØ General</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Detalles adicionales</label>
                    <textarea id="edit-resource-details" rows="3" placeholder="Instrucciones de uso, requisitos, informaci√≥n adicional..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-amber-500 outline-none resize-none"></textarea>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">URL del Recurso *</label>
                    <input id="edit-resource-url" type="url" required placeholder="https://..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-amber-500 outline-none">
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="Resources.deleteResource()" class="px-4 py-3 bg-red-100 text-red-600 rounded-xl font-bold text-sm hover:bg-red-200 transition flex items-center justify-center gap-2">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                    <button type="button" onclick="Modal.close('edit-resource')" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50 transition">Cancelar</button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-amber-500 text-white rounded-xl font-bold text-sm hover:bg-amber-600 transition flex items-center justify-center gap-2">
                        <i data-lucide="save" class="w-4 h-4"></i>
                        Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: Agregar Item Inventario -->
    <div id="modal-add-inventory" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-fade-in max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-green-600 to-emerald-700 p-6 text-white sticky top-0">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold flex items-center gap-2">
                        <i data-lucide="package-plus" class="w-6 h-6"></i>
                        Agregar al Inventario
                    </h3>
                    <button onclick="Modal.close('add-inventory')" class="text-white/70 hover:text-white">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <form class="p-6 space-y-4" onsubmit="Inventory.add(event)">
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Nombre del Item *</label>
                    <input id="inv-name" type="text" required placeholder="Ej: Arduino Uno R3" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-green-500 outline-none">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Categor√≠a *</label>
                        <select id="inv-category" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-green-500 outline-none">
                            <option value="">Seleccionar...</option>
                            <option value="electronico">‚ö° Electr√≥nico</option>
                            <option value="mecanico">‚öôÔ∏è Mec√°nico</option>
                            <option value="herramienta">üîß Herramienta</option>
                            <option value="material">üì¶ Material</option>
                            <option value="consumible">üî© Consumible</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Cantidad *</label>
                        <input id="inv-quantity" type="number" min="0" required placeholder="0" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-green-500 outline-none">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Stock M√≠nimo</label>
                        <input id="inv-min-stock" type="number" min="0" value="5" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-green-500 outline-none">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Ubicaci√≥n</label>
                        <input id="inv-location" type="text" placeholder="Ej: Estante A-3" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-green-500 outline-none">
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Descripci√≥n</label>
                    <textarea id="inv-description" rows="2" placeholder="Especificaciones, notas adicionales..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-green-500 outline-none resize-none"></textarea>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="Modal.close('add-inventory')" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50 transition">Cancelar</button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-green-600 text-white rounded-xl font-bold text-sm hover:bg-green-700 transition flex items-center justify-center gap-2">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Agregar Item
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: Crear Art√≠culo Wiki -->
    <div id="modal-add-wiki" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden animate-fade-in max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-purple-600 to-indigo-700 p-6 text-white sticky top-0">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold flex items-center gap-2">
                        <i data-lucide="file-text" class="w-6 h-6"></i>
                        Crear Art√≠culo Wiki
                    </h3>
                    <button onclick="Modal.close('add-wiki')" class="text-white/70 hover:text-white">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <form class="p-6 space-y-4" onsubmit="Wiki.create(event)">
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">T√≠tulo del Art√≠culo *</label>
                    <input id="wiki-title" type="text" required placeholder="Ej: C√≥mo programar un servo con Arduino" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-purple-500 outline-none">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Categor√≠a *</label>
                        <select id="wiki-category" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-purple-500 outline-none">
                            <option value="">Seleccionar...</option>
                            <option value="arduino">üîå Arduino & Microcontroladores</option>
                            <option value="electronica">‚ö° Electr√≥nica</option>
                            <option value="mecanica">‚öôÔ∏è Mec√°nica & CAD</option>
                            <option value="programacion">üíª Programaci√≥n & IA</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Dificultad</label>
                        <select id="wiki-difficulty" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-purple-500 outline-none">
                            <option value="basico">üü¢ B√°sico</option>
                            <option value="intermedio">üü° Intermedio</option>
                            <option value="avanzado">üî¥ Avanzado</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Resumen *</label>
                    <textarea id="wiki-summary" rows="2" required placeholder="Breve descripci√≥n de lo que aprender√° el lector..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-purple-500 outline-none resize-none"></textarea>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Contenido (Markdown) *</label>
                    <textarea id="wiki-content" rows="10" required placeholder="# Introducci√≥n&#10;&#10;Escribe el contenido en formato Markdown...&#10;&#10;## Materiales necesarios&#10;- Item 1&#10;- Item 2&#10;&#10;## Procedimiento&#10;1. Paso 1&#10;2. Paso 2" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-purple-500 outline-none resize-none font-mono"></textarea>
                    <p class="text-[10px] text-slate-400 mt-1">Soporta formato Markdown: # t√≠tulos, **negrita**, *cursiva*, - listas, ```c√≥digo```</p>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Tags (separados por coma)</label>
                    <input id="wiki-tags" type="text" placeholder="arduino, servo, pwm, tutorial" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-purple-500 outline-none">
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="Modal.close('add-wiki')" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50 transition">Cancelar</button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-purple-600 text-white rounded-xl font-bold text-sm hover:bg-purple-700 transition flex items-center justify-center gap-2">
                        <i data-lucide="save" class="w-4 h-4"></i>
                        Publicar Art√≠culo
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: Agregar Competencia -->
    <div id="modal-add-competition" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-fade-in max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-orange-500 to-red-600 p-6 text-white sticky top-0">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold flex items-center gap-2">
                        <i data-lucide="trophy" class="w-6 h-6"></i>
                        Agregar Competencia
                    </h3>
                    <button onclick="Modal.close('add-competition')" class="text-white/70 hover:text-white">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <form class="p-6 space-y-4" onsubmit="Competitions.add(event)">
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Nombre del Evento *</label>
                    <input id="comp-name" type="text" required placeholder="Ej: RoboCup Junior M√©xico 2026" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-orange-500 outline-none">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Fecha Inicio *</label>
                        <input id="comp-date-start" type="date" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-orange-500 outline-none">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Fecha Fin</label>
                        <input id="comp-date-end" type="date" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-orange-500 outline-none">
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Ubicaci√≥n *</label>
                    <input id="comp-location" type="text" required placeholder="Ej: CDMX, M√©xico" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-orange-500 outline-none">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Categor√≠a</label>
                        <select id="comp-category" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-orange-500 outline-none">
                            <option value="combate">‚öîÔ∏è Combate</option>
                            <option value="sumo">ü§º Sumo</option>
                            <option value="seguidor">üõ§Ô∏è Seguidor de L√≠nea</option>
                            <option value="autonomo">ü§ñ Robot Aut√≥nomo</option>
                            <option value="dron">‚úàÔ∏è Drones</option>
                            <option value="innovacion">üí° Innovaci√≥n</option>
                            <option value="otro">üìã Otro</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Fecha L√≠mite Registro</label>
                        <input id="comp-deadline" type="date" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-orange-500 outline-none">
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Descripci√≥n</label>
                    <textarea id="comp-description" rows="3" placeholder="Detalles del evento, requisitos, premios..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-orange-500 outline-none resize-none"></textarea>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Enlace Oficial</label>
                    <input id="comp-link" type="url" placeholder="https://..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-orange-500 outline-none">
                </div>
                <!-- Selector de Proyecto Asociado -->
                <div class="bg-gradient-to-br from-tec-blue/5 to-indigo-50 rounded-xl p-4 border border-tec-blue/20">
                    <label class="text-xs font-bold text-tec-blue uppercase mb-2 flex items-center gap-2">
                        <i data-lucide="folder" class="w-4 h-4"></i>
                        Proyecto Asociado
                    </label>
                    <p class="text-[10px] text-slate-500 mb-3">Vincula un proyecto del club que participar√° en esta competencia</p>
                    <select id="comp-project" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-orange-500 outline-none">
                        <option value="">Sin proyecto asignado</option>
                    </select>
                    <div id="comp-project-preview" class="hidden mt-3 p-3 bg-gradient-to-r from-tec-blue to-indigo-600 rounded-xl text-white">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="cpu" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <p class="font-bold text-sm" id="comp-project-name"></p>
                                <p class="text-[10px] text-blue-100" id="comp-project-info"></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="Modal.close('add-competition')" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50 transition">Cancelar</button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-orange-600 text-white rounded-xl font-bold text-sm hover:bg-orange-700 transition flex items-center justify-center gap-2">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Crear Evento
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: Agregar Tarea -->
    <div id="modal-add-task" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-fade-in">
            <div class="bg-gradient-to-r from-indigo-600 to-purple-700 p-6 text-white">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold flex items-center gap-2">
                        <i data-lucide="plus-square" class="w-5 h-5"></i>
                        Nueva Tarea
                    </h3>
                    <button onclick="Modal.close('add-task')" class="text-white/70 hover:text-white">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <form onsubmit="Tasks.create(event)" class="p-6 space-y-4">
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">T√≠tulo de la Tarea *</label>
                    <input id="task-title" type="text" required placeholder="Ej: Dise√±ar chasis del robot" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-indigo-500 outline-none">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Descripci√≥n</label>
                    <textarea id="task-description" rows="3" placeholder="Detalles adicionales de la tarea..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-indigo-500 outline-none resize-none"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Proyecto</label>
                        <select id="task-project" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-indigo-500 outline-none">
                            <option value="">Sin proyecto</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">√Årea Responsable *</label>
                        <select id="task-area" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-indigo-500 outline-none">
                            <option value="">Seleccionar √°rea</option>
                            <option value="gestion">üìã Gesti√≥n y Vinculaci√≥n</option>
                            <option value="telecom">üì° Telecomunicaciones</option>
                            <option value="software">üíª Software e IA</option>
                            <option value="electronica">‚ö° Electr√≥nica y Control</option>
                            <option value="mecanico">‚öôÔ∏è Dise√±o Mec√°nico</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Prioridad</label>
                        <select id="task-priority" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-indigo-500 outline-none">
                            <option value="low">üü¢ Baja</option>
                            <option value="medium" selected>üü° Media</option>
                            <option value="high">üî¥ Alta</option>
                            <option value="urgent">üö® Urgente</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Asignar a (Persona)</label>
                        <select id="task-assignee" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-indigo-500 outline-none">
                            <option value="">Sin asignar</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Fecha L√≠mite</label>
                    <input id="task-due-date" type="date" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-indigo-500 outline-none">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Estado Inicial</label>
                    <select id="task-status" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-indigo-500 outline-none">
                        <option value="todo">üìã Por Hacer</option>
                        <option value="progress">üîÑ En Progreso</option>
                        <option value="review">üëÅÔ∏è En Revisi√≥n</option>
                        <option value="done">‚úÖ Completado</option>
                    </select>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="Modal.close('add-task')" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50 transition">Cancelar</button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-indigo-600 text-white rounded-xl font-bold text-sm hover:bg-indigo-700 transition flex items-center justify-center gap-2">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Crear Tarea
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: Ver Detalles de Tarea -->
    <div id="modal-task-details" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden animate-fade-in max-h-[90vh] overflow-y-auto">
            <div id="task-details-header" class="bg-gradient-to-r from-indigo-600 to-purple-700 p-6 text-white">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <div id="task-details-badges" class="flex flex-wrap gap-2 mb-3"></div>
                        <h3 id="task-details-title" class="text-xl font-bold"></h3>
                    </div>
                    <button onclick="Modal.close('task-details')" class="text-white/70 hover:text-white ml-4">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <div class="p-6 space-y-6">
                <!-- Descripci√≥n -->
                <div id="task-details-description-section">
                    <h4 class="text-xs font-bold text-slate-500 uppercase mb-2 flex items-center gap-2">
                        <i data-lucide="file-text" class="w-4 h-4"></i>
                        Descripci√≥n
                    </h4>
                    <p id="task-details-description" class="text-slate-700 bg-slate-50 rounded-xl p-4 text-sm"></p>
                </div>
                
                <!-- Info Grid -->
                <div class="grid grid-cols-2 gap-4">
                    <!-- Proyecto -->
                    <div id="task-details-project-section" class="bg-slate-50 rounded-xl p-4">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-2 flex items-center gap-2">
                            <i data-lucide="folder" class="w-4 h-4"></i>
                            Proyecto
                        </h4>
                        <p id="task-details-project" class="text-slate-700 font-medium"></p>
                    </div>
                    
                    <!-- √Årea -->
                    <div class="bg-slate-50 rounded-xl p-4">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-2 flex items-center gap-2">
                            <i data-lucide="layers" class="w-4 h-4"></i>
                            √Årea Responsable
                        </h4>
                        <p id="task-details-area" class="font-medium"></p>
                    </div>
                    
                    <!-- Asignado a -->
                    <div class="bg-slate-50 rounded-xl p-4">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-2 flex items-center gap-2">
                            <i data-lucide="user" class="w-4 h-4"></i>
                            Asignado a
                        </h4>
                        <p id="task-details-assignee" class="text-slate-700 font-medium"></p>
                    </div>
                    
                    <!-- Fecha l√≠mite -->
                    <div class="bg-slate-50 rounded-xl p-4">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-2 flex items-center gap-2">
                            <i data-lucide="calendar" class="w-4 h-4"></i>
                            Fecha L√≠mite
                        </h4>
                        <p id="task-details-due" class="font-medium"></p>
                    </div>
                </div>
                
                <!-- Estado actual -->
                <div class="bg-gradient-to-r from-slate-50 to-slate-100 rounded-xl p-4">
                    <h4 class="text-xs font-bold text-slate-500 uppercase mb-3 flex items-center gap-2">
                        <i data-lucide="activity" class="w-4 h-4"></i>
                        Estado Actual
                    </h4>
                    <div id="task-details-status" class="flex items-center gap-3"></div>
                </div>
                
                <!-- Acciones -->
                <div id="task-details-actions" class="flex gap-3 pt-4 border-t border-slate-200"></div>
            </div>
        </div>
    </div>

    <!-- MODAL: Editar Tarea -->
    <div id="modal-edit-task" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-fade-in max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-amber-500 to-orange-600 p-6 text-white">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold flex items-center gap-2">
                        <i data-lucide="edit-3" class="w-5 h-5"></i>
                        Editar Tarea
                    </h3>
                    <button onclick="Modal.close('edit-task')" class="text-white/70 hover:text-white">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <form onsubmit="Tasks.update(event)" class="p-6 space-y-4">
                <input type="hidden" id="edit-task-id">
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">T√≠tulo de la Tarea *</label>
                    <input id="edit-task-title" type="text" required placeholder="Ej: Dise√±ar chasis del robot" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-amber-500 outline-none">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Descripci√≥n</label>
                    <textarea id="edit-task-description" rows="3" placeholder="Detalles adicionales de la tarea..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-amber-500 outline-none resize-none"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Proyecto</label>
                        <select id="edit-task-project" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-amber-500 outline-none">
                            <option value="">Sin proyecto</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">√Årea Responsable *</label>
                        <select id="edit-task-area" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-amber-500 outline-none">
                            <option value="">Seleccionar √°rea</option>
                            <option value="gestion">üìã Gesti√≥n y Vinculaci√≥n</option>
                            <option value="telecom">üì° Telecomunicaciones</option>
                            <option value="software">üíª Software e IA</option>
                            <option value="electronica">‚ö° Electr√≥nica y Control</option>
                            <option value="mecanico">‚öôÔ∏è Dise√±o Mec√°nico</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Prioridad</label>
                        <select id="edit-task-priority" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-amber-500 outline-none">
                            <option value="low">üü¢ Baja</option>
                            <option value="medium">üü° Media</option>
                            <option value="high">üî¥ Alta</option>
                            <option value="urgent">üö® Urgente</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Asignar a (Persona)</label>
                        <select id="edit-task-assignee" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-amber-500 outline-none">
                            <option value="">Sin asignar</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Fecha L√≠mite</label>
                    <input id="edit-task-due-date" type="date" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-amber-500 outline-none">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Estado</label>
                    <select id="edit-task-status" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-amber-500 outline-none">
                        <option value="todo">üìã Por Hacer</option>
                        <option value="progress">üîÑ En Progreso</option>
                        <option value="review">üëÅÔ∏è En Revisi√≥n</option>
                        <option value="done">‚úÖ Completado</option>
                    </select>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="Modal.close('edit-task')" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50 transition">Cancelar</button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-amber-600 text-white rounded-xl font-bold text-sm hover:bg-amber-700 transition flex items-center justify-center gap-2">
                        <i data-lucide="save" class="w-4 h-4"></i>
                        Guardar Cambios
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: Agregar Evento de Calendario -->
    <div id="modal-add-calendar-event" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-fade-in">
            <div class="bg-gradient-to-r from-cyan-600 to-teal-700 p-6 text-white">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold flex items-center gap-2">
                        <i data-lucide="calendar-plus" class="w-5 h-5"></i>
                        Nuevo Evento
                    </h3>
                    <button onclick="Modal.close('add-calendar-event')" class="text-white/70 hover:text-white">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <form onsubmit="Calendar.createEvent(event)" class="p-6 space-y-4">
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Nombre del Evento *</label>
                    <input id="cal-event-title" type="text" required placeholder="Ej: Reuni√≥n semanal de equipo" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-cyan-500 outline-none">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Fecha *</label>
                        <input id="cal-event-date" type="date" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-cyan-500 outline-none">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Hora</label>
                        <input id="cal-event-time" type="time" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-cyan-500 outline-none">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Tipo de Evento</label>
                        <select id="cal-event-type" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-cyan-500 outline-none">
                            <option value="meeting">üîµ Reuni√≥n</option>
                            <option value="competition">üî¥ Competencia</option>
                            <option value="workshop">üü¢ Taller/Capacitaci√≥n</option>
                            <option value="deadline">üü£ Entrega/Deadline</option>
                            <option value="social">üü° Evento Social</option>
                            <option value="proyecto">üü† Proyecto/Tarea</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Duraci√≥n</label>
                        <select id="cal-event-duration" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-cyan-500 outline-none">
                            <option value="30">30 minutos</option>
                            <option value="60" selected>1 hora</option>
                            <option value="90">1.5 horas</option>
                            <option value="120">2 horas</option>
                            <option value="180">3 horas</option>
                            <option value="allday">Todo el d√≠a</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Ubicaci√≥n</label>
                    <input id="cal-event-location" type="text" placeholder="Ej: Laboratorio CRAI, Sala de juntas..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-cyan-500 outline-none">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Descripci√≥n</label>
                    <textarea id="cal-event-description" rows="2" placeholder="Detalles del evento..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-cyan-500 outline-none resize-none"></textarea>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="Modal.close('add-calendar-event')" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50 transition">Cancelar</button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-cyan-600 text-white rounded-xl font-bold text-sm hover:bg-cyan-700 transition flex items-center justify-center gap-2">
                        <i data-lucide="calendar-plus" class="w-4 h-4"></i>
                        Crear Evento
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: Nuevo Anuncio -->
    <div id="modal-add-announcement" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-fade-in">
            <div class="bg-gradient-to-r from-rose-500 to-pink-600 p-6 text-white">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold flex items-center gap-2">
                        <i data-lucide="megaphone" class="w-5 h-5"></i>
                        Nuevo Anuncio
                    </h3>
                    <button onclick="Modal.close('add-announcement')" class="text-white/70 hover:text-white">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <form onsubmit="Communications.createAnnouncement(event)" class="p-6 space-y-4">
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">T√≠tulo del Anuncio *</label>
                    <input id="announcement-title" type="text" required placeholder="Ej: Reuni√≥n obligatoria este viernes" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-pink-500 outline-none">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Contenido *</label>
                    <textarea id="announcement-content" rows="4" required placeholder="Escribe el contenido del anuncio..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-pink-500 outline-none resize-none"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Prioridad</label>
                        <select id="announcement-priority" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-pink-500 outline-none">
                            <option value="normal">üì¢ Normal</option>
                            <option value="important">‚ö†Ô∏è Importante</option>
                            <option value="urgent">üö® Urgente</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Expira en</label>
                        <select id="announcement-expiry" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-pink-500 outline-none">
                            <option value="1">1 d√≠a</option>
                            <option value="3">3 d√≠as</option>
                            <option value="7" selected>1 semana</option>
                            <option value="14">2 semanas</option>
                            <option value="30">1 mes</option>
                            <option value="0">Nunca</option>
                        </select>
                    </div>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="Modal.close('add-announcement')" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50 transition">Cancelar</button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-gradient-to-r from-rose-500 to-pink-600 text-white rounded-xl font-bold text-sm hover:opacity-90 transition flex items-center justify-center gap-2">
                        <i data-lucide="send" class="w-4 h-4"></i>
                        Publicar Anuncio
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: Crear Evento P√∫blico -->
    <div id="modal-create-public-event" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden animate-fade-in max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-cyan-600 via-teal-500 to-emerald-600 p-6 text-white sticky top-0 z-10">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold flex items-center gap-2">
                        <i data-lucide="calendar-plus" class="w-6 h-6"></i>
                        Crear Evento P√∫blico
                    </h3>
                    <button onclick="Modal.close('create-public-event')" class="text-white/70 hover:text-white">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <p class="text-white/80 text-sm mt-2">Los eventos p√∫blicos aparecer√°n en la secci√≥n de eventos del sitio</p>
            </div>
            <form class="p-6 space-y-4" onsubmit="PublicEvents.create(event)">
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Nombre del Evento *</label>
                    <input id="pe-name" type="text" required placeholder="Ej: Torneo de Rob√≥tica CRAI 2025" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-gold outline-none">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Fecha del Evento *</label>
                        <input id="pe-date" type="date" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-gold outline-none">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Hora de Inicio *</label>
                        <input id="pe-time" type="time" required class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-gold outline-none">
                    </div>
                </div>
                
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Ubicaci√≥n *</label>
                    <input id="pe-location" type="text" required placeholder="Ej: Gimnasio TecNM Campus Mexicali" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-gold outline-none">
                </div>
                
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Descripci√≥n del Evento *</label>
                    <textarea id="pe-description" rows="3" required placeholder="Describe el evento, objetivos, qu√© incluye..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-gold outline-none resize-none"></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Categor√≠a</label>
                        <select id="pe-category" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-gold outline-none">
                            <option value="combate">‚öîÔ∏è Combate de Robots</option>
                            <option value="sumo">ü§º Sumo</option>
                            <option value="seguidor">üõ§Ô∏è Seguidor de L√≠nea</option>
                            <option value="minisumo">üéØ Mini Sumo</option>
                            <option value="autonomo">ü§ñ Robot Aut√≥nomo</option>
                            <option value="dron">‚úàÔ∏è Drones</option>
                            <option value="innovacion">üí° Innovaci√≥n</option>
                            <option value="taller">üîß Taller/Workshop</option>
                            <option value="hackathon">üíª Hackathon</option>
                            <option value="exhibicion">üé™ Exhibici√≥n</option>
                            <option value="otro">üìã Otro</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Fecha L√≠mite de Inscripci√≥n</label>
                        <input id="pe-deadline" type="date" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-gold outline-none">
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Tipo de Participaci√≥n</label>
                        <select id="pe-participation-type" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-gold outline-none">
                            <option value="both">üë• Equipos e Individuales</option>
                            <option value="team">üë• Solo Equipos</option>
                            <option value="individual">üë§ Solo Individuales</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">M√°x. Participantes (0 = ilimitado)</label>
                        <input id="pe-max-participants" type="number" min="0" value="0" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-gold outline-none">
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Costo de Inscripci√≥n</label>
                        <input id="pe-cost" type="text" placeholder="Gratis o $150 MXN" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-gold outline-none">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Link de Bases/Reglas</label>
                        <input id="pe-rules-link" type="url" placeholder="https://..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-gold outline-none">
                    </div>
                </div>
                
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">URL de Imagen (Banner)</label>
                    <input id="pe-image" type="url" placeholder="https://..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-gold outline-none">
                </div>
                
                <div class="flex items-center gap-3 p-3 bg-green-50 rounded-lg border border-green-200">
                    <input type="checkbox" id="pe-active" checked class="w-4 h-4 accent-green-500">
                    <label for="pe-active" class="text-sm text-green-700 font-medium">Publicar evento inmediatamente (visible al p√∫blico)</label>
                </div>
                
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="Modal.close('create-public-event')" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50 transition">Cancelar</button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-gradient-to-r from-cyan-600 to-teal-500 text-white rounded-xl font-bold text-sm hover:opacity-90 transition flex items-center justify-center gap-2">
                        <i data-lucide="rocket" class="w-4 h-4"></i>
                        Crear Evento
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: Registro a Evento P√∫blico -->
    <div id="modal-event-registration" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-xl overflow-hidden animate-fade-in max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-tec-blue via-blue-600 to-tec-dark p-6 text-white sticky top-0 z-10">
                <div class="flex justify-between items-center">
                    <div>
                        <span class="text-xs font-bold bg-white/20 px-2 py-1 rounded-full uppercase tracking-wider">Inscripci√≥n</span>
                        <h3 id="er-event-name" class="text-xl font-bold mt-2">Nombre del Evento</h3>
                    </div>
                    <button onclick="Modal.close('event-registration')" class="text-white/70 hover:text-white">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <form class="p-6 space-y-4" onsubmit="PublicEvents.register(event)">
                <input type="hidden" id="er-event-id">
                
                <!-- Tipo de participaci√≥n -->
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-2 block">Tipo de Participaci√≥n *</label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="relative cursor-pointer">
                            <input type="radio" name="er-type" value="team" class="peer sr-only" onchange="PublicEvents.toggleTeamFields(true)">
                            <div class="p-4 border-2 border-slate-200 rounded-xl text-center peer-checked:border-tec-blue peer-checked:bg-blue-50 transition">
                                <i data-lucide="users" class="w-8 h-8 mx-auto mb-2 text-slate-400 peer-checked:text-tec-blue"></i>
                                <p class="font-bold text-sm">Equipo</p>
                                <p class="text-xs text-slate-400">2+ integrantes</p>
                            </div>
                        </label>
                        <label class="relative cursor-pointer">
                            <input type="radio" name="er-type" value="individual" class="peer sr-only" checked onchange="PublicEvents.toggleTeamFields(false)">
                            <div class="p-4 border-2 border-slate-200 rounded-xl text-center peer-checked:border-tec-blue peer-checked:bg-blue-50 transition">
                                <i data-lucide="user" class="w-8 h-8 mx-auto mb-2 text-slate-400 peer-checked:text-tec-blue"></i>
                                <p class="font-bold text-sm">Individual</p>
                                <p class="text-xs text-slate-400">Participaci√≥n solo</p>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Campos de equipo (ocultos por defecto) -->
                <div id="er-team-fields" class="hidden space-y-4">
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Nombre del Equipo *</label>
                        <input id="er-team-name" type="text" placeholder="Ej: CRAI Robotics Team" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-blue outline-none">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Integrantes del Equipo *</label>
                        <textarea id="er-team-members" rows="3" placeholder="Nombre completo de cada integrante (uno por l√≠nea)&#10;Ej:&#10;Juan P√©rez Garc√≠a&#10;Mar√≠a L√≥pez Hern√°ndez" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-blue outline-none resize-none"></textarea>
                        <p class="text-xs text-slate-400 mt-1">Incluye a todos los integrantes, uno por l√≠nea</p>
                    </div>
                </div>
                
                <!-- Datos de contacto -->
                <div class="pt-2 border-t border-slate-100">
                    <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Datos de Contacto</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Nombre Completo *</label>
                            <input id="er-contact-name" type="text" required placeholder="Nombre del participante o capit√°n del equipo" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-blue outline-none">
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Email *</label>
                                <input id="er-email" type="email" required placeholder="correo@ejemplo.com" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-blue outline-none">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Tel√©fono *</label>
                                <input id="er-phone" type="tel" required placeholder="686 123 4567" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-blue outline-none">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Instituci√≥n -->
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Instituci√≥n / Escuela *</label>
                    <input id="er-institution" type="text" required placeholder="Ej: TecNM Campus Mexicali" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-blue outline-none">
                </div>
                
                <!-- Categor√≠a del robot (si aplica) -->
                <div id="er-robot-fields">
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Nombre del Robot</label>
                    <input id="er-robot-name" type="text" placeholder="Ej: Destructor 3000" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-blue outline-none">
                </div>
                
                <!-- Comentarios adicionales -->
                <div>
                    <label class="text-xs font-bold text-slate-600 uppercase mb-1 block">Comentarios Adicionales</label>
                    <textarea id="er-comments" rows="2" placeholder="Alg√∫n comentario o pregunta..." class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:border-tec-blue outline-none resize-none"></textarea>
                </div>
                
                <!-- Aceptar t√©rminos -->
                <div class="flex items-start gap-3 p-3 bg-slate-50 rounded-lg border border-slate-200">
                    <input type="checkbox" id="er-terms" required class="w-4 h-4 mt-0.5 accent-tec-blue">
                    <label for="er-terms" class="text-xs text-slate-600">
                        Acepto que mis datos sean utilizados para la organizaci√≥n del evento y comunicaci√≥n relacionada. 
                        El CRAI se compromete a no compartir esta informaci√≥n con terceros.
                    </label>
                </div>
                
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="Modal.close('event-registration')" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50 transition">Cancelar</button>
                    <button type="submit" class="flex-1 px-4 py-3 bg-gradient-to-r from-tec-blue to-tec-dark text-white rounded-xl font-bold text-sm hover:opacity-90 transition flex items-center justify-center gap-2">
                        <i data-lucide="check-circle" class="w-4 h-4"></i>
                        Completar Inscripci√≥n
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: Ver Inscripciones de Evento -->
    <div id="modal-view-registrations" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl overflow-hidden animate-fade-in max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-emerald-500 to-teal-600 p-6 text-white sticky top-0 z-10">
                <div class="flex justify-between items-center">
                    <div>
                        <span class="text-xs font-bold bg-white/20 px-2 py-1 rounded-full uppercase tracking-wider">Inscripciones</span>
                        <h3 id="vr-event-name" class="text-xl font-bold mt-2">Nombre del Evento</h3>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="PublicEvents.exportRegistrations()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-bold flex items-center gap-2 transition">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            Exportar CSV
                        </button>
                        <button onclick="Modal.close('view-registrations')" class="text-white/70 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                </div>
                <div class="flex gap-6 mt-4">
                    <div class="text-center">
                        <p class="text-3xl font-black" id="vr-total-count">0</p>
                        <p class="text-xs text-white/70">Total Inscritos</p>
                    </div>
                    <div class="text-center">
                        <p class="text-3xl font-black" id="vr-teams-count">0</p>
                        <p class="text-xs text-white/70">Equipos</p>
                    </div>
                    <div class="text-center">
                        <p class="text-3xl font-black" id="vr-individuals-count">0</p>
                        <p class="text-xs text-white/70">Individuales</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <input type="hidden" id="vr-event-id">
                
                <!-- Lista de inscripciones -->
                <div id="vr-registrations-list" class="space-y-3">
                    <!-- Las inscripciones se cargan din√°micamente -->
                </div>
                
                <!-- Estado vac√≠o -->
                <div id="vr-empty" class="hidden text-center py-12">
                    <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="inbox" class="w-10 h-10 text-slate-300"></i>
                    </div>
                    <p class="text-slate-400 font-bold">No hay inscripciones a√∫n</p>
                    <p class="text-slate-400 text-sm">Las inscripciones aparecer√°n aqu√≠ cuando los participantes se registren</p>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Gestionar Eventos P√∫blicos -->
    <div id="modal-manage-events" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-5xl overflow-hidden animate-fade-in max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-cyan-600 via-teal-500 to-emerald-600 p-6 text-white sticky top-0 z-10">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-xl font-bold flex items-center gap-2">
                            <i data-lucide="calendar-cog" class="w-6 h-6"></i>
                            Gestionar Eventos P√∫blicos
                        </h3>
                        <p class="text-white/80 text-sm mt-1">Administra los eventos y competencias del CRAI</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="Modal.open('create-public-event')" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-bold flex items-center gap-2 transition">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            Nuevo Evento
                        </button>
                        <button onclick="Modal.close('manage-events')" class="text-white/70 hover:text-white">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                </div>
                <div class="flex gap-6 mt-4">
                    <div class="text-center">
                        <p class="text-3xl font-black" id="me-total-events">0</p>
                        <p class="text-xs text-white/70">Total Eventos</p>
                    </div>
                    <div class="text-center">
                        <p class="text-3xl font-black" id="me-active-events">0</p>
                        <p class="text-xs text-white/70">Activos</p>
                    </div>
                    <div class="text-center">
                        <p class="text-3xl font-black" id="me-total-registrations">0</p>
                        <p class="text-xs text-white/70">Inscripciones</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <!-- Filtros -->
                <div class="flex flex-wrap gap-3 mb-6">
                    <button onclick="PublicEvents.filterManager('all')" class="me-filter active px-4 py-2 rounded-lg text-xs font-bold bg-cyan-600 text-white transition" data-filter="all">Todos</button>
                    <button onclick="PublicEvents.filterManager('active')" class="me-filter px-4 py-2 rounded-lg text-xs font-bold bg-slate-100 text-slate-600 hover:bg-green-100 hover:text-green-700 transition" data-filter="active">Activos</button>
                    <button onclick="PublicEvents.filterManager('upcoming')" class="me-filter px-4 py-2 rounded-lg text-xs font-bold bg-slate-100 text-slate-600 hover:bg-blue-100 hover:text-blue-700 transition" data-filter="upcoming">Pr√≥ximos</button>
                    <button onclick="PublicEvents.filterManager('past')" class="me-filter px-4 py-2 rounded-lg text-xs font-bold bg-slate-100 text-slate-600 hover:bg-slate-200 transition" data-filter="past">Pasados</button>
                    <button onclick="PublicEvents.filterManager('draft')" class="me-filter px-4 py-2 rounded-lg text-xs font-bold bg-slate-100 text-slate-600 hover:bg-yellow-100 hover:text-yellow-700 transition" data-filter="draft">Borradores</button>
                </div>
                
                <!-- Lista de eventos -->
                <div id="me-events-list" class="space-y-4">
                    <!-- Los eventos se cargan din√°micamente -->
                </div>
                
                <!-- Estado vac√≠o -->
                <div id="me-empty" class="hidden text-center py-12">
                    <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="calendar-x" class="w-10 h-10 text-slate-300"></i>
                    </div>
                    <p class="text-slate-400 font-bold">No hay eventos creados</p>
                    <p class="text-slate-400 text-sm mb-4">Crea tu primer evento p√∫blico para el CRAI</p>
                    <button onclick="Modal.open('create-public-event')" class="px-6 py-3 bg-cyan-600 text-white rounded-xl font-bold text-sm hover:bg-cyan-700 transition inline-flex items-center gap-2">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Crear Primer Evento
                    </button>
                </div>
                
                <!-- Loading -->
                <div id="me-loading" class="text-center py-12">
                    <i data-lucide="loader-2" class="w-8 h-8 animate-spin text-cyan-600 mx-auto"></i>
                    <p class="text-slate-400 font-bold mt-3">Cargando eventos...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Ver Art√≠culo Wiki -->
    <div id="modal-view-wiki" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl overflow-hidden animate-fade-in max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-purple-600 to-indigo-700 p-6 text-white sticky top-0 z-10">
                <div class="flex justify-between items-center">
                    <div>
                        <span id="view-wiki-category" class="text-xs font-bold bg-white/20 px-2 py-1 rounded-full uppercase tracking-wider">Categor√≠a</span>
                        <h3 id="view-wiki-title" class="text-2xl font-bold mt-2">T√≠tulo del art√≠culo</h3>
                    </div>
                    <button onclick="Modal.close('view-wiki')" class="text-white/70 hover:text-white">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="flex items-center gap-4 mb-6 text-sm text-slate-500 border-b border-slate-100 pb-4">
                    <span id="view-wiki-author" class="flex items-center gap-1"><i data-lucide="user" class="w-4 h-4"></i> Autor</span>
                    <span id="view-wiki-date" class="flex items-center gap-1"><i data-lucide="calendar" class="w-4 h-4"></i> Fecha</span>
                    <span id="view-wiki-difficulty" class="flex items-center gap-1"><i data-lucide="signal" class="w-4 h-4"></i> Dificultad</span>
                </div>
                <div id="view-wiki-content" class="prose prose-slate max-w-none">
                    <!-- Contenido renderizado -->
                </div>
                <div id="view-wiki-tags" class="mt-6 pt-4 border-t border-slate-100">
                    <!-- Tags -->
                </div>
            </div>
        </div>
    </div>

    <!-- ==============================
         NAVEGACI√ìN INFERIOR M√ìVIL
         ============================== -->
    <nav id="mobile-bottom-nav" class="mobile-bottom-nav fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 z-50 lg:hidden">
        <div class="flex items-center justify-around py-2">
            <button onclick="Router.to('landing')" class="flex flex-col items-center gap-1 px-4 py-2 text-slate-500 hover:text-tec-blue transition">
                <i data-lucide="home" class="w-5 h-5"></i>
                <span class="text-[10px] font-bold">Inicio</span>
            </button>
            <button onclick="Router.to('public-projects')" class="flex flex-col items-center gap-1 px-4 py-2 text-slate-500 hover:text-tec-blue transition">
                <i data-lucide="folder" class="w-5 h-5"></i>
                <span class="text-[10px] font-bold">Proyectos</span>
            </button>
            <button onclick="Router.to('public-join')" class="flex flex-col items-center gap-1 px-4 py-2 text-slate-500 hover:text-tec-blue transition">
                <i data-lucide="user-plus" class="w-5 h-5"></i>
                <span class="text-[10px] font-bold">Unirse</span>
            </button>
            <button id="mobile-nav-profile" onclick="MobileNav.handleProfile()" class="flex flex-col items-center gap-1 px-4 py-2 text-slate-500 hover:text-tec-blue transition">
                <i data-lucide="user" class="w-5 h-5"></i>
                <span class="text-[10px] font-bold" id="mobile-nav-profile-text">Acceso</span>
            </button>
        </div>
    </nav>

    <!-- ==============================
         FOOTER OFICIAL
         ============================== -->
    <footer class="bg-tec-dark text-white border-t-4 border-tec-gold mt-auto relative z-20">
        <div class="container mx-auto px-6 py-12">
            <div class="grid md:grid-cols-4 gap-12 text-sm">
                <!-- Col 1 -->
                <div class="col-span-1 md:col-span-2">
                    <div class="flex items-center gap-3 mb-6">
                        <img src="robot.gif" alt="CRAI" class="w-12 h-12 object-contain rounded">
                        <div>
                            <h4 class="font-black text-lg tracking-tight">CRAI</h4>
                            <p class="text-[10px] uppercase tracking-widest text-slate-400">TecNM Campus Mexicali</p>
                        </div>
                    </div>
                    <p class="text-slate-400 text-xs leading-relaxed max-w-sm mb-6">
                        El Centro de Rob√≥tica Avanzada e Ingenier√≠a (CRAI) es un organismo estudiantil dedicado a la excelencia t√©cnica y la innovaci√≥n competitiva.
                    </p>
                    <div class="flex gap-4">
                        <a href="https://www.facebook.com/profile.php?id=61583401749916" target="_blank" class="text-slate-400 hover:text-white transition"><i data-lucide="facebook" class="w-5 h-5"></i></a>
                        <a href="https://www.instagram.com/crai.itm/" target="_blank" class="text-slate-400 hover:text-white transition"><i data-lucide="instagram" class="w-5 h-5"></i></a>
                    </div>
                </div>

                <!-- Col 2 -->
                <div>
                    <h5 class="font-bold text-tec-gold mb-6 uppercase tracking-wider text-xs">Navegaci√≥n</h5>
                    <ul class="space-y-3 text-slate-300 text-xs">
                        <li><a href="#" onclick="Router.navigate('home')" class="hover:text-white transition">Inicio</a></li>
                        <li><a href="#" onclick="Router.navigate('projects')" class="hover:text-white transition">Proyectos</a></li>
                        <li><a href="#" onclick="Router.navigate('resources')" class="hover:text-white transition">Repositorio</a></li>
                        <li><a href="#" onclick="Router.navigate('donate')" class="hover:text-white transition">Donar</a></li>
                    </ul>
                </div>

                <!-- Col 3 -->
                <div>
                    <h5 class="font-bold text-tec-gold mb-6 uppercase tracking-wider text-xs">Contacto Oficial</h5>
                    <ul class="space-y-4 text-slate-300 text-xs">
                        <li class="flex gap-3">
                            <i data-lucide="map-pin" class="w-4 h-4 text-tec-gold shrink-0"></i>
                            <span>Av. Instituto Tecnol√≥gico s/n, Col. Plutarco El√≠as Calles, C.P. 21376, Mexicali, B.C.<br><span class="opacity-50">Edificio M, Lab. Metal-Mec√°nica</span></span>
                        </li>
                        <li class="flex gap-3 items-center">
                            <i data-lucide="mail" class="w-4 h-4 text-tec-gold shrink-0"></i>
                            <a onclick="Util.sendEmail('contacto@clubcrai.com', '', '');" class="hover:text-white transition cursor-pointer">contacto@clubcrai.com</a>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-slate-800 mt-12 pt-8 text-center">
                <p class="text-[10px] text-slate-600 font-mono">
                    &copy; 2026 CRAI ‚Ä¢ Creado por <span class="text-slate-400">Diego Mart√≠nez</span> y el <span class="text-slate-400">Club de Rob√≥tica CRAI</span> del Tecnol√≥gico Nacional de M√©xico Campus Mexicali
                </p>
            </div>
        </div>
    </footer>

    <!-- ==============================
         SISTEMA DE MODALES (PORTALES)
         ============================== -->

    <!-- 1. AUTH MODAL (Login & Register) -->
    <div id="modal-auth" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-tec-blue/80 backdrop-blur-sm transition-opacity" onclick="Modal.close('auth')"></div>
        
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl relative z-10 overflow-hidden transform transition-all animate-[fadeUp_0.3s] max-h-[90vh] overflow-y-auto">
            <!-- Side Decoration -->
            <div class="h-1 w-full bg-gradient-to-r from-tec-blue via-tec-lightBlue to-tec-gold"></div>
            <button onclick="Modal.close('auth')" class="absolute top-4 right-4 text-slate-400 hover:text-red-500 transition z-20"><i data-lucide="x" class="w-5 h-5"></i></button>

            <div class="p-6 sm:p-8">
                <div class="text-center mb-8">
                    <h3 class="text-2xl font-black text-tec-blue">IDENTIFICACI√ìN</h3>
                    <p class="text-xs text-slate-500 font-bold uppercase tracking-wide">Acceso Seguro Firebase</p>
                </div>

                <!-- VIEW LOGIN -->
                <div id="auth-view-login" class="auth-slide active">
                    <form onsubmit="Auth.login(event)" class="space-y-4">
                        <div>
                            <label class="block text-[10px] uppercase font-bold text-slate-400 mb-1">Email Institucional</label>
                            <div class="relative">
                                <i data-lucide="mail" class="absolute left-3 top-2.5 w-4 h-4 text-slate-400"></i>
                                <input type="email" id="login-email" class="w-full bg-slate-50 border border-slate-200 rounded-lg pl-10 p-2.5 text-sm font-bold text-tec-dark outline-none focus:border-tec-blue focus:ring-1 focus:ring-tec-blue transition" required placeholder="l210200@mexicali.tecnm.mx">
                            </div>
                        </div>
                        <div>
                            <label class="block text-[10px] uppercase font-bold text-slate-400 mb-1">Contrase√±a</label>
                            <div class="relative">
                                <i data-lucide="lock" class="absolute left-3 top-2.5 w-4 h-4 text-slate-400"></i>
                                <input type="password" id="login-pass" class="w-full bg-slate-50 border border-slate-200 rounded-lg pl-10 p-2.5 text-sm font-bold text-tec-dark outline-none focus:border-tec-blue focus:ring-1 focus:ring-tec-blue transition" required>
                            </div>
                        </div>
                        <button type="submit" class="w-full py-3 bg-tec-blue text-white rounded-lg font-black text-xs uppercase tracking-widest shadow-lg hover:bg-tec-dark transition transform active:scale-95">INGRESAR</button>
                    </form>
                    
                    <!-- Separador -->
                    <div class="mt-6 text-center border-t border-slate-100 pt-4">
                        <p class="text-xs text-slate-500">¬øEres nuevo miembro?</p>
                        <button onclick="Auth.toggleView('register')" class="text-tec-gold font-bold text-xs hover:underline mt-1 uppercase">Validar Matr√≠cula Aqu√≠</button>
                    </div>
                </div>

                <!-- VIEW REGISTER -->
                <div id="auth-view-register" class="auth-slide hidden">
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-100 mb-4 flex gap-3">
                        <i data-lucide="shield-alert" class="w-5 h-5 text-tec-blue shrink-0"></i>
                        <p class="text-[10px] text-blue-800 leading-tight"><strong>PROTOCOLO DE SEGURIDAD:</strong> El registro requiere un C√ìDIGO DE VALIDACI√ìN √∫nico que se cotejar√° con la base de datos.</p>
                    </div>
                    <form onsubmit="Auth.register(event)" class="space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <input type="text" id="reg-name" placeholder="Nombre" required class="bg-slate-50 border border-slate-200 rounded-lg p-2.5 text-xs font-bold outline-none focus:border-tec-blue">
                            <input type="text" id="reg-lastname" placeholder="Apellido" required class="bg-slate-50 border border-slate-200 rounded-lg p-2.5 text-xs font-bold outline-none focus:border-tec-blue">
                        </div>
                        <input type="email" id="reg-email" placeholder="Correo TecNM" required class="w-full bg-slate-50 border border-slate-200 rounded-lg p-2.5 text-xs font-bold outline-none focus:border-tec-blue">
                        <input type="password" id="reg-pass" placeholder="Crear Contrase√±a" required class="w-full bg-slate-50 border border-slate-200 rounded-lg p-2.5 text-xs font-bold outline-none focus:border-tec-blue">
                        
                        <!-- SAFETY CODE FIELD -->
                        <div class="relative group">
                            <input type="text" id="reg-code" placeholder="C√ìDIGO DE VALIDACI√ìN" required class="w-full bg-slate-50 border-2 border-tec-gold text-center tracking-[0.2em] font-mono text-tec-blue rounded-lg p-3 text-xs font-bold outline-none focus:bg-white placeholder-tec-gold/50">
                            <i data-lucide="key" class="w-4 h-4 text-tec-gold absolute right-3 top-3"></i>
                        </div>

                        <button type="submit" class="w-full py-3 bg-tec-gold text-white rounded-lg font-black text-xs uppercase tracking-widest shadow-lg hover:bg-yellow-600 transition mt-2">Crear Credenciales</button>
                    </form>
                    <div class="mt-4 text-center">
                        <button onclick="Auth.toggleView('login')" class="text-xs font-bold text-slate-400 hover:text-slate-600">VOLVER AL LOGIN</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. CMS CONTENT EDITOR MODAL (Admin Only) -->
    <div id="modal-cms" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-tec-dark/90 backdrop-blur-md" onclick="Modal.close('cms')"></div>
        <div class="bg-white w-full max-w-2xl rounded-xl shadow-2xl relative z-10 flex flex-col max-h-[90vh]">
            <!-- Header -->
            <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-xl">
                <div>
                    <h3 class="text-lg font-black text-tec-blue flex items-center gap-2"><i data-lucide="layout-template" class="w-5 h-5"></i> EDITOR DE CONTENIDO</h3>
                    <p class="text-xs text-slate-500">Modifica los textos visibles de la plataforma en tiempo real.</p>
                </div>
                <button onclick="Modal.close('cms')" class="text-slate-400 hover:text-tec-blue"><i data-lucide="x"></i></button>
            </div>
            
            <!-- Body Scroll -->
            <div class="p-8 overflow-y-auto space-y-6">
                <!-- Seccion Hero -->
                <div class="border border-slate-200 rounded-lg p-4">
                    <h4 class="font-bold text-xs uppercase text-tec-gold mb-3 bg-slate-50 inline-block px-2 rounded">Secci√≥n Hero (Landing)</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase">Subt√≠tulo / Descripci√≥n</label>
                            <textarea id="cms-input-hero-desc" rows="2" class="w-full p-2 border border-slate-200 rounded text-xs text-slate-600 focus:border-tec-gold outline-none resize-none"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n Datos Bancarios -->
                <div class="border border-slate-200 rounded-lg p-4">
                    <h4 class="font-bold text-xs uppercase text-tec-gold mb-3 bg-slate-50 inline-block px-2 rounded">Datos Financieros (P√∫blico)</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase">Cuenta / CLABE Visible</label>
                            <input type="text" id="cms-input-bank" class="w-full p-2 border border-slate-200 rounded font-mono text-sm focus:border-tec-gold outline-none">
                        </div>
                    </div>
                </div>
                
                <!-- Secci√≥n Wishlist / Lista de Deseos -->
                <div class="border border-emerald-200 rounded-lg p-4 bg-emerald-50/50">
                    <h4 class="font-bold text-xs uppercase text-emerald-600 mb-3 bg-white inline-block px-2 rounded flex items-center gap-1">
                        <i data-lucide="gift" class="w-3 h-3"></i> Lista de Deseos (Patrocinio en Especie)
                    </h4>
                    <div class="space-y-3">
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase">Link de la Wishlist (Amazon, MercadoLibre, etc.)</label>
                            <input type="url" id="cms-input-wishlist" placeholder="https://www.amazon.com.mx/hz/wishlist/ls/..." class="w-full p-2 border border-slate-200 rounded text-sm focus:border-emerald-500 outline-none">
                            <p class="text-[10px] text-slate-400 mt-1">Este link aparecer√° en el bot√≥n "Ver Lista de Deseos" de la secci√≥n de Patrocinios</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer Actions -->
            <div class="p-6 border-t border-slate-100 bg-slate-50 rounded-b-xl flex justify-end gap-3">
                <button onclick="Modal.close('cms')" class="px-6 py-2 bg-white border border-slate-200 rounded-lg text-xs font-bold text-slate-500 hover:bg-slate-100">CANCELAR</button>
                <button onclick="CMS.saveChanges()" class="px-6 py-2 bg-tec-blue text-white rounded-lg text-xs font-black uppercase tracking-wide shadow-lg hover:bg-tec-dark transition">GUARDAR CAMBIOS LIVE</button>
            </div>
        </div>
    </div>

    <!-- 3. PROJECT UPLOAD MODAL (Mejorado) -->
    <div id="modal-upload" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/80 backdrop-blur-sm" onclick="Modal.close('upload')"></div>
        <div class="bg-white w-full max-w-2xl rounded-2xl shadow-2xl relative z-10 animate-[fadeIn_0.3s] max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Header con gradiente -->
            <div class="bg-gradient-to-r from-tec-blue to-indigo-700 p-6 text-white relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"></div>
                <div class="relative z-10 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center">
                            <i data-lucide="folder-plus" class="w-6 h-6"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">Nuevo Proyecto</h3>
                            <p class="text-blue-200 text-xs">Comparte tu trabajo con el equipo CRAI</p>
                        </div>
                    </div>
                    <button onclick="Modal.close('upload')" class="w-10 h-10 bg-white/10 hover:bg-white/20 rounded-lg flex items-center justify-center transition">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
            
            <!-- Formulario con scroll -->
            <form onsubmit="Database.uploadProject(event)" class="p-6 space-y-5 overflow-y-auto flex-1">
                <!-- Informaci√≥n b√°sica -->
                <div class="space-y-4">
                    <div>
                        <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-2 block">T√≠tulo del Proyecto *</label>
                        <input type="text" id="up-title" placeholder="Ej: Robot de Combate 15kg - Tit√°n" required class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold outline-none focus:border-tec-blue focus:ring-2 focus:ring-tec-blue/20 transition">
                    </div>
                    
                    <div>
                        <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-2 block">Descripci√≥n del Proyecto *</label>
                        <textarea id="up-desc" placeholder="Describe el objetivo, tecnolog√≠as utilizadas, logros alcanzados..." required rows="3" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-tec-blue focus:ring-2 focus:ring-tec-blue/20 transition resize-none"></textarea>
                    </div>
                </div>
                
                <!-- Categor√≠a y Link -->
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-2 block">Categor√≠a *</label>
                        <select id="up-cat" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold text-slate-700 outline-none focus:border-tec-blue cursor-pointer">
                            <option value="Combate">ü§ñ Combate</option>
                            <option value="Drones">üöÅ Drones</option>
                            <option value="Industrial">üè≠ Industrial</option>
                            <option value="Autonomo">üß† Aut√≥nomo</option>
                            <option value="Software">üíª Software</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-2 block">Enlace Externo</label>
                        <input type="url" id="up-link" placeholder="https://github.com/..." class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-tec-blue focus:ring-2 focus:ring-tec-blue/20 transition">
                    </div>
                </div>
                
                <!-- Estado del Proyecto (Nuevo) -->
                <div class="bg-gradient-to-br from-emerald-50 to-green-50 rounded-xl p-4 border border-emerald-200">
                    <label class="text-[11px] font-bold text-emerald-700 uppercase tracking-wide mb-3 flex items-center gap-2">
                        <i data-lucide="activity" class="w-4 h-4"></i>
                        Estado del Proyecto
                    </label>
                    <div class="flex flex-wrap gap-3">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="up-status" value="completed" checked class="w-4 h-4 text-emerald-600 focus:ring-emerald-500">
                            <span class="text-sm font-medium text-slate-700">‚úÖ Completado</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="up-status" value="in_progress" class="w-4 h-4 text-emerald-600 focus:ring-emerald-500">
                            <span class="text-sm font-medium text-slate-700">üîÑ En Proceso</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="up-status" value="planning" class="w-4 h-4 text-emerald-600 focus:ring-emerald-500">
                            <span class="text-sm font-medium text-slate-700">üìã En Planificaci√≥n</span>
                        </label>
                    </div>
                    
                    <!-- Porcentaje Manual de Progreso -->
                    <div class="mt-4 pt-4 border-t border-emerald-200">
                        <label class="text-[11px] font-bold text-emerald-700 uppercase tracking-wide mb-2 flex items-center gap-2">
                            <i data-lucide="percent" class="w-4 h-4"></i>
                            Porcentaje de Progreso Manual
                        </label>
                        <p class="text-[10px] text-slate-500 mb-3">√ösalo cuando el proyecto no tiene tareas asignadas. Si hay tareas, el porcentaje se calcula autom√°ticamente.</p>
                        <div class="flex items-center gap-4">
                            <input type="range" id="up-manual-progress" min="0" max="100" value="0" class="flex-1 h-2 bg-emerald-200 rounded-full appearance-none cursor-pointer accent-emerald-600" oninput="document.getElementById('up-progress-value').textContent = this.value + '%'">
                            <span id="up-progress-value" class="text-lg font-black text-emerald-600 min-w-[50px] text-right">0%</span>
                        </div>
                        <div class="flex justify-between text-[10px] text-slate-400 mt-1">
                            <span>Inicio</span>
                            <span>En desarrollo</span>
                            <span>Completado</span>
                        </div>
                    </div>
                    
                    <p class="text-[10px] text-slate-500 mt-3">Los proyectos "En Proceso" ser√°n visibles p√∫blicamente en la secci√≥n de trabajo actual</p>
                </div>
                
                <!-- Selector de Competencia/Torneo Asociado -->
                <div class="bg-gradient-to-br from-orange-50 to-red-50 rounded-xl p-4 border border-orange-200">
                    <label class="text-[11px] font-bold text-orange-700 uppercase tracking-wide mb-3 flex items-center gap-2">
                        <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="trophy" class="w-4 h-4 text-orange-600"></i>
                        </div>
                        Torneo/Competencia Asociada
                    </label>
                    <p class="text-[10px] text-slate-500 mb-3">Si este proyecto ser√° usado en una competencia, selecci√≥nala para mostrar una insignia llamativa</p>
                    <select id="up-competition" class="w-full p-3.5 bg-white border border-orange-200 rounded-xl text-sm font-bold text-slate-700 outline-none focus:border-orange-500 cursor-pointer">
                        <option value="">Sin competencia asignada</option>
                    </select>
                    <div id="up-competition-preview" class="hidden mt-3 p-3 bg-gradient-to-r from-orange-500 to-red-500 rounded-xl text-white">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="trophy" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <p class="font-bold text-sm" id="up-competition-name"></p>
                                <p class="text-[10px] text-orange-100" id="up-competition-info"></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Selector de Participantes -->
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100">
                    <label class="text-[11px] font-bold text-tec-blue uppercase tracking-wide mb-3 flex items-center gap-2">
                        <i data-lucide="users" class="w-4 h-4"></i>
                        Participantes del Proyecto
                    </label>
                    <p class="text-[10px] text-slate-500 mb-3">Selecciona los miembros del club que participaron en este proyecto</p>
                    
                    <!-- B√∫squeda de miembros -->
                    <div class="relative mb-3">
                        <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
                        <input type="text" id="up-members-search" placeholder="Buscar miembros..." class="w-full pl-10 pr-4 py-2.5 bg-white border border-slate-200 rounded-lg text-xs outline-none focus:border-tec-blue" oninput="ProjectMembers.filterMembers(this.value)">
                    </div>
                    
                    <!-- Lista de miembros seleccionables -->
                    <div id="up-members-list" class="max-h-40 overflow-y-auto space-y-2 mb-3">
                        <div class="text-center py-3">
                            <div class="animate-spin w-5 h-5 border-2 border-tec-blue border-t-transparent rounded-full mx-auto mb-2"></div>
                            <p class="text-xs text-slate-400">Cargando miembros...</p>
                        </div>
                    </div>
                    
                    <!-- Miembros seleccionados -->
                    <div id="up-selected-members" class="flex flex-wrap gap-2 pt-3 border-t border-blue-200">
                        <span class="text-[10px] text-slate-400 italic">Ning√∫n participante seleccionado</span>
                    </div>
                    <input type="hidden" id="up-participants" value="[]">
                </div>
                
                <!-- Notas Privadas (solo miembros) -->
                <div class="bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl p-4 border border-purple-100">
                    <label class="text-[11px] font-bold text-purple-700 uppercase tracking-wide mb-2 flex items-center gap-2">
                        <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="message-square-lock" class="w-4 h-4 text-purple-600"></i>
                        </div>
                        Notas Privadas (Solo Miembros)
                    </label>
                    <p class="text-[10px] text-slate-500 mb-3">Links internos, contrase√±as, comentarios t√©cnicos... Solo visible para usuarios registrados</p>
                    <textarea id="up-private-notes" placeholder="Ej: Link de Drive con m√°s archivos, contrase√±as de repositorios, notas t√©cnicas del equipo..." rows="3" class="w-full p-3.5 bg-white border border-purple-200 rounded-xl text-sm outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition resize-none"></textarea>
                </div>
                
                <!-- Galer√≠a de Fotos (Google Drive) - P√öBLICO -->
                <div class="bg-gradient-to-br from-cyan-50 to-sky-50 rounded-xl p-4 border border-cyan-200">
                    <label class="text-[11px] font-bold text-cyan-700 uppercase tracking-wide mb-2 flex items-center gap-2">
                        <div class="w-8 h-8 bg-cyan-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="image" class="w-4 h-4 text-cyan-600"></i>
                        </div>
                        Galer√≠a de Fotos (P√∫blico)
                    </label>
                    <p class="text-[10px] text-slate-500 mb-3">Pega un enlace de carpeta de Google Drive con fotos del proyecto. La carpeta debe ser p√∫blica (compartida con "Cualquiera con el enlace").</p>
                    <input type="url" id="up-gallery-url" placeholder="https://drive.google.com/drive/folders/..." class="w-full p-3.5 bg-white border border-cyan-200 rounded-xl text-sm outline-none focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 transition">
                    <div class="mt-3 flex items-start gap-2 p-3 bg-cyan-100/50 rounded-lg">
                        <i data-lucide="info" class="w-4 h-4 text-cyan-600 flex-shrink-0 mt-0.5"></i>
                        <div class="text-[10px] text-cyan-700">
                            <p class="font-bold mb-1">¬øC√≥mo compartir una carpeta de Drive?</p>
                            <ol class="list-decimal list-inside space-y-0.5">
                                <li>Sube tus fotos a una carpeta en Google Drive</li>
                                <li>Clic derecho ‚Üí Compartir ‚Üí Compartir</li>
                                <li>Cambia a "Cualquiera con el enlace"</li>
                                <li>Copia el enlace y p√©galo aqu√≠</li>
                            </ol>
                        </div>
                    </div>
                </div>
                
                <!-- Archivos privados (solo miembros) -->
                <div class="border-2 border-dashed border-slate-200 rounded-xl p-4 bg-slate-50/50 hover:border-tec-blue/50 transition">
                    <label class="block text-xs font-bold text-slate-600 mb-2 flex items-center gap-2">
                        <div class="w-8 h-8 bg-tec-gold/10 rounded-lg flex items-center justify-center">
                            <i data-lucide="lock" class="w-4 h-4 text-tec-gold"></i>
                        </div>
                        Archivos Privados (Solo Miembros)
                    </label>
                    <p class="text-[10px] text-slate-400 mb-3">PDF, CAD, documentos t√©cnicos - M√°x 5MB por archivo</p>
                    <input type="file" id="up-files" multiple accept=".pdf,.dwg,.dxf,.step,.stp,.iges,.igs,.stl,.obj,.doc,.docx,.xlsx,.zip,.rar" class="w-full text-xs file:mr-3 file:py-2.5 file:px-4 file:rounded-lg file:border-0 file:text-xs file:font-bold file:bg-tec-blue file:text-white hover:file:bg-tec-dark cursor-pointer">
                    <div id="up-files-preview" class="mt-3 space-y-2 hidden"></div>
                </div>
                
                <!-- Bot√≥n de env√≠o -->
                <button type="submit" class="w-full py-4 bg-gradient-to-r from-tec-blue to-indigo-600 text-white font-bold text-sm uppercase rounded-xl shadow-lg hover:shadow-xl hover:from-tec-dark hover:to-indigo-700 transition-all duration-300 flex items-center justify-center gap-2">
                    <i data-lucide="upload" class="w-5 h-5"></i>
                    Publicar Proyecto
                </button>
            </form>
        </div>
    </div>

    <!-- 4. PROJECT EDIT MODAL -->
    <div id="modal-edit-project" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/80 backdrop-blur-sm" onclick="Modal.close('edit-project')"></div>
        <div class="bg-white w-full max-w-2xl rounded-2xl shadow-2xl relative z-10 animate-[fadeIn_0.3s] max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Header con gradiente -->
            <div class="bg-gradient-to-r from-amber-500 to-orange-600 p-6 text-white relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"></div>
                <div class="relative z-10 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center">
                            <i data-lucide="edit-3" class="w-6 h-6"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">Editar Proyecto</h3>
                            <p class="text-amber-100 text-xs">Actualiza la informaci√≥n de tu proyecto</p>
                        </div>
                    </div>
                    <button onclick="Modal.close('edit-project')" class="w-10 h-10 bg-white/10 hover:bg-white/20 rounded-lg flex items-center justify-center transition">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
            
            <!-- Formulario con scroll -->
            <form onsubmit="Database.updateProject(event)" class="p-6 space-y-5 overflow-y-auto flex-1">
                <input type="hidden" id="edit-project-id">
                
                <!-- Informaci√≥n b√°sica -->
                <div class="space-y-4">
                    <div>
                        <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-2 block">T√≠tulo del Proyecto *</label>
                        <input type="text" id="edit-title" placeholder="Ej: Robot de Combate 15kg - Tit√°n" required class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20 transition">
                    </div>
                    
                    <div>
                        <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-2 block">Descripci√≥n del Proyecto *</label>
                        <textarea id="edit-desc" placeholder="Describe el objetivo, tecnolog√≠as utilizadas, logros alcanzados..." required rows="3" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20 transition resize-none"></textarea>
                    </div>
                </div>
                
                <!-- Categor√≠a y Link -->
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-2 block">Categor√≠a *</label>
                        <select id="edit-cat" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold text-slate-700 outline-none focus:border-amber-500 cursor-pointer">
                            <option value="Combate">ü§ñ Combate</option>
                            <option value="Drones">üöÅ Drones</option>
                            <option value="Industrial">üè≠ Industrial</option>
                            <option value="Autonomo">üß† Aut√≥nomo</option>
                            <option value="Software">üíª Software</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-2 block">Enlace Externo</label>
                        <input type="url" id="edit-link" placeholder="https://github.com/..." class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20 transition">
                    </div>
                </div>
                
                <!-- Estado del Proyecto -->
                <div class="bg-gradient-to-br from-emerald-50 to-green-50 rounded-xl p-4 border border-emerald-200">
                    <label class="text-[11px] font-bold text-emerald-700 uppercase tracking-wide mb-3 flex items-center gap-2">
                        <i data-lucide="activity" class="w-4 h-4"></i>
                        Estado del Proyecto
                    </label>
                    <div class="flex flex-wrap gap-3">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="edit-status" value="completed" class="w-4 h-4 text-emerald-600 focus:ring-emerald-500">
                            <span class="text-sm font-medium text-slate-700">‚úÖ Completado</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="edit-status" value="in_progress" class="w-4 h-4 text-emerald-600 focus:ring-emerald-500">
                            <span class="text-sm font-medium text-slate-700">üîÑ En Proceso</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="edit-status" value="planning" class="w-4 h-4 text-emerald-600 focus:ring-emerald-500">
                            <span class="text-sm font-medium text-slate-700">üìã En Planificaci√≥n</span>
                        </label>
                    </div>
                    
                    <!-- Porcentaje Manual de Progreso -->
                    <div class="mt-4 pt-4 border-t border-emerald-200">
                        <label class="text-[11px] font-bold text-emerald-700 uppercase tracking-wide mb-2 flex items-center gap-2">
                            <i data-lucide="percent" class="w-4 h-4"></i>
                            Porcentaje de Progreso Manual
                        </label>
                        <p class="text-[10px] text-slate-500 mb-3">√ösalo cuando el proyecto no tiene tareas asignadas. Si hay tareas, el porcentaje se calcula autom√°ticamente.</p>
                        <div class="flex items-center gap-4">
                            <input type="range" id="edit-manual-progress" min="0" max="100" value="0" class="flex-1 h-2 bg-emerald-200 rounded-full appearance-none cursor-pointer accent-emerald-600" oninput="document.getElementById('edit-progress-value').textContent = this.value + '%'">
                            <span id="edit-progress-value" class="text-lg font-black text-emerald-600 min-w-[50px] text-right">0%</span>
                        </div>
                        <div class="flex justify-between text-[10px] text-slate-400 mt-1">
                            <span>Inicio</span>
                            <span>En desarrollo</span>
                            <span>Completado</span>
                        </div>
                    </div>
                    
                    <p class="text-[10px] text-slate-500 mt-3">Los proyectos "En Proceso" ser√°n visibles p√∫blicamente</p>
                </div>
                
                <!-- Selector de Competencia/Torneo Asociado para edici√≥n -->
                <div class="bg-gradient-to-br from-orange-50 to-red-50 rounded-xl p-4 border border-orange-200">
                    <label class="text-[11px] font-bold text-orange-700 uppercase tracking-wide mb-3 flex items-center gap-2">
                        <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="trophy" class="w-4 h-4 text-orange-600"></i>
                        </div>
                        Torneo/Competencia Asociada
                    </label>
                    <p class="text-[10px] text-slate-500 mb-3">Si este proyecto ser√° usado en una competencia, selecci√≥nala para mostrar una insignia llamativa</p>
                    <select id="edit-competition" class="w-full p-3.5 bg-white border border-orange-200 rounded-xl text-sm font-bold text-slate-700 outline-none focus:border-orange-500 cursor-pointer">
                        <option value="">Sin competencia asignada</option>
                    </select>
                    <div id="edit-competition-preview" class="hidden mt-3 p-3 bg-gradient-to-r from-orange-500 to-red-500 rounded-xl text-white">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                                <i data-lucide="trophy" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <p class="font-bold text-sm" id="edit-competition-name"></p>
                                <p class="text-[10px] text-orange-100" id="edit-competition-info"></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Selector de Participantes para edici√≥n -->
                <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-4 border border-amber-100">
                    <label class="text-[11px] font-bold text-amber-700 uppercase tracking-wide mb-3 flex items-center gap-2">
                        <i data-lucide="users" class="w-4 h-4"></i>
                        Participantes del Proyecto
                    </label>
                    <p class="text-[10px] text-slate-500 mb-3">Selecciona los miembros del club que participaron en este proyecto</p>
                    
                    <!-- B√∫squeda de miembros -->
                    <div class="relative mb-3">
                        <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
                        <input type="text" id="edit-members-search" placeholder="Buscar miembros..." class="w-full pl-10 pr-4 py-2.5 bg-white border border-slate-200 rounded-lg text-xs outline-none focus:border-amber-500" oninput="ProjectMembers.filterMembersEdit(this.value)">
                    </div>
                    
                    <!-- Lista de miembros seleccionables -->
                    <div id="edit-members-list" class="max-h-40 overflow-y-auto space-y-2 mb-3">
                        <div class="text-center py-3">
                            <div class="animate-spin w-5 h-5 border-2 border-amber-500 border-t-transparent rounded-full mx-auto mb-2"></div>
                            <p class="text-xs text-slate-400">Cargando miembros...</p>
                        </div>
                    </div>
                    
                    <!-- Miembros seleccionados -->
                    <div id="edit-selected-members" class="flex flex-wrap gap-2 pt-3 border-t border-amber-200">
                        <span class="text-[10px] text-slate-400 italic">Ning√∫n participante seleccionado</span>
                    </div>
                    <input type="hidden" id="edit-participants" value="[]">
                </div>
                
                <!-- Notas Privadas (solo miembros) -->
                <div class="bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl p-4 border border-purple-100">
                    <label class="text-[11px] font-bold text-purple-700 uppercase tracking-wide mb-2 flex items-center gap-2">
                        <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="message-square-lock" class="w-4 h-4 text-purple-600"></i>
                        </div>
                        Notas Privadas (Solo Miembros)
                    </label>
                    <p class="text-[10px] text-slate-500 mb-3">Links internos, contrase√±as, comentarios t√©cnicos... Solo visible para usuarios registrados</p>
                    <textarea id="edit-private-notes" placeholder="Ej: Link de Drive con m√°s archivos, contrase√±as de repositorios, notas t√©cnicas del equipo..." rows="3" class="w-full p-3.5 bg-white border border-purple-200 rounded-xl text-sm outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition resize-none"></textarea>
                </div>
                
                <!-- Galer√≠a de Fotos (Google Drive) - P√öBLICO -->
                <div class="bg-gradient-to-br from-cyan-50 to-sky-50 rounded-xl p-4 border border-cyan-200">
                    <label class="text-[11px] font-bold text-cyan-700 uppercase tracking-wide mb-2 flex items-center gap-2">
                        <div class="w-8 h-8 bg-cyan-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="image" class="w-4 h-4 text-cyan-600"></i>
                        </div>
                        Galer√≠a de Fotos (P√∫blico)
                    </label>
                    <p class="text-[10px] text-slate-500 mb-3">Pega un enlace de carpeta de Google Drive con fotos del proyecto. La carpeta debe ser p√∫blica.</p>
                    <input type="url" id="edit-gallery-url" placeholder="https://drive.google.com/drive/folders/..." class="w-full p-3.5 bg-white border border-cyan-200 rounded-xl text-sm outline-none focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 transition">
                </div>
                
                <!-- Archivos existentes -->
                <div id="edit-existing-files" class="hidden">
                    <label class="text-[11px] font-bold text-slate-600 uppercase tracking-wide mb-3 block flex items-center gap-2">
                        <i data-lucide="folder" class="w-4 h-4 text-tec-gold"></i>
                        Archivos Actuales
                    </label>
                    <div id="edit-files-list" class="space-y-2"></div>
                </div>
                
                <!-- Nuevos archivos -->
                <div class="border-2 border-dashed border-slate-200 rounded-xl p-4 bg-slate-50/50 hover:border-amber-500/50 transition">
                    <label class="block text-xs font-bold text-slate-600 mb-2 flex items-center gap-2">
                        <div class="w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="file-plus" class="w-4 h-4 text-amber-600"></i>
                        </div>
                        Agregar Nuevos Archivos
                    </label>
                    <p class="text-[10px] text-slate-400 mb-3">PDF, CAD, documentos t√©cnicos - M√°x 5MB por archivo</p>
                    <input type="file" id="edit-files" multiple accept=".pdf,.dwg,.dxf,.step,.stp,.iges,.igs,.stl,.obj,.doc,.docx,.xlsx,.zip,.rar" class="w-full text-xs file:mr-3 file:py-2.5 file:px-4 file:rounded-lg file:border-0 file:text-xs file:font-bold file:bg-amber-500 file:text-white hover:file:bg-amber-600 cursor-pointer">
                    <div id="edit-files-preview" class="mt-3 space-y-2 hidden"></div>
                </div>
                
                <!-- Botones de acci√≥n -->
                <div class="flex gap-3">
                    <button type="button" onclick="Modal.close('edit-project')" class="flex-1 py-4 bg-slate-100 text-slate-600 font-bold text-sm uppercase rounded-xl hover:bg-slate-200 transition">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold text-sm uppercase rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all duration-300 flex items-center justify-center gap-2">
                        <i data-lucide="save" class="w-5 h-5"></i>
                        Guardar Cambios
                    </button>
                </div>
            </form>
        </div>
    </div>
<!-- ============================================
         CORE SYSTEM JAVASCRIPT (MVC ARCHITECTURE)
         ============================================ -->
    <script>
        /**
         * ==========================================
         * 1. CONFIGURACI√ìN DEL SISTEMA
         * ==========================================
         */
        const SYS_CONFIG = {
            // Credenciales Firebase - Club de Rob√≥tica CRAI
            firebase: {
                apiKey: "AIzaSyATUt6oVceiOXCGsoMeEpjXFzFAOaYemuA",
                authDomain: "club-de-robotica-crai.firebaseapp.com",
                projectId: "club-de-robotica-crai",
                storageBucket: "club-de-robotica-crai.firebasestorage.app",
                messagingSenderId: "879814844436",
                appId: "1:879814844436:web:d8e7f5482ded33f222c701",
                measurementId: "G-9Y8MC4ECJM"
            },
            // Fallbacks locales por si la DB est√° vac√≠a (Initial State)
            defaults: {
                heroTitle: "CRAI\nCLUB DE ROB√ìTICA\nAVANZADA",
                heroDesc: "Nodo oficial de desarrollo tecnol√≥gico del Edificio T. Impulsando la rob√≥tica de competencia en el TecNM Mexicali.",
                stats: { s1: "12+", s2: "45", s3: "24/7" },
                bankInfo: "CLABE: 012 905 0281 9283 1928"
            }
        };

        // Estado Global de la Aplicaci√≥n (State Management Lite)
        const STATE = {
            currentUser: null,
            isAdmin: false,
            profile: null,
            profileSkills: [],
            unsubscribeChat: null // Para limpiar listeners
        };

        // Inicializadores de Servicio
        let db, auth;

        /**
         * ==========================================
         * 2. BOOTSTRAPPER (Arranque)
         * ==========================================
         */
        window.onload = async () => {
            const loader = document.getElementById('sys-loader');
            const loaderLog = document.getElementById('loader-log');
            
            // Timeout m√°ximo de 8 segundos para el loader
            const loaderTimeout = setTimeout(() => {
                if (loader && loader.parentNode) {
                    loaderLog.innerText = "Carga lenta detectada. Continuando...";
                    gsap.to(loader, { opacity: 0, duration: 0.5, onComplete: () => loader.remove() });
                }
            }, 8000);
            
            try {
                // Iniciar Firebase SDK
                loaderLog.innerText = "Conectando con Firebase...";
                firebase.initializeApp(SYS_CONFIG.firebase);
                db = firebase.firestore();
                auth = firebase.auth();

                console.log("%c SYSTEM: KERNEL LOADED ", "background: #1B396A; color: #D4AF37; font-weight: bold;");

                // Configurar Listeners Globales
                loaderLog.innerText = "Iniciando interfaz...";
                setupAuthObserver();
                lucide.createIcons();
                initTelemetryChart();

                // Hidratar CMS (Cargar textos din√°micos)
                loaderLog.innerText = "Cargando contenido...";
                await CMS.loadContent();

                // Datos p√∫blicos y listeners
                Database.loadPublicMembers();
                
                // Listener para preview de archivos en formulario de proyecto
                const filesInput = document.getElementById('up-files');
                if (filesInput) {
                    filesInput.addEventListener('change', (e) => {
                        const preview = document.getElementById('up-files-preview');
                        const files = e.target.files;
                        
                        if (files.length > 0) {
                            preview.classList.remove('hidden');
                            let html = '<p class="text-[10px] font-bold text-slate-500 mb-2">Archivos seleccionados:</p>';
                            
                            for (const file of files) {
                                const icon = Util.getFileIcon(file.name);
                                const size = Util.formatFileSize(file.size);
                                const isOversize = file.size > 5 * 1024 * 1024;
                                
                                html += `
                                    <div class="flex items-center gap-2 p-2 ${isOversize ? 'bg-red-50 border border-red-200' : 'bg-white border border-slate-200'} rounded-lg text-xs">
                                        <i data-lucide="${icon}" class="w-4 h-4 ${isOversize ? 'text-red-500' : 'text-tec-blue'}"></i>
                                        <span class="truncate flex-1 ${isOversize ? 'text-red-600' : 'text-slate-700'}">${file.name}</span>
                                        <span class="text-slate-400">${size}</span>
                                        ${isOversize ? '<span class="text-red-500 text-[10px] font-bold">¬°Muy grande!</span>' : ''}
                                    </div>
                                `;
                            }
                            
                            preview.innerHTML = html;
                            lucide.createIcons();
                        } else {
                            preview.classList.add('hidden');
                            preview.innerHTML = '';
                        }
                    });
                }

                // Eliminar Loader
                clearTimeout(loaderTimeout);
                const loader = document.getElementById('sys-loader');
                if (loader) {
                    gsap.to(loader, { opacity: 0, duration: 0.8, onComplete: () => loader.remove() });
                }

            } catch (error) {
                console.error("FATAL ERROR:", error);
                clearTimeout(loaderTimeout);
                document.getElementById('loader-log').innerText = "Error Cr√≠tico de Conexi√≥n. Recarga.";
                document.getElementById('loader-log').classList.add('text-red-500');
            }
        };

        /**
         * ==========================================
         * 3. AUTH SERVICE (Sistema de Seguridad)
         * ==========================================
         */
        function setupAuthObserver() {
            auth.onAuthStateChanged(async (user) => {
                const uiPublic = document.getElementById('login-btn');
                const uiUser = document.getElementById('user-pill');
                const pillName = document.getElementById('pill-username');

                STATE.currentUser = user;
                STATE.profile = null;
                STATE.isAdmin = false;

                if (user) {
                    const profileSnap = await db.collection('users').doc(user.uid).get();
                    STATE.profile = profileSnap.exists ? profileSnap.data() : {};
                    STATE.isAdmin = STATE.profile?.role === 'admin';
                    STATE.profileSkills = STATE.profile?.skills || [];

                    const displayName = STATE.profile?.fullName || user.displayName || 'Miembro';
                    const photoURL = STATE.profile?.photoURL || user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&background=1B396A&color=D4AF37&bold=true`;
                    // Prioridad: T√≠tulo personalizado > √Årea > Rol > Miembro
                    const displayRole = STATE.profile?.customTitle || STATE.profile?.areaName || STATE.profile?.role || 'Miembro';

                    if (!user.displayName && STATE.profile?.fullName) {
                        await user.updateProfile({ displayName: STATE.profile.fullName });
                    }

                    // Actualizar UI Header
                    uiPublic?.classList.add('hidden');
                    uiPublic?.classList.remove('flex');
                    uiUser?.classList.remove('hidden');
                    uiUser?.classList.add('flex');
                    if (pillName) pillName.innerText = displayName.split(' ')[0];

                    // Actualizar Mobile Menu
                    MobileMenu.updateUserState(true);

                    // Actualizar UI Dashboard
                    document.getElementById('dash-username').innerText = displayName;
                    document.getElementById('dash-avatar').src = photoURL;
                    document.getElementById('dash-role').innerText = displayRole.toUpperCase();
                    
                    // Cargar datos del perfil en el formulario
                    setTimeout(() => Profile.loadFromState(), 100);

                    // Check Admin Permissions - SOLO el propietario puede editar el sitio
                    // Cambiar este correo por el del administrador autorizado
                    const ADMIN_EMAIL = 'a23490819@itmexicali.edu.mx';
                    const isOwner = user.email === ADMIN_EMAIL;
                    
                    if (isOwner) {
                        document.getElementById('btn-cms-mode').classList.remove('hidden');
                        document.getElementById('btn-manage-events').classList.remove('hidden');
                    }
                    
                    // Conectar Chat Socket
                    Chat.connect();
                    Database.fetchPrivateData(); // Cargar datos del dashboard
                    Database.loadPublicMembers();
                    
                    // Inicializar sistema de notificaciones
                    NotificationSystem.init();
                    
                    // Verificar logros autom√°ticos al iniciar sesi√≥n
                    setTimeout(() => Achievements.checkAutoAchievements(user.uid), 2000);
                    
                    // Inicializar bot√≥n de reportes PDF (solo para l√≠deres/fundadores/maestros)
                    setTimeout(() => ClubReport.init(), 500);
                    
                    // Inicializar sistema de solicitudes (solo para fundadores/l√≠deres/maestros)
                    setTimeout(() => Applications.init(), 600);
                    
                    // Inicializar gesti√≥n de miembros (solo para admin/fundador)
                    setTimeout(() => AdminMembers.init(), 700);
                    
                    // Actualizar presencia (marcar usuario como online)
                    Communications.updatePresence();

                } else {
                    uiPublic?.classList.remove('hidden');
                    uiPublic?.classList.add('flex');
                    uiUser?.classList.add('hidden');
                    uiUser?.classList.remove('flex');
                    document.getElementById('btn-cms-mode')?.classList.add('hidden');
                    document.getElementById('btn-manage-events')?.classList.add('hidden');
                    
                    // Actualizar Mobile Menu
                    MobileMenu.updateUserState(false);
                    
                    if(STATE.unsubscribeChat) STATE.unsubscribeChat(); // Desconectar chat
                    
                    // Desconectar notificaciones
                    NotificationSystem.disconnect();
                }
            });
        }

        /**
         * ==========================================
         * SISTEMA DE NOTIFICACIONES EN TIEMPO REAL
         * ==========================================
         */
        const NotificationSystem = {
            notifications: [],
            unsubscribers: [],
            lastReadTimestamp: null,
            isOpen: false,
            
            // Inicializar sistema de notificaciones
            init: async () => {
                if (!STATE.currentUser) return;
                
                // Mostrar bot√≥n de notificaciones
                document.getElementById('notifications-btn')?.classList.remove('hidden');
                
                // Cargar timestamp de √∫ltima lectura desde localStorage
                const stored = localStorage.getItem(`notifications_read_${STATE.currentUser.uid}`);
                NotificationSystem.lastReadTimestamp = stored ? new Date(stored) : new Date(Date.now() - 24 * 60 * 60 * 1000); // √öltimas 24h por defecto
                
                // Escuchar cambios en todas las colecciones
                NotificationSystem.listenToCollection('members', 'member', 'Nuevo miembro', 'user-plus', 'Nuevo miembro registrado en CRAI');
                NotificationSystem.listenToCollection('projects', 'project', 'Nuevo proyecto', 'folder-plus', 'Se ha publicado un nuevo proyecto');
                NotificationSystem.listenToCollection('wiki', 'wiki', 'Wiki actualizada', 'book-open', 'Nueva entrada en la Wiki T√©cnica');
                NotificationSystem.listenToCollection('blog', 'article', 'Nuevo art√≠culo', 'file-text', 'Se ha publicado un nuevo art√≠culo');
                NotificationSystem.listenToCollection('events', 'event', 'Nuevo evento', 'calendar', 'Se ha agregado un nuevo evento');
                NotificationSystem.listenToCollection('alerts', 'alert', 'Nueva alerta', 'alert-triangle', 'Alerta importante del club');
                NotificationSystem.listenToCollection('chat', 'message', 'Nuevo mensaje', 'message-circle', 'Mensaje en el chat del club');
                NotificationSystem.listenToCompetitions(); // Escuchar competencias
                NotificationSystem.listenToAchievements(); // Escuchar logros del usuario actual
                NotificationSystem.listenToApplications(); // Escuchar solicitudes (solo l√≠deres/fundadores/maestros)
                
                // Actualizar badge inicialmente
                NotificationSystem.updateBadge();
            },
            
            // Escuchar competencias (con campo createdAt)
            listenToCompetitions: () => {
                try {
                    const unsubscribe = db.collection('competitions')
                        .orderBy('createdAt', 'desc')
                        .limit(10)
                        .onSnapshot(snapshot => {
                            snapshot.docChanges().forEach(change => {
                                if (change.type === 'added') {
                                    const data = change.doc.data();
                                    const docDate = data.createdAt?.toDate ? data.createdAt.toDate() : new Date();
                                    
                                    const maxAge = new Date(Date.now() - 48 * 60 * 60 * 1000);
                                    if (docDate > NotificationSystem.lastReadTimestamp && docDate > maxAge) {
                                        const isOwnAction = data.createdBy === STATE.currentUser?.uid;
                                        
                                        if (!isOwnAction) {
                                            const eventDate = new Date(data.dateStart);
                                            const daysLeft = Math.ceil((eventDate - new Date()) / (1000 * 60 * 60 * 24));
                                            let daysText = daysLeft <= 0 ? '¬°Hoy!' : daysLeft === 1 ? 'Ma√±ana' : `En ${daysLeft} d√≠as`;
                                            
                                            NotificationSystem.addNotification({
                                                id: change.doc.id,
                                                type: 'competition',
                                                icon: 'trophy',
                                                title: 'üèÜ Nueva Competencia',
                                                description: `"${data.name}" - ${daysText} en ${data.location || 'Por definir'}`,
                                                timestamp: docDate,
                                                data: data,
                                                read: false
                                            });
                                        }
                                    }
                                }
                            });
                        }, error => {
                            console.log('No se pudo escuchar competencias:', error.message);
                        });
                    
                    NotificationSystem.unsubscribers.push(unsubscribe);
                } catch (e) {
                    console.log('Colecci√≥n competitions no disponible');
                }
            },
            
            // Escuchar cambios en logros del usuario actual
            listenToAchievements: () => {
                if (!STATE.currentUser) return;
                
                let previousAchievements = null;
                
                try {
                    const unsubscribe = db.collection('users').doc(STATE.currentUser.uid)
                        .onSnapshot(snapshot => {
                            if (!snapshot.exists) return;
                            
                            const data = snapshot.data();
                            const currentAchievements = data.achievements || [];
                            
                            // Si es la primera carga, solo guardar el estado inicial
                            if (previousAchievements === null) {
                                previousAchievements = [...currentAchievements];
                                return;
                            }
                            
                            // Detectar nuevos logros
                            const newAchievements = currentAchievements.filter(a => !previousAchievements.includes(a));
                            
                            newAchievements.forEach(achievementId => {
                                const def = Achievements.definitions[achievementId];
                                if (def) {
                                    NotificationSystem.addNotification({
                                        id: `achievement_${achievementId}_${Date.now()}`,
                                        type: 'achievement',
                                        icon: def.icon,
                                        title: 'üèÜ ¬°Nuevo Logro!',
                                        description: `Desbloqueaste "${def.name}" - ${def.points} puntos`,
                                        timestamp: new Date(),
                                        data: { achievementId, ...def },
                                        read: false
                                    });
                                }
                            });
                            
                            previousAchievements = [...currentAchievements];
                        }, error => {
                            console.log('No se pudo escuchar logros:', error.message);
                        });
                    
                    NotificationSystem.unsubscribers.push(unsubscribe);
                } catch (e) {
                    console.log('Error escuchando logros:', e);
                }
            },
            
            // Escuchar solicitudes de ingreso (solo para l√≠deres, fundadores, maestros y admin)
            listenToApplications: () => {
                if (!STATE.currentUser || !STATE.profile) return;
                
                // Verificar si el usuario tiene permisos para ver solicitudes
                const title = (STATE.profile.customTitle || '').toLowerCase();
                const role = (STATE.profile.role || '').toLowerCase();
                
                const isFounder = title.includes('fundador') || title.includes('founder');
                const isLeader = title.includes('l√≠der') || title.includes('lider') || title.includes('leader');
                const isMaster = title.includes('maestro') || title.includes('mentor') || title.includes('master');
                const isAdmin = role === 'admin';
                
                // Solo escuchar si tiene permisos
                if (!isFounder && !isLeader && !isMaster && !isAdmin) return;
                
                try {
                    const unsubscribe = db.collection('applications')
                        .orderBy('submittedAt', 'desc')
                        .limit(20)
                        .onSnapshot(snapshot => {
                            snapshot.docChanges().forEach(change => {
                                if (change.type === 'added') {
                                    const data = change.doc.data();
                                    const docDate = data.submittedAt?.toDate ? data.submittedAt.toDate() : new Date();
                                    
                                    // Solo notificar si es reciente (√∫ltimas 48h) y posterior a √∫ltima lectura
                                    const maxAge = new Date(Date.now() - 48 * 60 * 60 * 1000);
                                    if (docDate > NotificationSystem.lastReadTimestamp && docDate > maxAge) {
                                        NotificationSystem.addNotification({
                                            id: `app_${change.doc.id}`,
                                            type: 'application',
                                            icon: 'user-plus',
                                            title: 'üìã Nueva Solicitud',
                                            description: `${data.name || 'Alguien'} quiere unirse al CRAI (${data.areaName || data.area || 'Sin √°rea'})`,
                                            timestamp: docDate,
                                            data: { ...data, appId: change.doc.id },
                                            read: false,
                                            action: () => Applications.show()
                                        });
                                        
                                        // Actualizar contador de solicitudes pendientes
                                        Applications.updatePendingCount();
                                    }
                                }
                            });
                        }, error => {
                            console.log('No se pudo escuchar solicitudes:', error.message);
                        });
                    
                    NotificationSystem.unsubscribers.push(unsubscribe);
                } catch (e) {
                    console.log('Error escuchando solicitudes:', e);
                }
            },
            
            // Escuchar cambios en una colecci√≥n
            listenToCollection: (collectionName, type, title, icon, defaultDesc) => {
                try {
                    const unsubscribe = db.collection(collectionName)
                        .orderBy('date', 'desc')
                        .limit(20)
                        .onSnapshot(snapshot => {
                            snapshot.docChanges().forEach(change => {
                                if (change.type === 'added') {
                                    const data = change.doc.data();
                                    const docDate = data.date?.toDate ? data.date.toDate() : new Date(data.date?.seconds * 1000 || Date.now());
                                    
                                    // Solo notificar si es posterior a la √∫ltima lectura y no es muy antiguo (√∫ltimas 48h)
                                    const maxAge = new Date(Date.now() - 48 * 60 * 60 * 1000);
                                    if (docDate > NotificationSystem.lastReadTimestamp && docDate > maxAge) {
                                        // Evitar notificaciones propias
                                        const isOwnAction = data.author === STATE.currentUser?.email || 
                                                          data.email === STATE.currentUser?.email ||
                                                          data.authorEmail === STATE.currentUser?.email;
                                        
                                        if (!isOwnAction) {
                                            NotificationSystem.addNotification({
                                                id: change.doc.id,
                                                type: type,
                                                icon: icon,
                                                title: title,
                                                description: NotificationSystem.getDescription(type, data, defaultDesc),
                                                timestamp: docDate,
                                                data: data,
                                                read: false
                                            });
                                        }
                                    }
                                }
                            });
                        }, error => {
                            console.log(`No se pudo escuchar ${collectionName}:`, error.message);
                        });
                    
                    NotificationSystem.unsubscribers.push(unsubscribe);
                } catch (e) {
                    console.log(`Colecci√≥n ${collectionName} no disponible`);
                }
            },
            
            // Obtener descripci√≥n personalizada seg√∫n el tipo
            getDescription: (type, data, defaultDesc) => {
                switch(type) {
                    case 'member':
                        return `${data.name || 'Alguien'} se uni√≥ al club`;
                    case 'project':
                        return `"${data.title || 'Proyecto'}" por ${data.authorName || 'An√≥nimo'}`;
                    case 'wiki':
                        return `"${data.title || 'Entrada'}" - ${data.category || 'General'}`;
                    case 'article':
                        return `"${data.title || 'Art√≠culo'}" por ${data.author || 'An√≥nimo'}`;
                    case 'event':
                        return `"${data.title || 'Evento'}" - ${data.location || 'Por definir'}`;
                    case 'alert':
                        return data.message || data.title || 'Alerta del sistema';
                    case 'message':
                        return `${data.authorName || 'Alguien'}: ${(data.text || '').substring(0, 50)}${data.text?.length > 50 ? '...' : ''}`;
                    default:
                        return defaultDesc;
                }
            },
            
            // Agregar notificaci√≥n
            addNotification: (notification) => {
                // Evitar duplicados
                if (NotificationSystem.notifications.find(n => n.id === notification.id && n.type === notification.type)) {
                    return;
                }
                
                NotificationSystem.notifications.unshift(notification);
                
                // Limitar a 50 notificaciones
                if (NotificationSystem.notifications.length > 50) {
                    NotificationSystem.notifications = NotificationSystem.notifications.slice(0, 50);
                }
                
                NotificationSystem.updateBadge();
                NotificationSystem.render();
                
                // Mostrar toast si el panel est√° cerrado
                if (!NotificationSystem.isOpen) {
                    NotificationSystem.showToast(notification);
                }
            },
            
            // Mostrar toast de notificaci√≥n
            showToast: (notification) => {
                const iconColors = {
                    'member': 'from-green-500 to-emerald-600',
                    'project': 'from-blue-500 to-indigo-600',
                    'wiki': 'from-purple-500 to-violet-600',
                    'article': 'from-orange-500 to-amber-600',
                    'event': 'from-pink-500 to-rose-600',
                    'alert': 'from-red-500 to-rose-600',
                    'message': 'from-tec-blue to-indigo-600',
                    'achievement': 'from-amber-400 to-yellow-500',
                    'competition': 'from-purple-500 to-pink-500',
                    'application': 'from-amber-500 to-orange-600'
                };
                
                const toast = document.createElement('div');
                toast.className = 'fixed bottom-24 sm:bottom-8 right-4 sm:right-6 bg-white rounded-xl shadow-2xl border border-slate-200 p-4 z-[100] max-w-sm animate-[slideInRight_0.3s] cursor-pointer hover:shadow-xl transition';
                toast.onclick = () => {
                    toast.remove();
                    // Si la notificaci√≥n tiene acci√≥n personalizada, ejecutarla
                    if (notification.action) {
                        notification.action();
                    } else {
                        NotificationSystem.open();
                    }
                };
                toast.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br ${iconColors[notification.type] || 'from-slate-500 to-slate-600'} rounded-xl flex items-center justify-center flex-shrink-0">
                            <i data-lucide="${notification.icon}" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="font-bold text-slate-800 text-sm">${notification.title}</p>
                            <p class="text-slate-500 text-xs truncate">${notification.description}</p>
                        </div>
                        <button onclick="event.stopPropagation(); this.parentElement.parentElement.remove()" class="text-slate-400 hover:text-slate-600">
                            <i data-lucide="x" class="w-4 h-4"></i>
                        </button>
                    </div>
                `;
                document.body.appendChild(toast);
                lucide.createIcons();
                
                // Auto-remover despu√©s de 5 segundos
                setTimeout(() => toast.remove(), 5000);
            },
            
            // Actualizar badge
            updateBadge: () => {
                const unreadCount = NotificationSystem.notifications.filter(n => !n.read).length;
                const badge = document.getElementById('notification-badge');
                const countText = document.getElementById('notifications-count');
                
                if (badge) {
                    if (unreadCount > 0) {
                        badge.classList.remove('hidden');
                        badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                    } else {
                        badge.classList.add('hidden');
                    }
                }
                
                if (countText) {
                    countText.textContent = `${unreadCount} nueva${unreadCount !== 1 ? 's' : ''}`;
                }
            },
            
            // Renderizar lista de notificaciones
            render: () => {
                const container = document.getElementById('notifications-list');
                if (!container) return;
                
                if (NotificationSystem.notifications.length === 0) {
                    container.innerHTML = `
                        <div class="p-8 text-center text-slate-400">
                            <i data-lucide="bell-off" class="w-12 h-12 mx-auto mb-3 opacity-50"></i>
                            <p class="text-sm font-medium">Sin notificaciones</p>
                            <p class="text-xs">Te avisaremos cuando haya actividad</p>
                        </div>
                    `;
                    lucide.createIcons();
                    return;
                }
                
                const iconColors = {
                    'member': 'from-green-500 to-emerald-600',
                    'project': 'from-blue-500 to-indigo-600',
                    'wiki': 'from-purple-500 to-violet-600',
                    'article': 'from-orange-500 to-amber-600',
                    'event': 'from-pink-500 to-rose-600',
                    'alert': 'from-red-500 to-rose-600',
                    'message': 'from-tec-blue to-indigo-600',
                    'achievement': 'from-amber-400 to-yellow-500',
                    'competition': 'from-purple-500 to-pink-500',
                    'application': 'from-amber-500 to-orange-600'
                };
                
                const now = new Date();
                container.innerHTML = NotificationSystem.notifications.map(n => {
                    const timeAgo = NotificationSystem.getTimeAgo(n.timestamp);
                    const bgClass = n.read ? 'bg-white' : 'bg-blue-50';
                    const onClickAction = n.type === 'application' ? 'Applications.show(); NotificationSystem.close();' : `NotificationSystem.markAsRead('${n.id}', '${n.type}')`;
                    
                    return `
                        <div class="${bgClass} border-b border-slate-100 p-4 hover:bg-slate-50 transition cursor-pointer" onclick="${onClickAction}">
                            <div class="flex items-start gap-3">
                                <div class="w-10 h-10 bg-gradient-to-br ${iconColors[n.type] || 'from-slate-500 to-slate-600'} rounded-xl flex items-center justify-center flex-shrink-0">
                                    <i data-lucide="${n.icon}" class="w-5 h-5 text-white"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between gap-2">
                                        <p class="font-bold text-slate-800 text-sm">${n.title}</p>
                                        ${!n.read ? '<span class="w-2 h-2 bg-blue-500 rounded-full flex-shrink-0"></span>' : ''}
                                    </div>
                                    <p class="text-slate-600 text-xs mt-0.5 line-clamp-2">${n.description}</p>
                                    <p class="text-slate-400 text-[10px] mt-1 flex items-center gap-1">
                                        <i data-lucide="clock" class="w-3 h-3"></i>
                                        ${timeAgo}
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                lucide.createIcons();
            },
            
            // Obtener tiempo transcurrido
            getTimeAgo: (date) => {
                const now = new Date();
                const diff = Math.floor((now - date) / 1000);
                
                if (diff < 60) return 'Ahora mismo';
                if (diff < 3600) return `Hace ${Math.floor(diff / 60)} min`;
                if (diff < 86400) return `Hace ${Math.floor(diff / 3600)} h`;
                if (diff < 604800) return `Hace ${Math.floor(diff / 86400)} d√≠as`;
                return date.toLocaleDateString('es-MX', { day: 'numeric', month: 'short' });
            },
            
            // Toggle panel
            toggle: () => {
                if (NotificationSystem.isOpen) {
                    NotificationSystem.close();
                } else {
                    NotificationSystem.open();
                }
            },
            
            // Abrir panel
            open: () => {
                NotificationSystem.isOpen = true;
                document.getElementById('notifications-panel')?.classList.remove('hidden');
                document.getElementById('notifications-overlay')?.classList.remove('hidden');
                NotificationSystem.render();
            },
            
            // Cerrar panel
            close: () => {
                NotificationSystem.isOpen = false;
                document.getElementById('notifications-panel')?.classList.add('hidden');
                document.getElementById('notifications-overlay')?.classList.add('hidden');
            },
            
            // Marcar como le√≠da
            markAsRead: (id, type) => {
                const notification = NotificationSystem.notifications.find(n => n.id === id && n.type === type);
                if (notification) {
                    notification.read = true;
                    NotificationSystem.updateBadge();
                    NotificationSystem.render();
                }
            },
            
            // Marcar todas como le√≠das
            markAllAsRead: () => {
                NotificationSystem.notifications.forEach(n => n.read = true);
                NotificationSystem.lastReadTimestamp = new Date();
                
                // Guardar timestamp en localStorage
                if (STATE.currentUser) {
                    localStorage.setItem(`notifications_read_${STATE.currentUser.uid}`, NotificationSystem.lastReadTimestamp.toISOString());
                }
                
                NotificationSystem.updateBadge();
                NotificationSystem.render();
                Util.notify('Todas marcadas como le√≠das', 'success');
            },
            
            // Limpiar todas
            clearAll: () => {
                NotificationSystem.notifications = [];
                NotificationSystem.lastReadTimestamp = new Date();
                
                if (STATE.currentUser) {
                    localStorage.setItem(`notifications_read_${STATE.currentUser.uid}`, NotificationSystem.lastReadTimestamp.toISOString());
                }
                
                NotificationSystem.updateBadge();
                NotificationSystem.render();
                NotificationSystem.close();
            },
            
            // Desconectar listeners
            disconnect: () => {
                NotificationSystem.unsubscribers.forEach(unsub => {
                    if (typeof unsub === 'function') unsub();
                });
                NotificationSystem.unsubscribers = [];
                NotificationSystem.notifications = [];
                NotificationSystem.isOpen = false;
                
                document.getElementById('notifications-btn')?.classList.add('hidden');
                document.getElementById('notifications-panel')?.classList.add('hidden');
                document.getElementById('notifications-overlay')?.classList.add('hidden');
            }
        };

        const Auth = {
            login: async (e) => {
                e.preventDefault();
                const em = document.getElementById('login-email').value;
                const pw = document.getElementById('login-pass').value;

                try {
                    Util.loading(true);
                    await auth.signInWithEmailAndPassword(em, pw);
                    Util.loading(false);
                    Modal.close('auth');
                    Util.notify("Acceso Autorizado", "success");
                    Router.to('dashboard');
                } catch (error) {
                    Util.loading(false);
                    Util.notify("Credenciales Incorrectas", "error");
                }
            },

            register: async (e) => {
                e.preventDefault();
                const code = document.getElementById('reg-code').value.trim().toUpperCase();
                const email = document.getElementById('reg-email').value.trim();
                const pass = document.getElementById('reg-pass').value;
                const name = document.getElementById('reg-name').value.trim() + ' ' + document.getElementById('reg-lastname').value.trim();

                // Validaci√≥n b√°sica
                if (!code || !email || !pass || !name.trim()) {
                    Util.notify('Por favor completa todos los campos', 'warning');
                    return;
                }

                if (pass.length < 6) {
                    Util.notify('La contrase√±a debe tener al menos 6 caracteres', 'warning');
                    return;
                }

                Util.loading(true, "Validando C√≥digo de Seguridad...");

                try {
                    // === VALIDACI√ìN DE C√ìDIGO ===
                    // C√≥digos v√°lidos por defecto (siempre funcionan)
                    const validDefaultCodes = ['CRAI2025', 'TECNM2025', 'CRAI2026'];
                    
                    let codeValid = false;
                    
                    // Primero verificar c√≥digos por defecto
                    if (validDefaultCodes.includes(code)) {
                        codeValid = true;
                        console.log('C√≥digo v√°lido (por defecto):', code);
                    } else {
                        // Buscar en Firestore
                        try {
                            const codeDoc = await db.collection('access_codes').doc(code).get();
                            if (codeDoc.exists) {
                                const codeData = codeDoc.data();
                                if (codeData.active !== false) {
                                    codeValid = true;
                                    console.log('C√≥digo v√°lido (Firestore):', code);
                                } else {
                                    throw new Error("Este c√≥digo ha expirado o est√° desactivado.");
                                }
                            }
                        } catch (firestoreError) {
                            console.log('Error buscando c√≥digo en Firestore:', firestoreError);
                        }
                    }

                    if (!codeValid) {
                        throw new Error("C√≥digo de acceso inv√°lido. Contacta al administrador.");
                    }

                    Util.loading(true, "Creando cuenta...");

                    // Crear usuario Auth
                    const userCred = await auth.createUserWithEmailAndPassword(email, pass);
                    await userCred.user.updateProfile({ displayName: name });

                    // Crear perfil en Firestore 'users'
                    await db.collection('users').doc(userCred.user.uid).set({
                        fullName: name,
                        email: email,
                        role: 'member', // Default role
                        bio: '',
                        photoURL: userCred.user.photoURL || '',
                        joinedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    Util.loading(false);
                    Modal.close('auth');
                    Util.notify("¬°Bienvenido al Club CRAI!", "success");
                    Router.to('dashboard');
                    Database.loadPublicMembers();

                } catch (error) {
                    Util.loading(false);
                    console.error('Error en registro:', error);
                    
                    // Mensajes de error m√°s amigables
                    let errorMsg = error.message;
                    if (error.code === 'auth/email-already-in-use') {
                        errorMsg = 'Este correo ya est√° registrado. Intenta iniciar sesi√≥n.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMsg = 'El correo electr√≥nico no es v√°lido.';
                    } else if (error.code === 'auth/weak-password') {
                        errorMsg = 'La contrase√±a es muy d√©bil. Usa al menos 6 caracteres.';
                    }
                    
                    Util.notify(errorMsg, "error");
                }
            },

            logout: async () => {
                // Marcar como offline antes de cerrar sesi√≥n
                if (STATE.currentUser) {
                    try {
                        await db.collection('presence').doc(STATE.currentUser.uid).update({ online: false });
                    } catch (e) {
                        console.log('No se pudo actualizar presencia:', e);
                    }
                }
                
                auth.signOut().then(() => {
                    Router.to('landing');
                    Util.notify("Sesi√≥n Finalizada", "info");
                });
            },

            loginWithGoogle: async () => {
                try {
                    Util.loading(true, "Conectando con Google...");
                    const provider = new firebase.auth.GoogleAuthProvider();
                    provider.addScope('email');
                    provider.addScope('profile');
                    
                    const result = await auth.signInWithPopup(provider);
                    const user = result.user;
                    
                    // Verificar si el usuario ya existe en Firestore
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    
                    if (!userDoc.exists) {
                        // Crear perfil para nuevo usuario de Google
                        await db.collection('users').doc(user.uid).set({
                            fullName: user.displayName || 'Usuario Google',
                            email: user.email,
                            role: 'member',
                            bio: '',
                            photoURL: user.photoURL || '',
                            joinedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        Database.loadPublicMembers();
                    }
                    
                    Util.loading(false);
                    Modal.close('auth');
                    Util.notify("¬°Bienvenido " + (user.displayName || 'Usuario') + "!", "success");
                    Router.to('dashboard');
                } catch (error) {
                    Util.loading(false);
                    console.error('Error en login con Google:', error);
                    console.error('C√≥digo de error:', error.code);
                    console.error('Mensaje:', error.message);
                    
                    let errorMsg = 'Error al iniciar sesi√≥n con Google';
                    if (error.code === 'auth/popup-closed-by-user') {
                        errorMsg = 'Inicio de sesi√≥n cancelado';
                    } else if (error.code === 'auth/popup-blocked') {
                        errorMsg = 'El navegador bloque√≥ la ventana emergente. Permite las ventanas emergentes e intenta de nuevo.';
                    } else if (error.code === 'auth/unauthorized-domain') {
                        errorMsg = 'Este dominio no est√° autorizado. Contacta al administrador.';
                    } else if (error.code === 'auth/operation-not-allowed') {
                        errorMsg = 'Google Sign-In no est√° habilitado en Firebase. Contacta al administrador.';
                    } else if (error.code === 'auth/cancelled-popup-request') {
                        errorMsg = 'Se cancel√≥ la solicitud de inicio de sesi√≥n';
                    } else if (error.code === 'auth/network-request-failed') {
                        errorMsg = 'Error de conexi√≥n. Verifica tu internet.';
                    }
                    
                    Util.notify(errorMsg, "error");
                }
            },

            toggleView: (view) => {
                const loginView = document.getElementById('auth-view-login');
                const regView = document.getElementById('auth-view-register');
                
                // Animation Slide Logic
                if (view === 'register') {
                    loginView.style.display = 'none';
                    regView.style.display = 'block';
                    regView.classList.add('animate-pulse-once'); // Simple visual cue
                } else {
                    regView.style.display = 'none';
                    loginView.style.display = 'block';
                }
            },

            toggleProfile: () => {
                Router.to('dashboard');
            }
        };

        /**
         * ==========================================
         * 4. CMS MANAGER (Content Management System)
         * ==========================================
         */
        const CMS = {
            // Fetch content from 'site_content' collection
            loadContent: async () => {
                try {
                    const doc = await db.collection('site_content').doc('general').get();
                    if (doc.exists) {
                        const data = doc.data();
                        CMS.hydrateDOM(data);
                    } else {
                        // First run: Upload defaults silently if user is admin, else use defaults
                        CMS.hydrateDOM(SYS_CONFIG.defaults);
                    }
                } catch (e) {
                    console.warn("CMS Offline: usando defaults.");
                    CMS.hydrateDOM(SYS_CONFIG.defaults);
                }
            },

            hydrateDOM: (data) => {
                // Helper safe set
                const setText = (id, val) => { const el = document.getElementById(id); if(el && val) el.innerText = val; };
                const setHtml = (id, val) => { const el = document.getElementById(id); if(el && val) el.innerHTML = val; };
                const setHref = (id, val) => { const el = document.getElementById(id); if(el && val) el.href = val; };

                // El t√≠tulo es fijo, solo actualizamos descripci√≥n
                if (data.heroDesc) setText('cms-hero-desc', data.heroDesc);
                if (data.bankInfo) setText('cms-bank-account', data.bankInfo);
                
                // Wishlist links
                if (data.wishlistLink) {
                    setHref('wishlist-btn-1', data.wishlistLink);
                    setHref('wishlist-btn-2', data.wishlistLink);
                }
                
                // Stats
                if (data.stats) {
                    setText('cms-stat-1', data.stats.s1);
                    setText('cms-stat-2', data.stats.s2);
                    setText('cms-stat-3', data.stats.s3);
                }

                // Populate Editor Inputs if modal is loaded
                const inpDesc = document.getElementById('cms-input-hero-desc');
                if (inpDesc) {
                    inpDesc.value = data.heroDesc || '';
                    document.getElementById('cms-input-bank').value = data.bankInfo || '';
                    const wishlistInput = document.getElementById('cms-input-wishlist');
                    if (wishlistInput) wishlistInput.value = data.wishlistLink || '';
                }
            },

            saveChanges: async () => {
                if (!STATE.currentUser) return;
                
                // Verificar que solo el superadmin pueda guardar cambios
                const SUPER_ADMIN_EMAIL = 'a23490819@itmexicali.edu.mx';
                if (STATE.currentUser.email !== SUPER_ADMIN_EMAIL && STATE.profile?.role !== 'admin') {
                    Util.notify('No tienes permisos para editar el contenido', 'error');
                    return;
                }
                
                Util.loading(true, "Actualizando Plataforma...");
                
                const payload = {
                    heroDesc: document.getElementById('cms-input-hero-desc').value,
                    bankInfo: document.getElementById('cms-input-bank').value,
                    wishlistLink: document.getElementById('cms-input-wishlist').value,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedBy: STATE.currentUser.email
                };

                try {
                    await db.collection('site_content').doc('general').set(payload, { merge: true });
                    CMS.hydrateDOM(payload); // Reflect instant changes
                    Util.loading(false);
                    Modal.close('cms');
                    Util.notify("Sitio Actualizado con √âxito", "success");
                } catch (e) {
                    Util.loading(false);
                    Util.notify("Error al guardar CMS", "error");
                }
            }
        };

        /**
         * ==========================================
         * 4.5 UTILIDADES GENERALES
         * ==========================================
         */
        const Util = {
            // Escapar HTML para prevenir XSS
            escapeHtml: (text) => {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            },
            loading: (show, msg = "Procesando...") => {
                if (show) {
                    Swal.fire({
                        title: msg,
                        didOpen: () => Swal.showLoading(),
                        allowOutsideClick: false,
                        showConfirmButton: false,
                        backdrop: `rgba(27, 57, 106, 0.4)`
                    });
                } else {
                    Swal.close();
                }
            },
            notify: (msg, icon = 'success') => {
                Swal.fire({
                    toast: true, position: 'top-end',
                    icon: icon, title: msg,
                    showConfirmButton: false, timer: 3000
                });
            },
            // Funci√≥n para enviar correo (funciona en PC y m√≥vil)
            sendEmail: (to, subject = '', body = '') => {
                const mailtoLink = `mailto:${to}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                
                // Intentar abrir mailto
                const mailWindow = window.open(mailtoLink, '_self');
                
                // Despu√©s de un breve delay, ofrecer alternativas
                setTimeout(() => {
                    Swal.fire({
                        title: '¬øNo se abri√≥ tu correo?',
                        html: `
                            <p class="text-sm text-slate-600 mb-4">Si no tienes un cliente de correo configurado, puedes:</p>
                            <div class="space-y-3">
                                <a href="https://mail.google.com/mail/?view=cm&to=${to}&su=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}" target="_blank" class="block w-full py-3 px-4 bg-red-500 hover:bg-red-600 text-white rounded-lg font-bold text-sm transition">
                                    <i class="mr-2">üìß</i> Abrir en Gmail
                                </a>
                                <a href="https://outlook.live.com/mail/0/deeplink/compose?to=${to}&subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}" target="_blank" class="block w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold text-sm transition">
                                    <i class="mr-2">üìß</i> Abrir en Outlook
                                </a>
                                <button onclick="navigator.clipboard.writeText('${to}'); Swal.fire({toast:true,position:'top-end',icon:'success',title:'Correo copiado',showConfirmButton:false,timer:2000})" class="block w-full py-3 px-4 bg-slate-600 hover:bg-slate-700 text-white rounded-lg font-bold text-sm transition">
                                    <i class="mr-2">üìã</i> Copiar correo: ${to}
                                </button>
                            </div>
                        `,
                        showConfirmButton: false,
                        showCloseButton: true,
                        customClass: {
                            popup: 'rounded-2xl'
                        }
                    });
                }, 500);
            },
            // Funci√≥n para abrir wishlist
            openWishlist: () => {
                const btn1 = document.getElementById('wishlist-btn-1');
                const link = btn1 ? btn1.href : null;
                
                if (!link || link === '#' || link.endsWith('/#') || link === window.location.href || link === window.location.href + '#') {
                    Swal.fire({
                        icon: 'info',
                        title: 'Lista de Deseos',
                        html: `
                            <p class="text-sm text-slate-600 mb-4">La lista de deseos a√∫n no ha sido configurada.</p>
                            <p class="text-xs text-slate-500">Si eres administrador, puedes configurarla desde el Dashboard ‚Üí Editar Contenido.</p>
                        `,
                        confirmButtonText: 'Entendido',
                        confirmButtonColor: '#D4AF37'
                    });
                } else {
                    window.open(link, '_blank');
                }
            },
            fakePayPal: () => {
                Util.loading(true, "Conectando PayPal...");
                setTimeout(() => {
                    Util.loading(false);
                    Swal.fire("Demo Finalizada", "En un entorno real, aqu√≠ se abrir√≠a la pasarela de pago segura SSL.", "info");
                }, 1500);
            },
            // Convertir archivo a Base64
            fileToBase64: (file) => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            },
            // Obtener icono seg√∫n extensi√≥n de archivo
            getFileIcon: (filename) => {
                const ext = filename.split('.').pop().toLowerCase();
                const icons = {
                    'pdf': 'file-text',
                    'doc': 'file-text',
                    'docx': 'file-text',
                    'xlsx': 'file-spreadsheet',
                    'xls': 'file-spreadsheet',
                    'dwg': 'pen-tool',
                    'dxf': 'pen-tool',
                    'step': 'box',
                    'stp': 'box',
                    'stl': 'box',
                    'obj': 'box',
                    'iges': 'box',
                    'igs': 'box',
                    'zip': 'file-archive',
                    'rar': 'file-archive',
                    '7z': 'file-archive'
                };
                return icons[ext] || 'file';
            },
            // Formatear tama√±o de archivo
            formatFileSize: (bytes) => {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            },
            // Descargar archivo desde Base64 (compatible con m√≥viles)
            downloadFile: (base64Data, filename, mimeType) => {
                try {
                    // Detectar si es m√≥vil
                    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                    
                    // Extraer solo la parte de datos del Base64 (sin el prefijo data:...)
                    const base64Content = base64Data.includes(',') ? base64Data.split(',')[1] : base64Data;
                    
                    // Convertir Base64 a Blob
                    const byteCharacters = atob(base64Content);
                    const byteNumbers = new Array(byteCharacters.length);
                    for (let i = 0; i < byteCharacters.length; i++) {
                        byteNumbers[i] = byteCharacters.charCodeAt(i);
                    }
                    const byteArray = new Uint8Array(byteNumbers);
                    const blob = new Blob([byteArray], { type: mimeType || 'application/octet-stream' });
                    
                    // Crear URL del Blob
                    const blobUrl = URL.createObjectURL(blob);
                    
                    if (isMobile) {
                        // En m√≥viles, abrir en nueva ventana/pesta√±a
                        // Esto permite que el navegador maneje la descarga nativamente
                        const newWindow = window.open(blobUrl, '_blank');
                        
                        // Si el popup fue bloqueado, intentar con link directo
                        if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
                            const link = document.createElement('a');
                            link.href = blobUrl;
                            link.download = filename;
                            link.target = '_blank';
                            link.rel = 'noopener noreferrer';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            
                            // Usar timeout para dar tiempo al navegador
                            setTimeout(() => {
                                link.click();
                                setTimeout(() => {
                                    document.body.removeChild(link);
                                    URL.revokeObjectURL(blobUrl);
                                }, 1000);
                            }, 100);
                        } else {
                            // Limpiar despu√©s de un tiempo
                            setTimeout(() => URL.revokeObjectURL(blobUrl), 60000);
                        }
                    } else {
                        // En desktop, usar el m√©todo tradicional con Blob
                        const link = document.createElement('a');
                        link.href = blobUrl;
                        link.download = filename;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        // Limpiar URL despu√©s de la descarga
                        setTimeout(() => URL.revokeObjectURL(blobUrl), 1000);
                    }
                    
                    Util.notify(`Descargando ${filename}`, 'success');
                } catch (error) {
                    console.error('Error al descargar archivo:', error);
                    Util.notify('Error al descargar el archivo. Intenta de nuevo.', 'error');
                }
            }
        };

        /**
         * ==========================================
         * 5. DATABASE & LOGIC SERVICE
         * ==========================================
         */
        
        // Sistema de Filtrado y Vista de Proyectos
        const ProjectsFilter = {
            allProjects: [],
            filteredProjects: [],
            tasksByProject: {}, // Mapa de tareas por proyecto para calcular progreso
            competitionsCache: {}, // Cache de competencias para mostrar insignias
            currentCategory: 'all',
            currentSort: 'newest',
            currentView: 'grid',
            searchTerm: '',
            statusFilter: 'all', // 'all', 'in_progress', 'completed'
            
            // Calcular progreso de un proyecto
            getProjectProgress: (projectId, projectData = null) => {
                const tasks = ProjectsFilter.tasksByProject[projectId] || [];
                
                // Si hay tareas, calcular el progreso autom√°ticamente
                if (tasks.length > 0) {
                    const done = tasks.filter(t => t.status === 'done').length;
                    return {
                        total: tasks.length,
                        done: done,
                        percent: Math.round((done / tasks.length) * 100),
                        isManual: false
                    };
                }
                
                // Si no hay tareas pero hay porcentaje manual, usarlo
                if (projectData && projectData.manualProgress !== undefined) {
                    const manualPercent = parseInt(projectData.manualProgress) || 0;
                    return {
                        total: 0,
                        done: 0,
                        percent: manualPercent,
                        isManual: true
                    };
                }
                
                return { total: 0, done: 0, percent: 0, isManual: false };
            },
            
            init: () => {
                // Event listener para b√∫squeda
                const searchInput = document.getElementById('project-search');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        ProjectsFilter.searchTerm = e.target.value.toLowerCase();
                        const clearBtn = document.getElementById('clear-search-btn');
                        if (clearBtn) {
                            clearBtn.classList.toggle('hidden', !ProjectsFilter.searchTerm);
                        }
                        ProjectsFilter.applyFilters();
                    });
                }
            },
            
            setCategory: (category) => {
                ProjectsFilter.currentCategory = category;
                
                // Actualizar UI de botones
                document.querySelectorAll('.category-filter-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.category === category);
                });
                
                ProjectsFilter.applyFilters();
            },
            
            setStatusFilter: (status) => {
                ProjectsFilter.statusFilter = status;
                
                // Actualizar UI de botones
                document.querySelectorAll('.status-filter-btn').forEach(btn => {
                    btn.classList.remove('bg-emerald-600', 'text-white', 'bg-slate-600');
                    btn.classList.add('bg-slate-100', 'text-slate-600');
                });
                
                const activeBtn = document.querySelector(`.status-filter-btn[data-status="${status}"]`);
                if (activeBtn) {
                    activeBtn.classList.remove('bg-slate-100', 'text-slate-600');
                    if (status === 'in_progress') {
                        activeBtn.classList.add('bg-emerald-600', 'text-white');
                    } else if (status === 'completed') {
                        activeBtn.classList.add('bg-slate-600', 'text-white');
                    } else {
                        activeBtn.classList.add('bg-tec-blue', 'text-white');
                    }
                }
                
                ProjectsFilter.applyFilters();
            },
            
            sort: (sortBy) => {
                ProjectsFilter.currentSort = sortBy;
                ProjectsFilter.applyFilters();
            },
            
            setView: (view) => {
                ProjectsFilter.currentView = view;
                
                // Actualizar UI de botones
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.view === view);
                });
                
                ProjectsFilter.renderProjects();
            },
            
            clearSearch: () => {
                const searchInput = document.getElementById('project-search');
                if (searchInput) {
                    searchInput.value = '';
                    ProjectsFilter.searchTerm = '';
                    document.getElementById('clear-search-btn')?.classList.add('hidden');
                    ProjectsFilter.applyFilters();
                }
            },
            
            reset: () => {
                ProjectsFilter.currentCategory = 'all';
                ProjectsFilter.currentSort = 'newest';
                ProjectsFilter.searchTerm = '';
                ProjectsFilter.statusFilter = 'all';
                
                const searchInput = document.getElementById('project-search');
                if (searchInput) searchInput.value = '';
                document.getElementById('clear-search-btn')?.classList.add('hidden');
                document.getElementById('project-sort').value = 'newest';
                
                document.querySelectorAll('.category-filter-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.category === 'all');
                });
                
                // Reset status filter buttons
                document.querySelectorAll('.status-filter-btn').forEach(btn => {
                    btn.classList.remove('bg-emerald-600', 'text-white', 'bg-slate-600', 'bg-tec-blue');
                    btn.classList.add('bg-slate-100', 'text-slate-600');
                });
                const allStatusBtn = document.querySelector('.status-filter-btn[data-status="all"]');
                if (allStatusBtn) {
                    allStatusBtn.classList.remove('bg-slate-100', 'text-slate-600');
                    allStatusBtn.classList.add('bg-tec-blue', 'text-white');
                }
                
                ProjectsFilter.applyFilters();
            },
            
            applyFilters: () => {
                let filtered = [...ProjectsFilter.allProjects];
                
                // Filtrar por estado
                if (ProjectsFilter.statusFilter !== 'all') {
                    filtered = filtered.filter(p => {
                        if (ProjectsFilter.statusFilter === 'in_progress') {
                            return p.data.status === 'in_progress';
                        } else if (ProjectsFilter.statusFilter === 'completed') {
                            return p.data.status !== 'in_progress' || !p.data.status;
                        }
                        return true;
                    });
                }
                
                // Filtrar por categor√≠a
                if (ProjectsFilter.currentCategory !== 'all') {
                    filtered = filtered.filter(p => 
                        p.data.category && p.data.category.toLowerCase().includes(ProjectsFilter.currentCategory.toLowerCase())
                    );
                }
                
                // Filtrar por b√∫squeda
                if (ProjectsFilter.searchTerm) {
                    filtered = filtered.filter(p => {
                        const data = p.data;
                        return (
                            (data.title && data.title.toLowerCase().includes(ProjectsFilter.searchTerm)) ||
                            (data.desc && data.desc.toLowerCase().includes(ProjectsFilter.searchTerm)) ||
                            (data.category && data.category.toLowerCase().includes(ProjectsFilter.searchTerm)) ||
                            (data.authorName && data.authorName.toLowerCase().includes(ProjectsFilter.searchTerm))
                        );
                    });
                }
                
                // Ordenar
                switch (ProjectsFilter.currentSort) {
                    case 'newest':
                        filtered.sort((a, b) => (b.data.date?.seconds || 0) - (a.data.date?.seconds || 0));
                        break;
                    case 'oldest':
                        filtered.sort((a, b) => (a.data.date?.seconds || 0) - (b.data.date?.seconds || 0));
                        break;
                    case 'name':
                        filtered.sort((a, b) => (a.data.title || '').localeCompare(b.data.title || ''));
                        break;
                }
                
                ProjectsFilter.filteredProjects = filtered;
                ProjectsFilter.renderProjects();
            },
            
            loadMore: () => {
                // Por ahora cargamos todos, pero podr√≠amos implementar paginaci√≥n
                Util.notify("Todos los proyectos ya est√°n cargados", "info");
            },
            
            getCategoryIcon: (category) => {
                const icons = {
                    'combate': 'sword',
                    'dron': 'plane',
                    'drones': 'plane',
                    'industrial': 'factory',
                    'autonomo': 'bot',
                    'aut√≥nomo': 'bot',
                    'software': 'code',
                    'electronica': 'cpu',
                    'mecanico': 'cog'
                };
                const cat = (category || '').toLowerCase();
                for (let key in icons) {
                    if (cat.includes(key)) return icons[key];
                }
                return 'cpu';
            },
            
            getCategoryColor: (category) => {
                const colors = {
                    'combate': { bg: 'bg-red-500', text: 'text-red-600', light: 'bg-red-50' },
                    'dron': { bg: 'bg-sky-500', text: 'text-sky-600', light: 'bg-sky-50' },
                    'drones': { bg: 'bg-sky-500', text: 'text-sky-600', light: 'bg-sky-50' },
                    'industrial': { bg: 'bg-orange-500', text: 'text-orange-600', light: 'bg-orange-50' },
                    'autonomo': { bg: 'bg-purple-500', text: 'text-purple-600', light: 'bg-purple-50' },
                    'aut√≥nomo': { bg: 'bg-purple-500', text: 'text-purple-600', light: 'bg-purple-50' },
                    'software': { bg: 'bg-green-500', text: 'text-green-600', light: 'bg-green-50' },
                    'electronica': { bg: 'bg-yellow-500', text: 'text-yellow-600', light: 'bg-yellow-50' },
                    'mecanico': { bg: 'bg-slate-500', text: 'text-slate-600', light: 'bg-slate-50' }
                };
                const cat = (category || '').toLowerCase();
                for (let key in colors) {
                    if (cat.includes(key)) return colors[key];
                }
                return { bg: 'bg-tec-blue', text: 'text-tec-blue', light: 'bg-blue-50' };
            },
            
            // Obtener informaci√≥n de competencia asociada al proyecto
            getCompetitionInfo: (competitionId) => {
                if (!competitionId || !ProjectsFilter.competitionsCache) return null;
                return ProjectsFilter.competitionsCache[competitionId] || null;
            },
            
            // Generar HTML de la insignia de torneo
            renderTournamentBadge: (competitionId, size = 'normal') => {
                const comp = ProjectsFilter.getCompetitionInfo(competitionId);
                if (!comp) return '';
                
                const dateStr = comp.dateStart ? new Date(comp.dateStart).toLocaleDateString('es-MX', { month: 'short', year: 'numeric' }) : '';
                
                if (size === 'small') {
                    return `
                        <a href="${comp.link || '#'}" ${comp.link ? 'target="_blank"' : ''} onclick="event.stopPropagation();" 
                           class="tournament-badge-small px-3 py-1.5 rounded-lg text-white text-[10px] font-bold flex items-center gap-1.5 hover:scale-105 transition-transform cursor-pointer" 
                           title="Competencia: ${comp.name}">
                            <i data-lucide="trophy" class="w-3 h-3"></i>
                            <span class="truncate max-w-[120px]">${comp.name}</span>
                        </a>
                    `;
                }
                
                return `
                    <a href="${comp.link || '#'}" ${comp.link ? 'target="_blank"' : ''} onclick="event.stopPropagation();" 
                       class="tournament-badge px-4 py-2.5 rounded-xl text-white font-bold flex items-center gap-2 transition-all cursor-pointer" 
                       title="Ir a ${comp.name}">
                        <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i data-lucide="trophy" class="w-4 h-4"></i>
                        </div>
                        <div class="text-left">
                            <p class="text-xs font-black leading-tight">${comp.name}</p>
                            <p class="text-[9px] opacity-80">${dateStr}${comp.location ? ' ‚Ä¢ ' + comp.location : ''}</p>
                        </div>
                        <i data-lucide="external-link" class="w-3.5 h-3.5 opacity-70 ml-1"></i>
                    </a>
                `;
            },
            
            renderProjects: () => {
                const grid = document.getElementById('public-projects-grid');
                const noProjectsMsg = document.getElementById('no-projects-message');
                const resultsCount = document.getElementById('results-count');
                const featuredContainer = document.getElementById('featured-project-container');
                const featuredProject = document.getElementById('featured-project');
                
                if (!grid) return;
                
                const projects = ProjectsFilter.filteredProjects;
                
                // Actualizar contador
                if (resultsCount) {
                    if (ProjectsFilter.searchTerm || ProjectsFilter.currentCategory !== 'all') {
                        resultsCount.textContent = `${projects.length} proyecto${projects.length !== 1 ? 's' : ''} encontrado${projects.length !== 1 ? 's' : ''}`;
                    } else {
                        resultsCount.textContent = `Mostrando ${projects.length} proyecto${projects.length !== 1 ? 's' : ''}`;
                    }
                }
                
                // Mostrar/ocultar mensaje de vac√≠o
                if (projects.length === 0) {
                    grid.classList.add('hidden');
                    noProjectsMsg?.classList.remove('hidden');
                    featuredContainer?.classList.add('hidden');
                    return;
                }
                
                grid.classList.remove('hidden');
                noProjectsMsg?.classList.add('hidden');
                
                // Mostrar proyecto destacado (solo si no hay filtros activos)
                if (featuredContainer && featuredProject && !ProjectsFilter.searchTerm && ProjectsFilter.currentCategory === 'all' && projects.length > 0) {
                    const featured = projects[0]; // El m√°s reciente
                    const fp = featured.data;
                    const fpId = featured.id;
                    const hasFiles = fp.privateFiles && fp.privateFiles.length > 0;
                    const filesCount = fp.privateFiles?.length || 0;
                    const categoryIcon = ProjectsFilter.getCategoryIcon(fp.category);
                    const dateStr = fp.date ? new Date(fp.date.seconds * 1000).toLocaleDateString('es-MX', { year: 'numeric', month: 'long' }) : '';
                    
                    // Calcular progreso del proyecto destacado
                    const fpIsInProgress = fp.status === 'in_progress';
                    const fpProgress = ProjectsFilter.getProjectProgress(fpId, fp);
                    const fpIsCompleted = !fpIsInProgress && fpProgress.percent === 100;
                    const fpDisplayPercent = fpIsCompleted ? 100 : (fpIsInProgress ? fpProgress.percent : 100);
                    
                    featuredProject.innerHTML = `
                        <div class="grid lg:grid-cols-2 gap-0">
                            <!-- Lado izquierdo - Info -->
                            <div class="p-10 lg:p-14 flex flex-col justify-center relative">
                                <div class="absolute top-0 left-0 w-full h-full opacity-10">
                                    <svg class="w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none">
                                        <defs>
                                            <pattern id="featured-grid" width="10" height="10" patternUnits="userSpaceOnUse">
                                                <circle cx="1" cy="1" r="0.5" fill="white"/>
                                            </pattern>
                                        </defs>
                                        <rect width="100%" height="100%" fill="url(#featured-grid)"/>
                                    </svg>
                                </div>
                                
                                <div class="relative z-10">
                                    <div class="flex items-center gap-3 mb-6">
                                        <span class="px-4 py-2 bg-tec-gold text-tec-dark rounded-full text-xs font-bold uppercase tracking-wider flex items-center gap-2">
                                            <i data-lucide="star" class="w-4 h-4"></i> Proyecto Destacado
                                        </span>
                                        <span class="px-3 py-2 bg-white/20 backdrop-blur text-white rounded-full text-xs font-bold">
                                            ${fp.category || 'General'}
                                        </span>
                                    </div>
                                    
                                    <h3 class="text-3xl lg:text-4xl font-black text-white mb-4 leading-tight">${fp.title}</h3>
                                    <p class="text-blue-100 text-lg leading-relaxed mb-6 line-clamp-3">${fp.desc}</p>
                                    
                                    <div class="flex flex-wrap items-center gap-4 text-sm text-blue-200 mb-8">
                                        <span class="flex items-center gap-2">
                                            <i data-lucide="user" class="w-4 h-4"></i> ${fp.authorName || 'An√≥nimo'}
                                        </span>
                                        ${dateStr ? `<span class="flex items-center gap-2"><i data-lucide="calendar" class="w-4 h-4"></i> ${dateStr}</span>` : ''}
                                        ${hasFiles ? `<span class="flex items-center gap-2 text-tec-gold"><i data-lucide="paperclip" class="w-4 h-4"></i> ${filesCount} archivos</span>` : ''}
                                    </div>
                                    
                                    ${fp.competitionId ? `
                                    <div class="mb-6">
                                        ${ProjectsFilter.renderTournamentBadge(fp.competitionId, 'normal')}
                                    </div>
                                    ` : ''}
                                    
                                    <div class="flex flex-wrap gap-4">
                                        <button onclick="Database.showProjectDetail('${fpId}')" class="px-8 py-4 bg-white text-tec-blue rounded-xl font-bold hover:bg-tec-gold hover:text-tec-dark transition-all duration-300 flex items-center gap-2 shadow-lg">
                                            <i data-lucide="eye" class="w-5 h-5"></i> Ver Detalles
                                        </button>
                                        ${fp.link ? `<a href="${fp.link}" target="_blank" class="px-8 py-4 bg-white/10 backdrop-blur text-white border border-white/20 rounded-xl font-bold hover:bg-white/20 transition-all duration-300 flex items-center gap-2">
                                            <i data-lucide="external-link" class="w-5 h-5"></i> Repositorio
                                        </a>` : ''}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Lado derecho - Visual -->
                            <div class="relative min-h-[300px] lg:min-h-0 ${fpIsInProgress ? 'bg-gradient-to-br from-emerald-500 to-teal-600' : (fpIsCompleted ? 'bg-gradient-to-br from-amber-500 to-orange-600' : 'bg-gradient-to-br from-indigo-600 to-purple-700')} flex items-center justify-center overflow-hidden">
                                <div class="absolute inset-0 opacity-30">
                                    <div class="absolute top-10 right-10 w-40 h-40 border-4 border-white/30 rounded-full"></div>
                                    <div class="absolute bottom-10 left-10 w-24 h-24 border-4 border-white/30 rounded-full"></div>
                                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-72 h-72 border-4 border-white/10 rounded-full"></div>
                                </div>
                                
                                <div class="relative z-10 text-center px-6">
                                    <div class="w-32 h-32 bg-white/20 backdrop-blur rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-2xl animate-float">
                                        <i data-lucide="${fpIsCompleted ? 'trophy' : categoryIcon}" class="w-16 h-16 text-white"></i>
                                    </div>
                                    
                                    ${fpIsCompleted ? `
                                    <!-- Insignia de Proyecto Completado -->
                                    <div class="inline-flex items-center gap-2 bg-white/20 backdrop-blur px-5 py-3 rounded-full text-white font-bold mb-4">
                                        <i data-lucide="award" class="w-5 h-5 text-amber-200"></i>
                                        <span class="text-lg">Proyecto Completado</span>
                                        <i data-lucide="check-circle" class="w-5 h-5 text-green-300"></i>
                                    </div>
                                    <div class="max-w-xs mx-auto">
                                        <div class="flex items-center justify-between text-white mb-2">
                                            <span class="text-sm font-medium">Progreso Total</span>
                                            <span class="text-2xl font-black">100%</span>
                                        </div>
                                        <div class="h-4 bg-white/30 rounded-full overflow-hidden shadow-inner">
                                            <div class="h-full bg-gradient-to-r from-amber-300 to-yellow-400 rounded-full w-full"></div>
                                        </div>
                                        <p class="text-amber-100 text-sm mt-2 font-medium flex items-center justify-center gap-2">
                                            <i data-lucide="sparkles" class="w-4 h-4"></i>
                                            ¬°Todas las tareas completadas!
                                        </p>
                                    </div>
                                    ` : fpIsInProgress ? `
                                    <!-- Estado En Proceso con Barra de Progreso -->
                                    <div class="inline-flex items-center gap-2 bg-white/20 backdrop-blur px-4 py-2 rounded-full text-white text-sm mb-4">
                                        <div class="w-2 h-2 bg-green-300 rounded-full animate-pulse"></div>
                                        Proyecto Activo
                                    </div>
                                    <div class="max-w-xs mx-auto">
                                        <div class="flex items-center justify-between text-white mb-2">
                                            <span class="text-sm font-medium">Progreso</span>
                                            <span class="text-2xl font-black">${fpProgress.percent}%</span>
                                        </div>
                                        <div class="h-4 bg-white/30 rounded-full overflow-hidden shadow-inner">
                                            <div class="h-full bg-white rounded-full transition-all duration-500 shadow-lg" style="width: ${fpProgress.percent}%"></div>
                                        </div>
                                        <p class="text-emerald-100 text-sm mt-2 font-medium">${fpProgress.done} de ${fpProgress.total} tareas</p>
                                    </div>
                                    ` : `
                                    <!-- Proyecto Normal -->
                                    <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur px-4 py-2 rounded-full text-white text-sm">
                                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                        Proyecto Activo
                                    </div>
                                    `}
                                </div>
                            </div>
                        </div>
                    `;
                    featuredContainer.classList.remove('hidden');
                } else {
                    featuredContainer?.classList.add('hidden');
                }
                
                // Cambiar clase del grid seg√∫n vista
                if (ProjectsFilter.currentView === 'list') {
                    grid.className = 'flex flex-col gap-4 transition-all duration-300';
                } else {
                    grid.className = 'grid md:grid-cols-2 lg:grid-cols-3 gap-8 transition-all duration-300';
                }
                
                let html = '';
                
                // Determinar si hay un proyecto destacado mostrado
                const hasFeatured = !ProjectsFilter.searchTerm && ProjectsFilter.currentCategory === 'all' && projects.length > 0;
                const projectsToRender = hasFeatured ? projects.slice(1) : projects; // Excluir el primero si est√° destacado
                
                projectsToRender.forEach((project, index) => {
                    const p = project.data;
                    const projectId = project.id;
                    const hasFiles = p.hasPrivateFiles || (p.privateFiles && p.privateFiles.length > 0);
                    const filesCount = p.privateFiles?.length || 0;
                    const categoryIcon = ProjectsFilter.getCategoryIcon(p.category);
                    const categoryColor = ProjectsFilter.getCategoryColor(p.category);
                    const dateStr = p.date ? new Date(p.date.seconds * 1000).toLocaleDateString('es-MX', { year: 'numeric', month: 'short' }) : '';
                    
                    // Calcular progreso y estado del proyecto
                    const isInProgress = p.status === 'in_progress';
                    const progress = ProjectsFilter.getProjectProgress(projectId, p);
                    const isCompleted = !isInProgress && progress.percent === 100;
                    
                    if (ProjectsFilter.currentView === 'list') {
                        // Vista de Lista
                        html += `
                        <div class="project-list-item bg-white rounded-2xl p-5 cursor-pointer group ${isInProgress ? 'ring-2 ring-emerald-200' : (isCompleted ? 'ring-2 ring-amber-200' : '')}" onclick="Database.showProjectDetail('${projectId}')">
                            <div class="flex flex-col md:flex-row md:items-center gap-4">
                                <!-- Icono/Preview -->
                                <div class="w-20 h-20 ${isInProgress ? 'bg-emerald-100' : (isCompleted ? 'bg-amber-100' : categoryColor.light)} rounded-xl flex items-center justify-center flex-shrink-0 relative">
                                    <i data-lucide="${isCompleted ? 'trophy' : categoryIcon}" class="w-10 h-10 ${isInProgress ? 'text-emerald-600' : (isCompleted ? 'text-amber-600' : categoryColor.text)} group-hover:scale-110 transition duration-300"></i>
                                    ${isInProgress ? '<span class="absolute -top-1 -right-1 w-4 h-4 bg-emerald-500 rounded-full animate-pulse"></span>' : ''}
                                    ${isCompleted ? '<span class="absolute -top-1 -right-1 w-5 h-5 bg-amber-500 rounded-full flex items-center justify-center"><i data-lucide="check" class="w-3 h-3 text-white"></i></span>' : ''}
                                </div>
                                
                                <!-- Info Principal -->
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-start justify-between gap-4">
                                        <div class="min-w-0">
                                            <div class="flex items-center gap-2 mb-1 flex-wrap">
                                                <span class="px-2 py-1 ${categoryColor.light} ${categoryColor.text} rounded-full text-[10px] font-bold uppercase tracking-wide">
                                                    ${p.category || 'General'}
                                                </span>
                                                ${isInProgress ? `<span class="px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full text-[10px] font-bold flex items-center gap-1"><i data-lucide="activity" class="w-3 h-3"></i> En Proceso ${progress.percent}%${progress.isManual ? ' (manual)' : ''}</span>` : ''}
                                                ${isCompleted ? `<span class="px-2 py-1 bg-amber-100 text-amber-700 rounded-full text-[10px] font-bold flex items-center gap-1"><i data-lucide="award" class="w-3 h-3"></i> Completado 100%</span>` : ''}
                                                ${hasFiles ? `<span class="px-2 py-1 bg-tec-gold/10 text-tec-gold rounded-full text-[10px] font-bold flex items-center gap-1"><i data-lucide="file" class="w-3 h-3"></i> ${filesCount} archivo${filesCount !== 1 ? 's' : ''}</span>` : ''}
                                                ${p.competitionId ? ProjectsFilter.renderTournamentBadge(p.competitionId, 'small') : ''}
                                            </div>
                                            <h3 class="font-bold text-lg text-tec-dark group-hover:text-tec-blue transition truncate">${p.title}</h3>
                                            <p class="text-sm text-slate-500 line-clamp-1 mt-1">${p.desc}</p>
                                            ${isInProgress && (progress.total > 0 || progress.isManual) ? `
                                            <div class="mt-2 flex items-center gap-2">
                                                <div class="flex-1 h-1.5 bg-slate-200 rounded-full overflow-hidden max-w-[200px]">
                                                    <div class="h-full bg-emerald-500 rounded-full transition-all" style="width: ${progress.percent}%"></div>
                                                </div>
                                                <span class="text-[10px] text-emerald-600 font-bold">${progress.isManual ? progress.percent + '%' : progress.done + '/' + progress.total}</span>
                                            </div>` : ''}
                                            ${isCompleted ? `
                                            <div class="mt-2 flex items-center gap-2">
                                                <div class="flex-1 h-1.5 bg-amber-200 rounded-full overflow-hidden max-w-[200px]">
                                                    <div class="h-full bg-amber-500 rounded-full" style="width: 100%"></div>
                                                </div>
                                                <span class="text-[10px] text-amber-600 font-bold flex items-center gap-1"><i data-lucide="check-circle" class="w-3 h-3"></i> Completo</span>
                                            </div>` : ''}
                                        </div>
                                        
                                        <!-- Meta -->
                                        <div class="hidden md:flex flex-col items-end gap-2 flex-shrink-0">
                                            <span class="text-xs text-slate-400">${dateStr}</span>
                                            <span class="text-xs text-slate-400 flex items-center gap-1">
                                                <i data-lucide="user" class="w-3 h-3"></i> ${p.authorName || 'An√≥nimo'}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Acciones -->
                                <div class="flex items-center gap-2 flex-shrink-0">
                                    ${p.link ? `<a href="${p.link}" target="_blank" onclick="event.stopPropagation()" class="p-2 bg-slate-100 rounded-lg text-slate-500 hover:bg-tec-blue hover:text-white transition"><i data-lucide="external-link" class="w-4 h-4"></i></a>` : ''}
                                    ${hasFiles && STATE.currentUser ? `<button onclick="event.stopPropagation(); Database.showProjectFiles('${projectId}')" class="p-2 bg-tec-gold/10 rounded-lg text-tec-gold hover:bg-tec-gold hover:text-white transition"><i data-lucide="folder-open" class="w-4 h-4"></i></button>` : ''}
                                    <div class="p-2 bg-tec-blue/10 rounded-lg text-tec-blue group-hover:bg-tec-blue group-hover:text-white transition">
                                        <i data-lucide="arrow-right" class="w-4 h-4"></i>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    } else {
                        // Vista de Grid (tarjetas)
                        html += `
                        <div class="project-card bg-white rounded-2xl overflow-hidden group cursor-pointer ${isInProgress ? 'ring-2 ring-emerald-300' : (isCompleted ? 'ring-2 ring-amber-300' : '')}" onclick="Database.showProjectDetail('${projectId}')" style="animation: fadeUp 0.5s ease ${index * 0.1}s backwards">
                            <!-- Imagen/Preview -->
                            <div class="h-52 relative overflow-hidden ${isInProgress ? 'bg-gradient-to-br from-emerald-50 to-teal-50' : (isCompleted ? 'bg-gradient-to-br from-amber-50 to-orange-50' : 'bg-gradient-to-br from-slate-100 to-slate-50')}">
                                <!-- Patr√≥n decorativo -->
                                <div class="absolute inset-0 opacity-30">
                                    <div class="absolute top-4 right-4 w-32 h-32 border-2 ${isInProgress ? 'border-emerald-200' : (isCompleted ? 'border-amber-200' : 'border-slate-200')} rounded-full"></div>
                                    <div class="absolute bottom-4 left-4 w-20 h-20 border-2 ${isInProgress ? 'border-emerald-200' : (isCompleted ? 'border-amber-200' : 'border-slate-200')} rounded-full"></div>
                                </div>
                                
                                <!-- Overlay hover -->
                                <div class="project-overlay absolute inset-0 bg-gradient-to-t ${isInProgress ? 'from-emerald-600/90 via-emerald-600/50' : (isCompleted ? 'from-amber-600/90 via-amber-600/50' : 'from-tec-blue/90 via-tec-blue/50')} to-transparent flex items-end justify-center pb-6">
                                    <div class="project-actions flex items-center gap-3">
                                        <button class="px-4 py-2 bg-white ${isInProgress ? 'text-emerald-600' : (isCompleted ? 'text-amber-600' : 'text-tec-blue')} rounded-lg font-bold text-xs hover:bg-tec-gold hover:text-white transition flex items-center gap-2">
                                            <i data-lucide="eye" class="w-4 h-4"></i> Ver Detalles
                                        </button>
                                        ${p.link ? `<a href="${p.link}" target="_blank" onclick="event.stopPropagation()" class="p-2 bg-white/20 backdrop-blur rounded-lg text-white hover:bg-white hover:text-tec-blue transition"><i data-lucide="external-link" class="w-4 h-4"></i></a>` : ''}
                                    </div>
                                </div>
                                
                                <!-- Icono central -->
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="w-20 h-20 ${isInProgress ? 'bg-emerald-100' : (isCompleted ? 'bg-amber-100' : categoryColor.light)} rounded-2xl flex items-center justify-center shadow-lg">
                                        <i data-lucide="${isCompleted ? 'trophy' : categoryIcon}" class="project-image-icon w-10 h-10 ${isInProgress ? 'text-emerald-600' : (isCompleted ? 'text-amber-600' : categoryColor.text)} transition duration-500"></i>
                                    </div>
                                </div>
                                
                                <!-- Badges superiores -->
                                <div class="absolute top-3 left-3 right-3 flex items-start justify-between">
                                    <div class="flex flex-col gap-1.5">
                                        <span class="px-3 py-1.5 ${categoryColor.bg} text-white rounded-lg text-[10px] font-bold uppercase tracking-wide shadow-lg flex items-center gap-1">
                                            <i data-lucide="${categoryIcon}" class="w-3 h-3"></i> ${p.category || 'General'}
                                        </span>
                                        ${isInProgress ? `
                                        <span class="px-4 py-2 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl text-sm font-black shadow-xl flex items-center gap-2 animate-pulse">
                                            <span class="w-3 h-3 bg-white rounded-full animate-ping opacity-75 absolute"></span>
                                            <span class="w-3 h-3 bg-white rounded-full relative"></span>
                                            EN DESARROLLO
                                        </span>` : ''}
                                        ${isCompleted ? `
                                        <span class="px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl text-sm font-black shadow-xl flex items-center gap-2">
                                            <i data-lucide="award" class="w-4 h-4"></i>
                                            COMPLETADO
                                            <i data-lucide="check-circle" class="w-4 h-4"></i>
                                        </span>` : ''}
                                    </div>
                                    ${hasFiles ? `
                                    <span class="px-2 py-1.5 bg-tec-gold text-white rounded-lg text-[10px] font-bold shadow-lg flex items-center gap-1">
                                        <i data-lucide="lock" class="w-3 h-3"></i> ${filesCount}
                                    </span>` : ''}
                                </div>
                                
                                ${isInProgress && (progress.total > 0 || progress.isManual) ? `
                                <!-- Barra de progreso en la imagen - GRANDE Y VISIBLE -->
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-emerald-600 to-emerald-500 px-4 py-3">
                                    <div class="flex items-center justify-between text-white mb-2">
                                        <span class="text-sm font-bold flex items-center gap-2">
                                            <i data-lucide="${progress.isManual ? 'percent' : 'trending-up'}" class="w-4 h-4"></i>
                                            Progreso del Proyecto
                                        </span>
                                        <span class="text-lg font-black">${progress.percent}%</span>
                                    </div>
                                    <div class="h-3 bg-white/30 rounded-full overflow-hidden shadow-inner">
                                        <div class="h-full bg-white rounded-full transition-all duration-500 shadow-lg" style="width: ${progress.percent}%"></div>
                                    </div>
                                    <p class="text-emerald-100 text-xs mt-1.5 font-medium">${progress.isManual ? 'Progreso manual' : `${progress.done} de ${progress.total} tareas completadas`}</p>
                                </div>` : ''}
                                
                                ${isCompleted ? `
                                <!-- Barra de progreso completado - 100% -->
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-amber-600 to-amber-500 px-4 py-3">
                                    <div class="flex items-center justify-between text-white mb-2">
                                        <span class="text-sm font-bold flex items-center gap-2">
                                            <i data-lucide="trophy" class="w-4 h-4"></i>
                                            Proyecto Completado
                                        </span>
                                        <span class="text-lg font-black">100%</span>
                                    </div>
                                    <div class="h-3 bg-white/30 rounded-full overflow-hidden shadow-inner">
                                        <div class="h-full bg-gradient-to-r from-amber-300 to-yellow-300 rounded-full shadow-lg w-full"></div>
                                    </div>
                                    <p class="text-amber-100 text-xs mt-1.5 font-medium flex items-center gap-1">
                                        <i data-lucide="sparkles" class="w-3 h-3"></i>
                                        ¬°Todas las tareas completadas!
                                    </p>
                                </div>` : ''}
                            </div>
                            
                            <!-- Contenido -->
                            <div class="p-6">
                                ${p.competitionId ? `
                                <div class="mb-3">
                                    ${ProjectsFilter.renderTournamentBadge(p.competitionId, 'small')}
                                </div>
                                ` : ''}
                                <h3 class="font-bold text-lg text-tec-dark mb-2 leading-tight group-hover:${isInProgress ? 'text-emerald-600' : (isCompleted ? 'text-amber-600' : 'text-tec-blue')} transition line-clamp-2">${p.title}</h3>
                                <p class="text-sm text-slate-500 line-clamp-2 leading-relaxed mb-4">${p.desc}</p>
                                
                                <!-- Meta info -->
                                <div class="flex items-center justify-between pt-4 border-t border-slate-100">
                                    <div class="flex items-center gap-3">
                                        <div class="flex items-center gap-1.5 text-xs text-slate-400">
                                            <i data-lucide="user" class="w-3.5 h-3.5"></i>
                                            <span class="truncate max-w-[100px]">${p.authorName || 'An√≥nimo'}</span>
                                        </div>
                                        ${dateStr ? `
                                        <div class="flex items-center gap-1.5 text-xs text-slate-400">
                                            <i data-lucide="calendar" class="w-3.5 h-3.5"></i>
                                            <span>${dateStr}</span>
                                        </div>` : ''}
                                    </div>
                                    
                                    <!-- Indicador de estado -->
                                    ${isInProgress ? `
                                    <div class="flex items-center gap-1 text-[10px] font-bold text-emerald-600">
                                        <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div> ${progress.done}/${progress.total} tareas
                                    </div>` : (isCompleted ? `
                                    <div class="flex items-center gap-1 text-[10px] font-bold text-amber-600">
                                        <i data-lucide="trophy" class="w-3.5 h-3.5"></i> 100% Completado
                                    </div>` : (hasFiles ? (STATE.currentUser ? `
                                    <button onclick="event.stopPropagation(); Database.showProjectFiles('${projectId}')" class="flex items-center gap-1 text-[10px] font-bold text-tec-gold hover:text-yellow-600 transition">
                                        <i data-lucide="folder-open" class="w-3.5 h-3.5"></i> Archivos
                                    </button>` : `
                                    <span class="flex items-center gap-1 text-[10px] font-bold text-slate-300">
                                        <i data-lucide="lock" class="w-3.5 h-3.5"></i> Miembros
                                    </span>`) : `
                                    <div class="flex items-center gap-1 text-[10px] font-bold text-tec-blue">
                                        <i data-lucide="folder" class="w-3.5 h-3.5"></i> Proyecto
                                    </div>`))}
                                </div>
                            </div>
                        </div>`;
                    }
                });
                
                grid.innerHTML = html;
                lucide.createIcons();
            }
        };
        
        const Database = {
            // Proyectos P√∫blicos
            loadPublicProjects: async () => {
                const grid = document.getElementById('public-projects-grid');
                if(!grid) return;
                
                // Inicializar el sistema de filtrado
                ProjectsFilter.init();
                
                try {
                    const snap = await db.collection('projects').orderBy('date', 'desc').get();
                    
                    // Actualizar contador en hero
                    const countStat = document.getElementById('projects-count-stat');
                    if (countStat) countStat.textContent = snap.size + '+';
                    
                    if(snap.empty) {
                        document.getElementById('no-projects-message')?.classList.remove('hidden');
                        grid.classList.add('hidden');
                        return;
                    }

                    // Guardar todos los proyectos
                    ProjectsFilter.allProjects = [];
                    const projectIds = [];
                    snap.forEach(doc => {
                        ProjectsFilter.allProjects.push({
                            id: doc.id,
                            data: doc.data()
                        });
                        // Recolectar IDs de proyectos en proceso para cargar sus tareas
                        if (doc.data().status === 'in_progress') {
                            projectIds.push(doc.id);
                        }
                    });
                    
                    // Cargar tareas de proyectos en proceso (para calcular progreso)
                    // NOTA: Solo si el usuario est√° autenticado (tasks requiere auth)
                    ProjectsFilter.tasksByProject = {};
                    if (projectIds.length > 0 && STATE.currentUser) {
                        try {
                            // Firestore tiene l√≠mite de 10 para 'in', hacer m√∫ltiples queries si es necesario
                            const chunks = [];
                            for (let i = 0; i < projectIds.length; i += 10) {
                                chunks.push(projectIds.slice(i, i + 10));
                            }
                            
                            for (const chunk of chunks) {
                                const tasksSnap = await db.collection('tasks')
                                    .where('projectId', 'in', chunk)
                                    .get();
                                
                                tasksSnap.forEach(doc => {
                                    const task = { id: doc.id, ...doc.data() };
                                    if (!ProjectsFilter.tasksByProject[task.projectId]) {
                                        ProjectsFilter.tasksByProject[task.projectId] = [];
                                    }
                                    ProjectsFilter.tasksByProject[task.projectId].push(task);
                                });
                            }
                        } catch (taskError) {
                            console.warn("No se pudieron cargar tareas (requiere autenticaci√≥n):", taskError);
                        }
                    }
                    
                    // Cargar competencias para mostrar insignias en proyectos
                    // NOTA: Solo si el usuario est√° autenticado (competitions requiere auth)
                    ProjectsFilter.competitionsCache = {};
                    if (STATE.currentUser) {
                        try {
                            const competitionsSnap = await db.collection('competitions').get();
                            competitionsSnap.forEach(doc => {
                                ProjectsFilter.competitionsCache[doc.id] = { id: doc.id, ...doc.data() };
                            });
                        } catch (compError) {
                            console.warn("No se pudieron cargar competencias (requiere autenticaci√≥n):", compError);
                        }
                    }
                    
                    // Aplicar filtros y renderizar
                    ProjectsFilter.applyFilters();
                    
                } catch (e) { 
                    console.error(e); 
                    grid.innerHTML = '<p class="col-span-full text-center text-red-400 py-10">Error al cargar proyectos. Intenta m√°s tarde.</p>';
                }
            },

            // Mostrar archivos privados de un proyecto (solo miembros)
            showProjectFiles: async (projectId) => {
                if (!STATE.currentUser) {
                    Util.notify("Inicia sesi√≥n para ver archivos", "warning");
                    Modal.open('auth');
                    return;
                }

                try {
                    const doc = await db.collection('projects').doc(projectId).get();
                    if (!doc.exists) {
                        Util.notify("Proyecto no encontrado", "error");
                        return;
                    }

                    const project = doc.data();
                    const files = project.privateFiles || [];

                    if (files.length === 0) {
                        Util.notify("Este proyecto no tiene archivos adjuntos", "info");
                        return;
                    }

                    // Crear lista de archivos para descargar
                    let filesList = files.map((file, idx) => {
                        const icon = Util.getFileIcon(file.name);
                        const size = Util.formatFileSize(file.size);
                        return `
                            <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg hover:bg-slate-100 transition">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-tec-blue/10 rounded-lg flex items-center justify-center">
                                        <i data-lucide="${icon}" class="w-5 h-5 text-tec-blue"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-slate-700 truncate max-w-[200px]">${file.name}</p>
                                        <p class="text-[10px] text-slate-400">${size}</p>
                                    </div>
                                </div>
                                <button onclick="Util.downloadFile('${file.data}', '${file.name}', '${file.type}')" class="px-3 py-2 bg-tec-blue text-white rounded-lg text-xs font-bold hover:bg-tec-dark transition flex items-center gap-1">
                                    <i data-lucide="download" class="w-3 h-3"></i> Descargar
                                </button>
                            </div>
                        `;
                    }).join('');

                    Swal.fire({
                        title: `<span class="text-tec-dark">Archivos de ${project.title}</span>`,
                        html: `
                            <div class="text-left space-y-3 max-h-80 overflow-y-auto">
                                ${filesList}
                            </div>
                        `,
                        showConfirmButton: false,
                        showCloseButton: true,
                        width: 500,
                        didOpen: () => lucide.createIcons()
                    });

                } catch (e) {
                    console.error(e);
                    Util.notify("Error al cargar archivos", "error");
                }
            },

            // Mostrar detalle de proyecto
            showProjectDetail: async (projectId) => {
                try {
                    const doc = await db.collection('projects').doc(projectId).get();
                    if (!doc.exists) return;

                    const p = doc.data();
                    const hasFiles = p.privateFiles && p.privateFiles.length > 0;
                    const isLoggedIn = STATE.currentUser !== null;
                    const filesCount = p.privateFiles?.length || 0;
                    const participantsCount = p.participants?.length || 0;
                    const dateStr = p.date ? new Date(p.date.seconds * 1000).toLocaleDateString('es-MX', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    }) : 'Sin fecha';
                    const timeAgo = p.date ? (() => {
                        const now = new Date();
                        const date = new Date(p.date.seconds * 1000);
                        const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
                        if (diffDays === 0) return 'Hoy';
                        if (diffDays === 1) return 'Ayer';
                        if (diffDays < 7) return `Hace ${diffDays} d√≠as`;
                        if (diffDays < 30) return `Hace ${Math.floor(diffDays / 7)} semanas`;
                        if (diffDays < 365) return `Hace ${Math.floor(diffDays / 30)} meses`;
                        return `Hace ${Math.floor(diffDays / 365)} a√±os`;
                    })() : '';
                    
                    // Obtener colores e iconos de categor√≠a
                    const categoryIcon = ProjectsFilter.getCategoryIcon(p.category);
                    const categoryColor = ProjectsFilter.getCategoryColor(p.category);
                    
                    // Colores de gradiente por categor√≠a
                    const categoryGradients = {
                        'combate': 'from-red-600 via-rose-700 to-red-900',
                        'drones': 'from-sky-500 via-blue-600 to-indigo-700',
                        'dron': 'from-sky-500 via-blue-600 to-indigo-700',
                        'industrial': 'from-orange-500 via-amber-600 to-orange-700',
                        'autonomo': 'from-purple-600 via-violet-700 to-indigo-800',
                        'aut√≥nomo': 'from-purple-600 via-violet-700 to-indigo-800',
                        'software': 'from-emerald-500 via-green-600 to-teal-700'
                    };
                    const catLower = (p.category || '').toLowerCase();
                    let headerGradient = 'from-tec-blue via-indigo-700 to-slate-900';
                    for (let key in categoryGradients) {
                        if (catLower.includes(key)) {
                            headerGradient = categoryGradients[key];
                            break;
                        }
                    }

                    // Secci√≥n de archivos
                    let filesSection = '';
                    if (hasFiles) {
                        if (isLoggedIn) {
                            const filesList = p.privateFiles.map((file, idx) => {
                                const icon = Util.getFileIcon(file.name);
                                const size = Util.formatFileSize(file.size);
                                const fileExt = file.name.split('.').pop().toUpperCase();
                                return `
                                    <div class="group/file relative bg-white rounded-xl border border-slate-200 p-3 sm:p-4 hover:border-tec-gold hover:shadow-lg transition-all duration-300 cursor-pointer active:scale-[0.98]" onclick="Util.downloadFile('${file.data}', '${file.name}', '${file.type}')">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br ${categoryColor.light} rounded-xl flex items-center justify-center flex-shrink-0 group-hover/file:scale-110 transition-transform">
                                                <i data-lucide="${icon}" class="w-5 h-5 sm:w-6 sm:h-6 ${categoryColor.text}"></i>
                                            </div>
                                            <div class="flex-1 min-w-0">
                                                <p class="text-xs sm:text-sm font-bold text-slate-800 truncate group-hover/file:text-tec-blue transition">${file.name}</p>
                                                <div class="flex items-center gap-2 mt-1">
                                                    <span class="text-[9px] sm:text-[10px] px-1.5 sm:px-2 py-0.5 bg-slate-100 text-slate-500 rounded font-mono">${fileExt}</span>
                                                    <span class="text-[9px] sm:text-[10px] text-slate-400">${size}</span>
                                                </div>
                                            </div>
                                            <div class="sm:opacity-0 sm:group-hover/file:opacity-100 transition-opacity">
                                                <div class="w-8 h-8 bg-tec-gold rounded-lg flex items-center justify-center shadow-lg">
                                                    <i data-lucide="download" class="w-4 h-4 text-white"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('');
                            
                            filesSection = `
                                <div id="section-files" class="scroll-mt-4">
                                    <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-4 sm:p-5 border border-amber-100">
                                        <div class="flex items-center justify-between mb-4">
                                            <div class="flex items-center gap-3">
                                                <div class="w-9 h-9 sm:w-10 sm:h-10 bg-gradient-to-br from-tec-gold to-amber-500 rounded-xl flex items-center justify-center shadow-lg">
                                                    <i data-lucide="folder-open" class="w-4 h-4 sm:w-5 sm:h-5 text-white"></i>
                                                </div>
                                                <div>
                                                    <h4 class="font-bold text-slate-800 text-sm sm:text-base">Recursos del Proyecto</h4>
                                                    <p class="text-[10px] text-slate-500 hidden sm:block">Archivos exclusivos para miembros</p>
                                                </div>
                                            </div>
                                            <span class="px-2.5 py-1 sm:px-3 sm:py-1.5 bg-tec-gold text-white rounded-full text-[10px] sm:text-xs font-bold shadow-lg">${filesCount}</span>
                                        </div>
                                        <div class="space-y-2 sm:space-y-3 max-h-[200px] sm:max-h-52 overflow-y-auto overscroll-contain pr-1 scroll-smooth" style="-webkit-overflow-scrolling: touch;">
                                            ${filesList}
                                        </div>
                                    </div>
                                </div>
                            `;
                        } else {
                            filesSection = `
                                <div id="section-files" class="scroll-mt-4">
                                    <div class="relative bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-5 sm:p-6 overflow-hidden">
                                        <div class="absolute inset-0 opacity-10">
                                            <div class="absolute top-4 right-4 w-24 h-24 border-2 border-white rounded-full"></div>
                                            <div class="absolute bottom-4 left-4 w-16 h-16 border-2 border-white rounded-full"></div>
                                        </div>
                                        <div class="relative z-10">
                                            <div class="flex items-center gap-3 sm:gap-4 mb-4">
                                                <div class="w-12 h-12 sm:w-14 sm:h-14 bg-white/10 backdrop-blur rounded-2xl flex items-center justify-center">
                                                    <i data-lucide="lock" class="w-6 h-6 sm:w-7 sm:h-7 text-tec-gold"></i>
                                                </div>
                                                <div>
                                                    <h4 class="font-bold text-white text-base sm:text-lg">Contenido Exclusivo</h4>
                                                    <p class="text-slate-400 text-xs sm:text-sm">${filesCount} archivo${filesCount !== 1 ? 's' : ''} disponible${filesCount !== 1 ? 's' : ''}</p>
                                                </div>
                                            </div>
                                            <p class="text-slate-300 text-xs sm:text-sm mb-4">Accede a documentaci√≥n t√©cnica, archivos CAD, c√≥digo fuente y m√°s recursos.</p>
                                            <button onclick="Swal.close(); Modal.open('auth')" class="w-full py-3 sm:py-3.5 bg-gradient-to-r from-tec-gold to-amber-500 text-white rounded-xl font-bold text-sm hover:shadow-xl hover:shadow-tec-gold/30 transition-all duration-300 flex items-center justify-center gap-2 active:scale-[0.98]">
                                                <i data-lucide="unlock" class="w-4 h-4 sm:w-5 sm:h-5"></i>
                                                Desbloquear Acceso
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }
                    }
                    
                    // Secci√≥n de participantes
                    let participantsSection = '';
                    if (p.participants && p.participants.length > 0) {
                        participantsSection = `
                            <div id="section-team" class="scroll-mt-4">
                                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-4 sm:p-5 border border-blue-100">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-9 h-9 sm:w-10 sm:h-10 bg-gradient-to-br from-tec-blue to-indigo-600 rounded-xl flex items-center justify-center shadow-lg">
                                            <i data-lucide="users" class="w-4 h-4 sm:w-5 sm:h-5 text-white"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-bold text-slate-800 text-sm sm:text-base">Equipo del Proyecto</h4>
                                            <p class="text-[10px] text-slate-500">${participantsCount} colaborador${participantsCount !== 1 ? 'es' : ''}</p>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 max-h-[180px] sm:max-h-[200px] overflow-y-auto overscroll-contain pr-1" style="-webkit-overflow-scrolling: touch;">
                                        ${p.participants.map(part => `
                                            <div class="flex items-center gap-2 sm:gap-3 p-2.5 sm:p-3 bg-white rounded-xl border border-slate-100 hover:border-blue-300 hover:shadow-md transition-all active:scale-[0.98]">
                                                <img src="${part.photo || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(part.name) + '&background=1B396A&color=fff'}" 
                                                     class="w-9 h-9 sm:w-10 sm:h-10 rounded-xl border-2 border-white shadow-md" 
                                                     alt="${part.name}">
                                                <div class="flex-1 min-w-0">
                                                    <p class="text-xs sm:text-sm font-bold text-slate-700 truncate">${part.name}</p>
                                                    <p class="text-[9px] sm:text-[10px] text-slate-400">Miembro CRAI</p>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    
                    // Secci√≥n de notas privadas (solo para usuarios logueados)
                    const hasPrivateNotes = p.privateNotes && p.privateNotes.trim().length > 0;
                    let privateNotesSection = '';
                    if (hasPrivateNotes || hasFiles) {
                        if (isLoggedIn && hasPrivateNotes) {
                            // Convertir URLs en links clickeables
                            const notesWithLinks = p.privateNotes.replace(
                                /(https?:\/\/[^\s]+)/g, 
                                '<a href="$1" target="_blank" class="text-purple-600 hover:text-purple-800 underline break-all">$1</a>'
                            );
                            privateNotesSection = `
                                <div id="section-notes" class="scroll-mt-4">
                                    <div class="bg-gradient-to-br from-purple-50 to-violet-50 rounded-2xl p-4 sm:p-5 border border-purple-100">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="w-9 h-9 sm:w-10 sm:h-10 bg-gradient-to-br from-purple-500 to-violet-600 rounded-xl flex items-center justify-center shadow-lg">
                                                <i data-lucide="message-square-lock" class="w-4 h-4 sm:w-5 sm:h-5 text-white"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-slate-800 text-sm sm:text-base">Notas Privadas</h4>
                                                <p class="text-[10px] text-slate-500">Solo visible para miembros</p>
                                            </div>
                                        </div>
                                        <div class="bg-white rounded-xl p-3 sm:p-4 border border-purple-100 text-slate-600 text-sm leading-relaxed whitespace-pre-wrap break-words">
                                            ${notesWithLinks}
                                        </div>
                                    </div>
                                </div>
                            `;
                        } else if (!isLoggedIn && hasPrivateNotes) {
                            // Mostrar indicador de notas bloqueadas solo si hay notas privadas
                            privateNotesSection = `
                                <div id="section-notes" class="scroll-mt-4">
                                    <div class="relative bg-gradient-to-br from-purple-800 to-violet-900 rounded-2xl p-4 sm:p-5 overflow-hidden">
                                        <div class="absolute inset-0 opacity-10">
                                            <div class="absolute top-2 right-2 w-16 h-16 border-2 border-white rounded-full"></div>
                                        </div>
                                        <div class="relative z-10 flex items-center gap-3">
                                            <div class="w-10 h-10 sm:w-12 sm:h-12 bg-white/10 backdrop-blur rounded-xl flex items-center justify-center">
                                                <i data-lucide="message-square-lock" class="w-5 h-5 sm:w-6 sm:h-6 text-purple-300"></i>
                                            </div>
                                            <div class="flex-1">
                                                <h4 class="font-bold text-white text-sm sm:text-base">Notas del Equipo</h4>
                                                <p class="text-purple-300 text-xs">Inicia sesi√≥n para ver links y comentarios privados</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }
                    }
                    
                    // Secci√≥n de tareas (solo para proyectos en proceso y usuarios logueados)
                    let tasksSection = '';
                    const isProjectInProgress = p.status === 'in_progress';
                    const projectTasks = ProjectsFilter.tasksByProject[projectId] || [];
                    const projectProgress = ProjectsFilter.getProjectProgress(projectId, p);
                    
                    if (isProjectInProgress && (projectTasks.length > 0 || projectProgress.isManual)) {
                        const taskProgress = projectProgress;
                        
                        // Agrupar tareas por √°rea
                        const tasksByArea = {};
                        projectTasks.forEach(task => {
                            const area = task.area || 'sin_area';
                            if (!tasksByArea[area]) tasksByArea[area] = [];
                            tasksByArea[area].push(task);
                        });
                        
                        const areaStyles = {
                            gestion: { bg: 'bg-purple-100', text: 'text-purple-700', icon: 'briefcase', name: 'Gesti√≥n' },
                            telecom: { bg: 'bg-blue-100', text: 'text-blue-700', icon: 'wifi', name: 'Telecom' },
                            software: { bg: 'bg-green-100', text: 'text-green-700', icon: 'code', name: 'Software' },
                            electronica: { bg: 'bg-orange-100', text: 'text-orange-700', icon: 'cpu', name: 'Electr√≥nica' },
                            mecanico: { bg: 'bg-red-100', text: 'text-red-700', icon: 'cog', name: 'Mec√°nico' },
                            sin_area: { bg: 'bg-slate-100', text: 'text-slate-700', icon: 'folder', name: 'Sin √°rea' }
                        };
                        
                        if (isLoggedIn && projectTasks.length > 0) {
                            // Mostrar tareas detalladas para miembros (solo si hay tareas)
                            let tasksHtml = Object.entries(tasksByArea).map(([area, tasks]) => {
                                const style = areaStyles[area] || areaStyles.sin_area;
                                const areaDone = tasks.filter(t => t.status === 'done').length;
                                const areaPercent = Math.round((areaDone / tasks.length) * 100);
                                
                                return `
                                    <div class="${style.bg} rounded-xl p-3 border border-slate-200/50">
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center gap-2">
                                                <i data-lucide="${style.icon}" class="w-4 h-4 ${style.text}"></i>
                                                <span class="font-bold ${style.text} text-sm">${style.name}</span>
                                            </div>
                                            <span class="text-xs font-bold ${style.text}">${areaPercent}%</span>
                                        </div>
                                        <div class="h-1.5 bg-white rounded-full overflow-hidden mb-2">
                                            <div class="h-full ${style.text.replace('text-', 'bg-')} opacity-70 rounded-full" style="width: ${areaPercent}%"></div>
                                        </div>
                                        <div class="space-y-1.5">
                                            ${tasks.slice(0, 4).map(task => {
                                                const statusIcon = task.status === 'done' ? 'check-circle' : (task.status === 'progress' ? 'loader' : 'circle');
                                                const statusClass = task.status === 'done' ? 'text-green-600' : (task.status === 'progress' ? 'text-blue-500' : 'text-slate-400');
                                                return `
                                                    <div class="flex items-center gap-2 text-xs bg-white/70 rounded-lg px-2 py-1.5">
                                                        <i data-lucide="${statusIcon}" class="w-3.5 h-3.5 ${statusClass} ${task.status === 'progress' ? 'animate-spin' : ''}"></i>
                                                        <span class="${task.status === 'done' ? 'line-through text-slate-400' : 'text-slate-700'} truncate">${task.title}</span>
                                                    </div>
                                                `;
                                            }).join('')}
                                            ${tasks.length > 4 ? `<p class="text-[10px] ${style.text} text-center">+${tasks.length - 4} tareas m√°s</p>` : ''}
                                        </div>
                                    </div>
                                `;
                            }).join('');
                            
                            tasksSection = `
                                <div id="section-tasks" class="scroll-mt-4">
                                    <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-4 sm:p-5 border border-emerald-200">
                                        <div class="flex items-center justify-between mb-4">
                                            <div class="flex items-center gap-3">
                                                <div class="w-9 h-9 sm:w-10 sm:h-10 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl flex items-center justify-center shadow-lg">
                                                    <i data-lucide="list-checks" class="w-4 h-4 sm:w-5 sm:h-5 text-white"></i>
                                                </div>
                                                <div>
                                                    <h4 class="font-bold text-slate-800 text-sm sm:text-base">Tareas del Proyecto</h4>
                                                    <p class="text-[10px] text-emerald-600 font-medium">${taskProgress.done}/${taskProgress.total} completadas</p>
                                                </div>
                                            </div>
                                            <span class="px-3 py-1.5 bg-emerald-500 text-white rounded-full text-xs font-bold shadow-lg">${taskProgress.percent}%</span>
                                        </div>
                                        
                                        <!-- Barra de progreso general -->
                                        <div class="mb-4">
                                            <div class="h-3 bg-white rounded-full overflow-hidden shadow-inner">
                                                <div class="h-full bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full transition-all" style="width: ${taskProgress.percent}%"></div>
                                            </div>
                                        </div>
                                        
                                        <!-- Tareas por √°rea -->
                                        <div class="space-y-3 max-h-[300px] overflow-y-auto pr-1">
                                            ${tasksHtml}
                                        </div>
                                    </div>
                                </div>
                            `;
                        } else if (taskProgress.isManual) {
                            // Vista de progreso manual (sin tareas asignadas)
                            tasksSection = `
                                <div id="section-tasks" class="scroll-mt-4">
                                    <div class="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-4 sm:p-5 text-white">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="w-10 h-10 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center">
                                                <i data-lucide="trending-up" class="w-5 h-5 text-white"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-white text-base">Progreso del Proyecto</h4>
                                                <p class="text-emerald-200 text-xs flex items-center gap-1">
                                                    <i data-lucide="pencil" class="w-3 h-3"></i>
                                                    Porcentaje establecido manualmente
                                                </p>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <div class="flex items-center justify-between text-sm mb-2">
                                                <span class="font-medium">Avance del proyecto</span>
                                                <span class="font-black text-2xl">${taskProgress.percent}%</span>
                                            </div>
                                            <div class="h-4 bg-white/20 rounded-full overflow-hidden shadow-inner">
                                                <div class="h-full bg-white rounded-full transition-all" style="width: ${taskProgress.percent}%"></div>
                                            </div>
                                        </div>
                                        
                                        <p class="text-emerald-200 text-xs text-center">
                                            <i data-lucide="info" class="w-3 h-3 inline mr-1"></i>
                                            Este proyecto no tiene tareas asignadas. El progreso fue configurado por el autor.
                                        </p>
                                    </div>
                                </div>
                            `;
                        } else {
                            // Vista p√∫blica - solo mostrar progreso general
                            tasksSection = `
                                <div id="section-tasks" class="scroll-mt-4">
                                    <div class="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-4 sm:p-5 text-white">
                                        <div class="flex items-center gap-3 mb-4">
                                            <div class="w-10 h-10 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center">
                                                <i data-lucide="activity" class="w-5 h-5 text-white"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-white text-base">Proyecto en Desarrollo</h4>
                                                <p class="text-emerald-200 text-xs">Progreso actual: ${taskProgress.percent}%</p>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <div class="flex items-center justify-between text-sm mb-2">
                                                <span class="font-medium">Tareas completadas</span>
                                                <span class="font-bold">${taskProgress.done}/${taskProgress.total}</span>
                                            </div>
                                            <div class="h-3 bg-white/20 rounded-full overflow-hidden">
                                                <div class="h-full bg-white rounded-full transition-all" style="width: ${taskProgress.percent}%"></div>
                                            </div>
                                        </div>
                                        
                                        <p class="text-emerald-200 text-xs text-center">
                                            <i data-lucide="lock" class="w-3 h-3 inline mr-1"></i>
                                            Inicia sesi√≥n para ver el detalle de tareas por √°rea
                                        </p>
                                    </div>
                                </div>
                            `;
                        }
                    }

                    // Calcular secciones para navegaci√≥n
                    const sections = [
                        { id: 'info', icon: 'file-text', label: 'Info' },
                        ...(p.galleryUrl ? [{ id: 'gallery', icon: 'image', label: 'Galer√≠a' }] : []),
                        ...(participantsCount > 0 ? [{ id: 'team', icon: 'users', label: 'Equipo' }] : []),
                        ...(p.link ? [{ id: 'repo', icon: 'github', label: 'Repo' }] : []),
                        ...(hasPrivateNotes ? [{ id: 'notes', icon: 'message-square-lock', label: 'Notas' }] : []),
                        ...(hasFiles ? [{ id: 'files', icon: 'folder', label: 'Archivos' }] : []),
                        ...(isProjectInProgress && (projectTasks.length > 0 || projectProgress.isManual) ? [{ id: 'tasks', icon: 'list-checks', label: 'Tareas' }] : [])
                    ];

                    Swal.fire({
                        html: `
                            <div class="project-detail-modal text-left -m-5 flex flex-col max-h-[calc(95vh-20px)] sm:max-h-[calc(90vh-20px)]">
                                
                                <!-- Header Compacto con Info Esencial - STICKY -->
                                <div class="sticky top-0 z-30 bg-gradient-to-br ${headerGradient} text-white relative overflow-hidden flex-shrink-0">
                                    <!-- Elementos decorativos -->
                                    <div class="absolute inset-0 overflow-hidden pointer-events-none">
                                        <div class="absolute top-0 right-0 w-48 sm:w-64 h-48 sm:h-64 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/3 blur-3xl"></div>
                                        <div class="absolute bottom-0 left-0 w-32 sm:w-48 h-32 sm:h-48 bg-tec-gold/20 rounded-full translate-y-1/2 -translate-x-1/4 blur-2xl"></div>
                                        <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(circle, white 1px, transparent 1px); background-size: 20px 20px;"></div>
                                    </div>
                                    
                                    <!-- Contenido del Header -->
                                    <div class="relative z-10 p-4 sm:p-6">
                                        <!-- Top Row: Categor√≠a y Cerrar -->
                                        <div class="flex items-start justify-between gap-3 mb-3 sm:mb-4">
                                            <div class="flex items-center gap-2 sm:gap-3">
                                                <div class="w-11 h-11 sm:w-14 sm:h-14 bg-white/20 backdrop-blur-xl rounded-xl sm:rounded-2xl flex items-center justify-center border border-white/20 shadow-xl">
                                                    <i data-lucide="${categoryIcon}" class="w-5 h-5 sm:w-7 sm:h-7 text-white"></i>
                                                </div>
                                                <div>
                                                    <span class="inline-flex items-center gap-1 px-2.5 sm:px-3 py-1 bg-white/20 backdrop-blur text-white rounded-full text-[10px] sm:text-xs font-bold uppercase tracking-wide border border-white/20">
                                                        <i data-lucide="${categoryIcon}" class="w-3 h-3"></i>
                                                        ${p.category || 'General'}
                                                    </span>
                                                    <p class="text-white/60 text-[10px] sm:text-xs mt-1 ml-0.5">${timeAgo}</p>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- T√≠tulo -->
                                        <h2 class="text-lg sm:text-2xl font-black leading-tight mb-2 drop-shadow-lg line-clamp-2">${p.title}</h2>
                                        
                                        <!-- Insignia de Competencia -->
                                        ${p.competitionId && ProjectsFilter.competitionsCache && ProjectsFilter.competitionsCache[p.competitionId] ? `
                                        <div class="mb-3">
                                            <a href="#" onclick="event.preventDefault(); Swal.close(); setTimeout(() => { Navigation.go('competitions'); }, 300);" 
                                               class="inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-amber-400 via-yellow-400 to-amber-500 text-slate-900 rounded-full text-xs font-bold shadow-lg hover:shadow-xl hover:scale-105 transition-all animate-pulse">
                                                <i data-lucide="trophy" class="w-4 h-4"></i>
                                                <span>üèÜ ${ProjectsFilter.competitionsCache[p.competitionId].name}</span>
                                                <i data-lucide="external-link" class="w-3 h-3 opacity-70"></i>
                                            </a>
                                        </div>
                                        ` : ''}
                                        
                                        <!-- Meta Tags Compactos -->
                                        <div class="flex flex-wrap items-center gap-2 text-[11px] sm:text-sm">
                                            <div class="flex items-center gap-1.5 px-2 sm:px-2.5 py-1 bg-black/20 backdrop-blur rounded-lg">
                                                <i data-lucide="user" class="w-3 h-3 sm:w-3.5 sm:h-3.5"></i>
                                                <span class="font-medium truncate max-w-[80px] sm:max-w-none">${p.authorName || 'An√≥nimo'}</span>
                                            </div>
                                            <div class="flex items-center gap-1.5 px-2 sm:px-2.5 py-1 bg-black/20 backdrop-blur rounded-lg">
                                                <i data-lucide="calendar" class="w-3 h-3 sm:w-3.5 sm:h-3.5"></i>
                                                <span class="font-medium hidden sm:inline">${dateStr}</span>
                                                <span class="font-medium sm:hidden">${timeAgo}</span>
                                            </div>
                                            ${hasFiles ? `
                                            <div class="flex items-center gap-1.5 px-2 sm:px-2.5 py-1 bg-tec-gold/40 backdrop-blur rounded-lg">
                                                <i data-lucide="paperclip" class="w-3 h-3 sm:w-3.5 sm:h-3.5"></i>
                                                <span class="font-medium">${filesCount}</span>
                                            </div>` : ''}
                                            ${participantsCount > 0 ? `
                                            <div class="flex items-center gap-1.5 px-2 sm:px-2.5 py-1 bg-black/20 backdrop-blur rounded-lg">
                                                <i data-lucide="users" class="w-3 h-3 sm:w-3.5 sm:h-3.5"></i>
                                                <span class="font-medium">${participantsCount}</span>
                                            </div>` : ''}
                                        </div>
                                    </div>
                                    
                                    <!-- Navegaci√≥n por Secciones - Sticky dentro del header -->
                                    ${sections.length > 1 ? `
                                    <div class="relative z-10 px-4 sm:px-6 pb-3 -mt-1">
                                        <div class="flex gap-1.5 sm:gap-2 overflow-x-auto hide-scroll pb-1" style="-webkit-overflow-scrolling: touch;">
                                            ${sections.map((sec, idx) => `
                                                <button onclick="document.getElementById('section-${sec.id}').scrollIntoView({behavior: 'smooth', block: 'start'})" 
                                                        class="flex items-center gap-1.5 px-3 sm:px-4 py-2 sm:py-2.5 rounded-xl text-[11px] sm:text-xs font-bold transition-all whitespace-nowrap ${idx === 0 ? 'bg-white text-slate-800 shadow-lg' : 'bg-white/20 text-white hover:bg-white/30 active:bg-white/40'}">
                                                    <i data-lucide="${sec.icon}" class="w-3.5 h-3.5 sm:w-4 sm:h-4"></i>
                                                    ${sec.label}
                                                </button>
                                            `).join('')}
                                        </div>
                                    </div>
                                    ` : ''}
                                </div>
                                
                                <!-- Contenido Principal -->
                                <div class="flex-1">
                                    <div class="p-4 sm:p-6 space-y-4 sm:space-y-6 bg-gradient-to-b from-slate-50 to-white">
                                        
                                        <!-- Descripci√≥n -->
                                        <div id="section-info" class="scroll-mt-4">
                                            <div class="bg-white rounded-2xl p-4 sm:p-5 border border-slate-100 shadow-sm">
                                                <div class="flex items-center gap-2 sm:gap-3 mb-3 sm:mb-4">
                                                    <div class="w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-slate-100 to-slate-200 rounded-xl flex items-center justify-center">
                                                        <i data-lucide="file-text" class="w-4 h-4 sm:w-5 sm:h-5 text-slate-600"></i>
                                                    </div>
                                                    <h4 class="font-bold text-slate-800 text-sm sm:text-base">Acerca del Proyecto</h4>
                                                </div>
                                                <p class="text-slate-600 leading-relaxed text-sm sm:text-[15px]">${p.desc || 'Sin descripci√≥n disponible.'}</p>
                                            </div>
                                        </div>
                                        
                                        <!-- Stats Cards - M√°s compactas en m√≥vil -->
                                        <div class="grid grid-cols-3 gap-2 sm:gap-3">
                                            <div class="bg-white rounded-xl p-3 sm:p-4 border border-slate-100 text-center hover:border-green-300 hover:shadow-md transition-all active:scale-[0.98]">
                                                <div class="w-8 h-8 sm:w-10 sm:h-10 bg-green-100 rounded-xl flex items-center justify-center mx-auto mb-1.5 sm:mb-2">
                                                    <i data-lucide="check-circle" class="w-4 h-4 sm:w-5 sm:h-5 text-green-600"></i>
                                                </div>
                                                <p class="text-sm sm:text-lg font-black text-green-600">Activo</p>
                                                <p class="text-[9px] sm:text-[10px] text-slate-400 uppercase tracking-wide">Estado</p>
                                            </div>
                                            <div class="bg-white rounded-xl p-3 sm:p-4 border border-slate-100 text-center hover:border-blue-300 hover:shadow-md transition-all active:scale-[0.98]">
                                                <div class="w-8 h-8 sm:w-10 sm:h-10 ${categoryColor.light} rounded-xl flex items-center justify-center mx-auto mb-1.5 sm:mb-2">
                                                    <i data-lucide="${categoryIcon}" class="w-4 h-4 sm:w-5 sm:h-5 ${categoryColor.text}"></i>
                                                </div>
                                                <p class="text-sm sm:text-lg font-black ${categoryColor.text} truncate">${p.category || 'General'}</p>
                                                <p class="text-[9px] sm:text-[10px] text-slate-400 uppercase tracking-wide">Tipo</p>
                                            </div>
                                            <div class="bg-white rounded-xl p-3 sm:p-4 border border-slate-100 text-center hover:border-purple-300 hover:shadow-md transition-all active:scale-[0.98]">
                                                <div class="w-8 h-8 sm:w-10 sm:h-10 bg-purple-100 rounded-xl flex items-center justify-center mx-auto mb-1.5 sm:mb-2">
                                                    <i data-lucide="users" class="w-4 h-4 sm:w-5 sm:h-5 text-purple-600"></i>
                                                </div>
                                                <p class="text-sm sm:text-lg font-black text-purple-600">${participantsCount}</p>
                                                <p class="text-[9px] sm:text-[10px] text-slate-400 uppercase tracking-wide">Equipo</p>
                                            </div>
                                        </div>
                                        
                                        <!-- Galer√≠a de Fotos (Google Drive) -->
                                        ${p.galleryUrl ? `
                                        <div id="section-gallery" class="scroll-mt-4">
                                            <div class="bg-gradient-to-br from-cyan-50 to-sky-50 rounded-2xl p-4 sm:p-5 border border-cyan-200">
                                                <div class="flex items-center justify-between mb-4">
                                                    <div class="flex items-center gap-3">
                                                        <div class="w-9 h-9 sm:w-10 sm:h-10 bg-gradient-to-br from-cyan-500 to-sky-600 rounded-xl flex items-center justify-center shadow-lg">
                                                            <i data-lucide="image" class="w-4 h-4 sm:w-5 sm:h-5 text-white"></i>
                                                        </div>
                                                        <div>
                                                            <h4 class="font-bold text-slate-800 text-sm sm:text-base">Galer√≠a de Fotos</h4>
                                                            <p class="text-[10px] text-cyan-600">Ver im√°genes del proyecto</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Preview de galer√≠a -->
                                                <div class="bg-white rounded-xl p-4 border border-cyan-100 mb-4">
                                                    <div class="grid grid-cols-3 gap-2 mb-3">
                                                        <div class="aspect-square bg-gradient-to-br from-cyan-100 to-sky-100 rounded-lg flex items-center justify-center">
                                                            <i data-lucide="image" class="w-6 h-6 text-cyan-400"></i>
                                                        </div>
                                                        <div class="aspect-square bg-gradient-to-br from-sky-100 to-blue-100 rounded-lg flex items-center justify-center">
                                                            <i data-lucide="image" class="w-6 h-6 text-sky-400"></i>
                                                        </div>
                                                        <div class="aspect-square bg-gradient-to-br from-blue-100 to-indigo-100 rounded-lg flex items-center justify-center relative">
                                                            <i data-lucide="image" class="w-6 h-6 text-blue-400"></i>
                                                            <div class="absolute inset-0 bg-black/50 rounded-lg flex items-center justify-center">
                                                                <span class="text-white font-bold text-sm">+</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <p class="text-xs text-slate-500 text-center mb-3">Las fotos est√°n almacenadas en Google Drive</p>
                                                </div>
                                                
                                                <!-- Bot√≥n para abrir galer√≠a -->
                                                <a href="${p.galleryUrl}" target="_blank" class="block w-full py-3 bg-gradient-to-r from-cyan-500 to-sky-600 text-white rounded-xl font-bold text-sm text-center hover:shadow-lg hover:shadow-cyan-500/30 transition-all duration-300 active:scale-[0.98]">
                                                    <i data-lucide="external-link" class="w-4 h-4 inline mr-2"></i>
                                                    Abrir Galer√≠a Completa
                                                </a>
                                            </div>
                                        </div>
                                        ` : ''}
                                        
                                        <!-- Participantes -->
                                        ${participantsSection}
                                        
                                        <!-- Link del repositorio -->
                                        ${p.link ? `
                                        <div id="section-repo" class="scroll-mt-4">
                                            <a href="${p.link}" target="_blank" class="group/repo block">
                                                <div class="relative bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 rounded-2xl p-4 sm:p-5 overflow-hidden hover:shadow-2xl transition-all duration-300 active:scale-[0.98]">
                                                    <div class="absolute inset-0 bg-gradient-to-r from-tec-blue/0 via-tec-blue/10 to-tec-blue/0 opacity-0 group-hover/repo:opacity-100 transition-opacity"></div>
                                                    <div class="relative z-10 flex items-center gap-3 sm:gap-4">
                                                        <div class="w-11 h-11 sm:w-14 sm:h-14 bg-white/10 rounded-xl sm:rounded-2xl flex items-center justify-center group-hover/repo:scale-110 group-hover/repo:bg-white/20 transition-all">
                                                            <i data-lucide="github" class="w-5 h-5 sm:w-7 sm:h-7 text-white"></i>
                                                        </div>
                                                        <div class="flex-1 min-w-0">
                                                            <p class="font-bold text-white text-sm sm:text-lg mb-0.5 sm:mb-1">Ver Repositorio</p>
                                                            <p class="text-slate-400 text-xs sm:text-sm truncate">${p.link}</p>
                                                        </div>
                                                        <div class="w-8 h-8 sm:w-10 sm:h-10 bg-tec-gold rounded-xl flex items-center justify-center sm:opacity-0 sm:group-hover/repo:opacity-100 transition-all">
                                                            <i data-lucide="external-link" class="w-4 h-4 sm:w-5 sm:h-5 text-white"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                        ` : ''}
                                        
                                        <!-- Notas Privadas -->
                                        ${privateNotesSection}
                                        
                                        <!-- Archivos -->
                                        ${filesSection}
                                        
                                        <!-- Tareas del Proyecto (solo para miembros y si est√° en proceso) -->
                                        ${tasksSection}
                                        
                                        <!-- Footer -->
                                        <div class="flex flex-col sm:flex-row items-center justify-between gap-3 pt-4 border-t border-slate-100">
                                            <div class="flex items-center gap-2 text-slate-400 order-2 sm:order-1">
                                                <i data-lucide="shield-check" class="w-4 h-4"></i>
                                                <span class="text-[10px] sm:text-xs">Proyecto verificado CRAI</span>
                                            </div>
                                            <button onclick="Swal.close(); Router.to('public-projects')" class="w-full sm:w-auto px-4 py-2.5 bg-slate-100 hover:bg-tec-blue hover:text-white text-slate-600 rounded-xl text-xs font-bold transition flex items-center justify-center gap-1 order-1 sm:order-2 active:scale-[0.98]">
                                                Explorar m√°s proyectos
                                                <i data-lucide="arrow-right" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                        
                                        <!-- Espaciado inferior para iOS safe area -->
                                        <div class="h-4 sm:h-2"></div>
                                    </div>
                                </div>
                            </div>
                        `,
                        showConfirmButton: false,
                        showCloseButton: true,
                        width: '95%',
                        padding: 0,
                        heightAuto: false,
                        customClass: {
                            container: 'project-detail-container',
                            popup: 'rounded-2xl sm:rounded-3xl shadow-2xl !max-w-[620px] !max-h-[95vh] sm:!max-h-[90vh] !overflow-y-auto !overflow-x-hidden',
                            htmlContainer: '!overflow-visible !m-0 !p-0',
                            closeButton: 'text-white hover:text-tec-gold focus:outline-none !top-3 !right-3 sm:!top-4 sm:!right-4 !w-8 !h-8 sm:!w-10 sm:!h-10 !bg-black/20 !backdrop-blur !rounded-xl hover:!bg-black/40 transition-all !z-50'
                        },
                        didOpen: () => {
                            lucide.createIcons();
                            // Prevenir scroll del body en m√≥viles
                            document.body.style.overflow = 'hidden';
                        },
                        willClose: () => {
                            document.body.style.overflow = '';
                        }
                    });

                } catch (e) {
                    console.error(e);
                }
            },

            // Private Dashboard Fetch
            fetchPrivateData: async () => {
                const tbody = document.getElementById('dashboard-list');
                const kpi = document.getElementById('kpi-projects');
                
                // Cargar estad√≠sticas del dashboard
                Database.loadDashboardStats();
                // Cargar pr√≥ximos eventos y actividad reciente
                Database.loadUpcomingEvents();
                Database.loadRecentActivity();
                // Cargar panel de logros
                Database.loadAchievementsPanel();
                
                if(!tbody) return;

                db.collection('projects').onSnapshot(snap => {
                    if(kpi) kpi.innerText = snap.size;
                    // Actualizar stat de proyectos
                    const statProjects = document.getElementById('stat-projects');
                    if(statProjects) statProjects.innerText = snap.size;
                    
                    if(snap.empty) {
                        tbody.innerHTML = '<tr><td colspan="4" class="p-6 text-center text-xs text-slate-400">Sin registros. Sube tu primer proyecto.</td></tr>';
                        return;
                    }

                    let rows = '';
                    snap.forEach(doc => {
                        const d = doc.data();
                        rows += `
                        <tr class="hover:bg-slate-50 transition group border-b border-slate-100 last:border-0">
                            <td class="px-6 py-4 font-bold text-slate-700 flex items-center gap-3">
                                <div class="w-8 h-8 rounded bg-slate-200 flex items-center justify-center text-slate-500"><i data-lucide="box" class="w-4 h-4"></i></div>
                                ${d.title}
                            </td>
                            <td class="px-6 py-4">
                                <span class="bg-blue-50 text-tec-blue px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider">${d.category}</span>
                            </td>
                            <td class="px-6 py-4 text-xs font-mono text-slate-500 truncate max-w-[150px]">${d.authorName || 'Desconocido'}</td>
                            <td class="px-6 py-4 text-right">
                                ${d.link ? `<a href="${d.link}" target="_blank" class="text-[11px] text-slate-500 font-bold underline mr-2">Link</a>` : ''}
                                <button class="text-red-400 hover:text-red-600 transition p-2 hover:bg-red-50 rounded" onclick="Database.deleteProject('${doc.id}')"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                            </td>
                        </tr>`;
                    });
                    tbody.innerHTML = rows;
                    lucide.createIcons();
                });
            },

            // Cargar estad√≠sticas del dashboard
            loadDashboardStats: async () => {
                try {
                    // Contar miembros
                    const usersSnap = await db.collection('users').get();
                    const statMembers = document.getElementById('stat-members');
                    if(statMembers) statMembers.innerText = usersSnap.size;

                    // Contar competencias
                    const compSnap = await db.collection('competitions').get();
                    const statCompetitions = document.getElementById('stat-competitions');
                    if(statCompetitions) statCompetitions.innerText = compSnap.size;

                    // Contar art√≠culos wiki
                    const wikiSnap = await db.collection('wiki').get();
                    const statWiki = document.getElementById('stat-wiki');
                    if(statWiki) statWiki.innerText = wikiSnap.size;

                } catch (err) {
                    console.log('Error cargando stats:', err);
                }
            },

            // Cargar pr√≥ximos eventos en el dashboard
            loadUpcomingEvents: async () => {
                const container = document.getElementById('upcoming-events');
                if (!container) return;
                
                try {
                    const today = new Date();
                    const snap = await db.collection('competitions')
                        .where('dateStart', '>=', today.toISOString().split('T')[0])
                        .orderBy('dateStart', 'asc')
                        .limit(6)
                        .get();
                    
                    if (snap.empty) {
                        container.innerHTML = `
                            <div class="text-center py-8">
                                <i data-lucide="calendar-x" class="w-10 h-10 text-slate-300 mx-auto mb-2"></i>
                                <p class="text-sm text-slate-400">No hay eventos pr√≥ximos</p>
                                <button onclick="Router.navigate('competitions')" class="mt-2 text-xs text-tec-blue hover:text-tec-gold font-bold">Ver competencias ‚Üí</button>
                            </div>
                        `;
                        lucide.createIcons();
                        return;
                    }
                    
                    // Cargar inscripciones para mostrar participantes
                    const registrationsSnap = await db.collection('competition_registrations')
                        .where('status', '==', 'confirmed')
                        .get();
                    
                    const eventRegistrations = {};
                    for (const doc of registrationsSnap.docs) {
                        const reg = doc.data();
                        if (!eventRegistrations[reg.competitionId]) {
                            eventRegistrations[reg.competitionId] = [];
                        }
                        let userPhoto = null;
                        try {
                            const userDoc = await db.collection('users').doc(reg.userId).get();
                            if (userDoc.exists) {
                                userPhoto = userDoc.data().photoURL;
                            }
                        } catch (e) {}
                        eventRegistrations[reg.competitionId].push({
                            name: reg.userName,
                            photo: userPhoto
                        });
                    }
                    
                    const categoryColors = {
                        'combate': { bg: 'red', gradient: 'from-red-50' },
                        'sumo': { bg: 'purple', gradient: 'from-purple-50' },
                        'seguidor': { bg: 'blue', gradient: 'from-blue-50' },
                        'autonomo': { bg: 'green', gradient: 'from-green-50' },
                        'dron': { bg: 'sky', gradient: 'from-sky-50' },
                        'innovacion': { bg: 'yellow', gradient: 'from-yellow-50' },
                        'otro': { bg: 'orange', gradient: 'from-orange-50' }
                    };
                    
                    const months = ['ENE', 'FEB', 'MAR', 'ABR', 'MAY', 'JUN', 'JUL', 'AGO', 'SEP', 'OCT', 'NOV', 'DIC'];
                    let html = '';
                    
                    snap.forEach(doc => {
                        const event = doc.data();
                        const eventId = doc.id;
                        const date = new Date(event.dateStart);
                        const cat = categoryColors[event.category] || categoryColors.otro;
                        const daysLeft = Math.ceil((date - today) / (1000 * 60 * 60 * 24));
                        let daysText = daysLeft <= 0 ? '¬°Hoy!' : daysLeft === 1 ? 'Ma√±ana' : `En ${daysLeft} d√≠as`;
                        
                        // Generar mini avatares de participantes
                        const participants = eventRegistrations[eventId] || [];
                        let participantsHtml = '';
                        if (participants.length > 0) {
                            const maxShow = 3;
                            const toShow = participants.slice(0, maxShow);
                            const remaining = participants.length - maxShow;
                            
                            participantsHtml = `<div class="flex -space-x-1.5 mt-1">`;
                            toShow.forEach(p => {
                                const initials = p.name.split(' ').map(n => n[0]).slice(0,2).join('').toUpperCase();
                                const photo = p.photo || `https://ui-avatars.com/api/?name=${encodeURIComponent(p.name)}&background=1B396A&color=D4AF37&size=20`;
                                participantsHtml += `<img src="${photo}" alt="${p.name}" title="${p.name}" class="w-5 h-5 rounded-full border border-white object-cover" onerror="this.src='https://ui-avatars.com/api/?name=${initials}&background=1B396A&color=D4AF37&size=20'">`;
                            });
                            if (remaining > 0) {
                                participantsHtml += `<div class="w-5 h-5 rounded-full border border-white bg-slate-200 flex items-center justify-center"><span class="text-[8px] font-bold text-slate-600">+${remaining}</span></div>`;
                            }
                            participantsHtml += `</div>`;
                        } else {
                            participantsHtml = `<p class="text-[9px] text-slate-400 mt-1">Sin inscritos</p>`;
                        }
                        
                        html += `
                            <div class="flex items-start gap-3 p-3 bg-gradient-to-r ${cat.gradient} to-transparent rounded-xl border-l-4 border-${cat.bg}-500 hover:shadow-md transition cursor-pointer" onclick="Router.navigate('competitions')">
                                <div class="flex-shrink-0 w-12 h-12 bg-${cat.bg}-500 rounded-lg flex flex-col items-center justify-center text-white">
                                    <span class="text-[10px] font-bold uppercase">${months[date.getMonth()]}</span>
                                    <span class="text-lg font-black leading-none">${date.getDate()}</span>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="font-bold text-slate-800 text-sm truncate">${event.name}</p>
                                    <p class="text-[10px] text-slate-500">${daysText} - ${event.location || 'Por definir'}</p>
                                    <div class="flex items-center justify-between">
                                        <span class="inline-block mt-1 text-[9px] bg-${cat.bg}-100 text-${cat.bg}-600 px-2 py-0.5 rounded-full font-bold capitalize">${event.category || 'Evento'}</span>
                                        ${participantsHtml}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                    lucide.createIcons();
                } catch (err) {
                    console.log('Error cargando eventos:', err);
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i data-lucide="wifi-off" class="w-10 h-10 text-slate-300 mx-auto mb-2"></i>
                            <p class="text-sm text-slate-400">Error al cargar eventos</p>
                        </div>
                    `;
                    lucide.createIcons();
                }
            },

            // Cargar actividad reciente
            loadRecentActivity: async () => {
                const container = document.getElementById('recent-activity');
                if (!container) return;
                
                try {
                    const activities = [];
                    
                    // Obtener proyectos recientes
                    const projectsSnap = await db.collection('projects').orderBy('date', 'desc').limit(5).get();
                    projectsSnap.forEach(doc => {
                        const data = doc.data();
                        activities.push({
                            type: 'project',
                            icon: 'folder-plus',
                            iconBg: 'blue',
                            text: `<span class="font-bold">Nuevo proyecto</span>: ${data.title}`,
                            author: data.authorName || 'Usuario',
                            timestamp: data.date?.toDate?.() || new Date()
                        });
                    });
                    
                    // Obtener usuarios recientes
                    const usersSnap = await db.collection('users').orderBy('joinedAt', 'desc').limit(5).get();
                    usersSnap.forEach(doc => {
                        const data = doc.data();
                        activities.push({
                            type: 'user',
                            icon: 'user-plus',
                            iconBg: 'green',
                            text: `<span class="font-bold">${data.name || 'Nuevo miembro'}</span> se uni√≥ al club`,
                            author: '',
                            timestamp: data.joinedAt?.toDate?.() || new Date()
                        });
                    });
                    
                    // Obtener art√≠culos wiki recientes
                    const wikiSnap = await db.collection('wiki').orderBy('createdAt', 'desc').limit(5).get();
                    wikiSnap.forEach(doc => {
                        const data = doc.data();
                        activities.push({
                            type: 'wiki',
                            icon: 'file-text',
                            iconBg: 'purple',
                            text: `<span class="font-bold">Art√≠culo</span> creado: ${data.title}`,
                            author: data.authorName || 'Usuario',
                            timestamp: data.createdAt?.toDate?.() || new Date()
                        });
                    });
                    
                    // Obtener reservaciones recientes
                    const reservSnap = await db.collection('reservations').orderBy('createdAt', 'desc').limit(5).get();
                    reservSnap.forEach(doc => {
                        const data = doc.data();
                        activities.push({
                            type: 'reservation',
                            icon: 'calendar-check',
                            iconBg: 'teal',
                            text: `<span class="font-bold">Reservaci√≥n</span>: ${data.equipmentName || 'Equipo'}`,
                            author: data.userName || 'Usuario',
                            timestamp: data.createdAt?.toDate?.() || new Date()
                        });
                    });
                    
                    // Ordenar por timestamp descendente y tomar los 8 m√°s recientes
                    activities.sort((a, b) => b.timestamp - a.timestamp);
                    const recentActivities = activities.slice(0, 8);
                    
                    if (recentActivities.length === 0) {
                        container.innerHTML = `
                            <div class="text-center py-4">
                                <i data-lucide="inbox" class="w-8 h-8 text-slate-300 mx-auto mb-2"></i>
                                <p class="text-sm text-slate-400">Sin actividad reciente</p>
                            </div>
                        `;
                        lucide.createIcons();
                        return;
                    }
                    
                    // Funci√≥n para formatear tiempo relativo
                    const timeAgo = (date) => {
                        const now = new Date();
                        const diffMs = now - date;
                        const diffMins = Math.floor(diffMs / 60000);
                        const diffHours = Math.floor(diffMs / 3600000);
                        const diffDays = Math.floor(diffMs / 86400000);
                        
                        if (diffMins < 1) return 'Ahora mismo';
                        if (diffMins < 60) return `Hace ${diffMins} min`;
                        if (diffHours < 24) return `Hace ${diffHours} hora${diffHours > 1 ? 's' : ''}`;
                        if (diffDays < 7) return `Hace ${diffDays} d√≠a${diffDays > 1 ? 's' : ''}`;
                        return date.toLocaleDateString('es-MX', { day: 'numeric', month: 'short' });
                    };
                    
                    let html = '';
                    recentActivities.forEach(activity => {
                        html += `
                            <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl hover:bg-slate-100 transition">
                                <div class="w-8 h-8 bg-${activity.iconBg}-100 rounded-full flex items-center justify-center flex-shrink-0">
                                    <i data-lucide="${activity.icon}" class="w-4 h-4 text-${activity.iconBg}-600"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm text-slate-700 truncate">${activity.text}</p>
                                    <p class="text-[10px] text-slate-400">${timeAgo(activity.timestamp)}${activity.author ? ` ‚Ä¢ ${activity.author}` : ''}</p>
                                </div>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                    lucide.createIcons();
                } catch (err) {
                    console.log('Error cargando actividad:', err);
                    container.innerHTML = `
                        <div class="text-center py-4">
                            <i data-lucide="alert-circle" class="w-8 h-8 text-slate-300 mx-auto mb-2"></i>
                            <p class="text-sm text-slate-400">Error al cargar</p>
                        </div>
                    `;
                    lucide.createIcons();
                }
            },

            // Cargar panel de logros en el dashboard
            loadAchievementsPanel: async () => {
                const container = document.getElementById('dashboard-achievements');
                if (!container || !STATE.currentUser) return;
                
                try {
                    // Obtener datos del usuario actual incluyendo campos necesarios
                    const userDoc = await db.collection('users').doc(STATE.currentUser.uid).get();
                    if (!userDoc.exists) return;
                    
                    const userData = { id: STATE.currentUser.uid, ...userDoc.data() };
                    
                    // Verificar y notificar nuevos logros
                    await Achievements.checkAndNotify(STATE.currentUser.uid, userData);
                    
                    // Renderizar secci√≥n de logros
                    container.innerHTML = Achievements.renderDashboardSection(userData);
                    container.classList.remove('hidden');
                    lucide.createIcons();
                } catch (err) {
                    console.log('Error cargando logros:', err);
                }
            },

            // Acciones de Base de Datos
            uploadProject: async (e) => {
                e.preventDefault();
                Util.loading(true, "Publicando Proyecto...");

                if (!STATE.currentUser) {
                    Util.loading(false);
                    Modal.open('auth');
                    return;
                }

                // Procesar archivos adjuntos
                const filesInput = document.getElementById('up-files');
                const privateFiles = [];
                
                if (filesInput.files.length > 0) {
                    Util.loading(true, "Procesando archivos...");
                    
                    for (const file of filesInput.files) {
                        // Limitar a 5MB por archivo
                        if (file.size > 5 * 1024 * 1024) {
                            Util.loading(false);
                            Util.notify(`${file.name} excede 5MB`, "error");
                            return;
                        }
                        
                        try {
                            const base64 = await Util.fileToBase64(file);
                            privateFiles.push({
                                name: file.name,
                                type: file.type || 'application/octet-stream',
                                size: file.size,
                                data: base64
                            });
                        } catch (err) {
                            console.error('Error procesando archivo:', err);
                        }
                    }
                }

                // Obtener participantes seleccionados
                const participantsInput = document.getElementById('up-participants');
                let participants = [];
                try {
                    participants = JSON.parse(participantsInput?.value || '[]');
                } catch (e) {
                    participants = [];
                }

                const privateNotes = document.getElementById('up-private-notes')?.value || '';
                
                // Obtener estado del proyecto
                const statusRadio = document.querySelector('input[name="up-status"]:checked');
                const projectStatus = statusRadio ? statusRadio.value : 'completed';
                
                // Obtener porcentaje manual de progreso
                const manualProgressInput = document.getElementById('up-manual-progress');
                const manualProgress = manualProgressInput ? parseInt(manualProgressInput.value) : 0;
                
                // Obtener competencia asociada
                const competitionSelect = document.getElementById('up-competition');
                const competitionId = competitionSelect ? competitionSelect.value : '';
                
                // Obtener galer√≠a de fotos (Google Drive)
                const galleryUrl = document.getElementById('up-gallery-url')?.value || '';
                
                const payload = {
                    title: document.getElementById('up-title').value,
                    desc: document.getElementById('up-desc').value,
                    category: document.getElementById('up-cat').value,
                    link: document.getElementById('up-link').value,
                    author: STATE.currentUser.email,
                    authorName: STATE.currentUser.displayName,
                    date: firebase.firestore.FieldValue.serverTimestamp(),
                    privateFiles: privateFiles, // Archivos solo para miembros
                    hasPrivateFiles: privateFiles.length > 0,
                    participants: participants, // Participantes del proyecto
                    privateNotes: privateNotes, // Notas privadas solo para miembros
                    status: projectStatus, // Estado del proyecto: completed, in_progress, planning
                    manualProgress: manualProgress, // Porcentaje manual cuando no hay tareas
                    competitionId: competitionId || null, // Competencia/torneo asociado
                    galleryUrl: galleryUrl || null // Galer√≠a de fotos (Google Drive)
                };

                try {
                    await db.collection('projects').add(payload);
                    Util.loading(false);
                    Modal.close('upload');
                    Util.notify("Proyecto A√±adido", "success");
                    e.target.reset();
                    document.getElementById('up-files-preview').innerHTML = '';
                    document.getElementById('up-files-preview').classList.add('hidden');
                    document.getElementById('up-competition-preview')?.classList.add('hidden');
                    ProjectMembers.reset('up'); // Resetear selecci√≥n de participantes
                    Database.loadPublicProjects(); // Refrescar vista p√∫blica
                    if (document.getElementById('tab-my-projects')?.classList.contains('hidden') === false) {
                        Dashboard.loadMyProjects(); // Refrescar mis proyectos si est√° visible
                    }
                    
                    // Verificar logros autom√°ticos despu√©s de subir proyecto
                    Achievements.checkAutoAchievements(STATE.currentUser.uid);
                } catch(e) {
                    Util.loading(false);
                    Util.notify(e.message, "error");
                }
            },

            // Editar proyecto existente
            editProject: async (projectId) => {
                if (!STATE.currentUser) {
                    Modal.open('auth');
                    return;
                }

                try {
                    Util.loading(true, "Cargando proyecto...");
                    
                    const doc = await db.collection('projects').doc(projectId).get();
                    if (!doc.exists) {
                        Util.loading(false);
                        Util.notify("Proyecto no encontrado", "error");
                        return;
                    }

                    const p = doc.data();
                    
                    // Verificar que el usuario es el autor
                    if (p.author !== STATE.currentUser.email) {
                        Util.loading(false);
                        Util.notify("Solo el autor puede editar este proyecto", "error");
                        return;
                    }

                    // Cargar miembros si no est√°n cargados
                    if (ProjectMembers.allMembers.length === 0) {
                        await ProjectMembers.loadMembers();
                    }

                    // Llenar el formulario de edici√≥n
                    document.getElementById('edit-project-id').value = projectId;
                    document.getElementById('edit-title').value = p.title || '';
                    document.getElementById('edit-desc').value = p.desc || '';
                    document.getElementById('edit-cat').value = p.category || 'Combate';
                    document.getElementById('edit-link').value = p.link || '';
                    document.getElementById('edit-private-notes').value = p.privateNotes || '';
                    
                    // Establecer estado del proyecto
                    const projectStatus = p.status || 'completed';
                    const statusRadio = document.querySelector(`input[name="edit-status"][value="${projectStatus}"]`);
                    if (statusRadio) statusRadio.checked = true;
                    
                    // Establecer porcentaje manual de progreso
                    const manualProgress = p.manualProgress || 0;
                    const manualProgressInput = document.getElementById('edit-manual-progress');
                    const progressValueSpan = document.getElementById('edit-progress-value');
                    if (manualProgressInput) {
                        manualProgressInput.value = manualProgress;
                    }
                    if (progressValueSpan) {
                        progressValueSpan.textContent = manualProgress + '%';
                    }

                    // Establecer participantes seleccionados
                    const participants = p.participants || [];
                    ProjectMembers.setSelected(participants, 'edit');

                    // Mostrar archivos existentes
                    const existingFilesContainer = document.getElementById('edit-existing-files');
                    const filesList = document.getElementById('edit-files-list');
                    
                    if (p.privateFiles && p.privateFiles.length > 0) {
                        existingFilesContainer?.classList.remove('hidden');
                        let filesHtml = '';
                        p.privateFiles.forEach((file, idx) => {
                            const icon = Util.getFileIcon(file.name);
                            const size = Util.formatFileSize(file.size);
                            filesHtml += `
                                <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-tec-gold/10 rounded-lg flex items-center justify-center">
                                            <i data-lucide="${icon}" class="w-5 h-5 text-tec-gold"></i>
                                        </div>
                                        <div>
                                            <p class="text-sm font-bold text-slate-700 truncate max-w-[200px]">${file.name}</p>
                                            <p class="text-[10px] text-slate-400">${size}</p>
                                        </div>
                                    </div>
                                    <button type="button" onclick="Database.removeExistingFile('${projectId}', ${idx})" class="p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            `;
                        });
                        if (filesList) filesList.innerHTML = filesHtml;
                    } else {
                        existingFilesContainer?.classList.add('hidden');
                    }
                    
                    // Cargar competencias para el selector y establecer la seleccionada
                    await ProjectCompetitionSelector.loadCompetitions('edit', p.competitionId);
                    
                    // Establecer galer√≠a de fotos existente
                    const galleryInput = document.getElementById('edit-gallery-url');
                    if (galleryInput) {
                        galleryInput.value = p.galleryUrl || '';
                    }

                    Util.loading(false);
                    Modal.open('edit-project');
                    lucide.createIcons();

                } catch (err) {
                    Util.loading(false);
                    console.error('Error cargando proyecto:', err);
                    Util.notify("Error al cargar proyecto", "error");
                }
            },

            // Actualizar proyecto
            updateProject: async (e) => {
                e.preventDefault();
                
                if (!STATE.currentUser) {
                    Modal.open('auth');
                    return;
                }

                const projectId = document.getElementById('edit-project-id').value;
                if (!projectId) {
                    Util.notify("ID de proyecto no v√°lido", "error");
                    return;
                }

                Util.loading(true, "Guardando cambios...");

                try {
                    // Obtener el proyecto actual para mantener archivos existentes
                    const doc = await db.collection('projects').doc(projectId).get();
                    if (!doc.exists) {
                        Util.loading(false);
                        Util.notify("Proyecto no encontrado", "error");
                        return;
                    }

                    const currentData = doc.data();
                    let existingFiles = currentData.privateFiles || [];

                    // Procesar nuevos archivos
                    const filesInput = document.getElementById('edit-files');
                    const newFiles = [];
                    
                    if (filesInput && filesInput.files.length > 0) {
                        for (const file of filesInput.files) {
                            if (file.size > 5 * 1024 * 1024) {
                                Util.loading(false);
                                Util.notify(`${file.name} excede 5MB`, "error");
                                return;
                            }
                            
                            try {
                                const base64 = await Util.fileToBase64(file);
                                newFiles.push({
                                    name: file.name,
                                    type: file.type || 'application/octet-stream',
                                    size: file.size,
                                    data: base64
                                });
                            } catch (err) {
                                console.error('Error procesando archivo:', err);
                            }
                        }
                    }

                    // Combinar archivos existentes con nuevos
                    const allFiles = [...existingFiles, ...newFiles];

                    // Obtener participantes
                    const participantsInput = document.getElementById('edit-participants');
                    let participants = [];
                    try {
                        participants = JSON.parse(participantsInput?.value || '[]');
                    } catch (e) {
                        participants = [];
                    }

                    // Obtener estado del proyecto
                    const editStatusRadio = document.querySelector('input[name="edit-status"]:checked');
                    const editProjectStatus = editStatusRadio ? editStatusRadio.value : 'completed';
                    
                    // Obtener porcentaje manual de progreso
                    const editManualProgressInput = document.getElementById('edit-manual-progress');
                    const editManualProgress = editManualProgressInput ? parseInt(editManualProgressInput.value) : 0;
                    
                    // Obtener competencia asociada
                    const editCompetitionSelect = document.getElementById('edit-competition');
                    const editCompetitionId = editCompetitionSelect ? editCompetitionSelect.value : '';
                    
                    // Obtener galer√≠a de fotos
                    const editGalleryUrl = document.getElementById('edit-gallery-url')?.value || '';

                    // Actualizar el proyecto
                    await db.collection('projects').doc(projectId).update({
                        title: document.getElementById('edit-title').value,
                        desc: document.getElementById('edit-desc').value,
                        category: document.getElementById('edit-cat').value,
                        link: document.getElementById('edit-link').value,
                        privateFiles: allFiles,
                        hasPrivateFiles: allFiles.length > 0,
                        participants: participants,
                        privateNotes: document.getElementById('edit-private-notes')?.value || '',
                        status: editProjectStatus,
                        manualProgress: editManualProgress,
                        competitionId: editCompetitionId || null,
                        galleryUrl: editGalleryUrl || null,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    Util.loading(false);
                    Modal.close('edit-project');
                    Util.notify("Proyecto actualizado", "success");
                    
                    // Limpiar formulario
                    document.getElementById('edit-files').value = '';
                    document.getElementById('edit-files-preview').innerHTML = '';
                    document.getElementById('edit-files-preview').classList.add('hidden');
                    ProjectMembers.reset('edit');
                    
                    // Refrescar vistas
                    Database.loadPublicProjects();
                    if (document.getElementById('tab-my-projects')?.classList.contains('hidden') === false) {
                        Dashboard.loadMyProjects();
                    }

                } catch (err) {
                    Util.loading(false);
                    console.error('Error actualizando proyecto:', err);
                    Util.notify("Error al actualizar: " + err.message, "error");
                }
            },

            // Eliminar archivo existente de un proyecto
            removeExistingFile: async (projectId, fileIndex) => {
                if (!confirm("¬øEliminar este archivo?")) return;

                try {
                    Util.loading(true, "Eliminando archivo...");
                    
                    const doc = await db.collection('projects').doc(projectId).get();
                    if (!doc.exists) {
                        Util.loading(false);
                        return;
                    }

                    const data = doc.data();
                    const files = data.privateFiles || [];
                    
                    if (fileIndex >= 0 && fileIndex < files.length) {
                        files.splice(fileIndex, 1);
                        
                        await db.collection('projects').doc(projectId).update({
                            privateFiles: files,
                            hasPrivateFiles: files.length > 0
                        });

                        // Actualizar UI
                        const filesList = document.getElementById('edit-files-list');
                        const existingFilesContainer = document.getElementById('edit-existing-files');
                        
                        if (files.length === 0) {
                            existingFilesContainer?.classList.add('hidden');
                        } else {
                            // Recargar el modal de edici√≥n
                            Database.editProject(projectId);
                        }
                        
                        Util.notify("Archivo eliminado", "success");
                    }
                    
                    Util.loading(false);
                } catch (err) {
                    Util.loading(false);
                    console.error('Error eliminando archivo:', err);
                    Util.notify("Error al eliminar archivo", "error");
                }
            },

            deleteProject: (id) => {
                Swal.fire({
                    title: '¬øEliminar proyecto?',
                    text: 'Esta acci√≥n no se puede deshacer',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#ef4444',
                    cancelButtonColor: '#64748b',
                    confirmButtonText: 'S√≠, eliminar',
                    cancelButtonText: 'Cancelar'
                }).then((result) => {
                    if (result.isConfirmed) {
                        db.collection('projects').doc(id).delete().then(() => {
                            Util.notify("Proyecto eliminado", "success");
                            Database.loadPublicProjects();
                            if (document.getElementById('tab-my-projects')?.classList.contains('hidden') === false) {
                                Dashboard.loadMyProjects();
                            }
                        });
                    }
                });
            },

            submitApplication: async (e) => {
                e.preventDefault();
                // Simple form handling saving to 'applications'
                const payload = {
                    name: document.getElementById('app-name').value,
                    control: document.getElementById('app-control').value,
                    semester: document.getElementById('app-sem').value,
                    career: document.getElementById('app-career').value,
                    reason: document.getElementById('app-reason').value,
                    submittedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                try {
                    await db.collection('applications').add(payload);
                    Swal.fire("Solicitud Recibida", "El consejo directivo revisar√° tu perfil. Mantente atento a tu correo.", "success");
                    e.target.reset();
                } catch(e) {
                    Util.notify("Error de red", "error");
                }
            },

            saveProfile: async (e) => {
                e.preventDefault();
                if (!STATE.currentUser) { Modal.open('auth'); return; }

                const fullName = document.getElementById('profile-name').value.trim();
                // El customTitle solo puede ser cambiado por admin desde el panel de gesti√≥n
                const customTitle = STATE.profile?.customTitle || '';
                const photoURL = document.getElementById('profile-photo').value.trim();
                const controlNumber = document.getElementById('profile-control').value.trim();
                const semester = document.getElementById('profile-semester').value;
                const career = document.getElementById('profile-career').value;
                const areaEl = document.querySelector('input[name="profile-area"]:checked');
                const area = areaEl ? areaEl.value : '';
                const bio = document.getElementById('profile-bio').value.trim();
                const github = document.getElementById('profile-github').value.trim();
                const linkedin = document.getElementById('profile-linkedin').value.trim();
                const skills = STATE.profileSkills || [];

                // Mapeo de √°reas para mostrar nombre legible
                const areaNames = {
                    'gestion': 'Gesti√≥n y Vinculaci√≥n',
                    'telecom': 'Telecomunicaciones y Redes',
                    'software': 'Software, Autonom√≠a e IA',
                    'electronica': 'Electr√≥nica y Control',
                    'mecanico': 'Dise√±o Mec√°nico y Manufactura'
                };

                Util.loading(true, "Guardando perfil...");
                try {
                    // Solo actualizar displayName en Firebase Auth (photoURL no acepta Base64 largo)
                    await STATE.currentUser.updateProfile({ displayName: fullName });
                    
                    // Guardar todo en Firestore (incluyendo foto Base64)
                    await db.collection('users').doc(STATE.currentUser.uid).set({
                        fullName,
                        customTitle, // T√≠tulo personalizado (ej: L√≠der y Fundador)
                        photoURL, // Base64 o URL externa
                        controlNumber,
                        semester,
                        career,
                        area,
                        areaName: areaNames[area] || area,
                        skills,
                        bio,
                        github,
                        linkedin,
                        role: STATE.profile?.role || 'member',
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    }, { merge: true });

                    document.getElementById('dash-username').innerText = fullName;
                    // Mostrar t√≠tulo personalizado si existe, sino el √°rea
                    const displayRole = customTitle || areaNames[area] || 'Miembro';
                    document.getElementById('dash-role').innerText = displayRole.toUpperCase();
                    if (photoURL) document.getElementById('dash-avatar').src = photoURL;
                    STATE.profile = { ...(STATE.profile || {}), fullName, customTitle, photoURL, area, areaName: areaNames[area], skills, bio, github, linkedin, controlNumber, semester, career };
                    Util.loading(false);
                    Util.notify("Perfil actualizado", "success");
                    Database.loadPublicMembers();
                    
                    // Verificar logros autom√°ticos despu√©s de actualizar perfil
                    Achievements.checkAutoAchievements(STATE.currentUser.uid);
                } catch (err) {
                    console.error("Error guardando perfil:", err);
                    Util.loading(false);
                    
                    // Mensaje m√°s espec√≠fico seg√∫n el error
                    if (err.code === 'resource-exhausted' || err.message?.includes('size')) {
                        Util.notify("La imagen es muy grande. Intenta con una m√°s peque√±a.", "error");
                    } else {
                        Util.notify("No se pudo guardar el perfil: " + (err.message || err.code), "error");
                    }
                }
            },

            loadPublicMembers: async () => {
                const grid = document.getElementById('members-grid');
                if (!grid) return;
                grid.innerHTML = '<div class="p-6 glass-card rounded-2xl shadow-sm animate-pulse"><div class="w-16 h-16 rounded-full bg-slate-200 mb-4 mx-auto"></div><div class="h-4 bg-slate-200 w-3/4 mb-2 rounded mx-auto"></div><div class="h-3 bg-slate-200 w-1/2 rounded mx-auto"></div></div>';
                
                // Email del superadmin que puede eliminar miembros
                const SUPER_ADMIN_EMAIL = 'a23490819@itmexicali.edu.mx';
                // Verificar si el usuario actual es fundador o admin
                const currentUserTitle = (STATE.profile?.customTitle || '').toLowerCase();
                const isFounder = currentUserTitle.includes('fundador') || currentUserTitle.includes('founder');
                const isAdmin = STATE.profile?.role === 'admin';
                const canDeleteMembers = STATE.currentUser && (STATE.currentUser.email === SUPER_ADMIN_EMAIL || isFounder || isAdmin);

                try {
                    const snap = await db.collection('users').orderBy('joinedAt', 'desc').limit(20).get();
                    
                    // Actualizar contadores de miembros en diferentes lugares
                    const count = snap.size;
                    const membersCountEl = document.getElementById('members-count-stat');
                    const membersCountCta = document.getElementById('members-count-cta');
                    if (membersCountEl) membersCountEl.innerText = count;
                    if (membersCountCta) membersCountCta.innerText = count;
                    
                    if (snap.empty) {
                        grid.innerHTML = '<div class="col-span-full text-center py-12"><i data-lucide="users" class="w-12 h-12 text-slate-300 mx-auto mb-4"></i><p class="text-slate-400 text-sm">A√∫n no hay miembros registrados.</p><p class="text-xs text-slate-300 mt-1">S√© el primero en unirte al equipo</p></div>';
                        lucide.createIcons();
                        return;
                    }

                    // Colores por √°rea
                    const areaColors = {
                        'gestion': { bg: 'bg-purple-100', text: 'text-purple-700', icon: 'briefcase' },
                        'telecom': { bg: 'bg-blue-100', text: 'text-blue-700', icon: 'wifi' },
                        'software': { bg: 'bg-green-100', text: 'text-green-700', icon: 'brain' },
                        'electronica': { bg: 'bg-orange-100', text: 'text-orange-700', icon: 'cpu' },
                        'mecanico': { bg: 'bg-red-100', text: 'text-red-700', icon: 'cog' }
                    };

                    let html = '';
                    let delay = 0;
                    snap.forEach(doc => {
                        const u = doc.data();
                        const name = u.fullName || 'Miembro CRAI';
                        const photo = u.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=1B396A&color=D4AF37&bold=true`;
                        const areaStyle = areaColors[u.area] || { bg: 'bg-slate-100', text: 'text-slate-600', icon: 'user' };
                        
                        // Prioridad: T√≠tulo personalizado > Nombre del √°rea > Rol > Miembro
                        const displayRole = u.customTitle || u.areaName || u.role || 'Miembro';
                        const roleColor = u.customTitle ? 'bg-tec-gold/20 text-tec-gold border-tec-gold' : (u.role === 'admin' ? 'bg-tec-gold/10 text-tec-gold border-tec-gold' : `${areaStyle.bg} ${areaStyle.text}`);
                        const skills = u.skills || [];
                        
                        html += `
                        <div class="group glass-card rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 hover:-translate-y-1 animate-fade-up overflow-hidden" style="animation-delay: ${delay}ms;">
                            <div class="p-5">
                                <div class="flex items-start gap-4">
                                    <div class="relative flex-shrink-0">
                                        <img src="${photo}" class="w-16 h-16 rounded-xl object-cover border-2 border-white shadow-md group-hover:scale-105 transition-transform duration-300" alt="${name}">
                                        <div class="absolute -bottom-1 -right-1 w-5 h-5 ${areaStyle.bg} border-2 border-white rounded-lg flex items-center justify-center">
                                            <i data-lucide="${areaStyle.icon}" class="w-3 h-3 ${areaStyle.text}"></i>
                                        </div>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p class="font-bold text-tec-blue leading-tight truncate group-hover:text-tec-gold transition-colors text-sm">${name}</p>
                                        <span class="inline-block text-[9px] ${roleColor} px-2 py-0.5 rounded-full font-bold uppercase tracking-wide mt-1 border">${displayRole}</span>
                                        ${u.career ? `<p class="text-[10px] text-slate-500 mt-1">${u.career}${u.semester ? ` ‚Ä¢ ${u.semester}¬∞ Sem` : ''}</p>` : ''}
                                    </div>
                                </div>
                                ${u.bio ? `<p class="text-[11px] text-slate-500 line-clamp-2 mt-3 leading-relaxed">${u.bio}</p>` : ''}
                                ${skills.length > 0 ? `
                                <div class="flex flex-wrap gap-1 mt-3">
                                    ${skills.slice(0, 4).map(s => `<span class="text-[9px] bg-slate-100 text-slate-600 px-2 py-0.5 rounded-full">${s}</span>`).join('')}
                                    ${skills.length > 4 ? `<span class="text-[9px] text-slate-400">+${skills.length - 4}</span>` : ''}
                                </div>` : ''}
                            </div>
                            ${(u.github || u.linkedin) ? `
                            <div class="px-5 py-3 bg-slate-50 border-t border-slate-100 flex gap-3">
                                ${u.github ? `<a href="https://github.com/${u.github}" target="_blank" class="text-[10px] text-slate-500 hover:text-slate-700 flex items-center gap-1"><i data-lucide="github" class="w-3 h-3"></i>${u.github}</a>` : ''}
                                ${u.linkedin ? `<a href="${u.linkedin.startsWith('http') ? u.linkedin : 'https://linkedin.com/in/' + u.linkedin}" target="_blank" class="text-[10px] text-slate-500 hover:text-blue-600 flex items-center gap-1"><i data-lucide="linkedin" class="w-3 h-3"></i>LinkedIn</a>` : ''}
                            </div>` : ''}
                            ${canDeleteMembers && u.email !== SUPER_ADMIN_EMAIL ? `
                            <div class="px-5 py-2 bg-red-50 border-t border-red-100">
                                <button onclick="Database.deleteMember('${doc.id}', '${name.replace(/'/g, "\\'").replace(/"/g, '')}')" class="w-full text-[10px] text-red-500 hover:text-red-700 font-bold flex items-center justify-center gap-1 py-1 hover:bg-red-100 rounded transition">
                                    <i data-lucide="trash-2" class="w-3 h-3"></i> Eliminar Miembro
                                </button>
                            </div>` : ''}
                        </div>`;
                        delay += 100;
                    });

                    grid.innerHTML = html;
                    lucide.createIcons();
                } catch (err) {
                    console.error(err);
                    grid.innerHTML = '<div class="col-span-full text-center py-12"><i data-lucide="alert-circle" class="w-12 h-12 text-red-300 mx-auto mb-4"></i><p class="text-red-500 text-sm">Error cargando miembros.</p></div>';
                    lucide.createIcons();
                }
            },
            
            deleteMember: async (userId, userName) => {
                // Verificar que solo el superadmin, fundadores o admins puedan eliminar
                const SUPER_ADMIN_EMAIL = 'a23490819@itmexicali.edu.mx';
                const currentUserTitle = (STATE.profile?.customTitle || '').toLowerCase();
                const isFounder = currentUserTitle.includes('fundador') || currentUserTitle.includes('founder');
                const isAdmin = STATE.profile?.role === 'admin';
                
                if (!STATE.currentUser || (STATE.currentUser.email !== SUPER_ADMIN_EMAIL && !isFounder && !isAdmin)) {
                    Util.notify('No tienes permisos para eliminar miembros', 'error');
                    return;
                }
                
                // Confirmaci√≥n con SweetAlert
                const result = await Swal.fire({
                    title: '¬øEliminar miembro?',
                    html: `<p class="text-sm text-slate-600">Est√°s a punto de eliminar a <strong>${userName}</strong> del club.</p><p class="text-xs text-red-500 mt-2">Esta acci√≥n eliminar√° su perfil de la base de datos. El usuario ya no podr√° acceder con esta cuenta.</p>`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#dc2626',
                    cancelButtonColor: '#64748b',
                    confirmButtonText: 'S√≠, eliminar',
                    cancelButtonText: 'Cancelar'
                });
                
                if (!result.isConfirmed) return;
                
                try {
                    Util.loading(true, 'Eliminando miembro...');
                    
                    // Eliminar documento del usuario en Firestore
                    await db.collection('users').doc(userId).delete();
                    
                    Util.loading(false);
                    Util.notify(`${userName} ha sido eliminado del club`, 'success');
                    
                    // Recargar lista de miembros
                    Database.loadPublicMembers();
                } catch (error) {
                    Util.loading(false);
                    console.error('Error eliminando miembro:', error);
                    Util.notify('Error al eliminar miembro: ' + error.message, 'error');
                }
            }
        };

        /**
         * ==========================================
         * 6. CHAT REAL-TIME SERVICE
         * ==========================================
         */
        const Chat = {
            connect: () => {
                const container = document.getElementById('chat-messages');
                const input = document.getElementById('chat-input');
                const btn = document.getElementById('chat-send-btn');
                
                if(!container) return;

                // Activar Input
                input.disabled = false;
                btn.disabled = false;

                // Snapshot Listener (Tiempo Real)
                STATE.unsubscribeChat = db.collection('chat_logs').orderBy('ts', 'asc').limitToLast(50)
                    .onSnapshot(snapshot => {
                        container.innerHTML = '';
                        if(snapshot.empty) {
                            container.innerHTML = '<div class="text-center text-xs text-slate-300 mt-10">Canal Seguro Establecido. Inicia la conversaci√≥n.</div>';
                        }

                        snapshot.forEach(doc => {
                            const msg = doc.data();
                            const isMe = msg.uid === STATE.currentUser.uid;
                            
                            const html = `
                            <div class="flex gap-3 mb-4 ${isMe ? 'flex-row-reverse' : ''} animate-fade-in-up">
                                <div class="w-8 h-8 rounded-full bg-slate-200 border-2 border-white shadow-sm flex-shrink-0 overflow-hidden">
                                    <img src="https://ui-avatars.com/api/?name=${msg.author}&background=${isMe ? 'D4AF37' : '1B396A'}&color=fff&size=64" class="w-full h-full object-cover">
                                </div>
                                <div class="flex flex-col ${isMe ? 'items-end' : 'items-start'} max-w-[80%]">
                                    <span class="text-[9px] text-slate-400 font-bold mb-1 ml-1">${msg.author}</span>
                                    <div class="${isMe ? 'bg-tec-blue text-white rounded-br-none' : 'bg-white border border-slate-200 text-slate-600 rounded-bl-none'} px-4 py-2.5 rounded-xl text-xs font-medium shadow-sm leading-relaxed">
                                        ${msg.text}
                                    </div>
                                </div>
                            </div>`;
                            container.insertAdjacentHTML('beforeend', html);
                        });
                        
                        // Auto Scroll Bottom
                        container.scrollTop = container.scrollHeight;
                    });
            },

            send: async (e) => {
                e.preventDefault();
                const inp = document.getElementById('chat-input');
                const txt = inp.value.trim();
                
                if(!txt || !STATE.currentUser) return;

                inp.value = '';
                
                try {
                    await db.collection('chat_logs').add({
                        text: txt,
                        uid: STATE.currentUser.uid,
                        author: STATE.currentUser.displayName || "Agente",
                        ts: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch(e) {
                    console.error("Error chat", e);
                }
            }
        };

        /**
         * ==========================================
         * 7. ROUTING & UI UTILITIES
         * ==========================================
         */
        const Router = {
            to: (view) => {
                if (view === 'dashboard' && !STATE.currentUser) {
                    Modal.open('auth'); return;
                }

                document.querySelectorAll('.view-section').forEach(v => {
                    v.classList.add('hidden');
                    v.classList.remove('animate-fade-in');
                });
                
                const target = document.getElementById(`view-${view}`);
                if (target) {
                    target.classList.remove('hidden');
                    target.classList.add('animate-fade-in');
                    
                    // Logic triggers on view switch
                    if(view === 'public-projects') Database.loadPublicProjects();
                    if(view === 'public-events') PublicEvents.load();
                    if(view === 'resources') Resources.load();
                    if(view === 'members') Members.load();
                    if(view === 'reservations') Reservations.init();
                    if(view === 'inventory') Inventory.load();
                    if(view === 'wiki') Wiki.load();
                    if(view === 'competitions') Competitions.load();
                    if(view === 'tasks') Tasks.load();
                    if(view === 'calendar') Calendar.load();
                    if(view === 'communications') Communications.load();
                    if(view === 'admin-members') AdminMembers.load();
                }
                
                window.scrollTo(0, 0);
            },

            // Alias para navigate
            navigate: (view) => Router.to(view),

            switchTab: (tabName) => {
                // Ocultar todos los tabs del dashboard
                document.querySelectorAll('#view-dashboard [id^="tab-"]').forEach(tab => {
                    tab.classList.add('hidden');
                });
                // Mostrar el tab seleccionado
                const targetTab = document.getElementById(`tab-${tabName}`);
                if (targetTab) {
                    targetTab.classList.remove('hidden');
                }
                
                // Si es el tab de perfil, cargar los datos y skills
                if (tabName === 'profile') {
                    Profile.loadFromState();
                }
            }
        };

        // Alias para Dashboard con funciones adicionales
        const Dashboard = {
            showTab: (tabName) => {
                Router.to('dashboard');
                setTimeout(() => Router.switchTab(tabName), 100);
            },
            
            // Mostrar mis proyectos
            showMyProjects: async () => {
                Router.to('dashboard');
                
                // Ocultar todos los tabs y mostrar el de mis proyectos
                document.querySelectorAll('#view-dashboard main > div').forEach(tab => {
                    tab.classList.add('hidden');
                });
                document.getElementById('tab-my-projects')?.classList.remove('hidden');
                
                await Dashboard.loadMyProjects();
            },
            
            // Cargar mis proyectos
            myProjectsData: [],
            myProjectsFilter: 'all',
            
            loadMyProjects: async () => {
                if (!STATE.currentUser) return;
                
                const container = document.getElementById('my-projects-list');
                const emptyState = document.getElementById('my-projects-empty');
                const countEl = document.getElementById('my-projects-count');
                
                if (!container) return;
                
                try {
                    // Obtener proyectos donde el usuario es autor
                    const authorSnap = await db.collection('projects').where('author', '==', STATE.currentUser.email).get();
                    
                    // Obtener todos los proyectos para filtrar por participante
                    const allProjectsSnap = await db.collection('projects').get();
                    
                    Dashboard.myProjectsData = [];
                    
                    // Proyectos como autor
                    authorSnap.forEach(doc => {
                        Dashboard.myProjectsData.push({
                            id: doc.id,
                            data: doc.data(),
                            role: 'author'
                        });
                    });
                    
                    // Proyectos como participante (excluyendo los que ya somos autor)
                    const authorIds = new Set(Dashboard.myProjectsData.map(p => p.id));
                    
                    allProjectsSnap.forEach(doc => {
                        if (authorIds.has(doc.id)) return;
                        
                        const data = doc.data();
                        const participants = data.participants || [];
                        
                        if (participants.some(p => p.email === STATE.currentUser.email || p.id === STATE.currentUser.uid)) {
                            Dashboard.myProjectsData.push({
                                id: doc.id,
                                data: data,
                                role: 'participant'
                            });
                        }
                    });
                    
                    // Actualizar contador
                    if (countEl) countEl.textContent = Dashboard.myProjectsData.length;
                    
                    // Aplicar filtro y renderizar
                    Dashboard.filterMyProjects(Dashboard.myProjectsFilter);
                    
                } catch (err) {
                    console.error('Error cargando mis proyectos:', err);
                    container.innerHTML = `
                        <div class="text-center py-12 bg-red-50 rounded-xl">
                            <i data-lucide="alert-circle" class="w-12 h-12 text-red-300 mx-auto mb-4"></i>
                            <p class="text-red-600 font-bold">Error al cargar proyectos</p>
                            <p class="text-sm text-red-400">${err.message}</p>
                        </div>
                    `;
                    lucide.createIcons();
                }
            },
            
            filterMyProjects: (filter) => {
                Dashboard.myProjectsFilter = filter;
                
                const container = document.getElementById('my-projects-list');
                const emptyState = document.getElementById('my-projects-empty');
                
                if (!container) return;
                
                let filtered = Dashboard.myProjectsData;
                
                if (filter === 'author') {
                    filtered = filtered.filter(p => p.role === 'author');
                } else if (filter === 'participant') {
                    filtered = filtered.filter(p => p.role === 'participant');
                }
                
                if (filtered.length === 0) {
                    container.classList.add('hidden');
                    emptyState?.classList.remove('hidden');
                    return;
                }
                
                container.classList.remove('hidden');
                emptyState?.classList.add('hidden');
                
                // Ordenar por fecha
                filtered.sort((a, b) => (b.data.date?.seconds || 0) - (a.data.date?.seconds || 0));
                
                let html = '';
                filtered.forEach(project => {
                    const p = project.data;
                    const projectId = project.id;
                    const isAuthor = project.role === 'author';
                    const hasFiles = p.privateFiles && p.privateFiles.length > 0;
                    const filesCount = p.privateFiles?.length || 0;
                    const participants = p.participants || [];
                    const categoryIcon = ProjectsFilter.getCategoryIcon(p.category);
                    const categoryColor = ProjectsFilter.getCategoryColor(p.category);
                    const dateStr = p.date ? new Date(p.date.seconds * 1000).toLocaleDateString('es-MX', { year: 'numeric', month: 'short', day: 'numeric' }) : 'Sin fecha';
                    
                    html += `
                    <div class="bg-white rounded-2xl border border-slate-200 overflow-hidden hover:shadow-lg hover:border-slate-300 transition-all group">
                        <div class="p-5">
                            <div class="flex flex-col sm:flex-row sm:items-start gap-4">
                                <!-- Icono categor√≠a -->
                                <div class="w-14 h-14 ${categoryColor.light} rounded-xl flex items-center justify-center flex-shrink-0">
                                    <i data-lucide="${categoryIcon}" class="w-7 h-7 ${categoryColor.text}"></i>
                                </div>
                                
                                <!-- Info principal -->
                                <div class="flex-1 min-w-0">
                                    <div class="flex flex-wrap items-center gap-2 mb-2">
                                        <span class="px-2 py-1 ${categoryColor.light} ${categoryColor.text} rounded-lg text-[10px] font-bold uppercase">${p.category || 'General'}</span>
                                        ${isAuthor ? 
                                            '<span class="px-2 py-1 bg-tec-gold/10 text-tec-gold rounded-lg text-[10px] font-bold flex items-center gap-1"><i data-lucide="crown" class="w-3 h-3"></i> Autor</span>' : 
                                            '<span class="px-2 py-1 bg-blue-50 text-blue-600 rounded-lg text-[10px] font-bold flex items-center gap-1"><i data-lucide="user-check" class="w-3 h-3"></i> Participante</span>'
                                        }
                                        ${hasFiles ? `<span class="px-2 py-1 bg-slate-100 text-slate-500 rounded-lg text-[10px] font-bold flex items-center gap-1"><i data-lucide="paperclip" class="w-3 h-3"></i> ${filesCount}</span>` : ''}
                                    </div>
                                    
                                    <h3 class="font-bold text-lg text-slate-800 mb-1 group-hover:text-tec-blue transition">${p.title}</h3>
                                    <p class="text-sm text-slate-500 line-clamp-2 mb-3">${p.desc}</p>
                                    
                                    <!-- Participantes -->
                                    ${participants.length > 0 ? `
                                    <div class="flex items-center gap-2 mb-3">
                                        <span class="text-[10px] text-slate-400 font-bold uppercase">Equipo:</span>
                                        <div class="flex -space-x-2">
                                            ${participants.slice(0, 4).map(part => `
                                                <img src="${part.photo || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(part.name) + '&background=1B396A&color=fff'}" 
                                                     class="w-6 h-6 rounded-full border-2 border-white" 
                                                     title="${part.name}"
                                                     alt="${part.name}">
                                            `).join('')}
                                            ${participants.length > 4 ? `<span class="w-6 h-6 rounded-full bg-slate-200 border-2 border-white flex items-center justify-center text-[9px] font-bold text-slate-600">+${participants.length - 4}</span>` : ''}
                                        </div>
                                    </div>` : ''}
                                    
                                    <!-- Meta info -->
                                    <div class="flex items-center gap-4 text-xs text-slate-400">
                                        <span class="flex items-center gap-1">
                                            <i data-lucide="calendar" class="w-3 h-3"></i> ${dateStr}
                                        </span>
                                        ${p.link ? `
                                        <a href="${p.link}" target="_blank" class="flex items-center gap-1 hover:text-tec-blue transition" onclick="event.stopPropagation()">
                                            <i data-lucide="external-link" class="w-3 h-3"></i> Repositorio
                                        </a>` : ''}
                                    </div>
                                </div>
                                
                                <!-- Acciones -->
                                <div class="flex sm:flex-col gap-2 flex-shrink-0">
                                    ${isAuthor ? `
                                    <button onclick="Database.editProject('${projectId}')" class="flex items-center justify-center gap-2 px-4 py-2 bg-amber-50 text-amber-600 rounded-lg font-bold text-xs hover:bg-amber-100 transition">
                                        <i data-lucide="edit-2" class="w-4 h-4"></i>
                                        <span class="hidden sm:inline">Editar</span>
                                    </button>
                                    <button onclick="Database.deleteProject('${projectId}')" class="flex items-center justify-center gap-2 px-4 py-2 bg-red-50 text-red-500 rounded-lg font-bold text-xs hover:bg-red-100 transition">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                        <span class="hidden sm:inline">Eliminar</span>
                                    </button>` : `
                                    <button onclick="Database.showProjectDetail('${projectId}')" class="flex items-center justify-center gap-2 px-4 py-2 bg-tec-blue/10 text-tec-blue rounded-lg font-bold text-xs hover:bg-tec-blue/20 transition">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                        <span class="hidden sm:inline">Ver</span>
                                    </button>`}
                                </div>
                            </div>
                        </div>
                    </div>`;
                });
                
                container.innerHTML = html;
                lucide.createIcons();
            }
        };

        /**
         * ==========================================
         * PROJECT-COMPETITION SELECTOR (Vinculaci√≥n)
         * ==========================================
         */
        const ProjectCompetitionSelector = {
            allCompetitions: [],
            allProjects: [],
            
            // Cargar competencias disponibles para el selector de proyecto
            loadCompetitions: async (prefix = 'up', selectedId = '') => {
                try {
                    const snap = await db.collection('competitions').orderBy('dateStart', 'desc').get();
                    ProjectCompetitionSelector.allCompetitions = [];
                    
                    snap.forEach(doc => {
                        const data = doc.data();
                        ProjectCompetitionSelector.allCompetitions.push({
                            id: doc.id,
                            name: data.name,
                            dateStart: data.dateStart,
                            location: data.location,
                            category: data.category,
                            link: data.link
                        });
                    });
                    
                    // Renderizar el selector
                    const select = document.getElementById(`${prefix}-competition`);
                    if (select) {
                        let html = '<option value="">Sin competencia asignada</option>';
                        ProjectCompetitionSelector.allCompetitions.forEach(comp => {
                            const dateStr = comp.dateStart ? new Date(comp.dateStart).toLocaleDateString('es-MX', { month: 'short', year: 'numeric' }) : '';
                            const selected = comp.id === selectedId ? 'selected' : '';
                            html += `<option value="${comp.id}" ${selected}>üèÜ ${comp.name} ${dateStr ? `(${dateStr})` : ''}</option>`;
                        });
                        select.innerHTML = html;
                        
                        // Agregar evento de cambio para mostrar preview
                        select.onchange = () => ProjectCompetitionSelector.updateCompetitionPreview(prefix);
                        
                        // Mostrar preview si hay selecci√≥n inicial
                        if (selectedId) {
                            ProjectCompetitionSelector.updateCompetitionPreview(prefix);
                        }
                    }
                } catch (err) {
                    console.error('Error cargando competencias:', err);
                }
            },
            
            // Actualizar preview de competencia seleccionada
            updateCompetitionPreview: (prefix) => {
                const select = document.getElementById(`${prefix}-competition`);
                const preview = document.getElementById(`${prefix}-competition-preview`);
                const nameEl = document.getElementById(`${prefix}-competition-name`);
                const infoEl = document.getElementById(`${prefix}-competition-info`);
                
                if (!select || !preview) return;
                
                const compId = select.value;
                if (!compId) {
                    preview.classList.add('hidden');
                    return;
                }
                
                const comp = ProjectCompetitionSelector.allCompetitions.find(c => c.id === compId);
                if (comp) {
                    if (nameEl) nameEl.textContent = comp.name;
                    if (infoEl) {
                        const dateStr = comp.dateStart ? new Date(comp.dateStart).toLocaleDateString('es-MX', { day: 'numeric', month: 'long', year: 'numeric' }) : '';
                        infoEl.textContent = `${dateStr}${comp.location ? ' ‚Ä¢ ' + comp.location : ''}`;
                    }
                    preview.classList.remove('hidden');
                } else {
                    preview.classList.add('hidden');
                }
                lucide.createIcons();
            },
            
            // Cargar proyectos disponibles para el selector de competencia
            loadProjects: async (prefix = 'comp', selectedId = '') => {
                try {
                    const snap = await db.collection('projects').orderBy('date', 'desc').get();
                    ProjectCompetitionSelector.allProjects = [];
                    
                    snap.forEach(doc => {
                        const data = doc.data();
                        ProjectCompetitionSelector.allProjects.push({
                            id: doc.id,
                            title: data.title,
                            category: data.category,
                            authorName: data.authorName
                        });
                    });
                    
                    // Renderizar el selector
                    const select = document.getElementById(`${prefix}-project`);
                    if (select) {
                        let html = '<option value="">Sin proyecto asignado</option>';
                        ProjectCompetitionSelector.allProjects.forEach(proj => {
                            const selected = proj.id === selectedId ? 'selected' : '';
                            html += `<option value="${proj.id}" ${selected}>ü§ñ ${proj.title} (${proj.category || 'General'})</option>`;
                        });
                        select.innerHTML = html;
                        
                        // Agregar evento de cambio para mostrar preview
                        select.onchange = () => ProjectCompetitionSelector.updateProjectPreview(prefix);
                        
                        // Mostrar preview si hay selecci√≥n inicial
                        if (selectedId) {
                            ProjectCompetitionSelector.updateProjectPreview(prefix);
                        }
                    }
                } catch (err) {
                    console.error('Error cargando proyectos:', err);
                }
            },
            
            // Actualizar preview de proyecto seleccionado
            updateProjectPreview: (prefix) => {
                const select = document.getElementById(`${prefix}-project`);
                const preview = document.getElementById(`${prefix}-project-preview`);
                const nameEl = document.getElementById(`${prefix}-project-name`);
                const infoEl = document.getElementById(`${prefix}-project-info`);
                
                if (!select || !preview) return;
                
                const projId = select.value;
                if (!projId) {
                    preview.classList.add('hidden');
                    return;
                }
                
                const proj = ProjectCompetitionSelector.allProjects.find(p => p.id === projId);
                if (proj) {
                    if (nameEl) nameEl.textContent = proj.title;
                    if (infoEl) infoEl.textContent = `${proj.category || 'General'} ‚Ä¢ ${proj.authorName || 'CRAI'}`;
                    preview.classList.remove('hidden');
                } else {
                    preview.classList.add('hidden');
                }
                lucide.createIcons();
            },
            
            // Obtener informaci√≥n de competencia por ID
            getCompetitionInfo: async (compId) => {
                if (!compId) return null;
                try {
                    const doc = await db.collection('competitions').doc(compId).get();
                    if (doc.exists) {
                        return { id: doc.id, ...doc.data() };
                    }
                } catch (err) {
                    console.error('Error obteniendo competencia:', err);
                }
                return null;
            }
        };

        /**
         * ==========================================
         * PROJECT MEMBERS (Sistema de Participantes)
         * ==========================================
         */
        const ProjectMembers = {
            allMembers: [],
            selectedMembers: [],
            selectedMembersEdit: [],
            
            // Cargar miembros disponibles
            loadMembers: async () => {
                try {
                    const snap = await db.collection('users').orderBy('fullName').get();
                    ProjectMembers.allMembers = [];
                    
                    snap.forEach(doc => {
                        const data = doc.data();
                        ProjectMembers.allMembers.push({
                            id: doc.id,
                            email: data.email || '',
                            name: data.fullName || 'Miembro CRAI',
                            photo: data.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(data.fullName || 'M')}&background=1B396A&color=fff`,
                            area: data.areaName || data.area || '',
                            career: data.career || ''
                        });
                    });
                    
                    ProjectMembers.renderMembersList('up-members-list', 'up');
                } catch (err) {
                    console.error('Error cargando miembros:', err);
                }
            },
            
            // Renderizar lista de miembros
            renderMembersList: (containerId, prefix) => {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                const members = ProjectMembers.allMembers;
                const selected = prefix === 'up' ? ProjectMembers.selectedMembers : ProjectMembers.selectedMembersEdit;
                
                if (members.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-4">
                            <i data-lucide="users" class="w-8 h-8 text-slate-300 mx-auto mb-2"></i>
                            <p class="text-xs text-slate-400">No hay miembros registrados</p>
                        </div>
                    `;
                    lucide.createIcons();
                    return;
                }
                
                let html = '';
                members.forEach(member => {
                    const isSelected = selected.some(s => s.id === member.id);
                    html += `
                        <label class="flex items-center gap-3 p-2.5 rounded-lg cursor-pointer hover:bg-white transition ${isSelected ? 'bg-blue-50 ring-1 ring-blue-200' : 'bg-slate-50'}">
                            <input type="checkbox" 
                                   value="${member.id}" 
                                   ${isSelected ? 'checked' : ''} 
                                   onchange="ProjectMembers.toggleMember('${member.id}', '${prefix}')"
                                   class="accent-tec-blue w-4 h-4 rounded">
                            <img src="${member.photo}" class="w-8 h-8 rounded-full object-cover border-2 border-white shadow-sm" alt="${member.name}">
                            <div class="flex-1 min-w-0">
                                <p class="text-xs font-bold text-slate-700 truncate">${member.name}</p>
                                <p class="text-[10px] text-slate-400 truncate">${member.area || member.career || 'Miembro CRAI'}</p>
                            </div>
                        </label>
                    `;
                });
                
                container.innerHTML = html;
                lucide.createIcons();
            },
            
            // Alternar selecci√≥n de miembro
            toggleMember: (memberId, prefix) => {
                const member = ProjectMembers.allMembers.find(m => m.id === memberId);
                if (!member) return;
                
                const selected = prefix === 'up' ? ProjectMembers.selectedMembers : ProjectMembers.selectedMembersEdit;
                const idx = selected.findIndex(s => s.id === memberId);
                
                if (idx > -1) {
                    selected.splice(idx, 1);
                } else {
                    selected.push(member);
                }
                
                ProjectMembers.updateSelectedUI(prefix);
                ProjectMembers.updateHiddenInput(prefix);
            },
            
            // Actualizar UI de seleccionados
            updateSelectedUI: (prefix) => {
                const container = document.getElementById(`${prefix}-selected-members`);
                if (!container) return;
                
                const selected = prefix === 'up' ? ProjectMembers.selectedMembers : ProjectMembers.selectedMembersEdit;
                
                if (selected.length === 0) {
                    container.innerHTML = '<span class="text-[10px] text-slate-400 italic">Ning√∫n participante seleccionado</span>';
                    return;
                }
                
                let html = '';
                selected.forEach(member => {
                    html += `
                        <span class="inline-flex items-center gap-1.5 px-2 py-1 bg-white border border-slate-200 rounded-full text-xs group">
                            <img src="${member.photo}" class="w-4 h-4 rounded-full" alt="${member.name}">
                            <span class="font-medium text-slate-700">${member.name.split(' ')[0]}</span>
                            <button type="button" onclick="ProjectMembers.removeMember('${member.id}', '${prefix}')" class="text-slate-400 hover:text-red-500 transition">
                                <i data-lucide="x" class="w-3 h-3"></i>
                            </button>
                        </span>
                    `;
                });
                
                container.innerHTML = html;
                lucide.createIcons();
            },
            
            // Remover miembro
            removeMember: (memberId, prefix) => {
                const selected = prefix === 'up' ? ProjectMembers.selectedMembers : ProjectMembers.selectedMembersEdit;
                const idx = selected.findIndex(s => s.id === memberId);
                
                if (idx > -1) {
                    selected.splice(idx, 1);
                    ProjectMembers.updateSelectedUI(prefix);
                    ProjectMembers.updateHiddenInput(prefix);
                    ProjectMembers.renderMembersList(prefix === 'up' ? 'up-members-list' : 'edit-members-list', prefix);
                }
            },
            
            // Actualizar input oculto
            updateHiddenInput: (prefix) => {
                const input = document.getElementById(`${prefix}-participants`);
                const selected = prefix === 'up' ? ProjectMembers.selectedMembers : ProjectMembers.selectedMembersEdit;
                
                if (input) {
                    input.value = JSON.stringify(selected.map(m => ({
                        id: m.id,
                        email: m.email,
                        name: m.name,
                        photo: m.photo
                    })));
                }
            },
            
            // Filtrar miembros (b√∫squeda)
            filterMembers: (query) => {
                const container = document.getElementById('up-members-list');
                if (!container) return;
                
                const filtered = query ? 
                    ProjectMembers.allMembers.filter(m => 
                        m.name.toLowerCase().includes(query.toLowerCase()) ||
                        (m.area && m.area.toLowerCase().includes(query.toLowerCase())) ||
                        (m.career && m.career.toLowerCase().includes(query.toLowerCase()))
                    ) : ProjectMembers.allMembers;
                
                const tempAllMembers = ProjectMembers.allMembers;
                ProjectMembers.allMembers = filtered;
                ProjectMembers.renderMembersList('up-members-list', 'up');
                ProjectMembers.allMembers = tempAllMembers;
            },
            
            filterMembersEdit: (query) => {
                const container = document.getElementById('edit-members-list');
                if (!container) return;
                
                const filtered = query ? 
                    ProjectMembers.allMembers.filter(m => 
                        m.name.toLowerCase().includes(query.toLowerCase()) ||
                        (m.area && m.area.toLowerCase().includes(query.toLowerCase())) ||
                        (m.career && m.career.toLowerCase().includes(query.toLowerCase()))
                    ) : ProjectMembers.allMembers;
                
                const tempAllMembers = ProjectMembers.allMembers;
                ProjectMembers.allMembers = filtered;
                ProjectMembers.renderMembersList('edit-members-list', 'edit');
                ProjectMembers.allMembers = tempAllMembers;
            },
            
            // Resetear selecci√≥n
            reset: (prefix = 'up') => {
                if (prefix === 'up') {
                    ProjectMembers.selectedMembers = [];
                } else {
                    ProjectMembers.selectedMembersEdit = [];
                }
                ProjectMembers.updateSelectedUI(prefix);
                ProjectMembers.updateHiddenInput(prefix);
            },
            
            // Establecer selecci√≥n (para edici√≥n)
            setSelected: (members, prefix) => {
                if (prefix === 'up') {
                    ProjectMembers.selectedMembers = members;
                } else {
                    ProjectMembers.selectedMembersEdit = members;
                }
                ProjectMembers.updateSelectedUI(prefix);
                ProjectMembers.updateHiddenInput(prefix);
                ProjectMembers.renderMembersList(prefix === 'up' ? 'up-members-list' : 'edit-members-list', prefix);
            }
        };

        /**
         * ==========================================
         * MOBILE MENU (Men√∫ M√≥vil)
         * ==========================================
         */
        const MobileMenu = {
            isOpen: false,

            toggle: () => {
                MobileMenu.isOpen ? MobileMenu.close() : MobileMenu.open();
            },

            open: () => {
                MobileMenu.isOpen = true;
                document.getElementById('mobile-menu').classList.add('active');
                document.getElementById('mobile-menu-overlay').classList.add('active');
                document.getElementById('hamburger-btn').classList.add('active');
                document.body.style.overflow = 'hidden';
                lucide.createIcons();
            },

            close: () => {
                MobileMenu.isOpen = false;
                document.getElementById('mobile-menu').classList.remove('active');
                document.getElementById('mobile-menu-overlay').classList.remove('active');
                document.getElementById('hamburger-btn').classList.remove('active');
                document.body.style.overflow = '';
            },

            navigateTo: (view) => {
                MobileMenu.close();
                Router.to(view);
            },

            updateUserState: (isLoggedIn) => {
                const userSection = document.getElementById('mobile-menu-user');
                const loginSection = document.getElementById('mobile-menu-login');
                if (isLoggedIn) {
                    userSection?.classList.remove('hidden');
                    loginSection?.classList.add('hidden');
                } else {
                    userSection?.classList.add('hidden');
                    loginSection?.classList.remove('hidden');
                }
                // Actualizar nav inferior tambi√©n
                MobileNav.updateUserState(isLoggedIn);
            }
        };

        /**
         * ==========================================
         * MOBILE NAV (Navegaci√≥n Inferior M√≥vil)
         * ==========================================
         */
        const MobileNav = {
            handleProfile: () => {
                if (STATE.currentUser) {
                    Router.to('dashboard');
                } else {
                    Modal.open('auth');
                }
            },

            updateUserState: (isLoggedIn) => {
                const profileText = document.getElementById('mobile-nav-profile-text');
                if (profileText) {
                    profileText.textContent = isLoggedIn ? 'Perfil' : 'Acceso';
                }
            }
        };

        /**
         * ==========================================
         * JOIN FORM (Formulario de Unirse)
         * ==========================================
         */
        const JoinForm = {
            selectedArea: '',
            selectedSkills: [],
            
            areaInfo: {
                'gestion': { name: 'Gesti√≥n y Vinculaci√≥n', color: 'purple', icon: 'briefcase' },
                'telecom': { name: 'Telecomunicaciones y Redes', color: 'blue', icon: 'wifi' },
                'software': { name: 'Software, Autonom√≠a e IA', color: 'green', icon: 'code' },
                'electronica': { name: 'Electr√≥nica y Control', color: 'orange', icon: 'cpu' },
                'mecanico': { name: 'Dise√±o Mec√°nico y Manufactura', color: 'red', icon: 'cog' }
            },
            
            selectArea: (area) => {
                JoinForm.selectedArea = area;
                const info = JoinForm.areaInfo[area];
                
                // Actualizar visualizaci√≥n de tarjetas
                document.querySelectorAll('.area-card').forEach(card => {
                    card.classList.remove('border-purple-400', 'border-blue-400', 'border-green-400', 'border-orange-400', 'border-red-400', 'bg-purple-50', 'bg-blue-50', 'bg-green-50', 'bg-orange-50', 'bg-red-50');
                    card.classList.add('border-transparent');
                });
                
                const selectedCard = document.querySelector(`.area-card[data-area="${area}"]`);
                if (selectedCard) {
                    selectedCard.classList.remove('border-transparent');
                    selectedCard.classList.add(`border-${info.color}-400`, `bg-${info.color}-50`);
                }
                
                // Actualizar display en el formulario
                const display = document.getElementById('selected-area-display');
                display.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-${info.color}-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="${info.icon}" class="w-5 h-5 text-${info.color}-500"></i>
                        </div>
                        <div>
                            <p class="font-bold text-slate-800 text-sm">${info.name}</p>
                            <p class="text-[10px] text-slate-400">√Årea seleccionada</p>
                        </div>
                    </div>
                `;
                lucide.createIcons();
                
                // Actualizar input hidden
                document.getElementById('join-area').value = area;
            },
            
            toggleSkill: (btn, skill) => {
                const index = JoinForm.selectedSkills.indexOf(skill);
                
                if (index > -1) {
                    JoinForm.selectedSkills.splice(index, 1);
                    btn.classList.remove('bg-tec-blue', 'text-white');
                    btn.classList.add('bg-slate-100', 'text-slate-600');
                } else {
                    JoinForm.selectedSkills.push(skill);
                    btn.classList.add('bg-tec-blue', 'text-white');
                    btn.classList.remove('bg-slate-100', 'text-slate-600');
                }
                
                document.getElementById('join-skills').value = JoinForm.selectedSkills.join(', ');
            },
            
            // Agregar habilidad como tag
            addSkill: () => {
                const input = document.getElementById('skill-input');
                const skill = input.value.trim();
                
                if (!skill) return;
                
                // Validar que no sea muy larga
                if (skill.length > 30) {
                    Util.notify('La habilidad no puede tener m√°s de 30 caracteres', 'warning');
                    return;
                }
                
                // Validar que no est√© duplicada
                if (JoinForm.selectedSkills.some(s => s.toLowerCase() === skill.toLowerCase())) {
                    Util.notify('Esta habilidad ya fue agregada', 'warning');
                    input.value = '';
                    return;
                }
                
                // L√≠mite de 15 habilidades
                if (JoinForm.selectedSkills.length >= 15) {
                    Util.notify('M√°ximo 15 habilidades permitidas', 'warning');
                    return;
                }
                
                // Agregar al array
                JoinForm.selectedSkills.push(skill);
                
                // Actualizar UI
                JoinForm.renderSkillTags();
                
                // Limpiar input
                input.value = '';
                input.focus();
            },
            
            // Eliminar habilidad
            removeSkill: (index) => {
                JoinForm.selectedSkills.splice(index, 1);
                JoinForm.renderSkillTags();
            },
            
            // Renderizar tags de habilidades
            renderSkillTags: () => {
                const container = document.getElementById('skills-container');
                const placeholder = document.getElementById('skills-placeholder');
                
                if (JoinForm.selectedSkills.length === 0) {
                    container.innerHTML = '<p id="skills-placeholder" class="text-xs text-slate-400 w-full text-center py-1">Las habilidades que agregues aparecer√°n aqu√≠</p>';
                    return;
                }
                
                container.innerHTML = JoinForm.selectedSkills.map((skill, index) => `
                    <span class="inline-flex items-center gap-1 px-3 py-1.5 bg-tec-blue/10 text-tec-blue rounded-full text-xs font-medium animate-fade-in">
                        ${Util.escapeHtml(skill)}
                        <button type="button" onclick="JoinForm.removeSkill(${index})" class="ml-1 hover:bg-tec-blue/20 rounded-full p-0.5 transition" title="Eliminar">
                            <i data-lucide="x" class="w-3 h-3"></i>
                        </button>
                    </span>
                `).join('');
                
                // Reinicializar iconos Lucide
                if (window.lucide) lucide.createIcons();
            },
            
            submit: async () => {
                // Validar campos requeridos
                const name = document.getElementById('join-name').value.trim();
                const email = document.getElementById('join-email').value.trim();
                const control = document.getElementById('join-control').value.trim();
                const semester = document.getElementById('join-semester').value.trim();
                const career = document.getElementById('join-career').value;
                const area = document.getElementById('join-area').value;
                const reason = document.getElementById('join-reason').value.trim();
                const phone = document.getElementById('join-phone').value.trim();
                
                // Disponibilidad
                const morning = document.getElementById('join-morning').checked ? 'Ma√±ana' : '';
                const afternoon = document.getElementById('join-afternoon').checked ? 'Tarde' : '';
                const evening = document.getElementById('join-evening').checked ? 'Noche' : '';
                const weekend = document.getElementById('join-weekend').checked ? 'Fines de semana' : '';
                const availability = [morning, afternoon, evening, weekend].filter(Boolean).join(', ') || 'No especificada';
                
                // Validaciones
                if (!name || !email || !control || !semester || !career || !reason) {
                    Util.notify('Por favor completa todos los campos requeridos', 'error');
                    return;
                }
                
                if (!area) {
                    Util.notify('Por favor selecciona un √°rea de inter√©s', 'warning');
                    return;
                }
                
                // Obtener nombre del √°rea
                const areaName = JoinForm.areaInfo[area]?.name || area;
                // Obtener habilidades del array de tags
                const skills = JoinForm.selectedSkills.length > 0 
                    ? JoinForm.selectedSkills.join(', ') 
                    : 'Ninguna especificada';
                
                // Mostrar loading
                Util.loading(true, 'Verificando solicitud...');
                
                try {
                    // === SISTEMA ANTI-SPAM: Verificar si ya existe una solicitud ===
                    // Nota: Esta verificaci√≥n puede fallar en modo inc√≥gnito sin autenticaci√≥n
                    // En ese caso, se procede a enviar y Firestore manejar√° duplicados
                    
                    try {
                        // Buscar por correo electr√≥nico
                        const emailCheck = await db.collection('applications')
                            .where('email', '==', email.toLowerCase())
                            .limit(1)
                            .get();
                        
                        if (!emailCheck.empty) {
                            Util.loading(false);
                            await Swal.fire({
                                icon: 'warning',
                                title: 'Solicitud ya registrada',
                                html: `
                                    <p class="text-slate-600 mb-4">Ya existe una solicitud con el correo <strong>${email}</strong></p>
                                    <div class="bg-blue-50 p-4 rounded-xl text-left">
                                        <p class="text-xs text-slate-600">Si necesitas actualizar tu informaci√≥n o tienes dudas, contacta a:</p>
                                        <a href="mailto:contacto@clubcrai.com" class="text-sm font-bold text-tec-blue">contacto@clubcrai.com</a>
                                    </div>
                                `,
                                confirmButtonText: 'Entendido',
                                confirmButtonColor: '#1B396A'
                            });
                            return;
                        }
                        
                        // Buscar por n√∫mero de control
                        const controlCheck = await db.collection('applications')
                            .where('control', '==', control)
                            .limit(1)
                            .get();
                        
                        if (!controlCheck.empty) {
                            Util.loading(false);
                            await Swal.fire({
                                icon: 'warning',
                                title: 'Solicitud ya registrada',
                                html: `
                                    <p class="text-slate-600 mb-4">Ya existe una solicitud con el n√∫mero de control <strong>${control}</strong></p>
                                    <div class="bg-blue-50 p-4 rounded-xl text-left">
                                        <p class="text-xs text-slate-600">Si necesitas actualizar tu informaci√≥n o tienes dudas, contacta a:</p>
                                        <a href="mailto:contacto@clubcrai.com" class="text-sm font-bold text-tec-blue">contacto@clubcrai.com</a>
                                    </div>
                                `,
                                confirmButtonText: 'Entendido',
                                confirmButtonColor: '#1B396A'
                            });
                            return;
                        }
                    } catch (checkError) {
                        // Si falla la verificaci√≥n (ej: modo inc√≥gnito sin permisos), continuar
                        console.warn('Verificaci√≥n anti-spam omitida:', checkError.message);
                    }
                    
                    // Si pas√≥ las verificaciones, proceder a guardar
                    Util.loading(true, 'Enviando solicitud...');
                    
                    // Verificar que Firebase est√© inicializado
                    if (!db) {
                        throw new Error('Base de datos no disponible. Por favor recarga la p√°gina.');
                    }
                    
                    // Preparar datos de la solicitud
                    const applicationData = {
                        name: name,
                        email: email.toLowerCase(),
                        phone: phone || '',
                        control: control,
                        semester: semester,
                        career: career,
                        area: area,
                        areaName: areaName,
                        skills: skills,
                        availability: availability,
                        reason: reason,
                        status: 'pending',
                        source: 'join-form',
                        submittedAtLocal: new Date().toISOString()
                    };
                    
                    // Intentar agregar serverTimestamp si est√° disponible
                    try {
                        applicationData.submittedAt = firebase.firestore.FieldValue.serverTimestamp();
                    } catch (e) {
                        console.warn('serverTimestamp no disponible, usando fecha local');
                        applicationData.submittedAt = new Date();
                    }
                    
                    // Guardar solicitud en Firestore (colecci√≥n applications)
                    await db.collection('applications').add(applicationData);
                    
                    Util.loading(false);
                    
                    // Mostrar mensaje de √©xito
                    await Swal.fire({
                        icon: 'success',
                        title: '¬°Solicitud Enviada!',
                        html: `
                            <div class="text-center">
                                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </div>
                                <p class="text-slate-600 mb-4">Tu solicitud ha sido recibida correctamente.</p>
                                <div class="bg-blue-50 p-4 rounded-xl text-left mb-4">
                                    <p class="text-sm font-bold text-tec-blue mb-2">¬øQu√© sigue?</p>
                                    <ul class="text-xs text-slate-600 space-y-1">
                                        <li>‚Ä¢ El consejo directivo revisar√° tu perfil</li>
                                        <li>‚Ä¢ Te contactaremos al correo: <strong>${email}</strong></li>
                                        <li>‚Ä¢ Mantente atento a nuestras redes sociales</li>
                                    </ul>
                                </div>
                                <div class="bg-amber-50 border border-amber-200 p-4 rounded-xl text-left">
                                    <p class="text-sm font-bold text-amber-700 mb-2 flex items-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        ¬°Aumenta tus posibilidades!
                                    </p>
                                    <p class="text-xs text-amber-800">Env√≠a tu <strong>CV o curr√≠culum</strong> al correo:</p>
                                    <a href="mailto:contacto@clubcrai.com?subject=CV%20-%20${encodeURIComponent(name)}" class="text-sm font-bold text-amber-700 hover:text-amber-900 underline">contacto@clubcrai.com</a>
                                </div>
                            </div>
                        `,
                        confirmButtonText: '¬°Entendido!',
                        confirmButtonColor: '#1B396A'
                    });
                    
                    // Limpiar formulario
                    JoinForm.resetForm();
                    
                } catch (error) {
                    console.error('Error al enviar solicitud:', error);
                    console.error('Detalles del error:', {
                        code: error.code,
                        message: error.message,
                        name: error.name
                    });
                    Util.loading(false);
                    
                    // Mensaje de error m√°s espec√≠fico
                    let errorDetail = '';
                    if (error.code === 'permission-denied') {
                        errorDetail = 'Error de permisos. Intenta recargar la p√°gina.';
                    } else if (error.code === 'unavailable') {
                        errorDetail = 'Servicio no disponible. Verifica tu conexi√≥n a internet.';
                    } else if (error.message && error.message.includes('network')) {
                        errorDetail = 'Error de red. Verifica tu conexi√≥n a internet.';
                    } else {
                        errorDetail = error.message || 'Error desconocido';
                    }
                    
                    // Fallback: Intentar abrir cliente de correo
                    const subject = encodeURIComponent(`[SOLICITUD CRAI] ${name} - ${areaName}`);
                    const body = encodeURIComponent(`
SOLICITUD DE INGRESO AL CRAI
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

DATOS PERSONALES
‚Ä¢ Nombre: ${name}
‚Ä¢ Correo: ${email}
‚Ä¢ Tel√©fono: ${phone || 'No proporcionado'}
‚Ä¢ No. Control: ${control}
‚Ä¢ Semestre: ${semester}
‚Ä¢ Carrera: ${career}

√ÅREA DE INTER√âS: ${areaName}
HABILIDADES: ${skills}
DISPONIBILIDAD: ${availability}

MOTIVACI√ìN:
${reason}

Fecha: ${new Date().toLocaleDateString('es-MX', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                    `.trim());
                    
                    const mailtoLink = `mailto:contacto@clubcrai.com?subject=${subject}&body=${body}`;
                    
                    // Preguntar si quiere usar el m√©todo alternativo
                    const result = await Swal.fire({
                        icon: 'warning',
                        title: 'Error de conexi√≥n',
                        html: `
                            <p class="text-sm text-slate-600 mb-2">No se pudo enviar autom√°ticamente.</p>
                            <p class="text-xs text-red-500 mb-4">${errorDetail}</p>
                            <p class="text-sm text-slate-600">¬øDeseas enviarlo por correo electr√≥nico?</p>
                        `,
                        showCancelButton: true,
                        confirmButtonText: 'Abrir correo',
                        cancelButtonText: 'Cancelar',
                        confirmButtonColor: '#1B396A'
                    });
                    
                    if (result.isConfirmed) {
                        window.open(mailtoLink, '_blank');
                        JoinForm.resetForm();
                    }
                }
            },
            
            resetForm: () => {
                document.getElementById('join-form').reset();
                JoinForm.selectedArea = '';
                JoinForm.selectedSkills = [];
                document.getElementById('selected-area-display').innerHTML = '<p class="text-sm text-slate-400">Selecciona un √°rea arriba ‚Üë</p>';
                document.querySelectorAll('.area-card').forEach(card => {
                    card.classList.remove('border-purple-400', 'border-blue-400', 'border-green-400', 'border-orange-400', 'border-red-400', 'bg-purple-50', 'bg-blue-50', 'bg-green-50', 'bg-orange-50', 'bg-red-50');
                    card.classList.add('border-transparent');
                });
                // Limpiar input y tags de habilidades
                const skillInput = document.getElementById('skill-input');
                if (skillInput) skillInput.value = '';
                JoinForm.renderSkillTags();
            }
        };

        /**
         * ==========================================
         * SPONSORSHIP SYSTEM (Solicitudes de Patrocinio)
         * ==========================================
         */
        const Sponsorship = {
            formLoadTime: null,
            
            // Inicializar tiempo cuando el usuario empieza a llenar el formulario
            init: (formElement) => {
                const form = formElement || document.querySelector('form[onsubmit*="Sponsorship.submit"]');
                if (form && !form.dataset.loaded) {
                    form.dataset.loaded = Date.now();
                    Sponsorship.formLoadTime = Date.now();
                }
            },
            
            submit: async (e) => {
                e.preventDefault();
                
                // ========== VALIDACIONES ANTI-SPAM ==========
                
                // 1. Honeypot: Si el campo oculto tiene valor, es un bot
                const honeypot = document.getElementById('sponsor-website');
                if (honeypot && honeypot.value) {
                    console.log('Bot detectado: honeypot filled');
                    // Simular √©xito para confundir al bot
                    await Swal.fire({
                        icon: 'success',
                        title: '¬°Solicitud Enviada!',
                        text: 'Gracias por tu inter√©s.',
                        confirmButtonColor: '#D4AF37'
                    });
                    return;
                }
                
                // 2. Tiempo m√≠nimo: Si llen√≥ el formulario en menos de 5 segundos, es sospechoso
                const form = e.target;
                const loadTime = parseInt(form.dataset.loaded) || Sponsorship.formLoadTime || Date.now();
                const timeSpent = (Date.now() - loadTime) / 1000;
                if (timeSpent < 5) {
                    Util.notify('Por favor revisa tu informaci√≥n antes de enviar', 'warning');
                    return;
                }
                
                // 3. Rate limiting: M√°ximo 3 solicitudes por hora
                const rateLimitKey = 'sponsor_submissions';
                const submissions = JSON.parse(localStorage.getItem(rateLimitKey) || '[]');
                const oneHourAgo = Date.now() - (60 * 60 * 1000);
                const recentSubmissions = submissions.filter(t => t > oneHourAgo);
                if (recentSubmissions.length >= 3) {
                    Util.notify('Has enviado demasiadas solicitudes. Intenta m√°s tarde.', 'error');
                    return;
                }
                
                const name = document.getElementById('sponsor-name').value.trim();
                const company = document.getElementById('sponsor-company').value.trim();
                const email = document.getElementById('sponsor-email').value.trim();
                const phone = document.getElementById('sponsor-phone').value.trim();
                const type = document.getElementById('sponsor-type').value;
                const message = document.getElementById('sponsor-message').value.trim();
                
                // Validaciones b√°sicas
                if (!name || !company || !email) {
                    Util.notify('Por favor completa los campos obligatorios', 'warning');
                    return;
                }
                
                // Validar email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    Util.notify('Por favor ingresa un correo v√°lido', 'warning');
                    return;
                }
                
                // 4. Detecci√≥n de spam en contenido
                const allText = (name + ' ' + company + ' ' + message).toLowerCase();
                const spamPatterns = [
                    /\b(viagra|cialis|casino|poker|lottery|bitcoin|crypto|nft|forex)\b/i,
                    /\b(click here|buy now|free money|winner|prize|congratulations)\b/i,
                    /\b(make money fast|work from home|earn \$|\$\$\$)\b/i,
                    /(https?:\/\/[^\s]+){3,}/i, // M√°s de 3 URLs
                    /(.{1,10})\1{5,}/i, // Texto muy repetitivo
                ];
                
                const isSpam = spamPatterns.some(pattern => pattern.test(allText));
                if (isSpam) {
                    Util.notify('Tu mensaje contiene contenido no permitido', 'error');
                    return;
                }
                
                // 5. Validar que el nombre de empresa no sea generico/spam
                const suspiciousCompanies = ['test', 'asdf', 'qwerty', '123', 'aaa', 'xxx'];
                if (suspiciousCompanies.some(s => company.toLowerCase() === s)) {
                    Util.notify('Por favor ingresa un nombre de empresa v√°lido', 'warning');
                    return;
                }
                
                Util.loading(true, 'Enviando solicitud...');
                
                try {
                    // Mapear tipo de patrocinio
                    const typeLabels = {
                        'monetario': 'Patrocinio Monetario',
                        'especie': 'Patrocinio en Especie',
                        'servicios': 'Servicios',
                        'mixto': 'Mixto',
                        'otro': 'Otro'
                    };
                    
                    // Guardar solicitud
                    await db.collection('sponsorship_requests').add({
                        name: name,
                        company: company,
                        email: email.toLowerCase(),
                        phone: phone || '',
                        type: type,
                        typeLabel: typeLabels[type] || type,
                        message: message || '',
                        status: 'pending',
                        submittedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        notes: ''
                    });
                    
                    // Registrar solicitud para rate limiting
                    recentSubmissions.push(Date.now());
                    localStorage.setItem(rateLimitKey, JSON.stringify(recentSubmissions));
                    
                    Util.loading(false);
                    
                    // √âxito
                    await Swal.fire({
                        icon: 'success',
                        title: '¬°Solicitud Enviada!',
                        html: `
                            <div class="text-left">
                                <p class="text-slate-600 mb-4">Gracias por tu inter√©s en patrocinar al CRAI.</p>
                                <div class="bg-tec-blue/5 p-4 rounded-xl border border-tec-blue/20">
                                    <p class="text-sm text-tec-blue font-bold mb-2">Pr√≥ximos pasos:</p>
                                    <ul class="text-xs text-slate-600 space-y-1">
                                        <li>‚Ä¢ Revisaremos tu solicitud</li>
                                        <li>‚Ä¢ Te contactaremos en menos de 48 horas</li>
                                        <li>‚Ä¢ Te enviaremos informaci√≥n detallada de beneficios</li>
                                    </ul>
                                </div>
                            </div>
                        `,
                        confirmButtonText: '¬°Excelente!',
                        confirmButtonColor: '#1B396A'
                    });
                    
                    // Limpiar formulario
                    document.getElementById('sponsor-name').value = '';
                    document.getElementById('sponsor-company').value = '';
                    document.getElementById('sponsor-email').value = '';
                    document.getElementById('sponsor-phone').value = '';
                    document.getElementById('sponsor-type').value = 'monetario';
                    document.getElementById('sponsor-message').value = '';
                    
                    // Actualizar conteo de solicitudes pendientes
                    Applications.updatePendingCount();
                    
                } catch (error) {
                    Util.loading(false);
                    console.error('Error enviando solicitud de patrocinio:', error);
                    Util.notify('Error al enviar la solicitud. Intenta de nuevo.', 'error');
                }
            }
        };

        /**
         * ==========================================
         * ADMIN MEMBERS (Gesti√≥n de Miembros - Admin)
         * Solo visible para Admins y Fundadores
         * ==========================================
         */
        const AdminMembers = {
            allMembers: [],
            filteredMembers: [],
            
            // Verificar si el usuario tiene permisos
            hasAccess: () => {
                if (!STATE.currentUser || !STATE.profile) return false;
                
                const title = (STATE.profile.customTitle || '').toLowerCase();
                const role = (STATE.profile.role || '').toLowerCase();
                const SUPER_ADMIN_EMAIL = 'a23490819@itmexicali.edu.mx';
                
                const isFounder = title.includes('fundador') || title.includes('founder');
                const isAdmin = role === 'admin' || STATE.currentUser.email === SUPER_ADMIN_EMAIL;
                
                return isFounder || isAdmin;
            },
            
            // Inicializar y mostrar bot√≥n si tiene acceso
            init: () => {
                const btn = document.getElementById('btn-admin-members');
                if (!btn) return;
                
                if (AdminMembers.hasAccess()) {
                    btn.classList.remove('hidden');
                } else {
                    btn.classList.add('hidden');
                }
            },
            
            // Cargar todos los miembros
            load: async () => {
                if (!AdminMembers.hasAccess()) {
                    Util.notify('No tienes permisos para acceder a esta secci√≥n', 'error');
                    Router.to('dashboard');
                    return;
                }
                
                const container = document.getElementById('admin-members-list');
                const countEl = document.getElementById('admin-members-count');
                
                if (!container) return;
                
                container.innerHTML = `
                    <div class="p-8 text-center">
                        <div class="animate-spin w-8 h-8 border-4 border-red-500 border-t-transparent rounded-full mx-auto mb-4"></div>
                        <p class="text-slate-400 text-sm">Cargando miembros...</p>
                    </div>
                `;
                
                try {
                    const snap = await db.collection('users').orderBy('fullName').get();
                    
                    AdminMembers.allMembers = [];
                    snap.forEach(doc => {
                        AdminMembers.allMembers.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    AdminMembers.filteredMembers = [...AdminMembers.allMembers];
                    
                    if (countEl) countEl.textContent = AdminMembers.allMembers.length;
                    
                    AdminMembers.render();
                    
                } catch (err) {
                    console.error('Error cargando miembros:', err);
                    container.innerHTML = `
                        <div class="p-8 text-center">
                            <i data-lucide="alert-circle" class="w-12 h-12 text-red-300 mx-auto mb-4"></i>
                            <p class="text-red-500 font-bold">Error al cargar miembros</p>
                            <p class="text-sm text-slate-400">${err.message}</p>
                        </div>
                    `;
                    lucide.createIcons();
                }
            },
            
            // Buscar miembros
            search: (query) => {
                const q = query.toLowerCase().trim();
                
                if (!q) {
                    AdminMembers.filteredMembers = [...AdminMembers.allMembers];
                } else {
                    AdminMembers.filteredMembers = AdminMembers.allMembers.filter(m => {
                        return (m.fullName || '').toLowerCase().includes(q) ||
                               (m.email || '').toLowerCase().includes(q) ||
                               (m.career || '').toLowerCase().includes(q) ||
                               (m.control || '').toLowerCase().includes(q);
                    });
                }
                
                AdminMembers.render();
            },
            
            // Renderizar lista de miembros
            render: () => {
                const container = document.getElementById('admin-members-list');
                if (!container) return;
                
                if (AdminMembers.filteredMembers.length === 0) {
                    container.innerHTML = `
                        <div class="p-8 text-center">
                            <i data-lucide="user-x" class="w-12 h-12 text-slate-300 mx-auto mb-4"></i>
                            <p class="text-slate-500 font-bold">No se encontraron miembros</p>
                        </div>
                    `;
                    lucide.createIcons();
                    return;
                }
                
                const areaColors = {
                    'gestion': 'bg-purple-100 text-purple-700',
                    'telecom': 'bg-blue-100 text-blue-700',
                    'software': 'bg-green-100 text-green-700',
                    'electronica': 'bg-orange-100 text-orange-700',
                    'mecanico': 'bg-red-100 text-red-700'
                };
                
                let html = '';
                AdminMembers.filteredMembers.forEach(member => {
                    const photo = member.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(member.fullName || 'M')}&background=1B396A&color=fff`;
                    const areaClass = areaColors[member.area] || 'bg-slate-100 text-slate-700';
                    const roleDisplay = member.customTitle || member.areaName || member.role || 'Miembro';
                    const isSuperAdmin = member.email === 'a23490819@itmexicali.edu.mx';
                    
                    html += `
                        <div class="p-4 hover:bg-slate-50 transition flex flex-col sm:flex-row sm:items-center gap-4">
                            <div class="flex items-center gap-4 flex-1">
                                <img src="${photo}" class="w-12 h-12 rounded-xl object-cover border-2 border-white shadow-md" alt="${member.fullName}">
                                <div class="flex-1 min-w-0">
                                    <p class="font-bold text-slate-800 truncate">${member.fullName || 'Sin nombre'}</p>
                                    <p class="text-xs text-slate-500 truncate">${member.email || 'Sin email'}</p>
                                    <div class="flex flex-wrap gap-2 mt-1">
                                        <span class="text-[10px] ${areaClass} px-2 py-0.5 rounded-full font-bold">${roleDisplay}</span>
                                        ${member.career ? `<span class="text-[10px] bg-slate-100 text-slate-600 px-2 py-0.5 rounded-full">${member.career}</span>` : ''}
                                        ${member.semester ? `<span class="text-[10px] bg-slate-100 text-slate-600 px-2 py-0.5 rounded-full">${member.semester}¬∞ Sem</span>` : ''}
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-2 sm:ml-4">
                                <button onclick="AdminMembers.edit('${member.id}')" class="px-3 py-2 bg-blue-100 text-blue-700 rounded-lg text-xs font-bold hover:bg-blue-200 transition flex items-center gap-1">
                                    <i data-lucide="edit-2" class="w-3 h-3"></i>
                                    Editar
                                </button>
                                ${!isSuperAdmin ? `
                                <button onclick="AdminMembers.delete('${member.id}', '${(member.fullName || '').replace(/'/g, "\\'")}')" class="px-3 py-2 bg-red-100 text-red-700 rounded-lg text-xs font-bold hover:bg-red-200 transition flex items-center gap-1">
                                    <i data-lucide="trash-2" class="w-3 h-3"></i>
                                    Eliminar
                                </button>
                                ` : `
                                <span class="px-3 py-2 bg-tec-gold/20 text-tec-gold rounded-lg text-xs font-bold flex items-center gap-1">
                                    <i data-lucide="shield" class="w-3 h-3"></i>
                                    Protegido
                                </span>
                                `}
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                lucide.createIcons();
            },
            
            // Editar miembro
            edit: async (memberId) => {
                const member = AdminMembers.allMembers.find(m => m.id === memberId);
                if (!member) return;
                
                const { value: formValues } = await Swal.fire({
                    title: 'Editar Miembro',
                    html: `
                        <div class="text-left space-y-4">
                            <div class="flex items-center gap-3 mb-4 pb-4 border-b">
                                <img src="${member.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(member.fullName || 'M')}&background=1B396A&color=fff`}" class="w-12 h-12 rounded-full">
                                <div>
                                    <p class="font-bold text-slate-800">${member.fullName}</p>
                                    <p class="text-xs text-slate-500">${member.email}</p>
                                </div>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-600 block mb-1">Nombre Completo</label>
                                <input id="swal-name" class="w-full p-2 border rounded-lg text-sm" value="${member.fullName || ''}">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-600 block mb-1">T√≠tulo Personalizado</label>
                                <input id="swal-title" class="w-full p-2 border rounded-lg text-sm" placeholder="Ej: L√≠der, Fundador, Mentor..." value="${member.customTitle || ''}">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-600 block mb-1">Rol del Sistema</label>
                                <select id="swal-role" class="w-full p-2 border rounded-lg text-sm">
                                    <option value="member" ${member.role === 'member' ? 'selected' : ''}>Miembro</option>
                                    <option value="admin" ${member.role === 'admin' ? 'selected' : ''}>Admin</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-600 block mb-1">√Årea</label>
                                <select id="swal-area" class="w-full p-2 border rounded-lg text-sm">
                                    <option value="">Sin asignar</option>
                                    <option value="gestion" ${member.area === 'gestion' ? 'selected' : ''}>Gesti√≥n y Vinculaci√≥n</option>
                                    <option value="telecom" ${member.area === 'telecom' ? 'selected' : ''}>Telecomunicaciones</option>
                                    <option value="software" ${member.area === 'software' ? 'selected' : ''}>Software e IA</option>
                                    <option value="electronica" ${member.area === 'electronica' ? 'selected' : ''}>Electr√≥nica</option>
                                    <option value="mecanico" ${member.area === 'mecanico' ? 'selected' : ''}>Mec√°nico</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-600 block mb-1">Carrera</label>
                                <input id="swal-career" class="w-full p-2 border rounded-lg text-sm" value="${member.career || ''}">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-600 block mb-1">Semestre</label>
                                <input id="swal-semester" type="number" min="1" max="12" class="w-full p-2 border rounded-lg text-sm" value="${member.semester || ''}">
                            </div>
                        </div>
                    `,
                    showCancelButton: true,
                    confirmButtonText: 'Guardar Cambios',
                    cancelButtonText: 'Cancelar',
                    confirmButtonColor: '#1B396A',
                    preConfirm: () => {
                        return {
                            fullName: document.getElementById('swal-name').value.trim(),
                            customTitle: document.getElementById('swal-title').value.trim(),
                            role: document.getElementById('swal-role').value,
                            area: document.getElementById('swal-area').value,
                            career: document.getElementById('swal-career').value.trim(),
                            semester: document.getElementById('swal-semester').value
                        };
                    }
                });
                
                if (formValues) {
                    try {
                        Util.loading(true, 'Actualizando miembro...');
                        
                        const areaNames = {
                            'gestion': 'Gesti√≥n y Vinculaci√≥n',
                            'telecom': 'Telecomunicaciones',
                            'software': 'Software e IA',
                            'electronica': 'Electr√≥nica',
                            'mecanico': 'Mec√°nico'
                        };
                        
                        await db.collection('users').doc(memberId).update({
                            fullName: formValues.fullName,
                            customTitle: formValues.customTitle || null,
                            role: formValues.role,
                            area: formValues.area || null,
                            areaName: areaNames[formValues.area] || null,
                            career: formValues.career || null,
                            semester: formValues.semester || null
                        });
                        
                        Util.loading(false);
                        Util.notify('Miembro actualizado correctamente', 'success');
                        
                        // Recargar lista
                        AdminMembers.load();
                        
                    } catch (err) {
                        Util.loading(false);
                        console.error('Error actualizando miembro:', err);
                        Util.notify('Error al actualizar: ' + err.message, 'error');
                    }
                }
            },
            
            // Eliminar miembro
            delete: async (memberId, memberName) => {
                const result = await Swal.fire({
                    title: '¬øEliminar miembro?',
                    html: `
                        <div class="text-center">
                            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i data-lucide="user-x" class="w-8 h-8 text-red-500"></i>
                            </div>
                            <p class="text-slate-600 mb-2">Est√°s a punto de eliminar a:</p>
                            <p class="font-bold text-lg text-slate-800">${memberName}</p>
                            <p class="text-xs text-red-500 mt-4">Esta acci√≥n eliminar√° su perfil permanentemente.</p>
                        </div>
                    `,
                    showCancelButton: true,
                    confirmButtonText: 'S√≠, eliminar',
                    cancelButtonText: 'Cancelar',
                    confirmButtonColor: '#dc2626',
                    cancelButtonColor: '#64748b',
                    didOpen: () => lucide.createIcons()
                });
                
                if (!result.isConfirmed) return;
                
                try {
                    Util.loading(true, 'Eliminando miembro...');
                    
                    await db.collection('users').doc(memberId).delete();
                    
                    Util.loading(false);
                    Util.notify(`${memberName} ha sido eliminado`, 'success');
                    
                    // Recargar lista
                    AdminMembers.load();
                    Database.loadPublicMembers();
                    
                } catch (err) {
                    Util.loading(false);
                    console.error('Error eliminando miembro:', err);
                    Util.notify('Error al eliminar: ' + err.message, 'error');
                }
            }
        };

        /**
         * ==========================================
         * APPLICATIONS SYSTEM (Gesti√≥n de Solicitudes)
         * Solo visible para Fundadores, L√≠deres y Maestros
         * ==========================================
         */
        const Applications = {
            allApplications: [],
            allSponsorships: [],
            filteredApplications: [],
            currentFilter: 'all',
            currentTab: 'ingreso', // 'ingreso' o 'patrocinio'
            
            // Verificar si el usuario tiene permisos para ver solicitudes
            hasAccess: () => {
                if (!STATE.currentUser || !STATE.profile) return false;
                
                const title = (STATE.profile.customTitle || '').toLowerCase();
                const role = (STATE.profile.role || '').toLowerCase();
                
                // Verificar si es fundador, l√≠der o maestro
                const isFounder = title.includes('fundador') || title.includes('founder');
                const isLeader = title.includes('l√≠der') || title.includes('lider') || title.includes('leader');
                const isMaster = title.includes('maestro') || title.includes('mentor') || title.includes('master');
                const isAdmin = role === 'admin';
                
                return isFounder || isLeader || isMaster || isAdmin;
            },
            
            // Inicializar y mostrar bot√≥n si tiene acceso
            init: async () => {
                if (!Applications.hasAccess()) {
                    document.getElementById('btn-applications')?.classList.add('hidden');
                    return;
                }
                
                // Mostrar bot√≥n
                document.getElementById('btn-applications')?.classList.remove('hidden');
                
                // Cargar conteo de solicitudes pendientes
                await Applications.updatePendingCount();
            },
            
            // Actualizar conteo de pendientes (ambos tipos)
            updatePendingCount: async () => {
                try {
                    // Contar solicitudes de ingreso pendientes
                    const ingresoSnap = await db.collection('applications')
                        .where('status', '==', 'pending')
                        .get();
                    
                    // Contar solicitudes de patrocinio pendientes
                    const patrocinioSnap = await db.collection('sponsorship_requests')
                        .where('status', '==', 'pending')
                        .get();
                    
                    const totalPending = ingresoSnap.size + patrocinioSnap.size;
                    const badge = document.getElementById('pending-applications-count');
                    
                    if (badge) {
                        badge.textContent = totalPending;
                        badge.classList.toggle('hidden', totalPending === 0);
                    }
                } catch (err) {
                    console.error('Error contando solicitudes:', err);
                }
            },
            
            // Cambiar entre tabs de ingreso y patrocinio
            switchTab: (tab) => {
                Applications.currentTab = tab;
                Applications.currentFilter = 'all';
                
                // Actualizar UI de tabs
                const tabIngreso = document.getElementById('app-tab-ingreso');
                const tabPatrocinio = document.getElementById('app-tab-patrocinio');
                
                if (tab === 'ingreso') {
                    tabIngreso?.classList.add('bg-tec-blue', 'text-white');
                    tabIngreso?.classList.remove('bg-slate-100', 'text-slate-600');
                    tabPatrocinio?.classList.remove('bg-tec-blue', 'text-white');
                    tabPatrocinio?.classList.add('bg-slate-100', 'text-slate-600');
                } else {
                    tabPatrocinio?.classList.add('bg-tec-gold', 'text-white');
                    tabPatrocinio?.classList.remove('bg-slate-100', 'text-slate-600');
                    tabIngreso?.classList.remove('bg-tec-blue', 'text-white');
                    tabIngreso?.classList.add('bg-slate-100', 'text-slate-600');
                }
                
                // Resetear filtros activos
                document.querySelectorAll('.app-filter-btn').forEach(btn => {
                    const isAll = btn.dataset.filter === 'all';
                    btn.classList.toggle('bg-tec-blue', isAll);
                    btn.classList.toggle('text-white', isAll);
                    btn.classList.toggle('bg-slate-100', !isAll);
                    btn.classList.toggle('text-slate-600', !isAll);
                });
                
                Applications.load();
            },
            
            // Mostrar secci√≥n de solicitudes
            show: () => {
                if (!Applications.hasAccess()) {
                    Util.notify('No tienes permisos para ver las solicitudes', 'error');
                    return;
                }
                
                Router.to('dashboard');
                
                // Ocultar todos los tabs y mostrar el de solicitudes
                document.querySelectorAll('#view-dashboard main > div').forEach(tab => {
                    tab.classList.add('hidden');
                });
                document.getElementById('tab-applications')?.classList.remove('hidden');
                
                Applications.load();
            },
            
            // Cargar solicitudes
            load: async () => {
                if (!Applications.hasAccess()) return;
                
                const list = document.getElementById('applications-list');
                const empty = document.getElementById('applications-empty');
                const emptyText = document.getElementById('applications-empty-text');
                
                if (!list) return;
                
                list.innerHTML = `
                    <div class="text-center py-12">
                        <div class="animate-spin w-8 h-8 border-3 border-amber-500 border-t-transparent rounded-full mx-auto mb-4"></div>
                        <p class="text-sm text-slate-400">Cargando solicitudes...</p>
                    </div>
                `;
                
                try {
                    // Cargar solicitudes de ingreso
                    const ingresoSnap = await db.collection('applications')
                        .orderBy('submittedAt', 'desc')
                        .get();
                    
                    Applications.allApplications = [];
                    ingresoSnap.forEach(doc => {
                        Applications.allApplications.push({ id: doc.id, type: 'ingreso', ...doc.data() });
                    });
                    
                    // Cargar solicitudes de patrocinio
                    const patrocinioSnap = await db.collection('sponsorship_requests')
                        .orderBy('submittedAt', 'desc')
                        .get();
                    
                    Applications.allSponsorships = [];
                    patrocinioSnap.forEach(doc => {
                        Applications.allSponsorships.push({ id: doc.id, type: 'patrocinio', ...doc.data() });
                    });
                    
                    // Actualizar contadores de tabs
                    const countIngreso = document.getElementById('app-count-ingreso');
                    const countPatrocinio = document.getElementById('app-count-patrocinio');
                    if (countIngreso) countIngreso.textContent = Applications.allApplications.length;
                    if (countPatrocinio) countPatrocinio.textContent = Applications.allSponsorships.length;
                    
                    // Actualizar estad√≠sticas del header
                    const currentData = Applications.currentTab === 'ingreso' ? Applications.allApplications : Applications.allSponsorships;
                    const pendingCount = currentData.filter(a => a.status === 'pending').length;
                    
                    const pendingStat = document.getElementById('applications-pending-stat');
                    const totalStat = document.getElementById('applications-total-stat');
                    if (pendingStat) pendingStat.textContent = pendingCount;
                    if (totalStat) totalStat.textContent = currentData.length;
                    
                    // Actualizar texto del empty state
                    if (emptyText) {
                        emptyText.textContent = Applications.currentTab === 'ingreso' 
                            ? 'Las nuevas solicitudes de aspirantes aparecer√°n aqu√≠'
                            : 'Las solicitudes de empresas interesadas en patrocinar aparecer√°n aqu√≠';
                    }
                    
                    // Aplicar filtro y renderizar
                    Applications.filter(Applications.currentFilter);
                    
                } catch (err) {
                    console.error('Error cargando solicitudes:', err);
                    list.innerHTML = `
                        <div class="text-center py-12 bg-red-50 rounded-xl">
                            <i data-lucide="alert-circle" class="w-12 h-12 text-red-300 mx-auto mb-4"></i>
                            <p class="text-red-600 font-bold">Error al cargar solicitudes</p>
                            <p class="text-sm text-red-400">${err.message}</p>
                        </div>
                    `;
                    lucide.createIcons();
                }
            },
            
            // Filtrar solicitudes
            filter: (status) => {
                Applications.currentFilter = status;
                
                // Actualizar UI de botones
                document.querySelectorAll('.app-filter-btn').forEach(btn => {
                    const isActive = btn.dataset.filter === status;
                    btn.classList.toggle('bg-tec-blue', isActive);
                    btn.classList.toggle('text-white', isActive);
                    btn.classList.toggle('bg-slate-100', !isActive);
                    btn.classList.toggle('text-slate-600', !isActive);
                });
                
                // Seleccionar data seg√∫n el tab actual
                const sourceData = Applications.currentTab === 'ingreso' 
                    ? Applications.allApplications 
                    : Applications.allSponsorships;
                
                // Filtrar
                if (status === 'all') {
                    Applications.filteredApplications = [...sourceData];
                } else {
                    Applications.filteredApplications = sourceData.filter(a => a.status === status);
                }
                
                Applications.render();
            },
            
            // Renderizar solicitudes
            render: () => {
                const list = document.getElementById('applications-list');
                const empty = document.getElementById('applications-empty');
                
                if (!list) return;
                
                const apps = Applications.filteredApplications;
                
                if (apps.length === 0) {
                    list.classList.add('hidden');
                    empty?.classList.remove('hidden');
                    return;
                }
                
                list.classList.remove('hidden');
                empty?.classList.add('hidden');
                
                const statusConfig = {
                    pending: { label: 'Pendiente', bg: 'bg-amber-100', text: 'text-amber-700', icon: 'clock' },
                    reviewed: { label: 'Revisada', bg: 'bg-blue-100', text: 'text-blue-700', icon: 'eye' },
                    accepted: { label: 'Aceptada', bg: 'bg-green-100', text: 'text-green-700', icon: 'check-circle' },
                    rejected: { label: 'Rechazada', bg: 'bg-red-100', text: 'text-red-700', icon: 'x-circle' }
                };
                
                let html = '';
                
                // Renderizar seg√∫n el tipo de tab
                if (Applications.currentTab === 'ingreso') {
                    html = Applications.renderIngresoCards(apps, statusConfig);
                } else {
                    html = Applications.renderPatrocinioCards(apps, statusConfig);
                }
                
                list.innerHTML = html;
                lucide.createIcons();
            },
            
            // Renderizar tarjetas de solicitudes de ingreso
            renderIngresoCards: (apps, statusConfig) => {
                const areaColors = {
                    'gestion': { bg: 'bg-purple-100', text: 'text-purple-700' },
                    'telecom': { bg: 'bg-blue-100', text: 'text-blue-700' },
                    'software': { bg: 'bg-green-100', text: 'text-green-700' },
                    'electronica': { bg: 'bg-orange-100', text: 'text-orange-700' },
                    'mecanico': { bg: 'bg-red-100', text: 'text-red-700' }
                };
                
                let html = '';
                
                apps.forEach(app => {
                    const status = statusConfig[app.status] || statusConfig.pending;
                    const areaColor = areaColors[app.area] || { bg: 'bg-slate-100', text: 'text-slate-700' };
                    const dateStr = app.submittedAt ? new Date(app.submittedAt.seconds * 1000).toLocaleDateString('es-MX', { 
                        year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' 
                    }) : 'Sin fecha';
                    
                    html += `
                    <div class="bg-white rounded-2xl border border-slate-200 overflow-hidden hover:shadow-lg hover:border-slate-300 transition-all">
                        <div class="p-5">
                            <div class="flex flex-col lg:flex-row lg:items-start gap-4">
                                <!-- Avatar e info principal -->
                                <div class="flex items-start gap-4 flex-1">
                                    <div class="w-14 h-14 bg-gradient-to-br from-tec-blue to-tec-dark rounded-xl flex items-center justify-center flex-shrink-0">
                                        <span class="text-white font-black text-lg">${app.name?.charAt(0) || '?'}</span>
                                    </div>
                                    
                                    <div class="flex-1 min-w-0">
                                        <div class="flex flex-wrap items-center gap-2 mb-2">
                                            <h3 class="font-bold text-lg text-slate-800">${app.name || 'Sin nombre'}</h3>
                                            <span class="px-2 py-1 ${status.bg} ${status.text} rounded-lg text-[10px] font-bold flex items-center gap-1">
                                                <i data-lucide="${status.icon}" class="w-3 h-3"></i>
                                                ${status.label}
                                            </span>
                                        </div>
                                        
                                        <div class="flex flex-wrap items-center gap-3 text-xs text-slate-500 mb-3">
                                            <span class="flex items-center gap-1">
                                                <i data-lucide="mail" class="w-3 h-3"></i>
                                                ${app.email || 'Sin correo'}
                                            </span>
                                            ${app.phone ? `<span class="flex items-center gap-1"><i data-lucide="phone" class="w-3 h-3"></i>${app.phone}</span>` : ''}
                                            <span class="flex items-center gap-1">
                                                <i data-lucide="id-card" class="w-3 h-3"></i>
                                                ${app.control || 'N/A'}
                                            </span>
                                        </div>
                                        
                                        <div class="flex flex-wrap gap-2 mb-3">
                                            <span class="px-2 py-1 ${areaColor.bg} ${areaColor.text} rounded-lg text-[10px] font-bold">
                                                ${app.areaName || app.area || 'Sin √°rea'}
                                            </span>
                                            <span class="px-2 py-1 bg-slate-100 text-slate-600 rounded-lg text-[10px] font-bold">
                                                ${app.career || 'Sin carrera'} ‚Ä¢ ${app.semester || '?'}¬∞ Sem
                                            </span>
                                        </div>
                                        
                                        ${app.skills && app.skills !== 'Ninguna especificada' && app.skills.trim() ? `
                                        <div class="bg-indigo-50 p-3 rounded-xl mb-3">
                                            <p class="text-[10px] font-bold text-indigo-400 uppercase mb-1 flex items-center gap-1">
                                                <i data-lucide="zap" class="w-3 h-3"></i> Habilidades
                                            </p>
                                            <p class="text-xs text-indigo-700" id="skills-${app.id}">${app.skills}</p>
                                        </div>` : ''}
                                        
                                        ${app.reason ? `
                                        <div class="bg-slate-50 p-3 rounded-xl mb-3">
                                            <div class="flex items-center justify-between mb-1">
                                                <p class="text-[10px] font-bold text-slate-400 uppercase flex items-center gap-1">
                                                    <i data-lucide="message-square" class="w-3 h-3"></i> Motivaci√≥n
                                                </p>
                                                <button onclick="Applications.toggleExpand('reason-${app.id}')" class="text-[10px] text-tec-blue hover:text-tec-dark font-bold flex items-center gap-1">
                                                    <span id="btn-reason-${app.id}">Ver m√°s</span>
                                                    <i data-lucide="chevron-down" class="w-3 h-3" id="icon-reason-${app.id}"></i>
                                                </button>
                                            </div>
                                            <p class="text-xs text-slate-600 line-clamp-3 transition-all" id="reason-${app.id}">${app.reason}</p>
                                        </div>` : ''}
                                        
                                        <div class="flex items-center gap-2 text-[10px] text-slate-400">
                                            <i data-lucide="calendar" class="w-3 h-3"></i>
                                            ${dateStr}
                                            ${app.availability ? `<span class="ml-2">‚Ä¢ Disponibilidad: ${app.availability}</span>` : ''}
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Acciones -->
                                <div class="flex lg:flex-col gap-2 flex-shrink-0">
                                    ${app.status === 'pending' ? `
                                    <button onclick="Applications.updateStatus('${app.id}', 'reviewed', 'ingreso')" class="flex items-center justify-center gap-2 px-4 py-2 bg-blue-50 text-blue-600 rounded-lg font-bold text-xs hover:bg-blue-100 transition">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                        <span class="hidden sm:inline">Marcar Revisada</span>
                                    </button>
                                    ` : ''}
                                    
                                    ${app.status !== 'accepted' ? `
                                    <button onclick="Applications.updateStatus('${app.id}', 'accepted', 'ingreso')" class="flex items-center justify-center gap-2 px-4 py-2 bg-green-50 text-green-600 rounded-lg font-bold text-xs hover:bg-green-100 transition">
                                        <i data-lucide="check" class="w-4 h-4"></i>
                                        <span class="hidden sm:inline">Aceptar</span>
                                    </button>
                                    ` : ''}
                                    
                                    ${app.status !== 'rejected' ? `
                                    <button onclick="Applications.updateStatus('${app.id}', 'rejected', 'ingreso')" class="flex items-center justify-center gap-2 px-4 py-2 bg-red-50 text-red-500 rounded-lg font-bold text-xs hover:bg-red-100 transition">
                                        <i data-lucide="x" class="w-4 h-4"></i>
                                        <span class="hidden sm:inline">Rechazar</span>
                                    </button>
                                    ` : ''}
                                    
                                    <button onclick="Applications.delete('${app.id}', 'ingreso')" class="flex items-center justify-center gap-2 px-4 py-2 bg-slate-100 text-slate-500 rounded-lg font-bold text-xs hover:bg-slate-200 transition">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    `;
                });
                
                return html;
            },
            
            // Renderizar tarjetas de solicitudes de patrocinio
            renderPatrocinioCards: (apps, statusConfig) => {
                const typeColors = {
                    'monetario': { bg: 'bg-green-100', text: 'text-green-700', icon: 'banknote' },
                    'especie': { bg: 'bg-blue-100', text: 'text-blue-700', icon: 'package' },
                    'servicios': { bg: 'bg-purple-100', text: 'text-purple-700', icon: 'wrench' },
                    'mixto': { bg: 'bg-orange-100', text: 'text-orange-700', icon: 'layers' },
                    'otro': { bg: 'bg-slate-100', text: 'text-slate-700', icon: 'help-circle' }
                };
                
                let html = '';
                
                apps.forEach(app => {
                    const status = statusConfig[app.status] || statusConfig.pending;
                    const typeColor = typeColors[app.type] || typeColors.otro;
                    const dateStr = app.submittedAt ? new Date(app.submittedAt.seconds * 1000).toLocaleDateString('es-MX', { 
                        year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' 
                    }) : 'Sin fecha';
                    
                    html += `
                    <div class="bg-white rounded-2xl border border-slate-200 overflow-hidden hover:shadow-lg hover:border-tec-gold/50 transition-all">
                        <div class="h-1 bg-gradient-to-r from-tec-gold via-yellow-400 to-orange-400"></div>
                        <div class="p-5">
                            <div class="flex flex-col lg:flex-row lg:items-start gap-4">
                                <!-- Avatar e info principal -->
                                <div class="flex items-start gap-4 flex-1">
                                    <div class="w-14 h-14 bg-gradient-to-br from-tec-gold to-orange-500 rounded-xl flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="building-2" class="w-7 h-7 text-white"></i>
                                    </div>
                                    
                                    <div class="flex-1 min-w-0">
                                        <div class="flex flex-wrap items-center gap-2 mb-2">
                                            <h3 class="font-bold text-lg text-slate-800">${app.company || 'Sin empresa'}</h3>
                                            <span class="px-2 py-1 ${status.bg} ${status.text} rounded-lg text-[10px] font-bold flex items-center gap-1">
                                                <i data-lucide="${status.icon}" class="w-3 h-3"></i>
                                                ${status.label}
                                            </span>
                                        </div>
                                        
                                        <div class="flex flex-wrap items-center gap-3 text-xs text-slate-500 mb-3">
                                            <span class="flex items-center gap-1">
                                                <i data-lucide="user" class="w-3 h-3"></i>
                                                ${app.name || 'Sin contacto'}
                                            </span>
                                            <span class="flex items-center gap-1">
                                                <i data-lucide="mail" class="w-3 h-3"></i>
                                                ${app.email || 'Sin correo'}
                                            </span>
                                            ${app.phone ? `<span class="flex items-center gap-1"><i data-lucide="phone" class="w-3 h-3"></i>${app.phone}</span>` : ''}
                                        </div>
                                        
                                        <div class="flex flex-wrap gap-2 mb-3">
                                            <span class="px-2 py-1 ${typeColor.bg} ${typeColor.text} rounded-lg text-[10px] font-bold flex items-center gap-1">
                                                <i data-lucide="${typeColor.icon}" class="w-3 h-3"></i>
                                                ${app.typeLabel || app.type || 'Sin tipo'}
                                            </span>
                                        </div>
                                        
                                        ${app.message ? `
                                        <div class="bg-tec-gold/5 border border-tec-gold/20 p-3 rounded-xl mb-3">
                                            <p class="text-[10px] font-bold text-tec-gold uppercase mb-1 flex items-center gap-1">
                                                <i data-lucide="message-square" class="w-3 h-3"></i> Mensaje
                                            </p>
                                            <p class="text-xs text-slate-600">${app.message}</p>
                                        </div>` : ''}
                                        
                                        <div class="flex items-center gap-2 text-[10px] text-slate-400">
                                            <i data-lucide="calendar" class="w-3 h-3"></i>
                                            ${dateStr}
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Acciones -->
                                <div class="flex lg:flex-col gap-2 flex-shrink-0">
                                    ${app.status === 'pending' ? `
                                    <button onclick="Applications.updateStatus('${app.id}', 'reviewed', 'patrocinio')" class="flex items-center justify-center gap-2 px-4 py-2 bg-blue-50 text-blue-600 rounded-lg font-bold text-xs hover:bg-blue-100 transition">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                        <span class="hidden sm:inline">Revisada</span>
                                    </button>
                                    ` : ''}
                                    
                                    <a href="mailto:${app.email}?subject=Patrocinio CRAI - ${encodeURIComponent(app.company || '')}" class="flex items-center justify-center gap-2 px-4 py-2 bg-tec-gold/10 text-tec-gold rounded-lg font-bold text-xs hover:bg-tec-gold/20 transition">
                                        <i data-lucide="mail" class="w-4 h-4"></i>
                                        <span class="hidden sm:inline">Contactar</span>
                                    </a>
                                    
                                    ${app.status !== 'accepted' ? `
                                    <button onclick="Applications.updateStatus('${app.id}', 'accepted', 'patrocinio')" class="flex items-center justify-center gap-2 px-4 py-2 bg-green-50 text-green-600 rounded-lg font-bold text-xs hover:bg-green-100 transition">
                                        <i data-lucide="check" class="w-4 h-4"></i>
                                        <span class="hidden sm:inline">Cerrado</span>
                                    </button>
                                    ` : ''}
                                    
                                    <button onclick="Applications.delete('${app.id}', 'patrocinio')" class="flex items-center justify-center gap-2 px-4 py-2 bg-slate-100 text-slate-500 rounded-lg font-bold text-xs hover:bg-slate-200 transition">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    `;
                });
                
                return html;
            },
            
            // Actualizar estado de solicitud
            updateStatus: async (appId, newStatus, appType) => {
                if (!Applications.hasAccess()) return;
                
                const collection = appType === 'patrocinio' ? 'sponsorship_requests' : 'applications';
                
                const statusLabels = {
                    reviewed: 'revisada',
                    accepted: 'aceptada',
                    rejected: 'rechazada'
                };
                
                try {
                    await db.collection(collection).doc(appId).update({
                        status: newStatus,
                        reviewedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        reviewedBy: STATE.currentUser.email
                    });
                    
                    Util.notify(`Solicitud marcada como ${statusLabels[newStatus]}`, 'success');
                    
                    // Recargar
                    await Applications.load();
                    await Applications.updatePendingCount();
                    
                } catch (err) {
                    console.error('Error actualizando solicitud:', err);
                    Util.notify('Error al actualizar la solicitud', 'error');
                }
            },
            
            // Eliminar solicitud
            delete: async (appId, appType) => {
                if (!Applications.hasAccess()) return;
                
                const collection = appType === 'patrocinio' ? 'sponsorship_requests' : 'applications';
                
                const result = await Swal.fire({
                    title: '¬øEliminar solicitud?',
                    text: 'Esta acci√≥n no se puede deshacer',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'S√≠, eliminar',
                    cancelButtonText: 'Cancelar',
                    confirmButtonColor: '#ef4444'
                });
                
                if (!result.isConfirmed) return;
                
                try {
                    await db.collection(collection).doc(appId).delete();
                    
                    Util.notify('Solicitud eliminada', 'success');
                    
                    // Recargar
                    await Applications.load();
                    await Applications.updatePendingCount();
                    
                } catch (err) {
                    console.error('Error eliminando solicitud:', err);
                    Util.notify('Error al eliminar la solicitud', 'error');
                }
            },
            
            // Expandir/contraer texto de motivaci√≥n o habilidades
            toggleExpand: (elementId) => {
                const element = document.getElementById(elementId);
                const btn = document.getElementById(`btn-${elementId}`);
                const icon = document.getElementById(`icon-${elementId}`);
                
                if (!element) return;
                
                const isExpanded = element.classList.contains('line-clamp-3');
                
                if (isExpanded) {
                    // Expandir
                    element.classList.remove('line-clamp-3');
                    element.style.maxHeight = 'none';
                    if (btn) btn.textContent = 'Ver menos';
                    if (icon) icon.style.transform = 'rotate(180deg)';
                } else {
                    // Contraer
                    element.classList.add('line-clamp-3');
                    element.style.maxHeight = '';
                    if (btn) btn.textContent = 'Ver m√°s';
                    if (icon) icon.style.transform = 'rotate(0deg)';
                }
            }
        };

        /**
         * ==========================================
         * ACHIEVEMENTS SYSTEM (Sistema de Logros)
         * ==========================================
         */
        const Achievements = {
            // Email del administrador de logros
            ADMIN_EMAIL: 'a23490819@itmexicali.edu.mx',
            
            // Definici√≥n de todos los logros disponibles
            // type: 'auto' = se detecta autom√°ticamente (seguro), 'manual' = solo admin puede asignar
            definitions: {
                // ========================================
                // M√çTICOS - Logros supremos con marcos especiales
                // ========================================
                completionist: {
                    id: 'completionist',
                    name: 'Completista',
                    description: 'Desbloque√≥ todos los logros disponibles',
                    reason: '¬°Incre√≠ble! Has desbloqueado todos los logros disponibles para ti. Este logro no requiere ser Fundador ni Maestro Mentor, ¬°as√≠ que cualquier miembro puede obtenerlo! Eres una leyenda del CRAI.',
                    icon: 'sparkles',
                    rarity: 'mythic',
                    points: 5000,
                    special: true,
                    type: 'auto', // Se detecta autom√°ticamente al tener todos los dem√°s
                    reward: 'üéÅ PREMIO: Obtienes un Marco M√≠tico Arco√≠ris exclusivo que aparece en tu tarjeta del Panel de Miembros. ¬°Todos ver√°n tu logro!',
                    frameType: 'rainbow'
                },
                polymath: {
                    id: 'polymath',
                    name: 'Pol√≠mata',
                    description: 'Domina todas las disciplinas: Software, Electr√≥nica y Mec√°nica',
                    reason: '¬°Eres un verdadero Pol√≠mata! Has demostrado dominio en las tres ramas principales de la rob√≥tica: tienes proyectos de Software/IA, Electr√≥nica y Mec√°nica. Tu versatilidad es inspiradora.',
                    icon: 'atom',
                    rarity: 'mythic',
                    points: 3000,
                    special: true,
                    type: 'auto', // Se detecta al tener proyectos en las 3 categor√≠as
                    reward: 'üåå PREMIO: Obtienes un Marco C√≥smico exclusivo con estrellas brillantes que aparece en tu tarjeta del Panel de Miembros. ¬°Muestra tu dominio multidisciplinario!',
                    frameType: 'cosmic'
                },
                
                // ========================================
                // LEGENDARIOS (dorados) - Muy dif√≠ciles
                // ========================================
                founder: {
                    id: 'founder',
                    name: 'Fundador',
                    description: 'Miembro fundador del CRAI',
                    reason: 'Eres uno de los miembros fundadores que iniciaron el Club de Rob√≥tica Avanzada e Ingenier√≠a.',
                    icon: 'crown',
                    rarity: 'legendary',
                    points: 1000,
                    special: true,
                    type: 'auto', // Se detecta por t√≠tulo que contenga "fundador"
                    reward: 'üëë PREMIO: Obtienes un Marco Dorado de Fundador exclusivo con corona real y efectos de realeza. ¬°Demuestra que eres uno de los originales!',
                    frameType: 'founder'
                },
                champion: {
                    id: 'champion',
                    name: 'Campe√≥n',
                    description: 'Gan√≥ una competencia nacional o internacional',
                    reason: 'Obtuviste el primer lugar en una competencia oficial de rob√≥tica.',
                    icon: 'trophy',
                    rarity: 'legendary',
                    points: 500,
                    type: 'manual' // Solo admin puede asignar
                },
                mentor_master: {
                    id: 'mentor_master',
                    name: 'Maestro Mentor',
                    description: 'Asesor o tutor oficial del club',
                    reason: 'Eres un asesor, tutor o profesor que gu√≠a a los miembros del club.',
                    icon: 'graduation-cap',
                    rarity: 'legendary',
                    points: 800,
                    type: 'auto' // Se detecta por t√≠tulo que contenga "maestro/tutor/asesor"
                },
                legend: {
                    id: 'legend',
                    name: 'Leyenda',
                    description: 'Reconocimiento especial por contribuciones extraordinarias',
                    reason: 'Tus contribuciones al club han sido tan significativas que te has convertido en una leyenda.',
                    icon: 'flame',
                    rarity: 'legendary',
                    points: 1500,
                    type: 'manual' // Solo admin puede asignar
                },
                pioneer: {
                    id: 'pioneer',
                    name: 'Pionero',
                    description: 'Fue el primero en lograr algo importante',
                    reason: 'Fuiste pionero en alg√∫n aspecto importante del club.',
                    icon: 'compass',
                    rarity: 'legendary',
                    points: 600,
                    type: 'manual' // Solo admin puede asignar
                },
                frutiger_aero: {
                    id: 'frutiger_aero',
                    name: 'Nostalgia Digital',
                    description: '???',
                    reason: '¬°Dominas tecnolog√≠as que muchos ya olvidaron! Tu conocimiento de herramientas cl√°sicas de ingenier√≠a te hace un verdadero nost√°lgico digital.',
                    icon: 'monitor',
                    rarity: 'legendary',
                    points: 700,
                    special: true,
                    secret: true, // Logro secreto
                    type: 'auto', // Se detecta por skills legacy en perfil
                    reward: 'Obtienes un Marco Aero exclusivo con burbujas brillantes y efectos glossy.',
                    frameType: 'frutiger'
                },
                world_class: {
                    id: 'world_class',
                    name: 'Clase Mundial',
                    description: 'Represent√≥ al club a nivel internacional',
                    reason: 'Representaste al CRAI en una competencia o evento internacional. ¬°Llevaste el nombre del CRAI m√°s all√° de las fronteras!',
                    icon: 'globe',
                    rarity: 'mythic',
                    points: 2500,
                    special: true,
                    type: 'manual', // Solo admin puede asignar
                    reward: 'üåç PREMIO: Obtienes un Marco Global exclusivo con efecto de mundo giratorio que aparece en tu tarjeta del Panel de Miembros. ¬°Demuestra tu alcance internacional!',
                    frameType: 'global'
                },
                
                // ========================================
                // √âPICOS (morados) - Dif√≠ciles
                // ========================================
                project_leader: {
                    id: 'project_leader',
                    name: 'L√≠der de Proyecto',
                    description: 'Lider√≥ un proyecto del club',
                    reason: 'Lideraste exitosamente un proyecto registrado en el club.',
                    icon: 'flag',
                    rarity: 'epic',
                    points: 200,
                    type: 'manual' // Solo admin puede asignar
                },
                area_leader: {
                    id: 'area_leader',
                    name: 'L√≠der de √Årea',
                    description: 'Es l√≠der de un √°rea del club',
                    reason: 'Eres el l√≠der responsable de una de las √°reas del club.',
                    icon: 'star',
                    rarity: 'epic',
                    points: 300,
                    type: 'auto' // Se detecta por t√≠tulo que contenga "l√≠der"
                },
                innovator: {
                    id: 'innovator',
                    name: 'Innovador',
                    description: 'Propuso una idea que fue implementada',
                    reason: 'Propusiste una idea innovadora que fue adoptada por el club.',
                    icon: 'lightbulb',
                    rarity: 'epic',
                    points: 150,
                    type: 'manual' // Solo admin puede asignar
                },
                competitor: {
                    id: 'competitor',
                    name: 'Competidor',
                    description: 'Particip√≥ en una competencia oficial',
                    reason: 'Representaste al club en una competencia oficial de rob√≥tica.',
                    icon: 'medal',
                    rarity: 'epic',
                    points: 200,
                    type: 'manual' // Solo admin puede asignar
                },
                podium: {
                    id: 'podium',
                    name: 'Podio',
                    description: 'Lleg√≥ al top 3 en una competencia',
                    reason: 'Obtuviste un lugar en el podio (1¬∞, 2¬∞ o 3¬∞) en una competencia.',
                    icon: 'award',
                    rarity: 'epic',
                    points: 350,
                    type: 'manual' // Solo admin puede asignar
                },
                multi_champion: {
                    id: 'multi_champion',
                    name: 'Multi-Campe√≥n',
                    description: 'Gan√≥ m√°s de una competencia',
                    reason: 'Has ganado m√∫ltiples competencias representando al club.',
                    icon: 'crown',
                    rarity: 'epic',
                    points: 400,
                    type: 'manual' // Solo admin puede asignar
                },
                researcher: {
                    id: 'researcher',
                    name: 'Investigador',
                    description: 'Realiz√≥ investigaci√≥n publicable',
                    reason: 'Tu trabajo de investigaci√≥n fue publicado o presentado oficialmente.',
                    icon: 'microscope',
                    rarity: 'epic',
                    points: 300,
                    type: 'manual' // Solo admin puede asignar
                },
                speaker: {
                    id: 'speaker',
                    name: 'Ponente',
                    description: 'Dio una charla o taller',
                    reason: 'Impartiste una charla, taller o conferencia representando al club.',
                    icon: 'presentation',
                    rarity: 'epic',
                    points: 250,
                    type: 'manual' // Solo admin puede asignar
                },
                influencer: {
                    id: 'influencer',
                    name: 'Influencer',
                    description: 'Promovi√≥ el club en redes sociales',
                    reason: 'Tu contenido en redes sociales ayud√≥ a promover el club significativamente.',
                    icon: 'megaphone',
                    rarity: 'epic',
                    points: 175,
                    type: 'manual' // Solo admin puede asignar
                },
                
                // ========================================
                // RAROS (azules) - Moderados
                // ========================================
                first_project: {
                    id: 'first_project',
                    name: 'Primer Proyecto',
                    description: 'Subi√≥ su primer proyecto al club',
                    reason: 'Subiste tu primer proyecto a la plataforma del club.',
                    icon: 'rocket',
                    rarity: 'rare',
                    points: 50,
                    type: 'auto' // Se detecta al subir un proyecto
                },
                team_player: {
                    id: 'team_player',
                    name: 'Trabajo en Equipo',
                    description: 'Particip√≥ en 3 o m√°s proyectos',
                    reason: 'Has participado como colaborador en 3 o m√°s proyectos del club.',
                    icon: 'users',
                    rarity: 'rare',
                    points: 75,
                    type: 'auto' // Se detecta al participar en 3+ proyectos
                },
                helper: {
                    id: 'helper',
                    name: 'Ayudante',
                    description: 'Ayud√≥ a otros miembros con sus proyectos',
                    reason: 'Ayudaste activamente a otros miembros con sus proyectos.',
                    icon: 'heart-handshake',
                    rarity: 'rare',
                    points: 60,
                    type: 'manual' // Solo admin puede asignar
                },
                event_organizer: {
                    id: 'event_organizer',
                    name: 'Organizador',
                    description: 'Ayud√≥ a organizar un evento del club',
                    reason: 'Participaste en la organizaci√≥n de un evento o competencia del club.',
                    icon: 'calendar-check',
                    rarity: 'rare',
                    points: 80,
                    type: 'manual' // Solo admin puede asignar
                },
                mentor_jr: {
                    id: 'mentor_jr',
                    name: 'Mentor Jr.',
                    description: 'Ense√±√≥ a nuevos miembros',
                    reason: 'Ayudaste a ense√±ar y guiar a miembros nuevos del club.',
                    icon: 'book-heart',
                    rarity: 'rare',
                    points: 100,
                    type: 'manual' // Solo admin puede asignar
                },
                bug_hunter: {
                    id: 'bug_hunter',
                    name: 'Cazador de Bugs',
                    description: 'Encontr√≥ y report√≥ errores en proyectos',
                    reason: 'Encontraste y reportaste errores que ayudaron a mejorar los proyectos.',
                    icon: 'bug',
                    rarity: 'rare',
                    points: 65,
                    type: 'manual' // Solo admin puede asignar
                },
                designer: {
                    id: 'designer',
                    name: 'Dise√±ador',
                    description: 'Cre√≥ dise√±os para el club',
                    reason: 'Creaste dise√±os gr√°ficos, logos o materiales visuales para el club.',
                    icon: 'palette',
                    rarity: 'rare',
                    points: 70,
                    type: 'manual' // Solo admin puede asignar
                },
                coder: {
                    id: 'coder',
                    name: 'Programador',
                    description: 'Contribuy√≥ c√≥digo significativo',
                    reason: 'Contribuiste c√≥digo importante a proyectos del club.',
                    icon: 'code',
                    rarity: 'rare',
                    points: 85,
                    type: 'auto' // Se detecta al tener proyectos de software
                },
                hardware_guru: {
                    id: 'hardware_guru',
                    name: 'Gur√∫ del Hardware',
                    description: 'Experto en componentes electr√≥nicos',
                    reason: 'Demostraste expertise en hardware y componentes electr√≥nicos.',
                    icon: 'cpu',
                    rarity: 'rare',
                    points: 90,
                    type: 'auto' // Se detecta al tener proyectos de electr√≥nica
                },
                mechanic: {
                    id: 'mechanic',
                    name: 'Mec√°nico',
                    description: 'Construy√≥ estructuras mec√°nicas',
                    reason: 'Construiste estructuras mec√°nicas para robots del club.',
                    icon: 'wrench',
                    rarity: 'rare',
                    points: 80,
                    type: 'auto' // Se detecta al tener proyectos mec√°nicos
                },
                night_owl: {
                    id: 'night_owl',
                    name: 'B√∫ho Nocturno',
                    description: 'Trabaj√≥ en proyectos hasta tarde',
                    reason: 'Dedicaste muchas noches trabajando en proyectos del club.',
                    icon: 'moon',
                    rarity: 'rare',
                    points: 55,
                    type: 'manual' // Solo admin puede asignar
                },
                early_bird: {
                    id: 'early_bird',
                    name: 'Madrugador',
                    description: 'Siempre puntual a las reuniones',
                    reason: 'Tu puntualidad a las reuniones y eventos es ejemplar.',
                    icon: 'sun',
                    rarity: 'rare',
                    points: 45,
                    type: 'manual' // Solo admin puede asignar
                },
                workshop_master: {
                    id: 'workshop_master',
                    name: 'Maestro del Taller',
                    description: 'Domina las herramientas del taller',
                    reason: 'Demuestras dominio de las herramientas y equipos del taller.',
                    icon: 'hammer',
                    rarity: 'rare',
                    points: 95,
                    type: 'manual' // Solo admin puede asignar
                },
                
                // ========================================
                // COMUNES (verdes) - F√°ciles
                // ========================================
                newcomer: {
                    id: 'newcomer',
                    name: 'Nuevo Miembro',
                    description: 'Se uni√≥ oficialmente al CRAI',
                    reason: '¬°Bienvenido! Te uniste oficialmente al Club de Rob√≥tica Avanzada e Ingenier√≠a.',
                    icon: 'sprout',
                    rarity: 'common',
                    points: 10,
                    type: 'auto' // Se asigna autom√°ticamente a todos
                },
                active: {
                    id: 'active',
                    name: 'Activo',
                    description: 'Particip√≥ activamente en el club',
                    reason: 'Has demostrado participaci√≥n activa en las actividades del club.',
                    icon: 'zap',
                    rarity: 'common',
                    points: 20,
                    type: 'manual' // Solo admin puede asignar
                },
                contributor: {
                    id: 'contributor',
                    name: 'Contribuidor',
                    description: 'Aport√≥ recursos o conocimiento',
                    reason: 'Aportaste recursos, documentaci√≥n o conocimiento valioso al club.',
                    icon: 'book-open',
                    rarity: 'common',
                    points: 25,
                    type: 'manual' // Solo admin puede asignar
                },
                social: {
                    id: 'social',
                    name: 'Social',
                    description: 'Conect√≥ sus redes sociales',
                    reason: 'Vinculaste tu perfil de GitHub y/o LinkedIn a tu cuenta del club.',
                    icon: 'share-2',
                    rarity: 'common',
                    points: 15,
                    type: 'auto' // Se detecta al tener GitHub o LinkedIn
                },
                first_meeting: {
                    id: 'first_meeting',
                    name: 'Primera Reuni√≥n',
                    description: 'Asisti√≥ a su primera reuni√≥n',
                    reason: 'Asististe a tu primera reuni√≥n oficial del club.',
                    icon: 'calendar',
                    rarity: 'common',
                    points: 10,
                    type: 'manual' // Solo admin puede asignar
                },
                profile_complete: {
                    id: 'profile_complete',
                    name: 'Perfil Completo',
                    description: 'Complet√≥ toda la informaci√≥n de su perfil',
                    reason: 'Completaste toda la informaci√≥n de tu perfil en el sistema.',
                    icon: 'user-check',
                    rarity: 'common',
                    points: 15,
                    type: 'auto' // Se detecta al completar el perfil
                },
                commenter: {
                    id: 'commenter',
                    name: 'Comentarista',
                    description: 'Coment√≥ en proyectos de otros',
                    reason: 'Participaste activamente comentando en proyectos de otros miembros.',
                    icon: 'message-circle',
                    rarity: 'common',
                    points: 15,
                    type: 'manual' // Solo admin puede asignar
                },
                voter: {
                    id: 'voter',
                    name: 'Votante',
                    description: 'Vot√≥ en decisiones del club',
                    reason: 'Participaste votando en decisiones importantes del club.',
                    icon: 'check-square',
                    rarity: 'common',
                    points: 10,
                    type: 'manual' // Solo admin puede asignar
                },
                photographer: {
                    id: 'photographer',
                    name: 'Fot√≥grafo',
                    description: 'Tom√≥ fotos en eventos del club',
                    reason: 'Capturaste momentos importantes del club con tus fotograf√≠as.',
                    icon: 'camera',
                    rarity: 'common',
                    points: 20,
                    type: 'manual' // Solo admin puede asignar
                },
                wiki_writer: {
                    id: 'wiki_writer',
                    name: 'Escritor Wiki',
                    description: 'Escribi√≥ un art√≠culo en la wiki',
                    reason: 'Contribuiste escribiendo un art√≠culo para la wiki del club.',
                    icon: 'file-text',
                    rarity: 'common',
                    points: 30,
                    type: 'auto' // Se detecta al publicar art√≠culo wiki
                },
                curious: {
                    id: 'curious',
                    name: 'Curioso',
                    description: 'Explor√≥ todas las secciones de la plataforma',
                    reason: 'Tu curiosidad te llev√≥ a explorar toda la plataforma del club.',
                    icon: 'search',
                    rarity: 'common',
                    points: 10,
                    type: 'manual' // Solo admin puede asignar
                },
                friendly: {
                    id: 'friendly',
                    name: 'Amigable',
                    description: 'Es conocido por ser amigable',
                    reason: 'Tu actitud amigable hace que todos se sientan bienvenidos.',
                    icon: 'smile',
                    rarity: 'common',
                    points: 20,
                    type: 'manual' // Solo admin puede asignar
                },
                persistent: {
                    id: 'persistent',
                    name: 'Persistente',
                    description: 'No se rinde ante los desaf√≠os',
                    reason: 'Tu persistencia ante los desaf√≠os es admirable.',
                    icon: 'target',
                    rarity: 'common',
                    points: 25,
                    type: 'manual' // Solo admin puede asignar
                },
                creative: {
                    id: 'creative',
                    name: 'Creativo',
                    description: 'Propuso ideas creativas',
                    reason: 'Tus ideas creativas han inspirado al equipo.',
                    icon: 'sparkle',
                    rarity: 'common',
                    points: 20,
                    type: 'manual' // Solo admin puede asignar
                },
                punctual: {
                    id: 'punctual',
                    name: 'Puntual',
                    description: 'Siempre llega a tiempo',
                    reason: 'Tu puntualidad es consistente y confiable.',
                    icon: 'clock',
                    rarity: 'common',
                    points: 15,
                    type: 'manual' // Solo admin puede asignar
                }
            },
            
            // Colores por rareza
            getRarityColors: (rarity) => {
                const colors = {
                    mythic: { bg: 'bg-gradient-to-br from-pink-500 via-purple-500 to-cyan-500', text: 'text-white', light: 'bg-gradient-to-r from-pink-100 to-cyan-100', border: 'border-pink-400' },
                    legendary: { bg: 'bg-gradient-to-br from-amber-400 to-yellow-500', text: 'text-amber-900', light: 'bg-amber-100', border: 'border-amber-400' },
                    epic: { bg: 'bg-gradient-to-br from-purple-500 to-violet-600', text: 'text-white', light: 'bg-purple-100', border: 'border-purple-400' },
                    rare: { bg: 'bg-gradient-to-br from-blue-500 to-indigo-600', text: 'text-white', light: 'bg-blue-100', border: 'border-blue-400' },
                    common: { bg: 'bg-gradient-to-br from-emerald-500 to-green-600', text: 'text-white', light: 'bg-green-100', border: 'border-green-400' }
                };
                return colors[rarity] || colors.common;
            },
            
            // Verificar si el usuario tiene alg√∫n marco especial y cu√°l
            hasSpecialFrame: (user) => {
                const achievements = Achievements.getUserAchievements(user);
                const canUse = {
                    rainbow: achievements.includes('completionist'),
                    cosmic: achievements.includes('polymath'),
                    global: achievements.includes('world_class'),
                    frutiger: achievements.includes('frutiger_aero')
                };
                
                // Si el usuario tiene una preferencia guardada, usarla
                const selectedFrame = user.selectedFrame;
                if (selectedFrame === 'none') return false;
                if (selectedFrame && canUse[selectedFrame]) return selectedFrame;
                
                // Si no hay preferencia, usar prioridad por defecto
                if (canUse.rainbow) return 'rainbow';
                if (canUse.cosmic) return 'cosmic';
                if (canUse.global) return 'global';
                if (canUse.frutiger) return 'frutiger';
                return false;
            },
            
            // Verificar si el usuario puede tener el overlay de fundador
            canUseFounderOverlay: (user) => {
                const achievements = Achievements.getUserAchievements(user);
                return achievements.includes('founder');
            },
            
            // Verificar si el usuario tiene el efecto de fundador activado
            hasFounderOverlay: (user) => {
                const achievements = Achievements.getUserAchievements(user);
                const hasFounder = achievements.includes('founder');
                if (!hasFounder) return false;
                
                // Si no tiene preferencia guardada, activado por defecto
                if (user.founderOverlayEnabled === undefined) return true;
                return user.founderOverlayEnabled === true;
            },
            
            // Toggle del overlay de fundador
            toggleFounderOverlay: async (enabled) => {
                if (!STATE.currentUser) return;
                
                try {
                    await db.collection('users').doc(STATE.currentUser.uid).update({
                        founderOverlayEnabled: enabled
                    });
                    
                    STATE.profile.founderOverlayEnabled = enabled;
                    
                    Util.notify(enabled ? 'Corona de Fundador activada üëë' : 'Corona de Fundador desactivada', 'success');
                    
                    Database.loadAchievementsPanel();
                    Database.loadPublicMembers();
                    Members.render();
                } catch (err) {
                    console.error('Error cambiando overlay:', err);
                    Util.notify('Error al cambiar el overlay', 'error');
                }
            },
            
            // Verificar si el fundador prefiere mostrarse como l√≠der de √°rea
            prefersAreaStyle: (user) => {
                // Solo aplica a fundadores principales
                const title = (user.customTitle || '').toLowerCase();
                const isFounder = title.includes('fundador') || title.includes('founder');
                if (!isFounder) return false;
                
                // Si tiene preferencia guardada, usarla
                return user.showAsAreaLeader === true;
            },
            
            // Toggle para mostrar como l√≠der de √°rea o como fundador dorado
            toggleAreaStyle: async (enabled) => {
                if (!STATE.currentUser) return;
                
                try {
                    await db.collection('users').doc(STATE.currentUser.uid).update({
                        showAsAreaLeader: enabled
                    });
                    
                    STATE.profile.showAsAreaLeader = enabled;
                    
                    Util.notify(
                        enabled 
                            ? 'Ahora te muestras con estilo de L√≠der de √Årea ‚≠ê' 
                            : 'Ahora te muestras con estilo de Fundador üëë', 
                        'success'
                    );
                    
                    // Re-renderizar panel de logros para actualizar el toggle
                    Database.loadAchievementsPanel();
                    Members.render();
                    Database.loadPublicMembers();
                } catch (err) {
                    console.error('Error cambiando estilo:', err);
                    Util.notify('Error al cambiar el estilo', 'error');
                }
            },
            
            // Verificar si el usuario puede usar alg√∫n marco
            canUseFrame: (user) => {
                const achievements = Achievements.getUserAchievements(user);
                return {
                    rainbow: achievements.includes('completionist'),
                    cosmic: achievements.includes('polymath'),
                    global: achievements.includes('world_class'),
                    frutiger: achievements.includes('frutiger_aero')
                };
            },
            
            // Obtener marcos disponibles para el usuario
            getAvailableFrames: (user) => {
                const canUse = Achievements.canUseFrame(user);
                const frames = [];
                if (canUse.rainbow) frames.push({ id: 'rainbow', name: 'Marco Arco√≠ris', icon: 'sparkles', color: 'from-pink-500 via-purple-500 to-cyan-500', achievement: 'Completista' });
                if (canUse.cosmic) frames.push({ id: 'cosmic', name: 'Marco C√≥smico', icon: 'atom', color: 'from-violet-600 via-purple-600 to-indigo-600', achievement: 'Pol√≠mata' });
                if (canUse.global) frames.push({ id: 'global', name: 'Marco Global', icon: 'globe', color: 'from-cyan-500 via-teal-500 to-cyan-400', achievement: 'Clase Mundial' });
                if (canUse.frutiger) frames.push({ id: 'frutiger', name: 'Marco Aero', icon: 'monitor', color: 'from-cyan-400 via-sky-400 to-cyan-300', achievement: '???' });
                return frames;
            },
            
            // Cambiar el marco seleccionado
            selectFrame: async (frameId) => {
                if (!STATE.currentUser) return;
                
                try {
                    await db.collection('users').doc(STATE.currentUser.uid).update({
                        selectedFrame: frameId
                    });
                    
                    STATE.profile.selectedFrame = frameId;
                    
                    const frameName = frameId === 'none' ? 'Ninguno' : 
                                     frameId === 'rainbow' ? 'Arco√≠ris' :
                                     frameId === 'cosmic' ? 'C√≥smico' :
                                     frameId === 'global' ? 'Global' : 'Frutiger Aero';
                    Util.notify(`Marco cambiado a: ${frameName}`, 'success');
                    
                    Database.loadAchievementsPanel();
                    Database.loadPublicMembers();
                } catch (err) {
                    console.error('Error cambiando marco:', err);
                    Util.notify('Error al cambiar el marco', 'error');
                }
            },
            
            // Obtener logros de un usuario
            // Tipos de logros: 'auto' = se detecta autom√°ticamente, 'manual' = solo admin puede asignar
            // Los 'auto' son seguros porque se basan en datos verificables de Firebase
            
            getUserAchievements: (user) => {
                const achievements = user.achievements || [];
                const autoAchievements = [];
                
                // Auto-detectar logro de FUNDADOR (basado en t√≠tulo - solo admin puede cambiar t√≠tulo)
                const title = (user.customTitle || '').toLowerCase();
                if (title.includes('fundador') || title.includes('cofundador')) {
                    if (!achievements.includes('founder')) {
                        autoAchievements.push('founder');
                    }
                }
                
                // Auto-detectar MENTOR/MAESTRO (basado en t√≠tulo)
                if (title.includes('maestro') || title.includes('tutor') || 
                    title.includes('asesor') || title.includes('profesor')) {
                    if (!achievements.includes('mentor_master')) {
                        autoAchievements.push('mentor_master');
                    }
                }
                
                // Auto-detectar L√çDER DE √ÅREA (basado en t√≠tulo)
                if ((title.includes('l√≠der') || title.includes('lider')) && 
                    !title.includes('fundador') && !title.includes('cofundador')) {
                    if (!achievements.includes('area_leader')) {
                        autoAchievements.push('area_leader');
                    }
                }
                
                // Auto-detectar SOCIAL (tiene GitHub o LinkedIn - verificable)
                if (user.github || user.linkedin) {
                    if (!achievements.includes('social')) {
                        autoAchievements.push('social');
                    }
                }
                
                // Auto-detectar PERFIL COMPLETO (todos los campos llenos - verificable)
                if (user.fullName && user.career && user.bio && user.area && (user.github || user.linkedin)) {
                    if (!achievements.includes('profile_complete')) {
                        autoAchievements.push('profile_complete');
                    }
                }
                
                // Auto-detectar NEWCOMER (todos lo tienen por defecto)
                if (!achievements.includes('newcomer')) {
                    autoAchievements.push('newcomer');
                }
                
                // Auto-detectar NOSTALGIA DIGITAL - habilidades cl√°sicas de ingenier√≠a en skills
                const skills = (user.skills || []).map(s => s.toLowerCase());
                const legacySkills = [
                    // Lenguajes legacy
                    'cobol', 'fortran', 'pascal', 'delphi', 'visual basic', 'vb6', 'vb.net',
                    'assembly', 'assembler', 'ensamblador', 'basic', 'qbasic', 'turbo pascal',
                    'foxpro', 'clipper', 'ada', 'lisp', 'prolog', 'smalltalk',
                    // Software CAD/CAM antiguo
                    'autocad 2d', 'autocad r14', 'autocad 2000', 'autocad 2004', 'autocad lt',
                    'mastercam', 'catia v4', 'pro/engineer', 'pro engineer', 'unigraphics',
                    // Electr√≥nica legacy
                    'orcad', 'pspice', 'protel', 'eagle', 'multisim', 'proteus',
                    'pic basic', 'pic16f84', 'pic16f877', 'at89c51', '8051', 'z80',
                    'motorola 68000', '6502', 'avr studio', 'mplab',
                    // PLCs y automatizaci√≥n legacy  
                    'rslogix', 'rslogix 500', 'step 5', 'step 7', 'simatic s5',
                    'plc-5', 'slc 500', 'micrologix', 'logo!', 'zelio',
                    // Software legacy
                    'labview', 'matlab 6', 'matlab 7', 'simulink', 'mathcad',
                    'flash', 'actionscript', 'director', 'shockwave',
                    // Herramientas
                    'torno manual', 'fresadora manual', 'torno convencional',
                    'dibujo t√©cnico', 'restirador', 'rapid√≥grafo',
                    // Comunicaciones legacy
                    'rs232', 'rs485', 'rs422', 'gpib', 'paralelo', 'puerto paralelo',
                    'modem', 'dial-up', 'bbs'
                ];
                
                const hasLegacySkill = skills.some(skill => 
                    legacySkills.some(legacy => skill.includes(legacy))
                );
                
                if (hasLegacySkill && !achievements.includes('frutiger_aero')) {
                    autoAchievements.push('frutiger_aero');
                }
                
                // Los siguientes se detectan con datos adicionales que se pasan
                // first_project, team_player, wiki_writer - se verifican en checkAutoAchievements()
                
                const allAchievements = [...new Set([...achievements, ...autoAchievements])];
                
                // Verificar si tiene TODOS los logros (excepto completionist, founder y mentor_master)
                // para dar el logro m√≠tico - as√≠ TODOS pueden obtenerlo
                const excludedFromCompletionist = ['completionist', 'founder', 'mentor_master', 'polymath', 'world_class', 'frutiger_aero'];
                const requiredForCompletionist = Object.keys(Achievements.definitions).filter(id => !excludedFromCompletionist.includes(id));
                const hasAll = requiredForCompletionist.every(id => allAchievements.includes(id));
                if (hasAll && !allAchievements.includes('completionist')) {
                    allAchievements.push('completionist');
                }
                
                return allAchievements;
            },
            
            // Verificar logros autom√°ticos basados en acciones en Firebase
            // Esta funci√≥n se llama despu√©s de ciertas acciones (subir proyecto, escribir wiki, etc.)
            checkAutoAchievements: async (userId) => {
                if (!userId) return;
                
                try {
                    const userDoc = await db.collection('users').doc(userId).get();
                    if (!userDoc.exists) return;
                    
                    const userData = userDoc.data();
                    const currentAchievements = userData.achievements || [];
                    const newAchievements = [...currentAchievements];
                    let hasChanges = false;
                    
                    // 1. PRIMER PROYECTO - Verificar si tiene al menos 1 proyecto
                    if (!currentAchievements.includes('first_project')) {
                        const projectsSnap = await db.collection('projects')
                            .where('authorId', '==', userId)
                            .limit(1)
                            .get();
                        
                        if (!projectsSnap.empty) {
                            newAchievements.push('first_project');
                            hasChanges = true;
                        }
                    }
                    
                    // 2. TRABAJO EN EQUIPO - Verificar si aparece en 3+ proyectos como colaborador
                    if (!currentAchievements.includes('team_player')) {
                        const projectsSnap = await db.collection('projects').get();
                        let projectCount = 0;
                        
                        projectsSnap.forEach(doc => {
                            const data = doc.data();
                            const members = data.members || [];
                            if (members.some(m => m.oderId === userId || m.id === userId) || data.authorId === userId) {
                                projectCount++;
                            }
                        });
                        
                        if (projectCount >= 3) {
                            newAchievements.push('team_player');
                            hasChanges = true;
                        }
                    }
                    
                    // 3. ESCRITOR WIKI - Verificar si escribi√≥ al menos 1 art√≠culo en la wiki
                    if (!currentAchievements.includes('wiki_writer')) {
                        const wikiSnap = await db.collection('wiki')
                            .where('authorId', '==', userId)
                            .limit(1)
                            .get();
                        
                        if (!wikiSnap.empty) {
                            newAchievements.push('wiki_writer');
                            hasChanges = true;
                        }
                    }
                    
                    // 4. PROGRAMADOR - Verificar si tiene proyectos de software
                    if (!currentAchievements.includes('coder')) {
                        const projectsSnap = await db.collection('projects')
                            .where('authorId', '==', userId)
                            .where('category', '==', 'software')
                            .limit(1)
                            .get();
                        
                        if (!projectsSnap.empty) {
                            newAchievements.push('coder');
                            hasChanges = true;
                        }
                    }
                    
                    // 5. GUR√ö DEL HARDWARE - Verificar si tiene proyectos de electr√≥nica
                    if (!currentAchievements.includes('hardware_guru')) {
                        const projectsSnap = await db.collection('projects')
                            .where('authorId', '==', userId)
                            .where('category', '==', 'electronica')
                            .limit(1)
                            .get();
                        
                        if (!projectsSnap.empty) {
                            newAchievements.push('hardware_guru');
                            hasChanges = true;
                        }
                    }
                    
                    // 6. MEC√ÅNICO - Verificar si tiene proyectos de mec√°nica
                    if (!currentAchievements.includes('mechanic')) {
                        const projectsSnap = await db.collection('projects')
                            .where('authorId', '==', userId)
                            .where('category', '==', 'mecanico')
                            .limit(1)
                            .get();
                        
                        if (!projectsSnap.empty) {
                            newAchievements.push('mechanic');
                            hasChanges = true;
                        }
                    }
                    
                    // 7. POL√çMATA - Verificar si tiene proyectos en TODAS las categor√≠as (software, electr√≥nica, mec√°nico)
                    if (!currentAchievements.includes('polymath')) {
                        // Ya verificamos arriba si tiene cada categor√≠a individual
                        const hasSoftware = newAchievements.includes('coder') || currentAchievements.includes('coder');
                        const hasElectronics = newAchievements.includes('hardware_guru') || currentAchievements.includes('hardware_guru');
                        const hasMechanic = newAchievements.includes('mechanic') || currentAchievements.includes('mechanic');
                        
                        if (hasSoftware && hasElectronics && hasMechanic) {
                            newAchievements.push('polymath');
                            hasChanges = true;
                        }
                    }
                    
                    // 8. NOSTALGIA DIGITAL - Detectar palabras clave retro en bio o skills
                    if (!currentAchievements.includes('frutiger_aero')) {
                        const bio = (userData.bio || '').toLowerCase();
                        const skills = (userData.skills || []).map(s => s.toLowerCase()).join(' ');
                        const searchText = bio + ' ' + skills;
                        
                        const retroKeywords = ['retro', 'vintage', 'nostalgia', 'nostalgico', 'nost√°lgico', 
                            'windows', 'vista', 'aero', 'frutiger', '2000', 'y2k', 'oldschool', 'old school',
                            'classico', 'cl√°sico', 'classic', 'pixel', 'vaporwave', 'retrowave', 
                            'synthwave', 'aesthetic', 'skeuomorphism', 'glossy', 'bubble', 'burbuja',
                            'aqua', 'gel', 'glass', 'cristal', 'xp', 'millennium', 'milenio'];
                        
                        const hasRetroVibes = retroKeywords.some(keyword => searchText.includes(keyword));
                        
                        if (hasRetroVibes) {
                            newAchievements.push('frutiger_aero');
                            hasChanges = true;
                        }
                    }
                    
                    // Guardar y notificar si hay cambios
                    if (hasChanges) {
                        await db.collection('users').doc(userId).update({
                            achievements: newAchievements
                        });
                        
                        // Notificar nuevos logros
                        const addedAchievements = newAchievements.filter(a => !currentAchievements.includes(a));
                        addedAchievements.forEach(achievementId => {
                            const def = Achievements.definitions[achievementId];
                            if (def) {
                                setTimeout(() => Achievements.showUnlockNotification(def), 500);
                            }
                        });
                        
                        // Recargar panel de logros si est√° visible
                        Database.loadAchievementsPanel();
                    }
                    
                } catch (err) {
                    console.error('Error verificando logros autom√°ticos:', err);
                }
            },
            
            // Renderizar una insignia individual con icono Lucide
            renderSingleBadge: (def, size = 'normal') => {
                const colors = Achievements.getRarityColors(def.rarity);
                const sizeClasses = size === 'small' ? 'w-7 h-7' : 'w-10 h-10';
                const iconSize = size === 'small' ? 'w-3.5 h-3.5' : 'w-5 h-5';
                
                return `
                    <div class="achievement-badge ${def.rarity} ${sizeClasses} ${colors.bg} ${colors.text} cursor-pointer" 
                         onclick="Achievements.showBadgeDetail('${def.id}')" 
                         title="${def.name}">
                        <i data-lucide="${def.icon}" class="${iconSize}"></i>
                    </div>
                `;
            },
            
            // Mostrar detalle de un logro (desbloqueado o bloqueado)
            showBadgeDetail: (achievementId, unlocked = true, currentUserHasIt = false) => {
                const def = Achievements.definitions[achievementId];
                if (!def) return;
                
                const colors = Achievements.getRarityColors(def.rarity);
                const rarityLabels = { mythic: 'M√≠tico', legendary: 'Legendario', epic: '√âpico', rare: 'Raro', common: 'Com√∫n' };
                const isMythic = def.rarity === 'mythic';
                const isAuto = def.type === 'auto';
                
                // Si el usuario actual no tiene el logro desbloqueado, revisar si ya lo tiene en su perfil
                if (!currentUserHasIt) {
                    const currentUserAchievements = STATE.profile?.achievements || [];
                    currentUserHasIt = currentUserAchievements.includes(achievementId);
                }
                
                // Si es secreto y NADIE (ni el del perfil ni el usuario actual) lo tiene, mostrar info misteriosa
                const isSecret = def.secret && !unlocked && !currentUserHasIt;
                
                if (isSecret) {
                    Swal.fire({
                        html: `
                            <div class="text-center py-4">
                                <div class="w-20 h-20 bg-gradient-to-br from-slate-400 to-slate-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg animate-pulse">
                                    <i data-lucide="help-circle" class="w-10 h-10 text-white"></i>
                                </div>
                                <h3 class="text-xl font-black text-slate-500 mb-1">???</h3>
                                <span class="inline-block px-3 py-1 bg-gradient-to-r from-purple-100 to-pink-100 border border-purple-300 rounded-full text-xs font-bold uppercase mb-4 text-purple-700">üîÆ Logro Secreto</span>
                                <p class="text-slate-600 text-sm mb-4 italic">Este logro permanece oculto en las sombras...</p>
                                
                                <div class="bg-gradient-to-br from-slate-100 to-slate-200 rounded-xl p-4 text-center mb-3">
                                    <p class="text-xs font-bold text-slate-500 uppercase mb-2">Pista</p>
                                    <p class="text-sm text-slate-600 italic">A veces las cosas m√°s nost√°lgicas se esconden a plena vista... ü´ß</p>
                                </div>
                                
                                <div class="flex items-center justify-center gap-2 mt-4">
                                    <i data-lucide="sparkles" class="w-4 h-4 text-purple-500 animate-pulse"></i>
                                    <span class="font-bold text-purple-500">??? puntos</span>
                                </div>
                            </div>
                        `,
                        showConfirmButton: false,
                        showCloseButton: true,
                        width: 380,
                        customClass: {
                            popup: 'rounded-2xl'
                        },
                        didOpen: () => lucide.createIcons()
                    });
                    return;
                }
                
                // Texto de c√≥mo obtener seg√∫n el tipo
                const howToGet = isAuto 
                    ? '<span class="text-green-600"><i data-lucide="zap" class="w-3 h-3 inline"></i> Autom√°tico</span> - Se desbloquea autom√°ticamente al cumplir la condici√≥n.'
                    : '<span class="text-amber-600"><i data-lucide="shield" class="w-3 h-3 inline"></i> Manual</span> - Solo un administrador puede otorgarlo.';
                
                Swal.fire({
                    html: `
                        <div class="text-center py-4">
                            <div class="w-20 h-20 ${unlocked ? colors.bg : 'bg-slate-300'} rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg ${isMythic && unlocked ? 'animate-pulse' : ''} ${def.rarity === 'legendary' && unlocked ? 'animate-pulse' : ''}">
                                <i data-lucide="${unlocked ? def.icon : 'lock'}" class="w-10 h-10 ${unlocked ? colors.text : 'text-slate-500'}"></i>
                            </div>
                            <h3 class="text-xl font-black ${unlocked ? 'text-slate-800' : 'text-slate-500'} mb-1">${def.name}</h3>
                            ${!unlocked ? '<span class="inline-block px-2 py-0.5 bg-slate-200 text-slate-600 rounded-full text-[10px] font-bold uppercase mb-2">üîí Bloqueado</span>' : ''}
                            <span class="inline-block px-3 py-1 ${unlocked ? colors.light + ' ' + colors.border : 'bg-slate-100 border-slate-300'} border rounded-full text-xs font-bold uppercase mb-4">${rarityLabels[def.rarity]}</span>
                            <p class="text-slate-600 text-sm mb-4">${def.description}</p>
                            
                            <div class="bg-slate-50 rounded-xl p-4 text-left mb-3">
                                <p class="text-xs font-bold text-slate-500 uppercase mb-2">${unlocked ? '¬øPor qu√© lo obtuviste?' : '¬øC√≥mo se obtiene?'}</p>
                                <p class="text-sm text-slate-700">${def.reason}</p>
                            </div>
                            
                            ${def.reward ? `
                            <div class="bg-gradient-to-r from-pink-50 to-purple-50 border border-pink-200 rounded-xl p-3 text-left mb-3">
                                <p class="text-xs font-bold text-pink-700 mb-1">üéÅ Premio Especial:</p>
                                <p class="text-xs text-purple-700">${def.reward}</p>
                            </div>
                            ` : ''}
                            
                            ${!unlocked && !def.reward ? `
                            <div class="bg-amber-50 border border-amber-200 rounded-xl p-3 text-left">
                                <p class="text-xs font-bold text-amber-700 mb-1">Tipo de logro:</p>
                                <p class="text-xs text-amber-800">${howToGet}</p>
                            </div>
                            ` : ''}
                            
                            ${!unlocked && def.reward ? `
                            <div class="bg-amber-50 border border-amber-200 rounded-xl p-3 text-left">
                                <p class="text-xs font-bold text-amber-700 mb-1">Tipo de logro:</p>
                                <p class="text-xs text-amber-800">${howToGet}</p>
                            </div>
                            ` : ''}
                            
                            <div class="flex items-center justify-center gap-2 mt-4">
                                <i data-lucide="gem" class="w-4 h-4 text-tec-gold"></i>
                                <span class="font-bold text-tec-gold">${def.points} puntos</span>
                            </div>
                        </div>
                    `,
                    showConfirmButton: false,
                    showCloseButton: true,
                    width: 380,
                    customClass: {
                        popup: 'rounded-2xl'
                    },
                    didOpen: () => lucide.createIcons()
                });
            },
            
            // Renderizar insignias compactas para vista previa
            renderBadgesPreview: (user, maxDisplay = 4) => {
                const achievementIds = Achievements.getUserAchievements(user);
                if (achievementIds.length === 0) return '';
                
                const rarityOrder = { legendary: 0, epic: 1, rare: 2, common: 3 };
                const sortedIds = achievementIds.sort((a, b) => {
                    const defA = Achievements.definitions[a];
                    const defB = Achievements.definitions[b];
                    if (!defA || !defB) return 0;
                    return rarityOrder[defA.rarity] - rarityOrder[defB.rarity];
                });
                
                const displayed = sortedIds.slice(0, maxDisplay);
                const remaining = sortedIds.length - maxDisplay;
                
                let html = '<div class="flex items-center gap-1">';
                displayed.forEach(id => {
                    const def = Achievements.definitions[id];
                    if (!def) return;
                    html += Achievements.renderSingleBadge(def, 'small');
                });
                if (remaining > 0) {
                    html += `<span class="text-[10px] text-slate-400 ml-1">+${remaining}</span>`;
                }
                html += '</div>';
                
                return html;
            },
            
            // Renderizar lista completa de logros para el modal de miembro
            renderFullList: (user) => {
                const achievementIds = Achievements.getUserAchievements(user);
                const allDefs = Object.values(Achievements.definitions);
                const rarityLabels = { mythic: 'M√≠tico', legendary: 'Legendario', epic: '√âpico', rare: 'Raro', common: 'Com√∫n' };
                const rarityOrder = { mythic: 0, legendary: 1, epic: 2, rare: 3, common: 4 };
                
                // Obtener logros del usuario actual (quien est√° viendo)
                const currentUserAchievements = STATE.profile?.achievements || [];
                
                // Ordenar por rareza
                const sortedDefs = allDefs.sort((a, b) => rarityOrder[a.rarity] - rarityOrder[b.rarity]);
                
                let html = '<div class="grid grid-cols-2 gap-3">';
                sortedDefs.forEach(def => {
                    const unlocked = achievementIds.includes(def.id);
                    const colors = Achievements.getRarityColors(def.rarity);
                    const isMythic = def.rarity === 'mythic';
                    
                    // El usuario actual tiene este logro desbloqueado? (√©l puede ver los secretos que √©l ya desbloque√≥)
                    const currentUserHasIt = currentUserAchievements.includes(def.id);
                    
                    // Si es secreto y NI el usuario del perfil NI el usuario actual lo tiene, mostrar como "???"
                    const isSecret = def.secret && !unlocked && !currentUserHasIt;
                    const displayName = isSecret ? '???' : def.name;
                    const displayDesc = isSecret ? 'Este logro es un misterio... ¬°Desc√∫brelo!' : def.description;
                    const displayIcon = isSecret ? 'help-circle' : (unlocked ? def.icon : 'lock');
                    
                    html += `
                        <div class="p-3 rounded-xl border-2 ${unlocked ? 'bg-white ' + colors.border : 'bg-slate-100 border-slate-200'} ${isSecret ? 'border-dashed' : ''} transition-all cursor-pointer hover:shadow-md ${isMythic && unlocked ? 'animate-pulse ring-2 ring-pink-300' : ''}" 
                             onclick="Achievements.showBadgeDetail('${def.id}', ${unlocked}, ${currentUserHasIt})">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-8 h-8 ${unlocked ? colors.bg : isSecret ? 'bg-gradient-to-br from-slate-300 to-slate-400' : 'bg-slate-300'} rounded-lg flex items-center justify-center ${isMythic && unlocked ? 'animate-spin-slow' : ''} ${isSecret ? 'animate-pulse' : ''}">
                                    <i data-lucide="${displayIcon}" class="w-4 h-4 ${unlocked ? colors.text : 'text-slate-500'}"></i>
                                </div>
                                <span class="text-xs font-bold ${unlocked ? 'text-slate-800' : 'text-slate-500'} ${isSecret ? 'italic' : ''}">${displayName}</span>
                            </div>
                            <p class="text-[10px] ${unlocked ? 'text-slate-500' : 'text-slate-400'} line-clamp-2 ${isSecret ? 'italic' : ''}">${displayDesc}</p>
                            <div class="flex items-center gap-1 mt-2">
                                <span class="text-[9px] px-1.5 py-0.5 rounded-full font-bold uppercase ${unlocked ? colors.light : isSecret ? 'bg-slate-300 text-slate-600' : 'bg-slate-200 text-slate-500'}">${isSecret ? '????' : rarityLabels[def.rarity]}</span>
                                <span class="text-[9px] text-slate-400">${isSecret ? '???' : def.points + ' pts'}</span>
                                ${!unlocked && !isSecret ? '<span class="ml-auto text-[9px] text-slate-400 flex items-center gap-0.5"><i data-lucide="help-circle" class="w-3 h-3"></i> C√≥mo obtener</span>' : ''}
                                ${isSecret ? '<span class="ml-auto text-[9px] text-purple-500 flex items-center gap-0.5"><i data-lucide="sparkles" class="w-3 h-3"></i> Secreto</span>' : ''}
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                
                return html;
            },
            
            // Calcular puntos totales
            getTotalPoints: (user) => {
                const achievementIds = Achievements.getUserAchievements(user);
                return achievementIds.reduce((total, id) => {
                    const def = Achievements.definitions[id];
                    return total + (def ? def.points : 0);
                }, 0);
            },
            
            // Verificar y notificar nuevos logros
            checkAndNotify: async (userId, userData) => {
                if (!userId || !userData) return;
                
                const currentAchievements = userData.achievements || [];
                const detectedAchievements = Achievements.getUserAchievements(userData);
                
                // Encontrar nuevos logros
                const newAchievements = detectedAchievements.filter(a => !currentAchievements.includes(a));
                
                if (newAchievements.length > 0) {
                    // Guardar los nuevos logros en la base de datos
                    try {
                        await db.collection('users').doc(userId).update({
                            achievements: detectedAchievements
                        });
                        
                        // Mostrar notificaci√≥n para cada nuevo logro
                        newAchievements.forEach(achievementId => {
                            const def = Achievements.definitions[achievementId];
                            if (def) {
                                Achievements.showUnlockNotification(def);
                            }
                        });
                    } catch (err) {
                        console.error('Error guardando logros:', err);
                    }
                }
            },
            
            // Mostrar notificaci√≥n de logro desbloqueado
            showUnlockNotification: (def) => {
                const colors = Achievements.getRarityColors(def.rarity);
                const rarityLabels = { legendary: 'Legendario', epic: '√âpico', rare: 'Raro', common: 'Com√∫n' };
                
                Swal.fire({
                    html: `
                        <div class="text-center">
                            <div class="relative">
                                <div class="absolute inset-0 ${colors.bg} rounded-full blur-xl opacity-50 animate-pulse"></div>
                                <div class="relative w-24 h-24 ${colors.bg} rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-2xl animate-bounce">
                                    <i data-lucide="${def.icon}" class="w-12 h-12 ${colors.text}"></i>
                                </div>
                            </div>
                            <p class="text-xs text-slate-500 uppercase tracking-wider mb-1">¬°Nuevo Logro Desbloqueado!</p>
                            <h3 class="text-2xl font-black text-slate-800 mb-2">${def.name}</h3>
                            <span class="inline-block px-3 py-1 ${colors.light} rounded-full text-xs font-bold uppercase mb-3">${rarityLabels[def.rarity]}</span>
                            <p class="text-slate-600 text-sm">${def.reason}</p>
                            <div class="flex items-center justify-center gap-2 mt-4 p-3 bg-tec-gold/10 rounded-xl">
                                <i data-lucide="gem" class="w-5 h-5 text-tec-gold"></i>
                                <span class="font-black text-tec-gold text-lg">+${def.points} puntos</span>
                            </div>
                        </div>
                    `,
                    showConfirmButton: true,
                    confirmButtonText: '¬°Genial!',
                    confirmButtonColor: '#1B396A',
                    width: 380,
                    customClass: {
                        popup: 'rounded-2xl'
                    },
                    didOpen: () => lucide.createIcons()
                });
            },
            
            // Renderizar secci√≥n de logros para el dashboard
            renderDashboardSection: (user) => {
                const achievementIds = Achievements.getUserAchievements(user);
                const totalPoints = Achievements.getTotalPoints(user);
                const totalAchievements = Object.keys(Achievements.definitions).length;
                const unlockedCount = achievementIds.length;
                const progressPercent = Math.round((unlockedCount / totalAchievements) * 100);
                const hasFrame = Achievements.hasSpecialFrame(user);
                const isAdmin = Achievements.isAchievementAdmin();
                
                const rarityOrder = { mythic: 0, legendary: 1, epic: 2, rare: 3, common: 4 };
                const sortedIds = achievementIds.sort((a, b) => {
                    const defA = Achievements.definitions[a];
                    const defB = Achievements.definitions[b];
                    if (!defA || !defB) return 0;
                    return rarityOrder[defA.rarity] - rarityOrder[defB.rarity];
                });
                
                let badgesHtml = sortedIds.map(id => {
                    const def = Achievements.definitions[id];
                    if (!def) return '';
                    return Achievements.renderSingleBadge(def, 'normal');
                }).join('');
                
                // Determinar estilos seg√∫n el tipo de marco
                const isRainbow = hasFrame === 'rainbow';
                const isCosmic = hasFrame === 'cosmic';
                const isGlobal = hasFrame === 'global';
                const isFrutiger = hasFrame === 'frutiger';
                const isFounder = hasFrame === 'founder';
                const hasAnyFrame = isRainbow || isCosmic || isGlobal || isFrutiger || isFounder;
                
                const headerClass = isRainbow 
                    ? 'bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500 animate-gradient-x'
                    : isCosmic 
                        ? 'bg-gradient-to-r from-violet-600 via-purple-600 to-indigo-600'
                        : isGlobal
                            ? 'bg-gradient-to-r from-cyan-500 via-teal-500 to-cyan-400 animate-gradient-x'
                            : isFrutiger
                                ? 'bg-gradient-to-r from-cyan-400 via-sky-300 to-cyan-400 animate-gradient-x'
                                : isFounder
                                    ? 'bg-gradient-to-r from-amber-500 via-yellow-400 to-amber-500 animate-gradient-x'
                                    : 'bg-gradient-to-r from-tec-gold via-amber-500 to-yellow-500';
                
                const frameClass = isRainbow ? 'mythic-frame' : isCosmic ? 'cosmic-frame' : isGlobal ? 'global-frame' : isFrutiger ? 'frutiger-frame' : isFounder ? 'founder-frame' : '';
                const frameTitle = isRainbow ? '‚ú® Completista ‚ú®' : isCosmic ? 'üåå Pol√≠mata üåå' : isGlobal ? 'üåç Clase Mundial üåç' : isFrutiger ? 'Mis Logros' : isFounder ? 'üëë Fundador üëë' : 'Mis Logros';
                const frameIcon = isRainbow ? 'sparkles' : isCosmic ? 'atom' : isGlobal ? 'globe' : isFrutiger ? 'monitor' : isFounder ? 'crown' : 'award';
                
                return `
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden ${frameClass}">
                        <div class="${headerClass} p-4 text-white">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center ${hasAnyFrame ? 'animate-pulse' : ''}">
                                        <i data-lucide="${frameIcon}" class="w-5 h-5"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-sm">${frameTitle}</h4>
                                        <p class="${hasAnyFrame ? 'text-white/80' : 'text-amber-100'} text-xs">${unlockedCount}/${totalAchievements} desbloqueados</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-2xl font-black">${totalPoints}</p>
                                    <p class="text-[10px] ${hasAnyFrame ? 'text-white/80' : 'text-amber-100'} uppercase">Puntos</p>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="h-2 bg-white/30 rounded-full overflow-hidden">
                                    <div class="h-full bg-white rounded-full transition-all" style="width: ${progressPercent}%"></div>
                                </div>
                                <p class="text-[10px] ${hasAnyFrame ? 'text-white/80' : 'text-amber-100'} mt-1 text-right">${progressPercent}% completado</p>
                            </div>
                        </div>
                        <div class="p-4">
                            <div class="flex flex-wrap gap-2 justify-center">
                                ${badgesHtml || '<p class="text-slate-400 text-xs">A√∫n no tienes logros</p>'}
                            </div>
                            ${(() => {
                                const availableFrames = Achievements.getAvailableFrames(user);
                                if (availableFrames.length === 0) return '';
                                
                                const currentFrame = user.selectedFrame || hasFrame || 'none';
                                
                                let selectorHtml = `
                                <div class="mt-4 p-3 bg-gradient-to-r from-slate-50 to-slate-100 border border-slate-200 rounded-xl">
                                    <div class="flex items-center gap-2 mb-3">
                                        <i data-lucide="palette" class="w-4 h-4 text-slate-600"></i>
                                        <span class="text-xs font-bold text-slate-700">Elegir Marco Especial</span>
                                    </div>
                                    <div class="grid gap-2">
                                        <button onclick="Achievements.selectFrame('none')" class="flex items-center gap-2 p-2 rounded-lg transition-all ${currentFrame === 'none' ? 'bg-white border-2 border-slate-400 shadow-sm' : 'bg-white/50 border border-slate-200 hover:bg-white'}">
                                            <div class="w-6 h-6 rounded-full bg-slate-200 flex items-center justify-center">
                                                <i data-lucide="x" class="w-3 h-3 text-slate-500"></i>
                                            </div>
                                            <span class="text-xs font-medium text-slate-600">Sin marco</span>
                                            ${currentFrame === 'none' ? '<i data-lucide="check" class="w-4 h-4 text-green-500 ml-auto"></i>' : ''}
                                        </button>`;
                                
                                availableFrames.forEach(frame => {
                                    const isSelected = currentFrame === frame.id;
                                    selectorHtml += `
                                        <button onclick="Achievements.selectFrame('${frame.id}')" class="flex items-center gap-2 p-2 rounded-lg transition-all ${isSelected ? 'bg-gradient-to-r ' + frame.color + ' text-white shadow-md' : 'bg-white/50 border border-slate-200 hover:bg-white'}">
                                            <div class="w-6 h-6 rounded-full ${isSelected ? 'bg-white/30' : 'bg-gradient-to-r ' + frame.color} flex items-center justify-center">
                                                <i data-lucide="${frame.icon}" class="w-3 h-3 ${isSelected ? 'text-white' : 'text-white'}"></i>
                                            </div>
                                            <div class="text-left flex-1">
                                                <span class="text-xs font-medium ${isSelected ? 'text-white' : 'text-slate-700'}">${frame.name}</span>
                                                <p class="text-[9px] ${isSelected ? 'text-white/80' : 'text-slate-400'}">${frame.achievement}</p>
                                            </div>
                                            ${isSelected ? '<i data-lucide="check" class="w-4 h-4 text-white ml-auto"></i>' : ''}
                                        </button>`;
                                });
                                
                                selectorHtml += `
                                    </div>
                                </div>`;
                                
                                return selectorHtml;
                            })()}
                            ${(() => {
                                // Toggle para overlay de fundador
                                const canUseFounder = Achievements.canUseFounderOverlay(user);
                                if (!canUseFounder) return '';
                                
                                const isEnabled = Achievements.hasFounderOverlay(user);
                                
                                return `
                                <div class="mt-4 p-3 bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200 rounded-xl">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <div class="w-8 h-8 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-lg flex items-center justify-center shadow-sm">
                                                <span class="text-sm">üëë</span>
                                            </div>
                                            <div>
                                                <span class="text-xs font-bold text-amber-800">Corona de Fundador</span>
                                                <p class="text-[10px] text-amber-600">Overlay dorado sobre tu marco</p>
                                            </div>
                                        </div>
                                        <button onclick="Achievements.toggleFounderOverlay(${!isEnabled})" class="relative w-12 h-6 rounded-full transition-all ${isEnabled ? 'bg-gradient-to-r from-amber-400 to-yellow-500' : 'bg-slate-300'}">
                                            <div class="absolute top-1 ${isEnabled ? 'right-1' : 'left-1'} w-4 h-4 bg-white rounded-full shadow transition-all flex items-center justify-center">
                                                ${isEnabled ? '<span class="text-[8px]">üëë</span>' : ''}
                                            </div>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Toggle para estilo de √°rea -->
                                ${(() => {
                                    const showAsArea = STATE.profile?.showAsAreaLeader === true;
                                    const areaColors = {
                                        'gestion': { name: 'Gesti√≥n', gradient: 'from-purple-500 to-purple-600' },
                                        'telecom': { name: 'Telecomunicaciones', gradient: 'from-blue-500 to-blue-600' },
                                        'software': { name: 'Software', gradient: 'from-green-500 to-green-600' },
                                        'electronica': { name: 'Electr√≥nica', gradient: 'from-orange-500 to-orange-600' },
                                        'mecanico': { name: 'Mec√°nico', gradient: 'from-red-500 to-red-600' }
                                    };
                                    const userArea = STATE.profile?.area || 'software';
                                    const areaInfo = areaColors[userArea] || areaColors['software'];
                                    
                                    return '<div class="mt-3 p-3 bg-gradient-to-r from-slate-50 to-slate-100 border border-slate-200 rounded-xl">' +
                                        '<div class="flex items-center justify-between">' +
                                            '<div class="flex items-center gap-2">' +
                                                '<div class="w-8 h-8 bg-gradient-to-br ' + areaInfo.gradient + ' rounded-lg flex items-center justify-center shadow-sm">' +
                                                    '<i data-lucide="star" class="w-4 h-4 text-white"></i>' +
                                                '</div>' +
                                                '<div>' +
                                                    '<span class="text-xs font-bold text-slate-800">Estilo de L√≠der de √Årea</span>' +
                                                    '<p class="text-[10px] text-slate-500">Mostrar con color de ' + areaInfo.name + '</p>' +
                                                '</div>' +
                                            '</div>' +
                                            '<button onclick="Achievements.toggleAreaStyle(' + (!showAsArea) + ')" class="relative w-12 h-6 rounded-full transition-all ' + (showAsArea ? 'bg-gradient-to-r ' + areaInfo.gradient : 'bg-slate-300') + '">' +
                                                '<div class="absolute top-1 ' + (showAsArea ? 'right-1' : 'left-1') + ' w-4 h-4 bg-white rounded-full shadow transition-all flex items-center justify-center">' +
                                                    (showAsArea ? '<i data-lucide="star" class="w-2 h-2 text-slate-600"></i>' : '') +
                                                '</div>' +
                                            '</button>' +
                                        '</div>' +
                                        '<p class="text-[9px] text-slate-400 mt-2 ml-10">Si activas esto, tu tarjeta mostrar√° el marco de l√≠der con el color de tu √°rea en lugar del dorado de fundador.</p>' +
                                    '</div>';
                                })()}
                                `;
                            })()}
                            <div class="flex gap-2 mt-4">
                                <button onclick="Achievements.showAllAchievements()" class="flex-1 py-2.5 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl text-xs font-bold transition flex items-center justify-center gap-2">
                                    <i data-lucide="trophy" class="w-4 h-4"></i>
                                    Ver Todos
                                </button>
                                ${isAdmin ? `
                                <button onclick="Achievements.openAdminPanel()" class="py-2.5 px-4 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-xl text-xs font-bold transition flex items-center justify-center gap-2" title="Panel de Administraci√≥n">
                                    <i data-lucide="shield-check" class="w-4 h-4"></i>
                                    Admin
                                </button>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            },
            
            // Mostrar modal con todos los logros disponibles
            showAllAchievements: () => {
                if (!STATE.currentUser) return;
                
                // Usar STATE.profile que contiene los datos de Firestore incluyendo achievements
                const userData = { ...STATE.profile, id: STATE.currentUser.uid };
                const html = Achievements.renderFullList(userData);
                const totalPoints = Achievements.getTotalPoints(userData);
                const achievementIds = Achievements.getUserAchievements(userData);
                const totalAchievements = Object.keys(Achievements.definitions).length;
                const hasFrame = Achievements.hasSpecialFrame(userData);
                
                // Determinar estilos seg√∫n el tipo de marco
                const isRainbow = hasFrame === 'rainbow';
                const isCosmic = hasFrame === 'cosmic';
                const isGlobal = hasFrame === 'global';
                const isFrutiger = hasFrame === 'frutiger';
                const isFounder = hasFrame === 'founder';
                const hasAnyFrame = isRainbow || isCosmic || isGlobal || isFrutiger || isFounder;
                
                const headerClass = isRainbow 
                    ? 'bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500 animate-gradient-x'
                    : isCosmic 
                        ? 'bg-gradient-to-r from-violet-600 via-purple-600 to-indigo-600'
                        : isGlobal
                            ? 'bg-gradient-to-r from-cyan-500 via-teal-500 to-cyan-400 animate-gradient-x'
                            : isFrutiger
                                ? 'bg-gradient-to-r from-cyan-400 via-sky-300 to-cyan-400 animate-gradient-x'
                                : isFounder
                                    ? 'bg-gradient-to-r from-amber-500 via-yellow-400 to-amber-500 animate-gradient-x'
                                    : 'bg-gradient-to-r from-tec-gold via-amber-500 to-yellow-500';
                
                const frameIcon = isRainbow ? 'sparkles' : isCosmic ? 'atom' : isGlobal ? 'globe' : isFrutiger ? 'monitor' : isFounder ? 'crown' : 'award';
                const frameLabel = isRainbow ? '¬°COMPLETISTA! Marco Arco√≠ris Activo' : isCosmic ? '¬°POL√çMATA! Marco C√≥smico Activo' : isGlobal ? '¬°CLASE MUNDIAL! Marco Global Activo' : isFrutiger ? 'Marco Aero Activo' : isFounder ? '¬°FUNDADOR! Marco Dorado Activo' : '';
                
                Swal.fire({
                    html: `
                        <div class="text-left -m-5">
                            <div class="${headerClass} p-6 text-white">
                                <div class="flex items-center gap-4">
                                    <div class="w-14 h-14 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center ${hasAnyFrame ? 'animate-pulse' : ''}">
                                        <i data-lucide="${frameIcon}" class="w-7 h-7"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-black">Sistema de Logros</h3>
                                        <p class="${hasAnyFrame ? 'text-white/80' : 'text-amber-100'} text-sm">${achievementIds.length}/${totalAchievements} logros desbloqueados</p>
                                    </div>
                                    <div class="ml-auto text-right">
                                        <p class="text-3xl font-black">${totalPoints}</p>
                                        <p class="text-xs ${hasAnyFrame ? 'text-white/80' : 'text-amber-100'}">puntos totales</p>
                                    </div>
                                </div>
                                ${hasAnyFrame ? `<p class="mt-3 text-xs text-white/90 flex items-center gap-1"><i data-lucide="${frameIcon}" class="w-3 h-3"></i> ${frameLabel}</p>` : ''}
                            </div>
                            <div class="p-5 max-h-[60vh] overflow-y-auto">
                                ${html}
                            </div>
                        </div>
                    `,
                    showConfirmButton: false,
                    showCloseButton: true,
                    width: 550,
                    padding: 0,
                    customClass: {
                        popup: 'rounded-2xl overflow-hidden'
                    },
                    didOpen: () => lucide.createIcons()
                });
            },
            
            // ==========================================
            // ADMIN: Gesti√≥n de logros (solo admin)
            // ==========================================
            
            // Verificar si es admin de logros
            isAchievementAdmin: () => {
                return STATE.currentUser?.email === Achievements.ADMIN_EMAIL;
            },
            
            // Abrir panel de administraci√≥n de logros
            openAdminPanel: async () => {
                if (!Achievements.isAchievementAdmin()) {
                    Util.notify('No tienes permisos para gestionar logros', 'error');
                    return;
                }
                
                // Cargar lista de usuarios
                const usersSnap = await db.collection('users').orderBy('fullName').get();
                const users = usersSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                let usersOptions = users.map(u => `<option value="${u.id}">${u.fullName || u.email || 'Sin nombre'}</option>`).join('');
                
                Swal.fire({
                    html: `
                        <div class="text-left -m-5">
                            <div class="bg-gradient-to-r from-purple-600 to-indigo-700 p-6 text-white">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center">
                                        <i data-lucide="shield-check" class="w-6 h-6"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-black">Panel de Logros</h3>
                                        <p class="text-purple-200 text-sm">Administrador de Logros</p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-5 space-y-4">
                                <!-- Leyenda de tipos de logros -->
                                <div class="bg-slate-100 p-3 rounded-xl text-xs">
                                    <p class="font-bold text-slate-700 mb-2">Tipos de logros:</p>
                                    <div class="flex flex-wrap gap-3">
                                        <span class="flex items-center gap-1">
                                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                            <span class="text-slate-600">Autom√°tico (el sistema lo detecta)</span>
                                        </span>
                                        <span class="flex items-center gap-1">
                                            <span class="w-2 h-2 bg-amber-500 rounded-full"></span>
                                            <span class="text-slate-600">Manual (solo t√∫ puedes asignar)</span>
                                        </span>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="text-sm font-bold text-slate-700 block mb-2">Seleccionar Miembro</label>
                                    <select id="admin-user-select" class="w-full p-3 border-2 border-slate-200 rounded-xl text-sm focus:border-purple-400 outline-none" onchange="Achievements.loadUserAchievementsAdmin()">
                                        <option value="">-- Selecciona un miembro --</option>
                                        ${usersOptions}
                                    </select>
                                </div>
                                
                                <div id="admin-achievements-list" class="hidden">
                                    <label class="text-sm font-bold text-slate-700 block mb-2">Logros del Miembro</label>
                                    <div id="admin-achievements-grid" class="grid grid-cols-2 gap-2 max-h-[300px] overflow-y-auto p-2 bg-slate-50 rounded-xl">
                                        <!-- Se carga din√°micamente -->
                                    </div>
                                </div>
                                
                                <div id="admin-actions" class="hidden flex gap-2">
                                    <button onclick="Achievements.saveUserAchievements()" class="flex-1 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-xl font-bold text-sm transition flex items-center justify-center gap-2">
                                        <i data-lucide="save" class="w-4 h-4"></i> Guardar Cambios
                                    </button>
                                </div>
                            </div>
                        </div>
                    `,
                    showConfirmButton: false,
                    showCloseButton: true,
                    width: 500,
                    padding: 0,
                    customClass: {
                        popup: 'rounded-2xl overflow-hidden'
                    },
                    didOpen: () => lucide.createIcons()
                });
            },
            
            // Cargar logros de un usuario para el panel admin
            loadUserAchievementsAdmin: async () => {
                const select = document.getElementById('admin-user-select');
                const userId = select.value;
                const listContainer = document.getElementById('admin-achievements-list');
                const actionsContainer = document.getElementById('admin-actions');
                const grid = document.getElementById('admin-achievements-grid');
                
                if (!userId) {
                    listContainer.classList.add('hidden');
                    actionsContainer.classList.add('hidden');
                    return;
                }
                
                // Obtener datos del usuario
                const userDoc = await db.collection('users').doc(userId).get();
                if (!userDoc.exists) return;
                
                const userData = { id: userId, ...userDoc.data() };
                // Usar getUserAchievements para incluir logros auto-detectados
                const currentAchievements = Achievements.getUserAchievements(userData);
                
                const rarityLabels = { mythic: 'M√≠tico', legendary: 'Legendario', epic: '√âpico', rare: 'Raro', common: 'Com√∫n' };
                const rarityOrder = { mythic: 0, legendary: 1, epic: 2, rare: 3, common: 4 };
                
                // Ordenar logros por rareza
                const sortedDefs = Object.values(Achievements.definitions).sort((a, b) => {
                    return rarityOrder[a.rarity] - rarityOrder[b.rarity];
                });
                
                let html = '';
                sortedDefs.forEach(def => {
                    if (def.id === 'completionist') return; // No se puede dar manualmente
                    
                    const hasAchievement = currentAchievements.includes(def.id);
                    const colors = Achievements.getRarityColors(def.rarity);
                    const isAuto = def.type === 'auto';
                    const typeIndicator = isAuto 
                        ? '<span class="w-1.5 h-1.5 bg-green-500 rounded-full flex-shrink-0" title="Autom√°tico"></span>' 
                        : '<span class="w-1.5 h-1.5 bg-amber-500 rounded-full flex-shrink-0" title="Manual"></span>';
                    
                    html += `
                        <label class="flex items-center gap-2 p-2 rounded-lg border-2 cursor-pointer transition ${hasAchievement ? colors.border + ' bg-white' : 'border-transparent bg-slate-100 hover:bg-slate-200'}">
                            <input type="checkbox" class="admin-achievement-check w-4 h-4 accent-purple-600" data-id="${def.id}" ${hasAchievement ? 'checked' : ''}>
                            <div class="w-7 h-7 ${colors.bg} rounded-lg flex items-center justify-center flex-shrink-0">
                                <i data-lucide="${def.icon}" class="w-3.5 h-3.5 ${colors.text}"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-1">
                                    ${typeIndicator}
                                    <p class="text-xs font-bold text-slate-700 truncate">${def.name}</p>
                                </div>
                                <p class="text-[9px] text-slate-400">${rarityLabels[def.rarity]} ‚Ä¢ ${def.points}pts</p>
                            </div>
                        </label>
                    `;
                });
                
                grid.innerHTML = html;
                grid.dataset.userId = userId;
                listContainer.classList.remove('hidden');
                actionsContainer.classList.remove('hidden');
                lucide.createIcons();
            },
            
            // Guardar logros del usuario (admin)
            saveUserAchievements: async () => {
                if (!Achievements.isAchievementAdmin()) return;
                
                const grid = document.getElementById('admin-achievements-grid');
                const userId = grid?.dataset?.userId;
                if (!userId) {
                    Util.notify('No se ha seleccionado ning√∫n usuario', 'error');
                    return;
                }
                
                const checkboxes = document.querySelectorAll('.admin-achievement-check');
                const selectedAchievements = [];
                
                checkboxes.forEach(cb => {
                    if (cb.checked) {
                        selectedAchievements.push(cb.dataset.id);
                    }
                });
                
                try {
                    Util.loading(true, 'Guardando logros...');
                    
                    // Obtener logros anteriores para detectar nuevos
                    const userDoc = await db.collection('users').doc(userId).get();
                    const previousAchievements = userDoc.exists ? (userDoc.data()?.achievements || []) : [];
                    
                    // Guardar en Firebase usando set con merge para evitar errores
                    await db.collection('users').doc(userId).set({
                        achievements: selectedAchievements
                    }, { merge: true });
                    
                    Util.loading(false);
                    
                    // Detectar nuevos logros para notificar
                    const newAchievements = selectedAchievements.filter(a => !previousAchievements.includes(a));
                    
                    // Si el usuario afectado es el usuario actual, notificar
                    if (userId === STATE.currentUser?.uid && newAchievements.length > 0) {
                        newAchievements.forEach(achievementId => {
                            const def = Achievements.definitions[achievementId];
                            if (def) {
                                setTimeout(() => Achievements.showUnlockNotification(def), 500);
                            }
                        });
                    }
                    
                    Util.notify('Logros actualizados correctamente', 'success');
                    Swal.close();
                    
                    // Recargar datos si es necesario
                    if (userId === STATE.currentUser?.uid) {
                        Database.loadAchievementsPanel();
                    }
                    Database.loadPublicMembers(); // Actualizar miembros p√∫blicos tambi√©n
                    
                } catch (err) {
                    Util.loading(false);
                    console.error('Error guardando logros:', err);
                    Util.notify('Error al guardar logros: ' + (err.message || err.code || 'Error desconocido'), 'error');
                }
            }
        };

        /**
         * ==========================================
         * SISTEMA DE REPORTES PDF
         * ==========================================
         */
        const ClubReport = {
            // Verificar si el usuario puede generar reportes
            canGenerateReport: () => {
                if (!STATE.currentUser || !STATE.profile) return false;
                
                const title = (STATE.profile.customTitle || '').toLowerCase();
                const isLeader = title.includes('l√≠der') || title.includes('lider');
                const isFounder = title.includes('fundador') || title.includes('cofundador');
                const isMentor = title.includes('maestro') || title.includes('tutor') || title.includes('asesor') || title.includes('profesor');
                const isAdmin = STATE.profile.role === 'admin';
                
                return isLeader || isFounder || isMentor || isAdmin;
            },
            
            // Inicializar bot√≥n de reporte
            init: () => {
                const btn = document.getElementById('btn-generate-report');
                if (btn && ClubReport.canGenerateReport()) {
                    btn.classList.remove('hidden');
                    btn.classList.add('flex');
                }
            },
            
            // Generar el reporte PDF
            generate: async () => {
                if (!ClubReport.canGenerateReport()) {
                    Util.notify('No tienes permisos para generar reportes', 'error');
                    return;
                }
                
                try {
                    Util.loading(true, 'Generando reporte del club...');
                    
                    // Recopilar toda la informaci√≥n
                    const data = await ClubReport.collectData();
                    
                    // Crear el PDF
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('p', 'mm', 'letter');
                    
                    const pageWidth = doc.internal.pageSize.getWidth();
                    const pageHeight = doc.internal.pageSize.getHeight();
                    const margin = 15;
                    let yPos = margin;
                    
                    // Colores institucionales
                    const tecBlue = [27, 57, 106];
                    const tecGold = [212, 175, 55];
                    const textDark = [30, 41, 59];
                    const textLight = [100, 116, 139];
                    
                    // ========== ENCABEZADO ==========
                    doc.setFillColor(...tecBlue);
                    doc.rect(0, 0, pageWidth, 45, 'F');
                    
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(22);
                    doc.setFont('helvetica', 'bold');
                    doc.text('CRAI - Club de Rob√≥tica Avanzada e Ingenier√≠a', pageWidth / 2, 18, { align: 'center' });
                    
                    doc.setFontSize(12);
                    doc.setFont('helvetica', 'normal');
                    doc.text('Instituto Tecnol√≥gico de Mexicali', pageWidth / 2, 27, { align: 'center' });
                    
                    doc.setFontSize(10);
                    doc.setTextColor(...tecGold);
                    doc.text('REPORTE EJECUTIVO DEL CLUB', pageWidth / 2, 38, { align: 'center' });
                    
                    yPos = 55;
                    
                    // ========== INFO DEL REPORTE ==========
                    doc.setTextColor(...textLight);
                    doc.setFontSize(9);
                    const fecha = new Date().toLocaleDateString('es-MX', { 
                        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
                    });
                    doc.text(`Generado el ${fecha}`, margin, yPos);
                    doc.text(`Por: ${STATE.profile.fullName || STATE.currentUser.displayName}`, pageWidth - margin, yPos, { align: 'right' });
                    
                    yPos += 10;
                    
                    // ========== ESTAD√çSTICAS GENERALES ==========
                    ClubReport.addSectionTitle(doc, 'Estad√≠sticas Generales', yPos, margin, tecBlue);
                    yPos += 10;
                    
                    const statsData = [
                        ['Total de Miembros', data.stats.totalMembers.toString()],
                        ['Proyectos Registrados', data.stats.totalProjects.toString()],
                        ['Art√≠culos en Wiki', data.stats.totalWiki.toString()],
                        ['Competencias Activas', data.stats.activeCompetitions.toString()],
                        ['Equipos en Inventario', data.stats.inventoryItems.toString()]
                    ];
                    
                    doc.autoTable({
                        startY: yPos,
                        head: [['M√©trica', 'Valor']],
                        body: statsData,
                        margin: { left: margin, right: margin },
                        headStyles: { fillColor: tecBlue, textColor: [255, 255, 255], fontStyle: 'bold' },
                        alternateRowStyles: { fillColor: [248, 250, 252] },
                        styles: { fontSize: 10, cellPadding: 4 }
                    });
                    
                    yPos = doc.lastAutoTable.finalY + 12;
                    
                    // ========== MIEMBROS POR √ÅREA ==========
                    if (data.membersByArea.length > 0) {
                        ClubReport.addSectionTitle(doc, 'Distribuci√≥n de Miembros por √Årea', yPos, margin, tecBlue);
                        yPos += 10;
                        
                        doc.autoTable({
                            startY: yPos,
                            head: [['√Årea', 'Miembros']],
                            body: data.membersByArea,
                            margin: { left: margin, right: margin },
                            headStyles: { fillColor: tecBlue, textColor: [255, 255, 255], fontStyle: 'bold' },
                            alternateRowStyles: { fillColor: [248, 250, 252] },
                            styles: { fontSize: 10, cellPadding: 4 }
                        });
                        
                        yPos = doc.lastAutoTable.finalY + 12;
                    }
                    
                    // ========== COMPETENCIAS ACTIVAS ==========
                    if (data.competitions.length > 0) {
                        // Verificar si necesitamos nueva p√°gina
                        if (yPos > pageHeight - 60) {
                            doc.addPage();
                            yPos = margin;
                        }
                        
                        ClubReport.addSectionTitle(doc, 'Competencias y Torneos', yPos, margin, tecBlue);
                        yPos += 10;
                        
                        const compData = data.competitions.map(c => [
                            c.name,
                            c.location || 'Por definir',
                            c.dateStart ? new Date(c.dateStart).toLocaleDateString('es-MX') : 'Sin fecha',
                            c.status || 'Activa'
                        ]);
                        
                        doc.autoTable({
                            startY: yPos,
                            head: [['Nombre', 'Ubicaci√≥n', 'Fecha', 'Estado']],
                            body: compData,
                            margin: { left: margin, right: margin },
                            headStyles: { fillColor: tecBlue, textColor: [255, 255, 255], fontStyle: 'bold' },
                            alternateRowStyles: { fillColor: [248, 250, 252] },
                            styles: { fontSize: 9, cellPadding: 3 },
                            columnStyles: { 0: { cellWidth: 60 }, 1: { cellWidth: 40 } }
                        });
                        
                        yPos = doc.lastAutoTable.finalY + 12;
                    }
                    
                    // ========== PROYECTOS RECIENTES ==========
                    if (data.recentProjects.length > 0) {
                        if (yPos > pageHeight - 60) {
                            doc.addPage();
                            yPos = margin;
                        }
                        
                        ClubReport.addSectionTitle(doc, 'Proyectos Recientes', yPos, margin, tecBlue);
                        yPos += 10;
                        
                        const projData = data.recentProjects.map(p => [
                            p.title || 'Sin t√≠tulo',
                            p.authorName || 'An√≥nimo',
                            p.category || 'General',
                            p.status === 'completed' ? 'Completado' : p.status === 'in_progress' ? 'En progreso' : 'Planeaci√≥n'
                        ]);
                        
                        doc.autoTable({
                            startY: yPos,
                            head: [['Proyecto', 'Autor', 'Categor√≠a', 'Estado']],
                            body: projData,
                            margin: { left: margin, right: margin },
                            headStyles: { fillColor: tecBlue, textColor: [255, 255, 255], fontStyle: 'bold' },
                            alternateRowStyles: { fillColor: [248, 250, 252] },
                            styles: { fontSize: 9, cellPadding: 3 },
                            columnStyles: { 0: { cellWidth: 55 } }
                        });
                        
                        yPos = doc.lastAutoTable.finalY + 12;
                    }
                    
                    // ========== MIEMBROS DEL CLUB ==========
                    if (data.members.length > 0) {
                        if (yPos > pageHeight - 60) {
                            doc.addPage();
                            yPos = margin;
                        }
                        
                        ClubReport.addSectionTitle(doc, 'Directorio de Miembros', yPos, margin, tecBlue);
                        yPos += 10;
                        
                        const membersData = data.members.slice(0, 25).map(m => [
                            m.fullName || 'Sin nombre',
                            m.customTitle || m.areaName || 'Miembro',
                            m.career || '-',
                            m.semester ? `${m.semester}¬∞ sem` : '-'
                        ]);
                        
                        doc.autoTable({
                            startY: yPos,
                            head: [['Nombre', 'Rol/√Årea', 'Carrera', 'Semestre']],
                            body: membersData,
                            margin: { left: margin, right: margin },
                            headStyles: { fillColor: tecBlue, textColor: [255, 255, 255], fontStyle: 'bold' },
                            alternateRowStyles: { fillColor: [248, 250, 252] },
                            styles: { fontSize: 8, cellPadding: 2.5 },
                            columnStyles: { 0: { cellWidth: 50 }, 1: { cellWidth: 45 } }
                        });
                        
                        yPos = doc.lastAutoTable.finalY + 12;
                    }
                    
                    // ========== TOP LOGROS ==========
                    if (data.topAchievers.length > 0) {
                        if (yPos > pageHeight - 60) {
                            doc.addPage();
                            yPos = margin;
                        }
                        
                        ClubReport.addSectionTitle(doc, 'Top Miembros por Logros', yPos, margin, tecBlue);
                        yPos += 10;
                        
                        const achieversData = data.topAchievers.map((m, i) => [
                            `#${i + 1}`,
                            m.name,
                            m.achievementCount.toString(),
                            m.points.toString()
                        ]);
                        
                        doc.autoTable({
                            startY: yPos,
                            head: [['Pos', 'Miembro', 'Logros', 'Puntos']],
                            body: achieversData,
                            margin: { left: margin, right: margin },
                            headStyles: { fillColor: tecGold, textColor: [30, 30, 30], fontStyle: 'bold' },
                            alternateRowStyles: { fillColor: [255, 251, 235] },
                            styles: { fontSize: 9, cellPadding: 3 },
                            columnStyles: { 0: { cellWidth: 15 }, 2: { cellWidth: 20 }, 3: { cellWidth: 20 } }
                        });
                        
                        yPos = doc.lastAutoTable.finalY + 12;
                    }
                    
                    // ========== PIE DE P√ÅGINA ==========
                    const totalPages = doc.internal.getNumberOfPages();
                    for (let i = 1; i <= totalPages; i++) {
                        doc.setPage(i);
                        doc.setFillColor(...tecBlue);
                        doc.rect(0, pageHeight - 12, pageWidth, 12, 'F');
                        doc.setTextColor(255, 255, 255);
                        doc.setFontSize(8);
                        doc.text(`CRAI - Instituto Tecnol√≥gico de Mexicali | P√°gina ${i} de ${totalPages}`, pageWidth / 2, pageHeight - 5, { align: 'center' });
                    }
                    
                    Util.loading(false);
                    
                    // Descargar el PDF
                    const fileName = `CRAI_Reporte_${new Date().toISOString().split('T')[0]}.pdf`;
                    doc.save(fileName);
                    
                    Util.notify('Reporte generado exitosamente', 'success');
                    
                } catch (err) {
                    Util.loading(false);
                    console.error('Error generando reporte:', err);
                    Util.notify('Error al generar el reporte: ' + err.message, 'error');
                }
            },
            
            // Agregar t√≠tulo de secci√≥n
            addSectionTitle: (doc, title, yPos, margin, color) => {
                doc.setFillColor(...color);
                doc.rect(margin, yPos - 5, 3, 8, 'F');
                doc.setTextColor(...color);
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text(title, margin + 6, yPos);
            },
            
            // Recopilar todos los datos del club
            collectData: async () => {
                const data = {
                    stats: {
                        totalMembers: 0,
                        totalProjects: 0,
                        totalWiki: 0,
                        activeCompetitions: 0,
                        inventoryItems: 0
                    },
                    members: [],
                    membersByArea: [],
                    recentProjects: [],
                    competitions: [],
                    topAchievers: []
                };
                
                try {
                    // Obtener miembros
                    const membersSnap = await db.collection('users').orderBy('fullName').get();
                    data.members = membersSnap.docs.map(d => ({ id: d.id, ...d.data() }));
                    data.stats.totalMembers = data.members.length;
                    
                    // Contar por √°rea
                    const areaCount = {};
                    const areaNames = {
                        'gestion': 'Gesti√≥n y Vinculaci√≥n',
                        'telecom': 'Telecomunicaciones y Redes',
                        'software': 'Software, Autonom√≠a e IA',
                        'electronica': 'Electr√≥nica y Control',
                        'mecanico': 'Dise√±o Mec√°nico y Manufactura'
                    };
                    data.members.forEach(m => {
                        const area = m.area || 'Sin asignar';
                        areaCount[area] = (areaCount[area] || 0) + 1;
                    });
                    data.membersByArea = Object.entries(areaCount).map(([k, v]) => [areaNames[k] || k, v.toString()]);
                    
                    // Top miembros por logros
                    const achieversRaw = data.members
                        .map(m => {
                            const achievements = Achievements.getUserAchievements(m);
                            const points = Achievements.getTotalPoints(m);
                            return { 
                                name: m.fullName || 'Sin nombre', 
                                achievementCount: achievements.length,
                                points: points
                            };
                        })
                        .filter(m => m.achievementCount > 0)
                        .sort((a, b) => b.points - a.points)
                        .slice(0, 10);
                    data.topAchievers = achieversRaw;
                    
                    // Obtener proyectos
                    const projectsSnap = await db.collection('projects').orderBy('createdAt', 'desc').limit(15).get();
                    data.recentProjects = projectsSnap.docs.map(d => d.data());
                    data.stats.totalProjects = projectsSnap.size;
                    
                    // Contar total real de proyectos
                    const allProjectsSnap = await db.collection('projects').get();
                    data.stats.totalProjects = allProjectsSnap.size;
                    
                    // Obtener competencias
                    const compSnap = await db.collection('competitions').orderBy('dateStart', 'asc').get();
                    data.competitions = compSnap.docs.map(d => d.data()).filter(c => {
                        if (!c.dateEnd) return true;
                        return new Date(c.dateEnd) >= new Date();
                    });
                    data.stats.activeCompetitions = data.competitions.length;
                    
                    // Obtener wiki
                    const wikiSnap = await db.collection('wiki').get();
                    data.stats.totalWiki = wikiSnap.size;
                    
                    // Obtener inventario
                    const invSnap = await db.collection('inventory').get();
                    data.stats.inventoryItems = invSnap.size;
                    
                } catch (err) {
                    console.error('Error recopilando datos:', err);
                }
                
                return data;
            }
        };

        /**
         * ==========================================
         * MEMBERS (Vista de Miembros)
         * ==========================================
         */
        const Members = {
            currentFilter: 'all',
            allMembers: [],

            load: async () => {
                const grid = document.getElementById('members-grid');
                if (!grid) return;
                
                grid.innerHTML = '<div class="col-span-full text-center py-12"><div class="animate-spin w-8 h-8 border-4 border-tec-blue border-t-transparent rounded-full mx-auto mb-4"></div><p class="text-slate-400">Cargando equipo...</p></div>';

                try {
                    const snap = await db.collection('users').orderBy('joinedAt', 'desc').limit(50).get();
                    Members.allMembers = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    
                    // Actualizar contadores
                    const count = Members.allMembers.length;
                    const countHero = document.getElementById('members-count-hero');
                    const countCta = document.getElementById('members-count-cta');
                    const countStat = document.getElementById('members-count-stat');
                    if (countHero) countHero.innerText = count;
                    if (countCta) countCta.innerText = count;
                    if (countStat) countStat.innerText = count;
                    
                    Members.render();
                } catch (err) {
                    console.error('Error cargando miembros:', err);
                    grid.innerHTML = '<div class="col-span-full text-center py-12"><i data-lucide="alert-circle" class="w-12 h-12 text-red-300 mx-auto mb-4"></i><p class="text-slate-400">Error al cargar el equipo</p></div>';
                    lucide.createIcons();
                }
            },

            render: () => {
                const grid = document.getElementById('members-grid');
                if (!grid) return;

                // Detectar fundadores principales (solo aparecen en "Todos")
                const isMainFounder = (u) => {
                    const title = (u.customTitle || '').toLowerCase();
                    return (title.includes('fundador') && title.includes('l√≠der')) || 
                           (title.includes('fundador') && title.includes('lider')) ||
                           title.includes('cofundador') || title.includes('cofundadora');
                };

                // Detectar l√≠deres de √°rea (aparecen anclados arriba en su √°rea)
                const isAreaLeader = (u) => {
                    const title = (u.customTitle || '').toLowerCase();
                    // Es l√≠der pero NO es fundador principal
                    return (title.includes('l√≠der') || title.includes('lider')) && !isMainFounder(u);
                };

                // Detectar maestros/tutores (solo aparecen en "Todos")
                const isMentor = (u) => {
                    const title = (u.customTitle || '').toLowerCase();
                    const role = (u.role || '').toLowerCase();
                    return title.includes('maestro') || title.includes('maestra') || 
                           title.includes('tutor') || title.includes('tutora') ||
                           title.includes('profesor') || title.includes('profesora') ||
                           title.includes('asesor') || title.includes('asesora') ||
                           role.includes('maestro') || role.includes('tutor');
                };

                // Detectar si merece dise√±o especial (corona)
                const isSpecialMember = (u) => isMainFounder(u) || isAreaLeader(u) || isMentor(u);

                let filtered = [];

                if (Members.currentFilter === 'all') {
                    // En "Todos": Fundadores primero, luego maestros/tutores, luego l√≠deres de √°rea, luego el resto
                    const mainFounders = Members.allMembers.filter(m => isMainFounder(m));
                    const mentors = Members.allMembers.filter(m => isMentor(m));
                    const areaLeaders = Members.allMembers.filter(m => isAreaLeader(m) && !isMentor(m));
                    const regularMembers = Members.allMembers.filter(m => !isMainFounder(m) && !isAreaLeader(m) && !isMentor(m));
                    filtered = [...mainFounders, ...mentors, ...areaLeaders, ...regularMembers];
                } else {
                    // En √°reas espec√≠ficas: Fundadores del √°rea primero, luego l√≠deres, luego miembros regulares
                    // Fundadores que pertenecen a esta √°rea aparecen primero
                    const areaFounders = Members.allMembers.filter(m => isMainFounder(m) && m.area === Members.currentFilter);
                    const areaLeaders = Members.allMembers.filter(m => isAreaLeader(m) && !isMentor(m) && !isMainFounder(m) && m.area === Members.currentFilter);
                    const areaMembers = Members.allMembers.filter(m => !isAreaLeader(m) && !isMainFounder(m) && !isMentor(m) && m.area === Members.currentFilter);
                    filtered = [...areaFounders, ...areaLeaders, ...areaMembers];
                }

                if (filtered.length === 0) {
                    grid.innerHTML = '<div class="col-span-full text-center py-12"><i data-lucide="users" class="w-16 h-16 text-slate-300 mx-auto mb-4"></i><p class="text-slate-400">No hay miembros en esta √°rea</p></div>';
                    lucide.createIcons();
                    return;
                }

                const areaColors = {
                    'gestion': { bg: 'bg-purple-100', text: 'text-purple-700', icon: 'briefcase', gradient: 'from-purple-500 to-purple-600', border: 'border-purple-400', borderHover: 'hover:border-purple-500', ring: 'ring-purple-400/20', shadow: 'shadow-purple-500/30' },
                    'telecom': { bg: 'bg-blue-100', text: 'text-blue-700', icon: 'wifi', gradient: 'from-blue-500 to-blue-600', border: 'border-blue-400', borderHover: 'hover:border-blue-500', ring: 'ring-blue-400/20', shadow: 'shadow-blue-500/30' },
                    'software': { bg: 'bg-green-100', text: 'text-green-700', icon: 'brain', gradient: 'from-green-500 to-green-600', border: 'border-green-400', borderHover: 'hover:border-green-500', ring: 'ring-green-400/20', shadow: 'shadow-green-500/30' },
                    'electronica': { bg: 'bg-orange-100', text: 'text-orange-700', icon: 'cpu', gradient: 'from-orange-500 to-orange-600', border: 'border-orange-400', borderHover: 'hover:border-orange-500', ring: 'ring-orange-400/20', shadow: 'shadow-orange-500/30' },
                    'mecanico': { bg: 'bg-red-100', text: 'text-red-700', icon: 'cog', gradient: 'from-red-500 to-red-600', border: 'border-red-400', borderHover: 'hover:border-red-500', ring: 'ring-red-400/20', shadow: 'shadow-red-500/30' }
                };

                let html = '';
                let delay = 0;
                
                filtered.forEach(u => {
                    const name = u.fullName || 'Miembro CRAI';
                    const photo = u.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=1B396A&color=D4AF37&bold=true&size=200`;
                    const areaStyle = areaColors[u.area] || { bg: 'bg-slate-100', text: 'text-slate-600', icon: 'user', gradient: 'from-slate-500 to-slate-600' };
                    const displayRole = u.customTitle || u.areaName || u.role || 'Miembro';
                    const roleColor = u.customTitle ? 'bg-gradient-to-r from-tec-gold to-yellow-500 text-white' : `${areaStyle.bg} ${areaStyle.text}`;
                    const skills = u.skills || [];
                    const rawMainFounder = isMainFounder(u);
                    const prefersAreaStyle = Achievements.prefersAreaStyle(u); // Si fundador prefiere mostrarse como l√≠der de √°rea
                    const mainFounder = rawMainFounder && !prefersAreaStyle; // Solo es "mainFounder" si NO prefiere estilo de √°rea
                    const areaLeader = isAreaLeader(u) || (rawMainFounder && prefersAreaStyle); // Si es l√≠der O es fundador que prefiere estilo de √°rea
                    const mentor = isMentor(u);
                    const specialFrame = Achievements.hasSpecialFrame(u); // 'rainbow', 'cosmic', 'global', 'frutiger' o false
                    const hasFounderOverlay = Achievements.hasFounderOverlay(u); // true si tiene logro de fundador
                    
                    // Funci√≥n helper para agregar overlay de fundador
                    const founderOverlayHtml = hasFounderOverlay ? `
                        <!-- Overlay de Fundador -->
                        <div class="founder-crown"><i data-lucide="crown" class="w-6 h-6 text-amber-400"></i></div>
                        <div class="founder-sparkles"></div>
                        <div class="founder-aura"></div>
                        <div class="light-rays"></div>
                    ` : '';
                    const founderOverlayClass = hasFounderOverlay ? 'founder-overlay' : '';
                    
                    // Dise√±o especial para usuarios con MARCOS M√çTICOS - tiene prioridad
                    if (specialFrame === 'rainbow') {
                        // COMPLETISTA - Marco arco√≠ris ULTRA LEGENDARIO
                        html += `
                        <div class="member-card completionist-card group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 hover:-translate-y-3 overflow-hidden mythic-frame ${founderOverlayClass} cursor-pointer" data-area="${u.area || 'completionist'}" data-uid="${u.id}" onclick="Members.showDetail('${u.id}')" style="animation: fadeUp 0.5s ease-out ${delay}ms both;">
                            ${founderOverlayHtml}
                            <!-- Aura arco√≠ris externa -->
                            <div class="absolute inset-0 pointer-events-none overflow-hidden rounded-2xl">
                                <div class="absolute -inset-8 bg-gradient-conic from-red-500 via-yellow-500 via-green-500 via-blue-500 via-purple-500 to-red-500 blur-2xl opacity-30 animate-spin-slow" style="animation-duration: 12s;"></div>
                            </div>
                            <!-- Header con gradiente arco√≠ris √âPICO -->
                            <div class="h-28 relative overflow-hidden" style="background: linear-gradient(135deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3); background-size: 400% 400%; animation: rainbowBorder 4s linear infinite;">
                                <div class="absolute inset-0 bg-black/10"></div>
                                <!-- Part√≠culas brillantes flotantes -->
                                <div class="absolute inset-0 overflow-hidden">
                                    <div class="absolute top-2 left-[10%] w-2 h-2 bg-yellow-300 rounded-full animate-ping" style="animation-duration: 1.5s;"></div>
                                    <div class="absolute top-4 left-[30%] w-1.5 h-1.5 bg-pink-300 rounded-full animate-bounce" style="animation-duration: 2s;"></div>
                                    <div class="absolute top-3 left-[50%] w-2 h-2 bg-cyan-300 rounded-full animate-ping" style="animation-duration: 2.5s;"></div>
                                    <div class="absolute top-5 left-[70%] w-1.5 h-1.5 bg-green-300 rounded-full animate-bounce" style="animation-duration: 1.8s;"></div>
                                    <div class="absolute top-2 left-[85%] w-2 h-2 bg-purple-300 rounded-full animate-ping" style="animation-duration: 2.2s;"></div>
                                    <div class="absolute bottom-3 left-[20%] w-1 h-1 bg-white rounded-full animate-pulse"></div>
                                    <div class="absolute bottom-4 left-[60%] w-1.5 h-1.5 bg-orange-300 rounded-full animate-bounce" style="animation-duration: 2.3s;"></div>
                                    <div class="absolute bottom-2 left-[80%] w-1 h-1 bg-red-300 rounded-full animate-ping" style="animation-duration: 1.7s;"></div>
                                    <!-- Shooting stars -->
                                    <div class="absolute top-6 left-0 w-12 h-0.5 bg-gradient-to-r from-transparent via-white to-transparent" style="animation: shootingStar 3s linear infinite;"></div>
                                    <div class="absolute top-10 left-[40%] w-8 h-0.5 bg-gradient-to-r from-transparent via-yellow-200 to-transparent" style="animation: shootingStar 4s linear infinite; animation-delay: 1.5s;"></div>
                                </div>
                                <!-- Corona dorada animada -->
                                <div class="absolute top-3 left-4 animate-bounce" style="animation-duration: 2s;">
                                    <span class="text-2xl drop-shadow-lg" style="filter: drop-shadow(0 0 10px gold);">üëë</span>
                                </div>
                                <!-- Estrellas giratorias -->
                                <div class="absolute top-2 right-12 animate-spin-slow" style="animation-duration: 4s;">
                                    <span class="text-xl">‚≠ê</span>
                                </div>
                                <div class="absolute bottom-2 left-8 animate-spin-slow" style="animation-duration: 6s; animation-direction: reverse;">
                                    <span class="text-lg">‚ú®</span>
                                </div>
                                <!-- Badge de completista PREMIUM -->
                                <div class="absolute top-2 right-2 bg-white/95 backdrop-blur-sm rounded-full px-3 py-1.5 flex items-center gap-1.5 shadow-lg" style="box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);">
                                    <span class="text-lg animate-pulse">üèÜ</span>
                                    <span class="text-[9px] font-black bg-gradient-to-r from-red-500 via-yellow-500 via-green-500 via-blue-500 to-purple-500 bg-clip-text text-transparent uppercase bg-size-200 animate-gradient-x" style="background-size: 200%;">Completista</span>
                                </div>
                            </div>
                            
                            <!-- Avatar con aura arco√≠ris -->
                            <div class="relative -mt-16 flex justify-center">
                                <div class="relative">
                                    <!-- Anillo orbital arco√≠ris -->
                                    <div class="absolute -inset-5 rounded-full animate-spin-slow" style="animation-duration: 8s; border: 2px dashed transparent; background: linear-gradient(white, white) padding-box, linear-gradient(135deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #9400d3) border-box; background-size: 400% 400%; animation: rainbowBorder 2s linear infinite, spin 8s linear infinite;"></div>
                                    <div class="absolute -inset-7 rounded-full animate-spin-slow" style="animation-duration: 12s; animation-direction: reverse; border: 1px dashed rgba(255,255,255,0.5);"></div>
                                    <!-- Aura brillante -->
                                    <div class="absolute -inset-3 rounded-2xl blur-md opacity-70" style="background: linear-gradient(135deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #9400d3); background-size: 400% 400%; animation: rainbowBorder 3s linear infinite;"></div>
                                    <img src="${photo}" class="relative w-32 h-32 rounded-2xl object-cover border-4 border-white shadow-2xl group-hover:scale-105 transition-transform duration-300" style="box-shadow: 0 0 30px rgba(236, 72, 153, 0.6), 0 0 50px rgba(139, 92, 246, 0.4), 0 0 70px rgba(6, 182, 212, 0.3);" alt="${name}">
                                    <!-- Badge de trofeo giratorio -->
                                    <div class="absolute -bottom-3 -right-3 w-12 h-12 rounded-xl flex items-center justify-center shadow-xl border-2 border-white" style="background: linear-gradient(135deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #9400d3); background-size: 400% 400%; animation: rainbowBorder 2s linear infinite;">
                                        <span class="text-2xl animate-bounce" style="animation-duration: 1.5s;">üèÜ</span>
                                    </div>
                                    <!-- Estrellas orbitando -->
                                    <div class="absolute inset-0 animate-spin-slow" style="animation-duration: 6s;">
                                        <div class="absolute -top-2 left-1/2 transform -translate-x-1/2">
                                            <span class="text-sm drop-shadow-lg">‚≠ê</span>
                                        </div>
                                    </div>
                                    <div class="absolute inset-0 animate-spin-slow" style="animation-duration: 8s; animation-direction: reverse;">
                                        <div class="absolute top-1/2 -right-2 transform -translate-y-1/2">
                                            <span class="text-xs drop-shadow-lg">‚ú®</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Info -->
                            <div class="p-5 text-center">
                                <h4 class="font-bold text-xl group-hover:bg-gradient-to-r group-hover:from-pink-500 group-hover:via-purple-500 group-hover:to-cyan-500 group-hover:bg-clip-text group-hover:text-transparent transition-all">${name}</h4>
                                <span class="inline-block text-[10px] text-white px-4 py-1.5 rounded-full font-bold uppercase tracking-wide mt-2 shadow-lg relative overflow-hidden" style="background: linear-gradient(135deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #9400d3); background-size: 400% 400%; animation: rainbowBorder 3s linear infinite;">
                                    <span class="relative z-10">üèÜ ${displayRole}</span>
                                </span>
                                
                                ${u.career ? `<p class="text-xs text-slate-500 mt-2">${u.career}${u.semester ? ` ‚Ä¢ ${u.semester}¬∞ Sem` : ''}</p>` : ''}
                                
                                ${u.bio ? `<p class="text-xs text-slate-400 mt-3 line-clamp-2 leading-relaxed">${u.bio}</p>` : ''}
                                
                                ${skills.length > 0 ? `
                                <div class="flex flex-wrap justify-center gap-1.5 mt-4">
                                    ${skills.slice(0, 3).map((s, i) => {
                                        const colors = ['bg-red-100 text-red-600 border-red-200', 'bg-green-100 text-green-600 border-green-200', 'bg-blue-100 text-blue-600 border-blue-200'];
                                        return `<span class="text-[9px] ${colors[i % 3]} px-2 py-1 rounded-full font-medium border">${s}</span>`;
                                    }).join('')}
                                    ${skills.length > 3 ? `<span class="text-[9px] text-slate-400 px-1">+${skills.length - 3}</span>` : ''}
                                </div>` : ''}
                                
                                <!-- Indicador de clic para ver m√°s -->
                                <p class="text-[10px] text-purple-500/70 mt-3 flex items-center justify-center gap-1"><i data-lucide="mouse-pointer-click" class="w-3 h-3"></i> Click para ver perfil</p>
                            </div>
                            
                            <!-- Footer con redes - arco√≠ris -->
                            ${(u.github || u.linkedin) ? `
                            <div class="px-5 py-3 border-t flex justify-center gap-4 relative overflow-hidden" style="background: linear-gradient(90deg, rgba(255,0,0,0.05), rgba(255,127,0,0.05), rgba(255,255,0,0.05), rgba(0,255,0,0.05), rgba(0,0,255,0.05), rgba(148,0,211,0.05)); border-image: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #9400d3) 1;" onclick="event.stopPropagation()">
                                ${u.github ? `<a href="https://github.com/${u.github}" target="_blank" class="text-slate-400 hover:text-purple-600 transition"><i data-lucide="github" class="w-5 h-5"></i></a>` : ''}
                                ${u.linkedin ? `<a href="${u.linkedin.startsWith('http') ? u.linkedin : 'https://linkedin.com/in/' + u.linkedin}" target="_blank" class="text-slate-400 hover:text-pink-600 transition"><i data-lucide="linkedin" class="w-5 h-5"></i></a>` : ''}
                            </div>` : ''}
                        </div>`;
                    } else if (specialFrame === 'cosmic') {
                        // POL√çMATA - Marco c√≥smico p√∫rpura ULTRA ANIMADO
                        html += `
                        <div class="member-card polymath-card group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 hover:-translate-y-3 overflow-hidden cosmic-frame ${founderOverlayClass} cursor-pointer" data-area="${u.area || 'polymath'}" data-uid="${u.id}" onclick="Members.showDetail('${u.id}')" style="animation: fadeUp 0.5s ease-out ${delay}ms both;">
                            ${founderOverlayHtml}
                            <!-- Anillo de nebulosa animado -->
                            <div class="absolute inset-0 pointer-events-none overflow-hidden rounded-2xl">
                                <div class="absolute -inset-4 bg-gradient-to-r from-violet-500/20 via-purple-500/10 to-fuchsia-500/20 blur-xl animate-pulse" style="animation-duration: 3s;"></div>
                            </div>
                            <!-- Header con gradiente c√≥smico -->
                            <div class="h-24 bg-gradient-to-r from-violet-900 via-purple-700 to-indigo-900 relative overflow-hidden">
                                <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-purple-400/30 via-transparent to-transparent"></div>
                                <!-- Estrellas animadas m√∫ltiples -->
                                <div class="absolute inset-0 overflow-hidden">
                                    <div class="absolute top-2 left-4 w-1 h-1 bg-white rounded-full animate-ping" style="animation-duration: 2s;"></div>
                                    <div class="absolute top-4 left-[30%] w-1.5 h-1.5 bg-purple-200 rounded-full animate-pulse"></div>
                                    <div class="absolute top-6 right-[20%] w-1 h-1 bg-white rounded-full animate-ping" style="animation-duration: 3s;"></div>
                                    <div class="absolute top-3 right-[40%] w-2 h-2 bg-fuchsia-300 rounded-full animate-pulse" style="animation-duration: 2.5s;"></div>
                                    <div class="absolute bottom-4 left-[15%] w-1 h-1 bg-violet-200 rounded-full animate-ping" style="animation-duration: 1.5s;"></div>
                                    <div class="absolute bottom-2 right-[25%] w-1.5 h-1.5 bg-white/80 rounded-full animate-pulse" style="animation-duration: 2s;"></div>
                                    <div class="absolute top-8 left-[50%] w-1 h-1 bg-pink-300 rounded-full animate-ping" style="animation-duration: 2.2s;"></div>
                                    <!-- Shooting star -->
                                    <div class="absolute top-4 left-0 w-8 h-0.5 bg-gradient-to-r from-transparent via-white to-transparent animate-shooting-star" style="animation: shootingStar 4s linear infinite;"></div>
                                </div>
                                <!-- √Åtomo giratorio -->
                                <div class="absolute top-3 left-3 animate-spin-slow" style="animation-duration: 8s;">
                                    <div class="relative w-8 h-8">
                                        <div class="absolute inset-0 border border-purple-300/50 rounded-full"></div>
                                        <div class="absolute inset-1 border border-fuchsia-300/50 rounded-full" style="transform: rotateX(60deg);"></div>
                                        <div class="absolute inset-0 flex items-center justify-center">
                                            <div class="w-2 h-2 bg-gradient-to-br from-purple-400 to-fuchsia-400 rounded-full shadow-lg shadow-purple-500/50"></div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Badge de pol√≠mata -->
                                <div class="absolute top-2 right-2 bg-white/95 backdrop-blur-sm rounded-full px-2 py-1 flex items-center gap-1 shadow-lg shadow-purple-500/30">
                                    <span class="text-lg animate-spin-slow" style="animation-duration: 6s;">‚öõÔ∏è</span>
                                    <span class="text-[9px] font-black bg-gradient-to-r from-violet-600 to-fuchsia-600 bg-clip-text text-transparent uppercase">Pol√≠mata</span>
                                </div>
                            </div>
                            
                            <!-- Avatar con aura c√≥smica -->
                            <div class="relative -mt-14 flex justify-center">
                                <div class="relative">
                                    <!-- Aura animada -->
                                    <div class="absolute -inset-2 bg-gradient-to-r from-violet-500 via-purple-500 to-fuchsia-500 rounded-2xl blur-md animate-pulse opacity-60"></div>
                                    <img src="${photo}" class="relative w-28 h-28 rounded-2xl object-cover border-4 border-white shadow-2xl group-hover:scale-105 transition-transform duration-300" style="box-shadow: 0 0 30px rgba(139, 92, 246, 0.6), 0 0 60px rgba(192, 38, 211, 0.3);" alt="${name}">
                                    <div class="absolute -bottom-2 -right-2 w-10 h-10 bg-gradient-to-br from-violet-500 via-purple-500 to-fuchsia-500 border-2 border-white rounded-xl flex items-center justify-center shadow-lg animate-bounce" style="animation-duration: 2s;">
                                        <span class="text-lg">‚öõÔ∏è</span>
                                    </div>
                                    <!-- Part√≠culas orbitando -->
                                    <div class="absolute inset-0 animate-spin-slow" style="animation-duration: 10s;">
                                        <div class="absolute -top-1 left-1/2 w-2 h-2 bg-purple-400 rounded-full shadow-lg shadow-purple-400"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Info -->
                            <div class="p-5 text-center">
                                <h4 class="font-bold text-tec-dark text-lg group-hover:text-purple-600 transition-colors">${name}</h4>
                                <span class="inline-block text-[10px] bg-gradient-to-r from-violet-600 via-purple-600 to-fuchsia-600 text-white px-4 py-1.5 rounded-full font-bold uppercase tracking-wide mt-2 shadow-lg shadow-purple-500/30 animate-pulse" style="animation-duration: 3s;">${displayRole}</span>
                                
                                ${u.career ? `<p class="text-xs text-slate-500 mt-2">${u.career}${u.semester ? ` ‚Ä¢ ${u.semester}¬∞ Sem` : ''}</p>` : ''}
                                
                                ${u.bio ? `<p class="text-xs text-slate-400 mt-3 line-clamp-2 leading-relaxed">${u.bio}</p>` : ''}
                                
                                ${skills.length > 0 ? `
                                <div class="flex flex-wrap justify-center gap-1.5 mt-4">
                                    ${skills.slice(0, 3).map(s => `<span class="text-[9px] bg-purple-100 text-purple-700 px-2 py-1 rounded-full font-medium border border-purple-200">${s}</span>`).join('')}
                                    ${skills.length > 3 ? `<span class="text-[9px] text-slate-400 px-1">+${skills.length - 3}</span>` : ''}
                                </div>` : ''}
                                
                                <!-- Indicador de clic -->
                                <p class="text-[10px] text-purple-500/70 mt-3 flex items-center justify-center gap-1"><i data-lucide="mouse-pointer-click" class="w-3 h-3"></i> Click para ver perfil</p>
                            </div>
                            
                            <!-- Footer -->
                            ${(u.github || u.linkedin) ? `
                            <div class="px-5 py-3 bg-gradient-to-r from-violet-50 via-purple-50 to-fuchsia-50 border-t border-purple-200 flex justify-center gap-4" onclick="event.stopPropagation()">
                                ${u.github ? `<a href="https://github.com/${u.github}" target="_blank" class="text-slate-400 hover:text-purple-600 transition"><i data-lucide="github" class="w-5 h-5"></i></a>` : ''}
                                ${u.linkedin ? `<a href="${u.linkedin.startsWith('http') ? u.linkedin : 'https://linkedin.com/in/' + u.linkedin}" target="_blank" class="text-slate-400 hover:text-purple-600 transition"><i data-lucide="linkedin" class="w-5 h-5"></i></a>` : ''}
                            </div>` : ''}
                        </div>`;
                    } else if (specialFrame === 'global') {
                        // CLASE MUNDIAL - Marco global cian ULTRA ANIMADO
                        html += `
                        <div class="member-card worldclass-card group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 hover:-translate-y-3 overflow-hidden global-frame ${founderOverlayClass} cursor-pointer" data-area="${u.area || 'worldclass'}" data-uid="${u.id}" onclick="Members.showDetail('${u.id}')" style="animation: fadeUp 0.5s ease-out ${delay}ms both;">
                            ${founderOverlayHtml}
                            <!-- Aura global -->
                            <div class="absolute inset-0 pointer-events-none overflow-hidden rounded-2xl">
                                <div class="absolute -inset-4 bg-gradient-to-r from-cyan-500/20 via-teal-500/10 to-sky-500/20 blur-xl animate-pulse" style="animation-duration: 2.5s;"></div>
                            </div>
                            <!-- Header con mapa mundial animado -->
                            <div class="h-24 bg-gradient-to-r from-cyan-600 via-teal-500 to-sky-500 relative overflow-hidden animate-gradient-x">
                                <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 50%22%3E%3Cpath fill=%22none%22 stroke=%22rgba(255,255,255,0.1)%22 stroke-width=%220.5%22 d=%22M20,25 Q30,15 50,25 T80,25%22/%3E%3C/svg%3E')] bg-repeat opacity-30"></div>
                                <!-- Elementos orbitales animados -->
                                <div class="absolute inset-0 overflow-hidden">
                                    <!-- Avi√≥n volando -->
                                    <div class="absolute animate-fly-around" style="animation: flyAround 12s linear infinite;">
                                        <span class="text-lg drop-shadow-lg">‚úàÔ∏è</span>
                                    </div>
                                    <!-- Sat√©lite orbitando -->
                                    <div class="absolute top-1/2 left-1/2 animate-spin-slow" style="animation-duration: 15s; transform-origin: 0 0;">
                                        <span class="absolute text-sm" style="transform: translateX(45px)">üõ∞Ô∏è</span>
                                    </div>
                                    <!-- Nubes -->
                                    <div class="absolute top-2 left-[10%] text-xl opacity-40 animate-cloud" style="animation: cloudMove 20s linear infinite;">‚òÅÔ∏è</div>
                                    <div class="absolute top-6 left-[60%] text-lg opacity-30 animate-cloud" style="animation: cloudMove 25s linear infinite; animation-delay: -10s;">‚òÅÔ∏è</div>
                                    <!-- Estrellas del mapa -->
                                    <div class="absolute top-3 left-[25%] w-1 h-1 bg-white rounded-full animate-ping" style="animation-duration: 2s;"></div>
                                    <div class="absolute top-5 right-[30%] w-1.5 h-1.5 bg-yellow-300 rounded-full animate-pulse"></div>
                                </div>
                                <!-- Mundo grande giratorio -->
                                <div class="absolute -bottom-8 -left-8 text-6xl opacity-20 animate-spin-slow" style="animation-duration: 30s;">üåç</div>
                                <!-- Badge de clase mundial -->
                                <div class="absolute top-2 right-2 bg-white/95 backdrop-blur-sm rounded-full px-2 py-1 flex items-center gap-1 shadow-lg shadow-cyan-500/30">
                                    <span class="text-lg animate-bounce" style="animation-duration: 2s;">üåç</span>
                                    <span class="text-[9px] font-black bg-gradient-to-r from-cyan-600 to-teal-600 bg-clip-text text-transparent uppercase">Clase Mundial</span>
                                </div>
                            </div>
                            
                            <!-- Avatar con √≥rbita -->
                            <div class="relative -mt-14 flex justify-center">
                                <div class="relative">
                                    <!-- Anillo orbital -->
                                    <div class="absolute -inset-4 border-2 border-dashed border-cyan-400/40 rounded-full animate-spin-slow" style="animation-duration: 20s;"></div>
                                    <div class="absolute -inset-6 border border-dashed border-teal-400/20 rounded-full animate-spin-slow" style="animation-duration: 30s; animation-direction: reverse;"></div>
                                    <!-- Aura animada -->
                                    <div class="absolute -inset-2 bg-gradient-to-r from-cyan-500 via-teal-500 to-sky-500 rounded-2xl blur-md animate-pulse opacity-60"></div>
                                    <img src="${photo}" class="relative w-28 h-28 rounded-2xl object-cover border-4 border-white shadow-2xl group-hover:scale-105 transition-transform duration-300" style="box-shadow: 0 0 30px rgba(6, 182, 212, 0.6), 0 0 60px rgba(20, 184, 166, 0.3);" alt="${name}">
                                    <!-- Globo terr√°queo badge -->
                                    <div class="absolute -bottom-2 -right-2 w-10 h-10 bg-gradient-to-br from-cyan-500 via-teal-500 to-sky-500 border-2 border-white rounded-xl flex items-center justify-center shadow-lg">
                                        <span class="text-lg animate-spin-slow" style="animation-duration: 10s;">üåé</span>
                                    </div>
                                    <!-- Sat√©lite orbitando foto -->
                                    <div class="absolute inset-0 animate-spin-slow" style="animation-duration: 8s;">
                                        <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                                            <span class="text-sm drop-shadow-lg">üõ∞Ô∏è</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Info -->
                            <div class="p-5 text-center">
                                <h4 class="font-bold text-tec-dark text-lg group-hover:text-cyan-600 transition-colors">${name}</h4>
                                <span class="inline-block text-[10px] bg-gradient-to-r from-cyan-600 via-teal-500 to-sky-500 text-white px-4 py-1.5 rounded-full font-bold uppercase tracking-wide mt-2 shadow-lg shadow-cyan-500/30 animate-pulse" style="animation-duration: 3s;">üåç ${displayRole}</span>
                                
                                ${u.career ? `<p class="text-xs text-slate-500 mt-2">${u.career}${u.semester ? ` ‚Ä¢ ${u.semester}¬∞ Sem` : ''}</p>` : ''}
                                
                                ${u.bio ? `<p class="text-xs text-slate-400 mt-3 line-clamp-2 leading-relaxed">${u.bio}</p>` : ''}
                                
                                ${skills.length > 0 ? `
                                <div class="flex flex-wrap justify-center gap-1.5 mt-4">
                                    ${skills.slice(0, 3).map(s => `<span class="text-[9px] bg-cyan-100 text-cyan-700 px-2 py-1 rounded-full font-medium border border-cyan-200">${s}</span>`).join('')}
                                    ${skills.length > 3 ? `<span class="text-[9px] text-slate-400 px-1">+${skills.length - 3}</span>` : ''}
                                </div>` : ''}
                                
                                <!-- Indicador -->
                                <p class="text-[10px] text-cyan-500/70 mt-3 flex items-center justify-center gap-1"><i data-lucide="mouse-pointer-click" class="w-3 h-3"></i> Click para ver perfil</p>
                            </div>
                            
                            <!-- Footer -->
                            ${(u.github || u.linkedin) ? `
                            <div class="px-5 py-3 bg-gradient-to-r from-cyan-50 via-teal-50 to-sky-50 border-t border-cyan-200 flex justify-center gap-4" onclick="event.stopPropagation()">
                                ${u.github ? `<a href="https://github.com/${u.github}" target="_blank" class="text-slate-400 hover:text-cyan-600 transition"><i data-lucide="github" class="w-5 h-5"></i></a>` : ''}
                                ${u.linkedin ? `<a href="${u.linkedin.startsWith('http') ? u.linkedin : 'https://linkedin.com/in/' + u.linkedin}" target="_blank" class="text-slate-400 hover:text-cyan-600 transition"><i data-lucide="linkedin" class="w-5 h-5"></i></a>` : ''}
                            </div>` : ''}
                        </div>`;
                    } else if (specialFrame === 'frutiger') {
                        // NOSTALGIA DIGITAL - Marco Frutiger Aero
                        html += `
                        <div class="member-card frutiger-card group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 hover:-translate-y-3 overflow-hidden frutiger-frame ${founderOverlayClass} cursor-pointer" data-area="${u.area || 'frutiger'}" data-uid="${u.id}" onclick="Members.showDetail('${u.id}')" style="animation: fadeUp 0.5s ease-out ${delay}ms both;">
                            ${founderOverlayHtml}
                            <!-- Aura frutiger -->
                            <div class="absolute inset-0 pointer-events-none overflow-hidden rounded-2xl">
                                <div class="absolute -inset-4 bg-gradient-to-r from-cyan-400/20 via-sky-300/10 to-cyan-400/20 blur-xl animate-pulse" style="animation-duration: 2.5s;"></div>
                            </div>
                            <!-- Header estilo Frutiger Aero -->
                            <div class="h-24 bg-gradient-to-r from-cyan-400 via-sky-300 to-cyan-400 relative overflow-hidden" style="background-image: url('frutiger.gif'); background-size: cover; background-position: center;">
                                <div class="absolute inset-0 bg-gradient-to-t from-white/40 to-transparent"></div>
                                <!-- Burbujas flotantes -->
                                <div class="absolute inset-0 overflow-hidden">
                                    <div class="absolute bottom-0 left-[20%] w-4 h-4 bg-white/60 rounded-full animate-float-bubble" style="animation-duration: 4s;"></div>
                                    <div class="absolute bottom-0 left-[50%] w-3 h-3 bg-cyan-200/60 rounded-full animate-float-bubble" style="animation-duration: 5s; animation-delay: 1s;"></div>
                                    <div class="absolute bottom-0 left-[70%] w-2 h-2 bg-white/70 rounded-full animate-float-bubble" style="animation-duration: 3.5s; animation-delay: 0.5s;"></div>
                                    <div class="absolute bottom-0 left-[35%] w-5 h-5 bg-sky-200/50 rounded-full animate-float-bubble" style="animation-duration: 6s; animation-delay: 2s;"></div>
                                    <div class="absolute bottom-0 left-[85%] w-2.5 h-2.5 bg-white/50 rounded-full animate-float-bubble" style="animation-duration: 4.5s; animation-delay: 1.5s;"></div>
                                </div>
                                <!-- Brillos -->
                                <div class="absolute top-3 right-8 w-6 h-6">
                                    <div class="absolute w-full h-0.5 bg-white/70 rotate-45 animate-pulse" style="animation-duration: 1.5s;"></div>
                                    <div class="absolute w-0.5 h-full bg-white/70 left-1/2 -translate-x-1/2 animate-pulse" style="animation-duration: 1.5s;"></div>
                                </div>
                                <!-- Badge discreto -->
                                <div class="absolute top-2 right-2 bg-white/95 backdrop-blur-sm rounded-full p-1.5 shadow-lg shadow-cyan-400/30">
                                    <i data-lucide="monitor" class="w-4 h-4 text-cyan-500"></i>
                                </div>
                            </div>
                            
                            <!-- Avatar con est√©tica glossy -->
                            <div class="relative -mt-14 flex justify-center">
                                <div class="relative">
                                    <!-- Aura glossy -->
                                    <div class="absolute -inset-2 bg-gradient-to-r from-cyan-400 via-sky-400 to-cyan-400 rounded-2xl blur-md animate-pulse opacity-60"></div>
                                    <!-- Reflejo superior -->
                                    <div class="absolute inset-0 bg-gradient-to-b from-white/40 to-transparent rounded-2xl pointer-events-none z-10" style="height: 50%;"></div>
                                    <img src="${photo}" class="relative w-28 h-28 rounded-2xl object-cover border-4 border-white shadow-2xl group-hover:scale-105 transition-transform duration-300" style="box-shadow: 0 0 30px rgba(6, 182, 212, 0.5), 0 0 60px rgba(125, 211, 252, 0.3), inset 0 2px 10px rgba(255,255,255,0.5);" alt="${name}">
                                    <!-- Badge de monitor -->
                                    <div class="absolute -bottom-2 -right-2 w-10 h-10 bg-gradient-to-br from-cyan-400 via-sky-400 to-cyan-300 border-2 border-white rounded-xl flex items-center justify-center shadow-lg overflow-hidden">
                                        <div class="absolute inset-0 bg-gradient-to-b from-white/30 to-transparent"></div>
                                        <span class="text-lg relative z-10">üñ•Ô∏è</span>
                                    </div>
                                    <!-- Burbujas peque√±as alrededor del avatar -->
                                    <div class="absolute -top-1 -left-1 w-2 h-2 bg-white/60 rounded-full animate-ping" style="animation-duration: 2s;"></div>
                                    <div class="absolute -top-2 right-4 w-1.5 h-1.5 bg-cyan-300/70 rounded-full animate-bounce" style="animation-duration: 2.5s;"></div>
                                </div>
                            </div>
                            
                            <!-- Info -->
                            <div class="p-5 text-center">
                                <h4 class="font-bold text-tec-dark text-lg group-hover:text-cyan-500 transition-colors">${name}</h4>
                                <span class="inline-block text-[10px] bg-gradient-to-r from-cyan-400 via-sky-400 to-cyan-300 text-white px-4 py-1.5 rounded-full font-bold uppercase tracking-wide mt-2 shadow-lg shadow-cyan-400/30 relative overflow-hidden">
                                    <span class="absolute inset-0 bg-gradient-to-b from-white/30 to-transparent"></span>
                                    <span class="relative">üíª ${displayRole}</span>
                                </span>
                                
                                ${u.career ? `<p class="text-xs text-slate-500 mt-2">${u.career}${u.semester ? ` ‚Ä¢ ${u.semester}¬∞ Sem` : ''}</p>` : ''}
                                
                                ${u.bio ? `<p class="text-xs text-slate-400 mt-3 line-clamp-2 leading-relaxed">${u.bio}</p>` : ''}
                                
                                ${skills.length > 0 ? `
                                <div class="flex flex-wrap justify-center gap-1.5 mt-4">
                                    ${skills.slice(0, 3).map(s => `<span class="text-[9px] bg-cyan-100 text-cyan-600 px-2 py-1 rounded-full font-medium border border-cyan-200 relative overflow-hidden"><span class="absolute inset-0 bg-gradient-to-b from-white/50 to-transparent"></span><span class="relative">${s}</span></span>`).join('')}
                                    ${skills.length > 3 ? `<span class="text-[9px] text-slate-400 px-1">+${skills.length - 3}</span>` : ''}
                                </div>` : ''}
                                
                                <!-- Indicador -->
                                <p class="text-[10px] text-cyan-500/70 mt-3 flex items-center justify-center gap-1"><i data-lucide="mouse-pointer-click" class="w-3 h-3"></i> Click para ver perfil</p>
                            </div>
                            
                            <!-- Footer con est√©tica glossy -->
                            ${(u.github || u.linkedin) ? `
                            <div class="px-5 py-3 bg-gradient-to-r from-cyan-50 via-sky-50 to-cyan-50 border-t border-cyan-200 flex justify-center gap-4 relative overflow-hidden" onclick="event.stopPropagation()">
                                <div class="absolute inset-0 bg-gradient-to-b from-white/50 to-transparent"></div>
                                ${u.github ? `<a href="https://github.com/${u.github}" target="_blank" class="relative z-10 text-slate-400 hover:text-cyan-500 transition"><i data-lucide="github" class="w-5 h-5"></i></a>` : ''}
                                ${u.linkedin ? `<a href="${u.linkedin.startsWith('http') ? u.linkedin : 'https://linkedin.com/in/' + u.linkedin}" target="_blank" class="relative z-10 text-slate-400 hover:text-cyan-500 transition"><i data-lucide="linkedin" class="w-5 h-5"></i></a>` : ''}
                            </div>` : ''}
                        </div>`;
                    } else if (mainFounder) {
                        // Dise√±o especial para FUNDADORES PRINCIPALES (dorado, muy destacado)
                        html += `
                        <div class="member-card founder-card group bg-white rounded-2xl shadow-lg hover:shadow-2xl hover:shadow-tec-gold/20 transition-all duration-500 hover:-translate-y-3 overflow-hidden border-[3px] border-tec-gold hover:border-yellow-500 ring-2 ring-tec-gold/30 ${founderOverlayClass} cursor-pointer" data-area="${u.area || 'founder'}" data-uid="${u.id}" onclick="Members.showDetail('${u.id}')" style="animation: fadeUp 0.5s ease-out ${delay}ms both;">
                            ${founderOverlayHtml}
                            <!-- Header con gradiente dorado -->
                            <div class="h-20 bg-gradient-to-r from-tec-gold via-yellow-500 to-tec-gold relative overflow-hidden">
                                <div class="absolute inset-0 bg-black/10"></div>
                                <div class="absolute -bottom-6 -right-6 w-24 h-24 bg-white/20 rounded-full"></div>
                                <div class="absolute -top-6 -left-6 w-20 h-20 bg-white/20 rounded-full"></div>
                                <!-- Badge de fundador -->
                                <div class="absolute top-2 right-2 bg-white/90 backdrop-blur-sm rounded-full px-2 py-0.5 flex items-center gap-1">
                                    <i data-lucide="crown" class="w-3 h-3 text-tec-gold"></i>
                                    <span class="text-[8px] font-black text-tec-gold uppercase">Fundador</span>
                                </div>
                            </div>
                            
                            <!-- Avatar -->
                            <div class="relative -mt-12 flex justify-center">
                                <div class="relative">
                                    <img src="${photo}" class="w-24 h-24 rounded-2xl object-cover border-4 border-white shadow-xl group-hover:scale-105 transition-transform duration-300 ring-2 ring-tec-gold" alt="${name}">
                                    <div class="absolute -bottom-2 -right-2 w-8 h-8 bg-gradient-to-br from-tec-gold to-yellow-600 border-2 border-white rounded-lg flex items-center justify-center shadow-lg shadow-tec-gold/50">
                                        <i data-lucide="crown" class="w-4 h-4 text-white"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Info -->
                            <div class="p-5 text-center">
                                <h4 class="font-bold text-tec-dark text-lg group-hover:text-tec-gold transition-colors">${name}</h4>
                                <span class="inline-block text-[10px] bg-gradient-to-r from-tec-gold to-yellow-500 text-white px-3 py-1 rounded-full font-bold uppercase tracking-wide mt-2 shadow-sm">${displayRole}</span>
                                
                                ${u.career ? `<p class="text-xs text-slate-500 mt-2">${u.career}${u.semester ? ` ‚Ä¢ ${u.semester}¬∞ Sem` : ''}</p>` : ''}
                                
                                ${u.bio ? `<p class="text-xs text-slate-400 mt-3 line-clamp-2 leading-relaxed">${u.bio}</p>` : ''}
                                
                                ${skills.length > 0 ? `
                                <div class="flex flex-wrap justify-center gap-1.5 mt-4">
                                    ${skills.slice(0, 3).map(s => `<span class="text-[9px] bg-tec-gold/10 text-tec-gold px-2 py-1 rounded-full font-medium border border-tec-gold/20">${s}</span>`).join('')}
                                    ${skills.length > 3 ? `<span class="text-[9px] text-slate-400 px-1">+${skills.length - 3}</span>` : ''}
                                </div>` : ''}
                                
                                <!-- Indicador de clic para ver m√°s -->
                                <p class="text-[10px] text-tec-gold/70 mt-3 flex items-center justify-center gap-1"><i data-lucide="mouse-pointer-click" class="w-3 h-3"></i> Click para ver perfil</p>
                            </div>
                            
                            <!-- Footer con redes -->
                            ${(u.github || u.linkedin) ? `
                            <div class="px-5 py-3 bg-tec-gold/10 border-t border-tec-gold/30 flex justify-center gap-4" onclick="event.stopPropagation()">
                                ${u.github ? `<a href="https://github.com/${u.github}" target="_blank" class="text-slate-400 hover:text-tec-gold transition"><i data-lucide="github" class="w-5 h-5"></i></a>` : ''}
                                ${u.linkedin ? `<a href="${u.linkedin.startsWith('http') ? u.linkedin : 'https://linkedin.com/in/' + u.linkedin}" target="_blank" class="text-slate-400 hover:text-tec-gold transition"><i data-lucide="linkedin" class="w-5 h-5"></i></a>` : ''}
                            </div>` : ''}
                        </div>`;
                    } else if (mentor) {
                        // Dise√±o especial para MAESTROS/TUTORES (guinda intenso, muy destacado)
                        html += `
                        <div class="member-card mentor-card group bg-white rounded-2xl shadow-lg hover:shadow-2xl hover:shadow-rose-900/30 transition-all duration-500 hover:-translate-y-3 overflow-hidden border-[3px] border-rose-800 hover:border-rose-700 ring-2 ring-rose-800/40 cursor-pointer ${founderOverlayClass}" data-area="mentor" data-uid="${u.id}" onclick="Members.showDetail('${u.id}')" style="animation: fadeUp 0.5s ease-out ${delay}ms both;">
                            ${founderOverlayHtml}
                            <!-- Header con gradiente guinda intenso -->
                            <div class="h-20 bg-gradient-to-r from-rose-900 via-rose-800 to-pink-900 relative overflow-hidden">
                                <div class="absolute inset-0 bg-black/10"></div>
                                <div class="absolute -bottom-6 -right-6 w-24 h-24 bg-white/20 rounded-full"></div>
                                <div class="absolute -top-6 -left-6 w-20 h-20 bg-white/20 rounded-full"></div>
                                <!-- Badge de maestro -->
                                <div class="absolute top-2 right-2 bg-white/90 backdrop-blur-sm rounded-full px-2 py-0.5 flex items-center gap-1">
                                    <i data-lucide="graduation-cap" class="w-3 h-3 text-rose-800"></i>
                                    <span class="text-[8px] font-black text-rose-800 uppercase">Mentor</span>
                                </div>
                            </div>
                            
                            <!-- Avatar -->
                            <div class="relative -mt-12 flex justify-center">
                                <div class="relative">
                                    <img src="${photo}" class="w-24 h-24 rounded-2xl object-cover border-4 border-white shadow-xl group-hover:scale-105 transition-transform duration-300 ring-2 ring-rose-800" alt="${name}">
                                    <div class="absolute -bottom-2 -right-2 w-8 h-8 bg-gradient-to-br from-rose-800 to-rose-900 border-2 border-white rounded-lg flex items-center justify-center shadow-lg shadow-rose-900/50">
                                        <i data-lucide="graduation-cap" class="w-4 h-4 text-white"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Info -->
                            <div class="p-5 text-center">
                                <h4 class="font-bold text-tec-dark text-lg group-hover:text-rose-800 transition-colors">${name}</h4>
                                <span class="inline-block text-[10px] bg-gradient-to-r from-rose-800 to-rose-900 text-white px-3 py-1 rounded-full font-bold uppercase tracking-wide mt-2 shadow-sm">${displayRole}</span>
                                
                                ${u.career ? `<p class="text-xs text-slate-500 mt-2">${u.career}${u.semester ? ` ‚Ä¢ ${u.semester}¬∞ Sem` : ''}</p>` : ''}
                                
                                ${u.bio ? `<p class="text-xs text-slate-400 mt-3 line-clamp-2 leading-relaxed">${u.bio}</p>` : ''}
                                
                                ${skills.length > 0 ? `
                                <div class="flex flex-wrap justify-center gap-1.5 mt-4">
                                    ${skills.slice(0, 3).map(s => `<span class="text-[9px] bg-rose-50 text-rose-800 px-2 py-1 rounded-full font-medium border border-rose-200">${s}</span>`).join('')}
                                    ${skills.length > 3 ? `<span class="text-[9px] text-slate-400 px-1">+${skills.length - 3}</span>` : ''}
                                </div>` : ''}
                                
                                <!-- Indicador de clic para ver m√°s -->
                                <p class="text-[10px] text-rose-800/70 mt-3 flex items-center justify-center gap-1"><i data-lucide="mouse-pointer-click" class="w-3 h-3"></i> Click para ver perfil</p>
                            </div>
                            
                            <!-- Footer con redes -->
                            ${(u.github || u.linkedin) ? `
                            <div class="px-5 py-3 bg-rose-50 border-t border-rose-200 flex justify-center gap-4" onclick="event.stopPropagation()">
                                ${u.github ? `<a href="https://github.com/${u.github}" target="_blank" class="text-slate-400 hover:text-rose-800 transition"><i data-lucide="github" class="w-5 h-5"></i></a>` : ''}
                                ${u.linkedin ? `<a href="${u.linkedin.startsWith('http') ? u.linkedin : 'https://linkedin.com/in/' + u.linkedin}" target="_blank" class="text-slate-400 hover:text-rose-800 transition"><i data-lucide="linkedin" class="w-5 h-5"></i></a>` : ''}
                            </div>` : ''}
                        </div>`;
                    } else if (areaLeader) {
                        // Dise√±o especial para L√çDERES DE √ÅREA (color del √°rea, m√°s destacado)
                        html += `
                        <div class="member-card leader-card group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 hover:-translate-y-3 overflow-hidden border-[3px] ${areaStyle.border} ${areaStyle.borderHover} ring-2 ${areaStyle.ring} cursor-pointer ${founderOverlayClass}" data-area="${u.area || ''}" data-uid="${u.id}" onclick="Members.showDetail('${u.id}')" style="animation: fadeUp 0.5s ease-out ${delay}ms both;">
                            ${founderOverlayHtml}
                            <!-- Header con gradiente del √°rea -->
                            <div class="h-20 bg-gradient-to-r ${areaStyle.gradient} relative overflow-hidden">
                                <div class="absolute inset-0 bg-black/10"></div>
                                <div class="absolute -bottom-6 -right-6 w-24 h-24 bg-white/20 rounded-full"></div>
                                <div class="absolute -top-6 -left-6 w-20 h-20 bg-white/20 rounded-full"></div>
                                <!-- Badge de l√≠der -->
                                <div class="absolute top-2 right-2 bg-white/90 backdrop-blur-sm rounded-full px-2 py-0.5 flex items-center gap-1">
                                    <i data-lucide="star" class="w-3 h-3 ${areaStyle.text}"></i>
                                    <span class="text-[8px] font-black ${areaStyle.text} uppercase">L√≠der</span>
                                </div>
                            </div>
                            
                            <!-- Avatar -->
                            <div class="relative -mt-12 flex justify-center">
                                <div class="relative">
                                    <img src="${photo}" class="w-24 h-24 rounded-2xl object-cover border-4 border-white shadow-xl group-hover:scale-105 transition-transform duration-300 ring-2 ${areaStyle.border}" alt="${name}">
                                    <div class="absolute -bottom-2 -right-2 w-8 h-8 bg-gradient-to-br ${areaStyle.gradient} border-2 border-white rounded-lg flex items-center justify-center shadow-lg ${areaStyle.shadow}">
                                        <i data-lucide="star" class="w-4 h-4 text-white"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Info -->
                            <div class="p-5 text-center">
                                <h4 class="font-bold text-tec-dark text-lg group-hover:${areaStyle.text} transition-colors">${name}</h4>
                                <span class="inline-block text-[10px] bg-gradient-to-r ${areaStyle.gradient} text-white px-3 py-1 rounded-full font-bold uppercase tracking-wide mt-2 shadow-sm">${displayRole}</span>
                                
                                ${u.career ? `<p class="text-xs text-slate-500 mt-2">${u.career}${u.semester ? ` ‚Ä¢ ${u.semester}¬∞ Sem` : ''}</p>` : ''}
                                
                                ${u.bio ? `<p class="text-xs text-slate-400 mt-3 line-clamp-2 leading-relaxed">${u.bio}</p>` : ''}
                                
                                ${skills.length > 0 ? `
                                <div class="flex flex-wrap justify-center gap-1.5 mt-4">
                                    ${skills.slice(0, 3).map(s => `<span class="text-[9px] ${areaStyle.bg} ${areaStyle.text} px-2 py-1 rounded-full font-medium">${s}</span>`).join('')}
                                    ${skills.length > 3 ? `<span class="text-[9px] text-slate-400 px-1">+${skills.length - 3}</span>` : ''}
                                </div>` : ''}
                                
                                <!-- Indicador de clic para ver m√°s -->
                                <p class="text-[10px] ${areaStyle.text} opacity-70 mt-3 flex items-center justify-center gap-1"><i data-lucide="mouse-pointer-click" class="w-3 h-3"></i> Click para ver perfil</p>
                            </div>
                            
                            <!-- Footer con redes -->
                            ${(u.github || u.linkedin) ? `
                            <div class="px-5 py-3 ${areaStyle.bg} border-t ${areaStyle.border}/30 flex justify-center gap-4" onclick="event.stopPropagation()">
                                ${u.github ? `<a href="https://github.com/${u.github}" target="_blank" class="text-slate-400 hover:${areaStyle.text} transition"><i data-lucide="github" class="w-5 h-5"></i></a>` : ''}
                                ${u.linkedin ? `<a href="${u.linkedin.startsWith('http') ? u.linkedin : 'https://linkedin.com/in/' + u.linkedin}" target="_blank" class="text-slate-400 hover:${areaStyle.text} transition"><i data-lucide="linkedin" class="w-5 h-5"></i></a>` : ''}
                            </div>` : ''}
                        </div>`;
                    } else {
                        // Dise√±o normal para miembros regulares (color del √°rea, sutil)
                        html += `
                        <div class="member-card group bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-500 hover:-translate-y-2 overflow-hidden border-2 ${areaStyle.border}/40 ${areaStyle.borderHover} ring-1 ${areaStyle.ring} cursor-pointer ${founderOverlayClass}" data-area="${u.area || ''}" data-uid="${u.id}" onclick="Members.showDetail('${u.id}')" style="animation: fadeUp 0.5s ease-out ${delay}ms both;">
                            ${founderOverlayHtml}
                            <!-- Header con gradiente -->
                            <div class="h-20 bg-gradient-to-r ${areaStyle.gradient} relative overflow-hidden">
                                <div class="absolute inset-0 bg-black/10"></div>
                                <div class="absolute -bottom-6 -right-6 w-24 h-24 bg-white/10 rounded-full"></div>
                                <div class="absolute -top-6 -left-6 w-20 h-20 bg-white/10 rounded-full"></div>
                            </div>
                            
                            <!-- Avatar -->
                            <div class="relative -mt-12 flex justify-center">
                                <div class="relative">
                                    <img src="${photo}" class="w-24 h-24 rounded-2xl object-cover border-4 border-white shadow-lg group-hover:scale-105 transition-transform duration-300" alt="${name}">
                                    <div class="absolute -bottom-2 -right-2 w-8 h-8 ${areaStyle.bg} border-2 border-white rounded-lg flex items-center justify-center shadow">
                                        <i data-lucide="${areaStyle.icon}" class="w-4 h-4 ${areaStyle.text}"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Info -->
                            <div class="p-5 text-center">
                                <h4 class="font-bold text-tec-dark text-lg group-hover:${areaStyle.text} transition-colors">${name}</h4>
                                <span class="inline-block text-[10px] ${areaStyle.bg} ${areaStyle.text} px-3 py-1 rounded-full font-bold uppercase tracking-wide mt-2">${displayRole}</span>
                                
                                ${u.career ? `<p class="text-xs text-slate-500 mt-2">${u.career}${u.semester ? ` ‚Ä¢ ${u.semester}¬∞ Sem` : ''}</p>` : ''}
                                
                                ${u.bio ? `<p class="text-xs text-slate-400 mt-3 line-clamp-2 leading-relaxed">${u.bio}</p>` : ''}
                                
                                ${skills.length > 0 ? `
                                <div class="flex flex-wrap justify-center gap-1.5 mt-4">
                                    ${skills.slice(0, 3).map(s => `<span class="text-[9px] bg-slate-100 text-slate-600 px-2 py-1 rounded-full font-medium">${s}</span>`).join('')}
                                    ${skills.length > 3 ? `<span class="text-[9px] text-slate-400 px-1">+${skills.length - 3}</span>` : ''}
                                </div>` : ''}
                                
                                <!-- Indicador de clic para ver m√°s -->
                                <p class="text-[10px] text-slate-400 mt-3 flex items-center justify-center gap-1"><i data-lucide="mouse-pointer-click" class="w-3 h-3"></i> Click para ver perfil</p>
                            </div>
                            
                            <!-- Footer con redes -->
                            ${(u.github || u.linkedin) ? `
                            <div class="px-5 py-3 bg-slate-50 border-t border-slate-100 flex justify-center gap-4" onclick="event.stopPropagation()">
                                ${u.github ? `<a href="https://github.com/${u.github}" target="_blank" class="text-slate-400 hover:text-slate-700 transition"><i data-lucide="github" class="w-5 h-5"></i></a>` : ''}
                                ${u.linkedin ? `<a href="${u.linkedin.startsWith('http') ? u.linkedin : 'https://linkedin.com/in/' + u.linkedin}" target="_blank" class="text-slate-400 hover:text-blue-600 transition"><i data-lucide="linkedin" class="w-5 h-5"></i></a>` : ''}
                            </div>` : ''}
                        </div>`;
                    }
                    delay += 80;
                });

                grid.innerHTML = html;
                lucide.createIcons();
            },

            // Mostrar modal de detalle de miembro
            showDetail: (userId) => {
                const user = Members.allMembers.find(m => m.id === userId);
                if (!user) return;

                const areaColors = {
                    'gestion': { bg: 'bg-purple-100', text: 'text-purple-700', gradient: 'from-purple-500 to-purple-600' },
                    'telecom': { bg: 'bg-blue-100', text: 'text-blue-700', gradient: 'from-blue-500 to-blue-600' },
                    'software': { bg: 'bg-green-100', text: 'text-green-700', gradient: 'from-green-500 to-green-600' },
                    'electronica': { bg: 'bg-orange-100', text: 'text-orange-700', gradient: 'from-orange-500 to-orange-600' },
                    'mecanico': { bg: 'bg-red-100', text: 'text-red-700', gradient: 'from-red-500 to-red-600' }
                };

                const name = user.fullName || 'Miembro CRAI';
                const photo = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=1B396A&color=D4AF37&bold=true&size=200`;
                const title = (user.customTitle || '').toLowerCase();
                const areaStyle = areaColors[user.area] || { bg: 'bg-slate-100', text: 'text-slate-600', gradient: 'from-slate-500 to-slate-600' };
                const displayRole = user.customTitle || user.areaName || user.role || 'Miembro';
                const skills = user.skills || [];
                const hasFrame = Achievements.hasSpecialFrame(user);
                
                // Determinar tipo de miembro para el header
                let headerGradient = `bg-gradient-to-r ${areaStyle.gradient}`;
                let roleIcon = 'user';
                let roleLabel = 'Miembro';
                
                // Si tiene marco m√≠tico, usar gradiente especial
                if (hasFrame) {
                    headerGradient = 'bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500 animate-gradient-x';
                    roleIcon = 'sparkles';
                    roleLabel = 'Completista';
                } else if (title.includes('fundador') || title.includes('cofundador')) {
                    headerGradient = 'bg-gradient-to-r from-tec-gold via-yellow-500 to-tec-gold';
                    roleIcon = 'crown';
                    roleLabel = 'Fundador';
                } else if (title.includes('maestro') || title.includes('tutor') || title.includes('asesor') || title.includes('profesor')) {
                    headerGradient = 'bg-gradient-to-r from-rose-900 via-rose-800 to-pink-900';
                    roleIcon = 'graduation-cap';
                    roleLabel = 'Mentor';
                } else if (title.includes('l√≠der') || title.includes('lider')) {
                    roleIcon = 'star';
                    roleLabel = 'L√≠der';
                }

                // Obtener logros
                const achievementIds = Achievements.getUserAchievements(user);
                const totalPoints = Achievements.getTotalPoints(user);
                
                const achievementsHtml = Achievements.renderFullList(user);

                Swal.fire({
                    html: `
                        <div class="text-left -m-5">
                            <!-- Header -->
                            <div class="${headerGradient} p-6 text-white relative overflow-hidden">
                                <div class="absolute -bottom-10 -right-10 w-32 h-32 bg-white/10 rounded-full"></div>
                                <div class="absolute -top-10 -left-10 w-24 h-24 bg-white/10 rounded-full"></div>
                                <div class="relative flex items-center gap-5">
                                    <img src="${photo}" class="w-20 h-20 rounded-2xl object-cover border-4 border-white/30 shadow-xl" alt="${name}">
                                    <div>
                                        <p class="text-xs text-white/70 uppercase tracking-wider flex items-center gap-1">
                                            <i data-lucide="${roleIcon}" class="w-3 h-3"></i> ${roleLabel}
                                        </p>
                                        <h3 class="text-xl font-black">${name}</h3>
                                        <p class="text-sm text-white/90">${displayRole}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Content -->
                            <div class="p-5 max-h-[60vh] overflow-y-auto space-y-5">
                                <!-- Info b√°sica -->
                                <div class="bg-slate-50 rounded-xl p-4 space-y-3">
                                    ${user.career ? `
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 bg-tec-blue/10 rounded-lg flex items-center justify-center">
                                            <i data-lucide="graduation-cap" class="w-4 h-4 text-tec-blue"></i>
                                        </div>
                                        <div>
                                            <p class="text-xs text-slate-400">Carrera</p>
                                            <p class="text-sm font-medium text-slate-700">${user.career}${user.semester ? ` ‚Ä¢ ${user.semester}¬∞ Semestre` : ''}</p>
                                        </div>
                                    </div>` : ''}
                                    
                                    ${user.areaName ? `
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 ${areaStyle.bg} rounded-lg flex items-center justify-center">
                                            <i data-lucide="layers" class="w-4 h-4 ${areaStyle.text}"></i>
                                        </div>
                                        <div>
                                            <p class="text-xs text-slate-400">√Årea</p>
                                            <p class="text-sm font-medium ${areaStyle.text}">${user.areaName}</p>
                                        </div>
                                    </div>` : ''}
                                    
                                    ${user.bio ? `
                                    <div class="pt-2 border-t border-slate-200">
                                        <p class="text-xs text-slate-400 mb-1">Biograf√≠a</p>
                                        <p class="text-sm text-slate-600 leading-relaxed">${user.bio}</p>
                                    </div>` : ''}
                                </div>
                                
                                <!-- Skills -->
                                ${skills.length > 0 ? `
                                <div>
                                    <h4 class="font-bold text-slate-700 text-sm mb-3 flex items-center gap-2">
                                        <i data-lucide="wrench" class="w-4 h-4 text-tec-blue"></i> Habilidades
                                    </h4>
                                    <div class="flex flex-wrap gap-2">
                                        ${skills.map(s => `<span class="text-xs ${areaStyle.bg} ${areaStyle.text} px-3 py-1.5 rounded-full font-medium">${s}</span>`).join('')}
                                    </div>
                                </div>` : ''}
                                
                                <!-- Redes Sociales -->
                                ${(user.github || user.linkedin) ? `
                                <div>
                                    <h4 class="font-bold text-slate-700 text-sm mb-3 flex items-center gap-2">
                                        <i data-lucide="share-2" class="w-4 h-4 text-tec-blue"></i> Redes Sociales
                                    </h4>
                                    <div class="flex gap-3">
                                        ${user.github ? `<a href="https://github.com/${user.github}" target="_blank" class="flex items-center gap-2 px-4 py-2 bg-slate-800 text-white rounded-xl text-sm hover:bg-slate-700 transition"><i data-lucide="github" class="w-4 h-4"></i> GitHub</a>` : ''}
                                        ${user.linkedin ? `<a href="${user.linkedin.startsWith('http') ? user.linkedin : 'https://linkedin.com/in/' + user.linkedin}" target="_blank" class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-xl text-sm hover:bg-blue-700 transition"><i data-lucide="linkedin" class="w-4 h-4"></i> LinkedIn</a>` : ''}
                                    </div>
                                </div>` : ''}
                                
                                <!-- Logros -->
                                <div>
                                    <div class="flex items-center justify-between mb-3">
                                        <h4 class="font-bold text-slate-700 text-sm flex items-center gap-2">
                                            <i data-lucide="award" class="w-4 h-4 text-tec-gold"></i> Logros
                                        </h4>
                                        <div class="flex items-center gap-2 px-3 py-1 bg-tec-gold/10 rounded-full">
                                            <i data-lucide="gem" class="w-3 h-3 text-tec-gold"></i>
                                            <span class="text-xs font-bold text-tec-gold">${totalPoints} pts</span>
                                        </div>
                                    </div>
                                    <p class="text-xs text-slate-400 mb-3">Haz clic en un logro para ver por qu√© se obtuvo</p>
                                    ${achievementsHtml}
                                </div>
                            </div>
                        </div>
                    `,
                    showConfirmButton: false,
                    showCloseButton: true,
                    width: 500,
                    padding: 0,
                    customClass: {
                        popup: 'rounded-2xl overflow-hidden'
                    },
                    didOpen: () => lucide.createIcons()
                });
            },

            filter: (area) => {
                Members.currentFilter = area;
                
                // Actualizar botones de filtro
                document.querySelectorAll('.member-filter').forEach(btn => {
                    const isActive = btn.dataset.filter === area;
                    if (isActive) {
                        btn.classList.remove('bg-white', 'text-slate-600', 'border-slate-200');
                        btn.classList.add('bg-tec-blue', 'text-white', 'shadow-lg', 'shadow-tec-blue/30');
                    } else {
                        btn.classList.add('bg-white', 'text-slate-600', 'border-slate-200');
                        btn.classList.remove('bg-tec-blue', 'text-white', 'shadow-lg', 'shadow-tec-blue/30');
                    }
                });

                Members.render();
            }
        };

        const Modal = {
            open: async (id) => { 
                const el = document.getElementById(`modal-${id}`);
                el.classList.remove('hidden');
                
                // Cargar miembros y competencias cuando se abra el modal de upload
                if (id === 'upload') {
                    if (ProjectMembers.allMembers.length === 0) {
                        await ProjectMembers.loadMembers();
                    } else {
                        ProjectMembers.renderMembersList('up-members-list', 'up');
                    }
                    // Cargar competencias para el selector
                    await ProjectCompetitionSelector.loadCompetitions('up', '');
                }
                
                // Cargar miembros cuando se abra el modal de edici√≥n
                if (id === 'edit-project') {
                    if (ProjectMembers.allMembers.length === 0) {
                        await ProjectMembers.loadMembers();
                    }
                    ProjectMembers.renderMembersList('edit-members-list', 'edit');
                }
                
                // Cargar proyectos cuando se abra el modal de agregar competencia
                if (id === 'add-competition') {
                    await ProjectCompetitionSelector.loadProjects('comp', '');
                }
                
                lucide.createIcons();
            },
            close: (id) => {
                const el = document.getElementById(`modal-${id}`);
                el.classList.add('hidden');
                
                // Limpiar formularios al cerrar
                if (id === 'upload') {
                    ProjectMembers.reset('up');
                    document.getElementById('up-competition-preview')?.classList.add('hidden');
                }
                if (id === 'edit-project') {
                    ProjectMembers.reset('edit');
                    document.getElementById('edit-competition-preview')?.classList.add('hidden');
                }
                if (id === 'add-competition') {
                    document.getElementById('comp-project-preview')?.classList.add('hidden');
                }
            }
        };

        /**
         * ==========================================
         * 8. RESOURCES (Repositorio de Recursos)
         * ==========================================
         */
        const Resources = {
            currentFilter: 'all',
            allResources: [],
            expandedCards: new Set(),
            editingResource: null,

            // Informaci√≥n de las √°reas del club con colores
            areaInfo: {
                'gestion': { name: 'Gesti√≥n y Vinculaci√≥n', color: 'purple', icon: 'briefcase', border: 'border-l-purple-500', bg: 'bg-purple-50', text: 'text-purple-600', badge: 'bg-purple-100 text-purple-700' },
                'telecom': { name: 'Telecomunicaciones', color: 'blue', icon: 'wifi', border: 'border-l-blue-500', bg: 'bg-blue-50', text: 'text-blue-600', badge: 'bg-blue-100 text-blue-700' },
                'software': { name: 'Software e IA', color: 'green', icon: 'code', border: 'border-l-green-500', bg: 'bg-green-50', text: 'text-green-600', badge: 'bg-green-100 text-green-700' },
                'electronica': { name: 'Electr√≥nica', color: 'orange', icon: 'cpu', border: 'border-l-orange-500', bg: 'bg-orange-50', text: 'text-orange-600', badge: 'bg-orange-100 text-orange-700' },
                'mecanico': { name: 'Dise√±o Mec√°nico', color: 'red', icon: 'cog', border: 'border-l-red-500', bg: 'bg-red-50', text: 'text-red-600', badge: 'bg-red-100 text-red-700' },
                'general': { name: 'General', color: 'slate', icon: 'folder', border: 'border-l-slate-400', bg: 'bg-slate-50', text: 'text-slate-600', badge: 'bg-slate-100 text-slate-700' }
            },

            load: async () => {
                const grid = document.getElementById('resources-grid');
                const uploadBtn = document.getElementById('resources-upload-btn');
                
                // Mostrar bot√≥n de subir si est√° autenticado
                if (STATE.currentUser && uploadBtn) {
                    uploadBtn.classList.remove('hidden');
                } else if (uploadBtn) {
                    uploadBtn.classList.add('hidden');
                }

                if (!grid) return;
                grid.innerHTML = '<div class="col-span-full text-center py-12"><div class="animate-spin w-8 h-8 border-4 border-tec-blue border-t-transparent rounded-full mx-auto mb-4"></div><p class="text-slate-400">Cargando recursos...</p></div>';

                try {
                    const snap = await db.collection('resources').orderBy('createdAt', 'desc').get();
                    Resources.allResources = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    Resources.render();
                } catch (err) {
                    console.error('Error cargando recursos:', err);
                    grid.innerHTML = '<div class="col-span-full text-center py-12"><i data-lucide="alert-circle" class="w-12 h-12 text-red-300 mx-auto mb-4"></i><p class="text-slate-400">Error al cargar recursos</p></div>';
                    lucide.createIcons();
                }
            },

            toggleExpand: (resourceId) => {
                if (Resources.expandedCards.has(resourceId)) {
                    Resources.expandedCards.delete(resourceId);
                } else {
                    Resources.expandedCards.add(resourceId);
                }
                Resources.render();
            },

            render: () => {
                const grid = document.getElementById('resources-grid');
                if (!grid) return;

                const filtered = Resources.currentFilter === 'all' 
                    ? Resources.allResources 
                    : Resources.allResources.filter(r => r.category === Resources.currentFilter);

                if (filtered.length === 0) {
                    grid.innerHTML = '<div class="col-span-full text-center py-12"><i data-lucide="folder-open" class="w-16 h-16 text-slate-300 mx-auto mb-4"></i><p class="text-slate-400">No hay recursos en esta categor√≠a</p><p class="text-xs text-slate-300 mt-1">S√© el primero en compartir algo</p></div>';
                    lucide.createIcons();
                    return;
                }

                const categoryIcons = {
                    'documento': 'file-text',
                    'tutorial': 'book-open',
                    'codigo': 'code',
                    'diseno': 'pen-tool',
                    'otro': 'package'
                };

                const categoryStyles = {
                    'documento': { bg: 'bg-blue-100', text: 'text-blue-500', badge: 'bg-blue-100 text-blue-600' },
                    'tutorial': { bg: 'bg-purple-100', text: 'text-purple-500', badge: 'bg-purple-100 text-purple-600' },
                    'codigo': { bg: 'bg-green-100', text: 'text-green-500', badge: 'bg-green-100 text-green-600' },
                    'diseno': { bg: 'bg-orange-100', text: 'text-orange-500', badge: 'bg-orange-100 text-orange-600' },
                    'otro': { bg: 'bg-slate-100', text: 'text-slate-500', badge: 'bg-slate-100 text-slate-600' }
                };

                grid.innerHTML = filtered.map(r => {
                    const icon = categoryIcons[r.category] || 'file';
                    const style = categoryStyles[r.category] || categoryStyles['otro'];
                    const date = r.createdAt?.toDate?.() ? new Date(r.createdAt.toDate()).toLocaleDateString('es-MX') : 'Reciente';
                    const areaData = Resources.areaInfo[r.area] || Resources.areaInfo['general'];
                    const isExpanded = Resources.expandedCards.has(r.id);
                    const isOwner = STATE.currentUser && STATE.currentUser.uid === r.authorId;
                    const hasDetails = r.details && r.details.trim().length > 0;
                    
                    return `
                        <div class="resource-card bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-lg transition-all group border-l-4 ${areaData.border}" data-category="${r.category}" data-area="${r.area || 'general'}">
                            <!-- Header con color del √°rea -->
                            <div class="${areaData.bg} px-4 py-2 flex items-center justify-between border-b border-slate-100">
                                <span class="flex items-center gap-2 text-[10px] font-bold ${areaData.text} uppercase">
                                    <i data-lucide="${areaData.icon}" class="w-3 h-3"></i>
                                    ${areaData.name}
                                </span>
                                ${isOwner ? `
                                    <button onclick="Resources.openEdit('${r.id}')" class="text-slate-400 hover:text-tec-blue transition p-1 rounded hover:bg-white/50" title="Editar recurso">
                                        <i data-lucide="edit-2" class="w-3.5 h-3.5"></i>
                                    </button>
                                ` : ''}
                            </div>
                            <div class="p-5">
                                <div class="flex items-start gap-4 mb-3">
                                    <div class="w-12 h-12 ${style.bg} rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform flex-shrink-0">
                                        <i data-lucide="${icon}" class="w-6 h-6 ${style.text}"></i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <h4 class="font-bold text-slate-800 text-sm mb-1">${r.title}</h4>
                                        <span class="text-[10px] ${style.badge} px-2 py-0.5 rounded-full font-bold uppercase">${r.category}</span>
                                    </div>
                                </div>
                                ${r.description ? `<p class="text-xs text-slate-500 mb-3 ${isExpanded ? '' : 'line-clamp-2'}">${r.description}</p>` : ''}
                                
                                <!-- Detalles expandibles -->
                                ${hasDetails || r.description ? `
                                    <div class="${isExpanded ? '' : 'hidden'} mt-3 pt-3 border-t border-slate-100">
                                        ${hasDetails ? `
                                            <div class="bg-slate-50 rounded-lg p-3 mb-3">
                                                <p class="text-[10px] font-bold text-slate-500 uppercase mb-2 flex items-center gap-1">
                                                    <i data-lucide="info" class="w-3 h-3"></i>
                                                    Detalles adicionales
                                                </p>
                                                <p class="text-xs text-slate-600 whitespace-pre-wrap">${r.details}</p>
                                            </div>
                                        ` : ''}
                                        <div class="grid grid-cols-2 gap-2 text-[10px]">
                                            <div class="bg-slate-50 rounded-lg p-2">
                                                <span class="text-slate-400 block">Subido por</span>
                                                <span class="text-slate-700 font-bold">${r.authorName || 'An√≥nimo'}</span>
                                            </div>
                                            <div class="bg-slate-50 rounded-lg p-2">
                                                <span class="text-slate-400 block">Fecha</span>
                                                <span class="text-slate-700 font-bold">${date}</span>
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <div class="flex items-center justify-between text-[10px] text-slate-400 pt-3 border-t border-slate-100 mt-3">
                                    <span class="flex items-center gap-1">
                                        <i data-lucide="user" class="w-3 h-3"></i>
                                        ${r.authorName || 'An√≥nimo'}
                                    </span>
                                    <div class="flex items-center gap-2">
                                        <span class="flex items-center gap-1">
                                            <i data-lucide="calendar" class="w-3 h-3"></i>
                                            ${date}
                                        </span>
                                        ${hasDetails || r.description ? `
                                            <button onclick="Resources.toggleExpand('${r.id}')" class="flex items-center gap-1 text-tec-blue hover:text-tec-dark font-bold transition">
                                                <i data-lucide="${isExpanded ? 'chevron-up' : 'chevron-down'}" class="w-3 h-3"></i>
                                                ${isExpanded ? 'Menos' : 'M√°s'}
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                            <a href="${r.url}" target="_blank" rel="noopener" class="block bg-gradient-to-r from-tec-blue to-tec-dark text-white text-center py-3 text-xs font-bold uppercase tracking-wider hover:from-tec-gold hover:to-yellow-600 transition-all">
                                <i data-lucide="external-link" class="w-4 h-4 inline mr-1"></i>
                                Abrir Recurso
                            </a>
                        </div>
                    `;
                }).join('');

                lucide.createIcons();
            },

            openEdit: (resourceId) => {
                const resource = Resources.allResources.find(r => r.id === resourceId);
                if (!resource) return;
                
                Resources.editingResource = resource;
                
                // Rellenar formulario de edici√≥n
                document.getElementById('edit-resource-title').value = resource.title || '';
                document.getElementById('edit-resource-desc').value = resource.description || '';
                document.getElementById('edit-resource-category').value = resource.category || '';
                document.getElementById('edit-resource-area').value = resource.area || 'general';
                document.getElementById('edit-resource-details').value = resource.details || '';
                document.getElementById('edit-resource-url').value = resource.url || '';
                
                Modal.open('edit-resource');
            },

            saveEdit: async (e) => {
                e.preventDefault();
                if (!Resources.editingResource || !STATE.currentUser) return;
                
                const resourceId = Resources.editingResource.id;
                
                const updatedData = {
                    title: document.getElementById('edit-resource-title').value.trim(),
                    description: document.getElementById('edit-resource-desc').value.trim(),
                    category: document.getElementById('edit-resource-category').value,
                    area: document.getElementById('edit-resource-area').value,
                    details: document.getElementById('edit-resource-details').value.trim(),
                    url: document.getElementById('edit-resource-url').value.trim(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                if (!updatedData.title || !updatedData.category || !updatedData.url) {
                    Util.notify('Por favor completa los campos requeridos', 'error');
                    return;
                }
                
                Util.loading(true, 'Guardando cambios...');
                
                try {
                    await db.collection('resources').doc(resourceId).update(updatedData);
                    Util.loading(false);
                    Modal.close('edit-resource');
                    Util.notify('Recurso actualizado correctamente', 'success');
                    Resources.editingResource = null;
                    Resources.load();
                } catch (err) {
                    console.error('Error actualizando recurso:', err);
                    Util.loading(false);
                    Util.notify('Error al actualizar el recurso', 'error');
                }
            },

            deleteResource: async () => {
                if (!Resources.editingResource || !STATE.currentUser) return;
                
                if (!confirm('¬øEst√°s seguro de eliminar este recurso? Esta acci√≥n no se puede deshacer.')) return;
                
                Util.loading(true, 'Eliminando recurso...');
                
                try {
                    await db.collection('resources').doc(Resources.editingResource.id).delete();
                    Util.loading(false);
                    Modal.close('edit-resource');
                    Util.notify('Recurso eliminado', 'success');
                    Resources.editingResource = null;
                    Resources.load();
                } catch (err) {
                    console.error('Error eliminando recurso:', err);
                    Util.loading(false);
                    Util.notify('Error al eliminar el recurso', 'error');
                }
            },

            filter: (category) => {
                Resources.currentFilter = category;
                
                // Actualizar botones de filtro
                document.querySelectorAll('.resource-filter').forEach(btn => {
                    if (btn.dataset.filter === category) {
                        btn.classList.remove('bg-slate-200', 'text-slate-600');
                        btn.classList.add('bg-tec-blue', 'text-white');
                    } else {
                        btn.classList.add('bg-slate-200', 'text-slate-600');
                        btn.classList.remove('bg-tec-blue', 'text-white');
                    }
                });

                Resources.render();
            },

            upload: async (e) => {
                e.preventDefault();
                if (!STATE.currentUser) {
                    Modal.close('resource-upload');
                    Modal.open('auth');
                    return;
                }

                const title = document.getElementById('resource-title').value.trim();
                const description = document.getElementById('resource-desc').value.trim();
                const category = document.getElementById('resource-category').value;
                const area = document.getElementById('resource-area').value;
                const details = document.getElementById('resource-details').value.trim();
                const url = document.getElementById('resource-url').value.trim();

                if (!title || !category || !area || !url) {
                    Util.notify('Por favor completa todos los campos requeridos', 'error');
                    return;
                }

                Util.loading(true, 'Publicando recurso...');

                try {
                    await db.collection('resources').add({
                        title,
                        description,
                        category,
                        area,
                        details,
                        url,
                        authorId: STATE.currentUser.uid,
                        authorName: STATE.currentUser.displayName || 'Miembro CRAI',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    Util.loading(false);
                    Modal.close('resource-upload');
                    Util.notify('Recurso publicado correctamente', 'success');
                    e.target.reset();
                    Resources.load();
                } catch (err) {
                    console.error('Error subiendo recurso:', err);
                    Util.loading(false);
                    Util.notify('Error al publicar el recurso: ' + err.message, 'error');
                }
            }
        };

        /**
         * ==========================================
         * 8. PROFILE HELPERS (Skills & Photo)
         * ==========================================
         */
        const Profile = {
            previewPhoto: (dataOrUrl) => {
                const preview = document.getElementById('profile-preview');
                if (preview && dataOrUrl) {
                    preview.src = dataOrUrl;
                    preview.onerror = () => {
                        preview.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(STATE.profile?.fullName || 'User')}&background=1B396A&color=D4AF37&bold=true`;
                    };
                }
            },

            handleFileSelect: (event) => {
                const file = event.target.files[0];
                if (file) Profile.processImageFile(file);
            },

            handleDragOver: (event) => {
                event.preventDefault();
                event.stopPropagation();
                const zone = document.getElementById('photo-drop-zone');
                zone.classList.add('border-tec-blue', 'bg-tec-blue/10');
                zone.classList.remove('border-slate-300');
            },

            handleDragLeave: (event) => {
                event.preventDefault();
                event.stopPropagation();
                const zone = document.getElementById('photo-drop-zone');
                zone.classList.remove('border-tec-blue', 'bg-tec-blue/10');
                zone.classList.add('border-slate-300');
            },

            handleDrop: (event) => {
                event.preventDefault();
                event.stopPropagation();
                const zone = document.getElementById('photo-drop-zone');
                zone.classList.remove('border-tec-blue', 'bg-tec-blue/10');
                zone.classList.add('border-slate-300');
                
                const file = event.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    Profile.processImageFile(file);
                } else {
                    Util.notify('Solo se permiten archivos de imagen', 'error');
                }
            },

            processImageFile: (file) => {
                // Validar tipo de archivo
                const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
                if (!validTypes.includes(file.type)) {
                    Util.notify('Formato no v√°lido. Usa JPG, PNG, GIF o WebP', 'error');
                    return;
                }

                // Validar tama√±o (1MB m√°ximo antes de comprimir)
                const maxSize = 1024 * 1024; // 1MB
                if (file.size > maxSize) {
                    Util.notify('La imagen es muy grande. M√°ximo 1MB', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const base64 = e.target.result;
                    
                    // Comprimir imagen
                    Profile.compressImage(base64, (compressedBase64) => {
                        // Guardar en campo oculto
                        document.getElementById('profile-photo').value = compressedBase64;
                        // Mostrar preview
                        Profile.previewPhoto(compressedBase64);
                        Util.notify('Imagen cargada correctamente', 'success');
                    });
                };
                reader.onerror = () => {
                    Util.notify('Error al leer la imagen', 'error');
                };
                reader.readAsDataURL(file);
            },

            compressImage: (base64, callback) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Tama√±o m√°ximo 150x150 para foto de perfil (optimizado para Firestore)
                    const maxDim = 150;
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > height) {
                        if (width > maxDim) {
                            height = Math.round((height * maxDim) / width);
                            width = maxDim;
                        }
                    } else {
                        if (height > maxDim) {
                            width = Math.round((width * maxDim) / height);
                            height = maxDim;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Convertir a JPEG con calidad 0.7 para reducir tama√±o (~10-20KB final)
                    const compressed = canvas.toDataURL('image/jpeg', 0.7);
                    
                    // Verificar que el resultado no sea muy grande
                    const sizeKB = Math.round((compressed.length * 3/4) / 1024);
                    console.log(`Imagen comprimida: ${width}x${height}, ~${sizeKB}KB`);
                    
                    callback(compressed);
                };
                img.src = base64;
            },

            addSkill: () => {
                const input = document.getElementById('profile-skill-input');
                if (!input) {
                    console.error('No se encontr√≥ el input de skills del perfil');
                    return;
                }
                const skill = input.value.trim();
                
                // Asegurar que profileSkills sea un array
                if (!Array.isArray(STATE.profileSkills)) {
                    STATE.profileSkills = STATE.profile?.skills || [];
                }
                
                if (skill && !STATE.profileSkills.includes(skill)) {
                    if (STATE.profileSkills.length >= 20) {
                        Util.notify('M√°ximo 20 habilidades permitidas', 'warning');
                        return;
                    }
                    STATE.profileSkills.push(skill);
                    Profile.renderSkills();
                    input.value = '';
                    input.focus();
                    Util.notify('Skill agregada: ' + skill, 'success');
                } else if (STATE.profileSkills.includes(skill)) {
                    Util.notify('Esta skill ya existe', 'warning');
                }
            },

            addSkillOnEnter: (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    Profile.addSkill();
                }
            },

            removeSkill: (skill) => {
                if (!Array.isArray(STATE.profileSkills)) {
                    STATE.profileSkills = [];
                }
                STATE.profileSkills = STATE.profileSkills.filter(s => s !== skill);
                Profile.renderSkills();
                Util.notify('Skill eliminada', 'info');
            },

            renderSkills: () => {
                const container = document.getElementById('profile-skills-container');
                if (!container) {
                    console.log('Container de skills del perfil no encontrado');
                    return;
                }
                
                // Asegurar que profileSkills sea un array
                if (!Array.isArray(STATE.profileSkills)) {
                    STATE.profileSkills = STATE.profile?.skills || [];
                }
                
                console.log('Renderizando skills:', STATE.profileSkills);
                
                if (STATE.profileSkills.length === 0) {
                    container.innerHTML = '<p class="text-xs text-slate-400 w-full text-center py-1">Agrega tus habilidades y tecnolog√≠as</p>';
                    return;
                }
                
                container.innerHTML = STATE.profileSkills.map(s => {
                    // Escapar el skill para evitar problemas con comillas
                    const escapedSkill = Util.escapeHtml(s).replace(/'/g, "\\'");
                    return `
                    <span class="inline-flex items-center gap-1 bg-tec-blue/10 text-tec-blue px-2 py-1 rounded-full text-xs font-bold group">
                        ${Util.escapeHtml(s)}
                        <button type="button" onclick="Profile.removeSkill('${escapedSkill}')" class="hover:text-red-500 transition opacity-50 group-hover:opacity-100" title="Eliminar">
                            <i data-lucide="x" class="w-3 h-3"></i>
                        </button>
                    </span>`;
                }).join('');
                lucide.createIcons();
            },

            loadFromState: () => {
                if (!STATE.profile) return;
                const p = STATE.profile;
                
                const setVal = (id, val) => { const el = document.getElementById(id); if (el && val) el.value = val; };
                
                setVal('profile-name', p.fullName);
                setVal('profile-title', p.customTitle); // T√≠tulo personalizado (campo oculto)
                setVal('profile-photo', p.photoURL); // Ahora guarda Base64 o URL
                setVal('profile-control', p.controlNumber);
                setVal('profile-semester', p.semester);
                setVal('profile-career', p.career);
                setVal('profile-bio', p.bio);
                setVal('profile-github', p.github);
                setVal('profile-linkedin', p.linkedin);
                
                // Mostrar el t√≠tulo personalizado en el campo de solo lectura
                const titleTextEl = document.getElementById('profile-title-text');
                if (titleTextEl) {
                    if (p.customTitle && p.customTitle.trim()) {
                        titleTextEl.textContent = p.customTitle;
                        titleTextEl.classList.remove('text-slate-400');
                        titleTextEl.classList.add('text-tec-blue', 'font-bold');
                    } else {
                        titleTextEl.textContent = 'Sin t√≠tulo asignado';
                        titleTextEl.classList.add('text-slate-400');
                        titleTextEl.classList.remove('text-tec-blue', 'font-bold');
                    }
                }
                
                // Preview photo (funciona con Base64 y URLs)
                if (p.photoURL) {
                    Profile.previewPhoto(p.photoURL);
                }
                
                // Area radio
                if (p.area) {
                    const radio = document.querySelector(`input[name="profile-area"][value="${p.area}"]`);
                    if (radio) radio.checked = true;
                }
                
                // Skills - cargar desde el perfil
                const skillsFromProfile = p.skills || [];
                console.log('Skills cargadas del perfil:', skillsFromProfile);
                STATE.profileSkills = Array.isArray(skillsFromProfile) ? [...skillsFromProfile] : [];
                
                // Renderizar skills despu√©s de un peque√±o delay para asegurar que el DOM est√© listo
                setTimeout(() => {
                    Profile.renderSkills();
                    lucide.createIcons();
                }, 100);
            }
        };

        /**
         * ==========================================
         * SISTEMA DE RESERVACIONES
         * ==========================================
         */
        const Reservations = {
            currentDate: new Date(),
            currentMonth: new Date().getMonth(),
            currentYear: new Date().getFullYear(),
            
            equipment: [
                { id: 'impresora-3d-1', name: 'Impresora 3D #1 (Ender 3)', icon: 'printer', color: 'blue', available: true },
                { id: 'impresora-3d-2', name: 'Impresora 3D #2 (Prusa)', icon: 'printer', color: 'blue', available: true },
                { id: 'cnc-router', name: 'CNC Router', icon: 'cog', color: 'slate', available: true },
                { id: 'laser-cutter', name: 'Cortadora L√°ser', icon: 'scissors', color: 'red', available: false },
                { id: 'soldadura', name: 'Estaci√≥n de Soldadura', icon: 'flame', color: 'orange', available: true },
                { id: 'osciloscopio', name: 'Osciloscopio', icon: 'activity', color: 'green', available: true },
                { id: 'fuente-poder', name: 'Fuente de Poder Variable', icon: 'zap', color: 'yellow', available: true },
                { id: 'multimetro-pro', name: 'Mult√≠metro Profesional', icon: 'gauge', color: 'purple', available: true },
                { id: 'dremel', name: 'Dremel / Rotativa', icon: 'disc', color: 'slate', available: true },
                { id: 'mesa-trabajo-1', name: 'Mesa de Trabajo #1', icon: 'square', color: 'teal', available: true },
                { id: 'mesa-trabajo-2', name: 'Mesa de Trabajo #2', icon: 'square', color: 'teal', available: true },
                { id: 'area-pruebas', name: '√Årea de Pruebas Robot', icon: 'bot', color: 'indigo', available: true }
            ],
            
            init: () => {
                Reservations.renderCalendar();
                Reservations.loadTodayReservations();
                Reservations.loadEquipment();
                Reservations.loadMyReservations();
                
                // Set fecha m√≠nima a hoy
                const dateInput = document.getElementById('res-date');
                if (dateInput) {
                    const today = new Date().toISOString().split('T')[0];
                    dateInput.min = today;
                    dateInput.value = today;
                }
            },
            
            setTab: (tab) => {
                document.querySelectorAll('.reservation-tab').forEach(t => {
                    t.classList.toggle('active', t.dataset.tab === tab);
                });
                document.querySelectorAll('.reservation-tab-content').forEach(c => c.classList.add('hidden'));
                document.getElementById(`tab-${tab}`)?.classList.remove('hidden');
                lucide.createIcons();
            },
            
            renderCalendar: () => {
                const grid = document.getElementById('calendar-grid');
                const monthYear = document.getElementById('calendar-month-year');
                if (!grid) return;
                
                const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
                monthYear.textContent = `${months[Reservations.currentMonth]} ${Reservations.currentYear}`;
                
                const firstDay = new Date(Reservations.currentYear, Reservations.currentMonth, 1).getDay();
                const daysInMonth = new Date(Reservations.currentYear, Reservations.currentMonth + 1, 0).getDate();
                const today = new Date();
                
                let html = '';
                
                // D√≠as vac√≠os antes del primer d√≠a
                for (let i = 0; i < firstDay; i++) {
                    html += '<div class="p-2"></div>';
                }
                
                // D√≠as del mes
                for (let day = 1; day <= daysInMonth; day++) {
                    const isToday = day === today.getDate() && Reservations.currentMonth === today.getMonth() && Reservations.currentYear === today.getFullYear();
                    const isPast = new Date(Reservations.currentYear, Reservations.currentMonth, day) < new Date(today.getFullYear(), today.getMonth(), today.getDate());
                    
                    html += `
                        <button onclick="Reservations.selectDate(${day})" 
                            class="p-2 text-center rounded-lg text-sm font-medium transition-all
                            ${isToday ? 'bg-blue-600 text-white' : isPast ? 'text-slate-300 cursor-not-allowed' : 'hover:bg-blue-50 text-slate-700'}"
                            ${isPast ? 'disabled' : ''}>
                            ${day}
                        </button>
                    `;
                }
                
                grid.innerHTML = html;
            },
            
            prevMonth: () => {
                Reservations.currentMonth--;
                if (Reservations.currentMonth < 0) {
                    Reservations.currentMonth = 11;
                    Reservations.currentYear--;
                }
                Reservations.renderCalendar();
            },
            
            nextMonth: () => {
                Reservations.currentMonth++;
                if (Reservations.currentMonth > 11) {
                    Reservations.currentMonth = 0;
                    Reservations.currentYear++;
                }
                Reservations.renderCalendar();
            },
            
            selectDate: (day) => {
                const dateStr = `${Reservations.currentYear}-${String(Reservations.currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                document.getElementById('res-date').value = dateStr;
            },
            
            create: async (e) => {
                e.preventDefault();
                
                if (!STATE.currentUser) {
                    Util.notify('Inicia sesi√≥n para hacer reservaciones', 'warning');
                    Modal.open('auth');
                    return;
                }
                
                const data = {
                    date: document.getElementById('res-date').value,
                    startTime: document.getElementById('res-start').value,
                    endTime: document.getElementById('res-end').value,
                    equipment: document.getElementById('res-equipment').value,
                    purpose: document.getElementById('res-purpose').value,
                    userId: STATE.currentUser.uid,
                    userName: STATE.currentUser.displayName || STATE.currentUser.email,
                    status: 'confirmed',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                if (!data.date || !data.startTime || !data.endTime || !data.equipment) {
                    Util.notify('Completa todos los campos requeridos', 'error');
                    return;
                }
                
                if (data.startTime >= data.endTime) {
                    Util.notify('La hora de fin debe ser posterior a la de inicio', 'error');
                    return;
                }
                
                try {
                    Util.loading(true, 'Creando reservaci√≥n...');
                    await db.collection('reservations').add(data);
                    Util.loading(false);
                    Util.notify('¬°Reservaci√≥n creada exitosamente!', 'success');
                    document.getElementById('reservation-form').reset();
                    Reservations.loadTodayReservations();
                    Reservations.loadMyReservations();
                } catch (e) {
                    console.error(e);
                    Util.loading(false);
                    Util.notify('Error al crear reservaci√≥n', 'error');
                }
            },
            
            loadTodayReservations: async () => {
                const container = document.getElementById('today-reservations');
                if (!container) return;
                
                const today = new Date().toISOString().split('T')[0];
                
                try {
                    const snap = await db.collection('reservations')
                        .where('date', '==', today)
                        .orderBy('startTime')
                        .get();
                    
                    if (snap.empty) {
                        container.innerHTML = '<p class="col-span-full text-slate-400 text-sm text-center py-8">No hay reservas para hoy</p>';
                        return;
                    }
                    
                    let html = '';
                    snap.forEach(doc => {
                        const r = doc.data();
                        const equip = Reservations.equipment.find(e => e.id === r.equipment);
                        html += `
                            <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="${equip?.icon || 'box'}" class="w-5 h-5 text-blue-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-bold text-sm text-tec-dark">${equip?.name || r.equipment}</p>
                                        <p class="text-xs text-slate-400">${r.startTime} - ${r.endTime}</p>
                                    </div>
                                </div>
                                <p class="text-xs text-slate-500">${r.purpose}</p>
                                <p class="text-[10px] text-slate-400 mt-2">Por: ${r.userName}</p>
                            </div>
                        `;
                    });
                    container.innerHTML = html;
                    lucide.createIcons();
                } catch (e) {
                    console.error(e);
                }
            },
            
            loadMyReservations: async () => {
                const container = document.getElementById('my-reservations-list');
                if (!container || !STATE.currentUser) {
                    if (container) container.innerHTML = '<p class="text-slate-400 text-sm text-center py-12">Inicia sesi√≥n para ver tus reservaciones</p>';
                    return;
                }
                
                try {
                    const snap = await db.collection('reservations')
                        .where('userId', '==', STATE.currentUser.uid)
                        .orderBy('date', 'desc')
                        .limit(20)
                        .get();
                    
                    if (snap.empty) {
                        container.innerHTML = '<p class="text-slate-400 text-sm text-center py-12">No tienes reservaciones</p>';
                        return;
                    }
                    
                    let html = '';
                    snap.forEach(doc => {
                        const r = doc.data();
                        const equip = Reservations.equipment.find(e => e.id === r.equipment);
                        const isPast = new Date(r.date) < new Date(new Date().toISOString().split('T')[0]);
                        
                        html += `
                            <div class="flex items-center justify-between p-4 hover:bg-slate-50 transition">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                                        <i data-lucide="${equip?.icon || 'box'}" class="w-6 h-6 text-blue-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-bold text-tec-dark">${equip?.name || r.equipment}</p>
                                        <p class="text-xs text-slate-400">${r.date} ‚Ä¢ ${r.startTime} - ${r.endTime}</p>
                                        <p class="text-xs text-slate-500 mt-1">${r.purpose}</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="px-2 py-1 rounded-full text-[10px] font-bold ${isPast ? 'bg-slate-100 text-slate-400' : 'bg-green-100 text-green-600'}">
                                        ${isPast ? 'Completada' : 'Activa'}
                                    </span>
                                    ${!isPast ? `<button onclick="Reservations.cancel('${doc.id}')" class="p-2 text-red-400 hover:bg-red-50 rounded-lg transition"><i data-lucide="trash-2" class="w-4 h-4"></i></button>` : ''}
                                </div>
                            </div>
                        `;
                    });
                    container.innerHTML = html;
                    lucide.createIcons();
                } catch (e) {
                    console.error(e);
                }
            },
            
            cancel: async (id) => {
                if (!confirm('¬øCancelar esta reservaci√≥n?')) return;
                try {
                    await db.collection('reservations').doc(id).delete();
                    Util.notify('Reservaci√≥n cancelada', 'success');
                    Reservations.loadMyReservations();
                    Reservations.loadTodayReservations();
                } catch (e) {
                    Util.notify('Error al cancelar', 'error');
                }
            },
            
            loadEquipment: () => {
                const grid = document.getElementById('equipment-grid');
                if (!grid) return;
                
                let html = '';
                Reservations.equipment.forEach(equip => {
                    html += `
                        <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 hover:shadow-lg transition-all">
                            <div class="flex items-start justify-between mb-4">
                                <div class="w-14 h-14 bg-${equip.color}-100 rounded-xl flex items-center justify-center">
                                    <i data-lucide="${equip.icon}" class="w-7 h-7 text-${equip.color}-600"></i>
                                </div>
                                <span class="px-2 py-1 rounded-full text-[10px] font-bold ${equip.available ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}">
                                    ${equip.available ? 'Disponible' : 'En uso'}
                                </span>
                            </div>
                            <h4 class="font-bold text-tec-dark mb-2">${equip.name}</h4>
                            <button onclick="document.getElementById('res-equipment').value='${equip.id}'; Reservations.setTab('calendar')" 
                                class="w-full mt-4 py-2 bg-blue-50 text-blue-600 rounded-lg text-xs font-bold hover:bg-blue-100 transition ${!equip.available ? 'opacity-50 cursor-not-allowed' : ''}"
                                ${!equip.available ? 'disabled' : ''}>
                                Reservar
                            </button>
                        </div>
                    `;
                });
                grid.innerHTML = html;
                lucide.createIcons();
            }
        };

        /**
         * ==========================================
         * SISTEMA DE INVENTARIO
         * ==========================================
         */
        const Inventory = {
            items: [],
            filteredItems: [],
            currentFilter: 'all',
            
            load: async () => {
                try {
                    const snap = await db.collection('inventory').orderBy('name').get();
                    
                    Inventory.items = [];
                    snap.forEach(doc => {
                        Inventory.items.push({ id: doc.id, ...doc.data() });
                    });
                    
                    Inventory.updateStats();
                    Inventory.filter('all');
                    
                    // Mostrar bot√≥n admin si es usuario
                    if (STATE.currentUser) {
                        document.getElementById('inv-admin-btn')?.classList.remove('hidden');
                    }
                } catch (e) {
                    console.error(e);
                }
            },
            
            updateStats: () => {
                const items = Inventory.items;
                document.getElementById('inv-total-items').textContent = items.length;
                document.getElementById('inv-electronics').textContent = items.filter(i => i.category === 'electronico').length;
                document.getElementById('inv-low-stock').textContent = items.filter(i => i.quantity <= (i.minStock || 5)).length;
                
                const categories = new Set(items.map(i => i.category));
                document.getElementById('inv-categories').textContent = categories.size;
            },
            
            filter: (category) => {
                Inventory.currentFilter = category;
                
                // Actualizar botones
                document.querySelectorAll('.inv-filter').forEach(btn => {
                    const isActive = btn.dataset.filter === category;
                    btn.classList.toggle('bg-green-600', isActive);
                    btn.classList.toggle('text-white', isActive);
                    btn.classList.toggle('bg-slate-100', !isActive);
                    btn.classList.toggle('text-slate-600', !isActive);
                });
                
                Inventory.filteredItems = category === 'all' 
                    ? Inventory.items 
                    : Inventory.items.filter(i => i.category === category);
                
                Inventory.render();
            },
            
            search: (term) => {
                const searchTerm = term.toLowerCase();
                Inventory.filteredItems = Inventory.items.filter(i => 
                    i.name.toLowerCase().includes(searchTerm) ||
                    (i.description && i.description.toLowerCase().includes(searchTerm)) ||
                    (i.location && i.location.toLowerCase().includes(searchTerm))
                );
                Inventory.render();
            },
            
            render: () => {
                const tbody = document.getElementById('inventory-table');
                if (!tbody) return;
                
                if (Inventory.filteredItems.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-12 text-center text-slate-400">No se encontraron items</td></tr>';
                    return;
                }
                
                const categoryIcons = {
                    'electronico': { icon: 'cpu', color: 'blue' },
                    'mecanico': { icon: 'cog', color: 'slate' },
                    'herramienta': { icon: 'wrench', color: 'orange' },
                    'material': { icon: 'box', color: 'green' },
                    'consumible': { icon: 'package', color: 'purple' }
                };
                
                let html = '';
                Inventory.filteredItems.forEach(item => {
                    const cat = categoryIcons[item.category] || { icon: 'box', color: 'slate' };
                    const isLowStock = item.quantity <= (item.minStock || 5);
                    
                    html += `
                        <tr class="hover:bg-slate-50 transition">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-${cat.color}-100 rounded-lg flex items-center justify-center">
                                        <i data-lucide="${cat.icon}" class="w-5 h-5 text-${cat.color}-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-bold text-tec-dark">${item.name}</p>
                                        ${item.description ? `<p class="text-xs text-slate-400 truncate max-w-[200px]">${item.description}</p>` : ''}
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="px-2 py-1 bg-${cat.color}-50 text-${cat.color}-600 rounded-full text-[10px] font-bold uppercase">${item.category}</span>
                            </td>
                            <td class="px-6 py-4 text-center">
                                <span class="font-bold ${isLowStock ? 'text-red-600' : 'text-tec-dark'}">${item.quantity}</span>
                                ${isLowStock ? '<i data-lucide="alert-triangle" class="w-3 h-3 text-red-500 inline ml-1"></i>' : ''}
                            </td>
                            <td class="px-6 py-4 text-sm text-slate-500">${item.location || '-'}</td>
                            <td class="px-6 py-4 text-center">
                                <span class="px-2 py-1 rounded-full text-[10px] font-bold ${item.quantity > 0 ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}">
                                    ${item.quantity > 0 ? 'Disponible' : 'Agotado'}
                                </span>
                            </td>
                            <td class="px-6 py-4 text-right">
                                <div class="flex items-center justify-end gap-1">
                                    <button onclick="Inventory.adjustStock('${item.id}', -1)" class="p-1 hover:bg-slate-100 rounded text-slate-400 hover:text-red-600 transition">
                                        <i data-lucide="minus" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="Inventory.adjustStock('${item.id}', 1)" class="p-1 hover:bg-slate-100 rounded text-slate-400 hover:text-green-600 transition">
                                        <i data-lucide="plus" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="Inventory.delete('${item.id}')" class="p-1 hover:bg-red-50 rounded text-slate-400 hover:text-red-600 transition ml-2">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                tbody.innerHTML = html;
                lucide.createIcons();
            },
            
            add: async (e) => {
                e.preventDefault();
                
                if (!STATE.currentUser) {
                    Util.notify('Inicia sesi√≥n para agregar items', 'warning');
                    return;
                }
                
                const data = {
                    name: document.getElementById('inv-name').value,
                    category: document.getElementById('inv-category').value,
                    quantity: parseInt(document.getElementById('inv-quantity').value) || 0,
                    minStock: parseInt(document.getElementById('inv-min-stock').value) || 5,
                    location: document.getElementById('inv-location').value,
                    description: document.getElementById('inv-description').value,
                    addedBy: STATE.currentUser.uid,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                try {
                    Util.loading(true, 'Agregando item...');
                    await db.collection('inventory').add(data);
                    Util.loading(false);
                    Modal.close('add-inventory');
                    Util.notify('Item agregado al inventario', 'success');
                    Inventory.load();
                } catch (e) {
                    console.error(e);
                    Util.loading(false);
                    Util.notify('Error al agregar item', 'error');
                }
            },
            
            adjustStock: async (id, delta) => {
                try {
                    const item = Inventory.items.find(i => i.id === id);
                    if (!item) return;
                    
                    const newQty = Math.max(0, item.quantity + delta);
                    await db.collection('inventory').doc(id).update({ quantity: newQty });
                    
                    item.quantity = newQty;
                    Inventory.updateStats();
                    Inventory.render();
                } catch (e) {
                    Util.notify('Error al actualizar stock', 'error');
                }
            },
            
            delete: async (id) => {
                if (!confirm('¬øEliminar este item del inventario?')) return;
                try {
                    await db.collection('inventory').doc(id).delete();
                    Util.notify('Item eliminado', 'success');
                    Inventory.load();
                } catch (e) {
                    Util.notify('Error al eliminar', 'error');
                }
            }
        };

        /**
         * ==========================================
         * WIKI T√âCNICA
         * ==========================================
         */
        const Wiki = {
            articles: [],
            filteredArticles: [],
            currentCategory: 'all',
            
            load: async () => {
                try {
                    const snap = await db.collection('wiki').orderBy('createdAt', 'desc').get();
                    
                    Wiki.articles = [];
                    snap.forEach(doc => {
                        Wiki.articles.push({ id: doc.id, ...doc.data() });
                    });
                    
                    Wiki.updateCounts();
                    Wiki.filterCategory('all');
                    
                    // Mostrar bot√≥n crear si est√° logueado
                    if (STATE.currentUser) {
                        document.getElementById('wiki-add-btn')?.classList.remove('hidden');
                    }
                } catch (e) {
                    console.error(e);
                }
            },
            
            updateCounts: () => {
                const counts = {
                    arduino: Wiki.articles.filter(a => a.category === 'arduino').length,
                    electronica: Wiki.articles.filter(a => a.category === 'electronica').length,
                    mecanica: Wiki.articles.filter(a => a.category === 'mecanica').length,
                    programacion: Wiki.articles.filter(a => a.category === 'programacion').length
                };
                
                Object.keys(counts).forEach(cat => {
                    const el = document.getElementById(`wiki-count-${cat}`);
                    if (el) el.textContent = `${counts[cat]} art√≠culos`;
                });
            },
            
            filterCategory: (category) => {
                Wiki.currentCategory = category;
                
                const filterLabel = document.getElementById('wiki-active-filter');
                const clearBtn = document.getElementById('wiki-clear-filter');
                
                const categoryNames = {
                    'all': 'Todos los art√≠culos',
                    'arduino': 'Arduino & Microcontroladores',
                    'electronica': 'Electr√≥nica',
                    'mecanica': 'Mec√°nica & CAD',
                    'programacion': 'Programaci√≥n & IA'
                };
                
                if (filterLabel) filterLabel.textContent = categoryNames[category] || 'Todos';
                if (clearBtn) clearBtn.classList.toggle('hidden', category === 'all');
                
                Wiki.filteredArticles = category === 'all'
                    ? Wiki.articles
                    : Wiki.articles.filter(a => a.category === category);
                
                Wiki.render();
            },
            
            search: (term) => {
                const searchTerm = term.toLowerCase();
                Wiki.filteredArticles = Wiki.articles.filter(a =>
                    a.title.toLowerCase().includes(searchTerm) ||
                    (a.summary && a.summary.toLowerCase().includes(searchTerm)) ||
                    (a.tags && a.tags.some(t => t.toLowerCase().includes(searchTerm)))
                );
                Wiki.render();
            },
            
            render: () => {
                const container = document.getElementById('wiki-articles');
                if (!container) return;
                
                if (Wiki.filteredArticles.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-16">
                            <i data-lucide="search-x" class="w-16 h-16 text-slate-300 mx-auto mb-4"></i>
                            <p class="text-slate-400">No se encontraron art√≠culos</p>
                        </div>
                    `;
                    lucide.createIcons();
                    return;
                }
                
                const categoryColors = {
                    'arduino': { bg: 'bg-blue-500', light: 'bg-blue-50', text: 'text-blue-600' },
                    'electronica': { bg: 'bg-green-500', light: 'bg-green-50', text: 'text-green-600' },
                    'mecanica': { bg: 'bg-orange-500', light: 'bg-orange-50', text: 'text-orange-600' },
                    'programacion': { bg: 'bg-purple-500', light: 'bg-purple-50', text: 'text-purple-600' }
                };
                
                const difficultyBadges = {
                    'basico': { color: 'green', label: 'B√°sico' },
                    'intermedio': { color: 'yellow', label: 'Intermedio' },
                    'avanzado': { color: 'red', label: 'Avanzado' }
                };
                
                let html = '';
                Wiki.filteredArticles.forEach(article => {
                    const cat = categoryColors[article.category] || categoryColors.arduino;
                    const diff = difficultyBadges[article.difficulty] || difficultyBadges.basico;
                    const dateStr = article.createdAt ? new Date(article.createdAt.seconds * 1000).toLocaleDateString('es-MX') : '';
                    
                    html += `
                        <article class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden hover:shadow-lg transition-all cursor-pointer group" onclick="Wiki.view('${article.id}')">
                            <div class="h-2 ${cat.bg}"></div>
                            <div class="p-6">
                                <div class="flex items-center gap-2 mb-3">
                                    <span class="px-2 py-1 ${cat.light} ${cat.text} rounded-full text-[10px] font-bold uppercase">${article.category}</span>
                                    <span class="px-2 py-1 bg-${diff.color}-50 text-${diff.color}-600 rounded-full text-[10px] font-bold">${diff.label}</span>
                                </div>
                                <h3 class="font-bold text-lg text-tec-dark mb-2 group-hover:text-purple-600 transition line-clamp-2">${article.title}</h3>
                                <p class="text-sm text-slate-500 line-clamp-2 mb-4">${article.summary || ''}</p>
                                <div class="flex items-center justify-between text-xs text-slate-400">
                                    <span class="flex items-center gap-1">
                                        <i data-lucide="user" class="w-3 h-3"></i> ${article.authorName || 'An√≥nimo'}
                                    </span>
                                    <span>${dateStr}</span>
                                </div>
                                ${article.tags && article.tags.length > 0 ? `
                                <div class="flex flex-wrap gap-1 mt-3 pt-3 border-t border-slate-100">
                                    ${article.tags.slice(0, 3).map(tag => `<span class="px-2 py-0.5 bg-slate-100 text-slate-500 rounded text-[10px]">#${tag}</span>`).join('')}
                                </div>` : ''}
                            </div>
                        </article>
                    `;
                });
                container.innerHTML = html;
                lucide.createIcons();
            },
            
            create: async (e) => {
                e.preventDefault();
                
                if (!STATE.currentUser) {
                    Util.notify('Inicia sesi√≥n para crear art√≠culos', 'warning');
                    return;
                }
                
                const tagsInput = document.getElementById('wiki-tags').value;
                const tags = tagsInput ? tagsInput.split(',').map(t => t.trim().toLowerCase()).filter(t => t) : [];
                
                const data = {
                    title: document.getElementById('wiki-title').value,
                    category: document.getElementById('wiki-category').value,
                    difficulty: document.getElementById('wiki-difficulty').value,
                    summary: document.getElementById('wiki-summary').value,
                    content: document.getElementById('wiki-content').value,
                    tags: tags,
                    authorId: STATE.currentUser.uid,
                    authorName: STATE.currentUser.displayName || STATE.currentUser.email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                try {
                    Util.loading(true, 'Publicando art√≠culo...');
                    await db.collection('wiki').add(data);
                    Util.loading(false);
                    Modal.close('add-wiki');
                    Util.notify('Art√≠culo publicado exitosamente', 'success');
                    Wiki.load();
                    
                    // Verificar logros autom√°ticos despu√©s de publicar art√≠culo wiki
                    Achievements.checkAutoAchievements(STATE.currentUser.uid);
                } catch (e) {
                    console.error(e);
                    Util.loading(false);
                    Util.notify('Error al publicar art√≠culo', 'error');
                }
            },
            
            view: (id) => {
                const article = Wiki.articles.find(a => a.id === id);
                if (!article) return;
                
                const categoryNames = {
                    'arduino': 'Arduino & Microcontroladores',
                    'electronica': 'Electr√≥nica',
                    'mecanica': 'Mec√°nica & CAD',
                    'programacion': 'Programaci√≥n & IA'
                };
                
                const diffLabels = {
                    'basico': 'üü¢ B√°sico',
                    'intermedio': 'üü° Intermedio',
                    'avanzado': 'üî¥ Avanzado'
                };
                
                document.getElementById('view-wiki-category').textContent = categoryNames[article.category] || article.category;
                document.getElementById('view-wiki-title').textContent = article.title;
                document.getElementById('view-wiki-author').innerHTML = `<i data-lucide="user" class="w-4 h-4"></i> ${article.authorName || 'An√≥nimo'}`;
                document.getElementById('view-wiki-date').innerHTML = `<i data-lucide="calendar" class="w-4 h-4"></i> ${article.createdAt ? new Date(article.createdAt.seconds * 1000).toLocaleDateString('es-MX') : '-'}`;
                document.getElementById('view-wiki-difficulty').innerHTML = `<i data-lucide="signal" class="w-4 h-4"></i> ${diffLabels[article.difficulty] || 'B√°sico'}`;
                
                // Renderizar Markdown simple
                let content = article.content || '';
                content = content
                    .replace(/^### (.*$)/gim, '<h3 class="text-lg font-bold mt-6 mb-2">$1</h3>')
                    .replace(/^## (.*$)/gim, '<h2 class="text-xl font-bold mt-8 mb-3 text-tec-dark">$1</h2>')
                    .replace(/^# (.*$)/gim, '<h1 class="text-2xl font-bold mt-8 mb-4 text-tec-dark">$1</h1>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/```([\s\S]*?)```/g, '<pre class="bg-slate-900 text-green-400 p-4 rounded-lg overflow-x-auto text-sm my-4"><code>$1</code></pre>')
                    .replace(/`(.*?)`/g, '<code class="bg-slate-100 px-1 rounded text-sm">$1</code>')
                    .replace(/^\- (.*$)/gim, '<li class="ml-4">$1</li>')
                    .replace(/^\d+\. (.*$)/gim, '<li class="ml-4 list-decimal">$1</li>')
                    .replace(/\n/g, '<br>');
                
                document.getElementById('view-wiki-content').innerHTML = content;
                
                // Tags
                const tagsContainer = document.getElementById('view-wiki-tags');
                if (article.tags && article.tags.length > 0) {
                    tagsContainer.innerHTML = `<div class="flex flex-wrap gap-2">${article.tags.map(t => `<span class="px-3 py-1 bg-purple-50 text-purple-600 rounded-full text-xs font-bold">#${t}</span>`).join('')}</div>`;
                } else {
                    tagsContainer.innerHTML = '';
                }
                
                Modal.open('view-wiki');
                lucide.createIcons();
            }
        };

        /**
         * ==========================================
         * SISTEMA DE COMPETENCIAS (MEJORADO)
         * ==========================================
         */
        const Competitions = {
            events: [],
            eventRegistrations: {}, // Almacena los inscritos por evento
            projectsCache: {}, // Cache de proyectos para mostrar en competencias
            
            load: async () => {
                try {
                    const snap = await db.collection('competitions').orderBy('dateStart', 'asc').get();
                    
                    Competitions.events = [];
                    snap.forEach(doc => {
                        Competitions.events.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // Cargar proyectos para cache
                    Competitions.projectsCache = {};
                    const projectsSnap = await db.collection('projects').get();
                    projectsSnap.forEach(doc => {
                        Competitions.projectsCache[doc.id] = { id: doc.id, ...doc.data() };
                    });
                    
                    // Cargar inscritos para cada evento
                    await Competitions.loadRegistrationsForEvents();
                    
                    Competitions.updateStats();
                    Competitions.renderUpcoming();
                    Competitions.renderPast();
                    Competitions.loadMyRegistrations();
                    
                    // Mostrar bot√≥n admin si est√° logueado
                    if (STATE.currentUser) {
                        document.getElementById('comp-admin-btn')?.classList.remove('hidden');
                    }
                } catch (e) {
                    console.error(e);
                }
            },
            
            // Cargar todos los inscritos para todos los eventos
            loadRegistrationsForEvents: async () => {
                try {
                    const snap = await db.collection('competition_registrations')
                        .where('status', '==', 'confirmed')
                        .get();
                    
                    Competitions.eventRegistrations = {};
                    
                    for (const doc of snap.docs) {
                        const reg = doc.data();
                        if (!Competitions.eventRegistrations[reg.competitionId]) {
                            Competitions.eventRegistrations[reg.competitionId] = [];
                        }
                        
                        // Obtener info del usuario
                        let userInfo = { 
                            id: reg.userId,
                            name: reg.userName, 
                            photo: null 
                        };
                        try {
                            const userDoc = await db.collection('users').doc(reg.userId).get();
                            if (userDoc.exists) {
                                const userData = userDoc.data();
                                userInfo.name = userData.fullName || reg.userName;
                                userInfo.photo = userData.photoURL;
                                userInfo.area = userData.area;
                            }
                        } catch (e) {}
                        
                        Competitions.eventRegistrations[reg.competitionId].push(userInfo);
                    }
                } catch (e) {
                    console.error('Error cargando inscripciones:', e);
                }
            },
            
            // Renderizar los avatares de inscritos
            renderRegisteredAvatars: (eventId, maxShow = 5) => {
                const registrations = Competitions.eventRegistrations[eventId] || [];
                if (registrations.length === 0) {
                    return `<p class="text-xs text-slate-400">Nadie inscrito a√∫n</p>`;
                }
                
                const toShow = registrations.slice(0, maxShow);
                const remaining = registrations.length - maxShow;
                
                let html = `<div class="flex items-center">
                    <div class="flex -space-x-2">`;
                
                toShow.forEach(user => {
                    const initials = user.name.split(' ').map(n => n[0]).slice(0,2).join('').toUpperCase();
                    const photo = user.photo || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=1B396A&color=D4AF37&size=32`;
                    html += `
                        <img src="${photo}" 
                             alt="${user.name}" 
                             title="${user.name}"
                             class="w-8 h-8 rounded-full border-2 border-white object-cover"
                             onerror="this.src='https://ui-avatars.com/api/?name=${initials}&background=1B396A&color=D4AF37&size=32'">
                    `;
                });
                
                if (remaining > 0) {
                    html += `
                        <div class="w-8 h-8 rounded-full border-2 border-white bg-slate-200 flex items-center justify-center">
                            <span class="text-[10px] font-bold text-slate-600">+${remaining}</span>
                        </div>
                    `;
                }
                
                html += `</div>
                    <span class="ml-2 text-xs text-slate-500 font-medium">${registrations.length} inscrito${registrations.length !== 1 ? 's' : ''}</span>
                </div>`;
                
                return html;
            },
            
            updateStats: async () => {
                const today = new Date();
                const upcoming = Competitions.events.filter(e => new Date(e.dateStart) >= today);
                const total = Competitions.events.length;
                
                document.getElementById('comp-upcoming').textContent = upcoming.length;
                document.getElementById('comp-total').textContent = total;
                
                // Contar inscritos totales
                try {
                    const confirmedSnap = await db.collection('competition_registrations')
                        .where('status', '==', 'confirmed').get();
                    
                    document.getElementById('comp-registered').textContent = confirmedSnap.size;
                    document.getElementById('comp-pending').textContent = '0';
                } catch (e) {
                    console.error(e);
                }
            },
            
            setTab: (tab) => {
                document.querySelectorAll('.comp-tab').forEach(t => {
                    t.classList.toggle('active', t.dataset.tab === tab);
                });
                document.querySelectorAll('.comp-tab-content').forEach(c => c.classList.add('hidden'));
                document.getElementById(`tab-${tab}`)?.classList.remove('hidden');
            },
            
            // Verificar si el usuario est√° inscrito en un evento
            isUserRegistered: (eventId) => {
                if (!STATE.currentUser) return false;
                const registrations = Competitions.eventRegistrations[eventId] || [];
                return registrations.some(r => r.id === STATE.currentUser.uid);
            },
            
            // Verificar si el usuario es el creador del evento
            isEventCreator: (event) => {
                if (!STATE.currentUser) return false;
                return event.createdBy === STATE.currentUser.uid;
            },
            
            renderUpcoming: () => {
                const container = document.getElementById('upcoming-competitions');
                if (!container) return;
                
                const today = new Date();
                const upcoming = Competitions.events.filter(e => new Date(e.dateStart) >= today);
                
                if (upcoming.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-16">
                            <i data-lucide="calendar-x" class="w-16 h-16 text-slate-300 mx-auto mb-4"></i>
                            <p class="text-slate-400">No hay competencias pr√≥ximas</p>
                        </div>
                    `;
                    lucide.createIcons();
                    return;
                }
                
                const categoryIcons = {
                    'combate': { icon: 'sword', color: 'red', label: 'Robot de Combate' },
                    'sumo': { icon: 'users', color: 'purple', label: 'Sumo Bot' },
                    'seguidor': { icon: 'route', color: 'blue', label: 'Seguidor de L√≠nea' },
                    'autonomo': { icon: 'bot', color: 'green', label: 'Robot Aut√≥nomo' },
                    'dron': { icon: 'plane', color: 'sky', label: 'Drones' },
                    'innovacion': { icon: 'lightbulb', color: 'yellow', label: 'Innovaci√≥n' },
                    'otro': { icon: 'trophy', color: 'orange', label: 'Otro' }
                };
                
                let html = '';
                upcoming.forEach(event => {
                    const cat = categoryIcons[event.category] || categoryIcons.otro;
                    const startDate = new Date(event.dateStart);
                    const endDate = event.dateEnd ? new Date(event.dateEnd) : null;
                    const daysLeft = Math.ceil((startDate - today) / (1000 * 60 * 60 * 24));
                    const deadlinePassed = event.deadline && new Date(event.deadline) < today;
                    const deadlineDate = event.deadline ? new Date(event.deadline) : null;
                    
                    html += `
                        <div class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden hover:shadow-xl transition-all">
                            <!-- Header con gradiente -->
                            <div class="bg-gradient-to-r from-${cat.color}-500 to-${cat.color}-600 p-4 text-white">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                                            <i data-lucide="${cat.icon}" class="w-6 h-6"></i>
                                        </div>
                                        <div>
                                            <span class="text-${cat.color}-100 text-[10px] uppercase tracking-wider font-bold">${cat.label}</span>
                                            <h3 class="font-bold text-lg leading-tight">${event.name}</h3>
                                        </div>
                                    </div>
                                    <span class="px-3 py-1.5 bg-white/20 backdrop-blur rounded-full text-xs font-bold">
                                        ${daysLeft <= 0 ? '¬°Hoy!' : daysLeft === 1 ? 'Ma√±ana' : `${daysLeft} d√≠as`}
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Contenido detallado -->
                            <div class="p-5 space-y-4">
                                <!-- Informaci√≥n principal -->
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="bg-slate-50 rounded-xl p-3">
                                        <div class="flex items-center gap-2 text-slate-500 mb-1">
                                            <i data-lucide="calendar" class="w-4 h-4"></i>
                                            <span class="text-[10px] uppercase font-bold">Fecha</span>
                                        </div>
                                        <p class="font-bold text-tec-dark text-sm">
                                            ${startDate.toLocaleDateString('es-MX', { day: 'numeric', month: 'short', year: 'numeric' })}
                                        </p>
                                        ${endDate ? `<p class="text-xs text-slate-400">hasta ${endDate.toLocaleDateString('es-MX', { day: 'numeric', month: 'short' })}</p>` : ''}
                                    </div>
                                    <div class="bg-slate-50 rounded-xl p-3">
                                        <div class="flex items-center gap-2 text-slate-500 mb-1">
                                            <i data-lucide="map-pin" class="w-4 h-4"></i>
                                            <span class="text-[10px] uppercase font-bold">Lugar</span>
                                        </div>
                                        <p class="font-bold text-tec-dark text-sm">${event.location}</p>
                                    </div>
                                </div>
                                
                                <!-- Descripci√≥n -->
                                ${event.description ? `
                                <div class="bg-slate-50 rounded-xl p-3">
                                    <div class="flex items-center gap-2 text-slate-500 mb-2">
                                        <i data-lucide="info" class="w-4 h-4"></i>
                                        <span class="text-[10px] uppercase font-bold">Descripci√≥n</span>
                                    </div>
                                    <p class="text-sm text-slate-600 leading-relaxed">${event.description}</p>
                                </div>
                                ` : ''}
                                
                                <!-- Deadline de inscripci√≥n -->
                                ${deadlineDate ? `
                                <div class="flex items-center justify-between p-3 rounded-xl ${deadlinePassed ? 'bg-red-50 border border-red-200' : 'bg-yellow-50 border border-yellow-200'}">
                                    <div class="flex items-center gap-2">
                                        <i data-lucide="clock" class="w-4 h-4 ${deadlinePassed ? 'text-red-500' : 'text-yellow-600'}"></i>
                                        <span class="text-xs font-bold ${deadlinePassed ? 'text-red-600' : 'text-yellow-700'}">
                                            ${deadlinePassed ? 'Inscripciones cerradas' : 'Cierre de inscripciones'}
                                        </span>
                                    </div>
                                    <span class="text-xs font-bold ${deadlinePassed ? 'text-red-500' : 'text-yellow-600'}">
                                        ${deadlineDate.toLocaleDateString('es-MX', { day: 'numeric', month: 'short' })}
                                    </span>
                                </div>
                                ` : ''}
                                
                                <!-- Participantes inscritos -->
                                <div class="bg-green-50 border border-green-200 rounded-xl p-3">
                                    <div class="flex items-center gap-2 text-green-600 mb-2">
                                        <i data-lucide="users" class="w-4 h-4"></i>
                                        <span class="text-[10px] uppercase font-bold">Participantes Inscritos</span>
                                    </div>
                                    ${Competitions.renderRegisteredAvatars(event.id, 5)}
                                </div>
                                
                                ${event.projectId && Competitions.projectsCache[event.projectId] ? `
                                <!-- Proyecto Asociado -->
                                <div class="bg-gradient-to-r from-tec-blue/10 to-indigo-50 border border-tec-blue/20 rounded-xl p-3 cursor-pointer hover:shadow-md transition" onclick="Database.showProjectDetail('${event.projectId}')">
                                    <div class="flex items-center gap-2 text-tec-blue mb-2">
                                        <i data-lucide="cpu" class="w-4 h-4"></i>
                                        <span class="text-[10px] uppercase font-bold">Proyecto Participante</span>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="w-12 h-12 bg-tec-blue/10 rounded-xl flex items-center justify-center">
                                            <i data-lucide="bot" class="w-6 h-6 text-tec-blue"></i>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p class="font-bold text-tec-dark text-sm truncate">${Competitions.projectsCache[event.projectId].title}</p>
                                            <p class="text-xs text-slate-500">${Competitions.projectsCache[event.projectId].category || 'General'} ‚Ä¢ ${Competitions.projectsCache[event.projectId].authorName || 'CRAI'}</p>
                                        </div>
                                        <i data-lucide="arrow-right" class="w-4 h-4 text-tec-blue"></i>
                                    </div>
                                </div>
                                ` : ''}
                                
                                <!-- Botones de acci√≥n -->
                                <div class="flex gap-2 pt-2">
                                    ${Competitions.isUserRegistered(event.id) ? `
                                    <button disabled
                                        class="flex-1 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl text-sm font-bold cursor-default flex items-center justify-center gap-2">
                                        <i data-lucide="check-circle" class="w-4 h-4"></i>
                                        ¬°Inscrito!
                                    </button>
                                    ` : `
                                    <button onclick="Competitions.requestRegistration('${event.id}')" 
                                        class="flex-1 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl text-sm font-bold hover:from-orange-600 hover:to-orange-700 transition-all flex items-center justify-center gap-2 ${deadlinePassed ? 'opacity-50 cursor-not-allowed' : ''}"
                                        ${deadlinePassed ? 'disabled' : ''}>
                                        <i data-lucide="user-plus" class="w-4 h-4"></i>
                                        ${deadlinePassed ? 'Registro cerrado' : 'Inscribirme'}
                                    </button>
                                    `}
                                    <button onclick="Competitions.viewDetails('${event.id}')" 
                                        class="px-4 py-3 bg-slate-100 text-slate-600 rounded-xl hover:bg-slate-200 transition">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                    ${Competitions.isEventCreator(event) ? `
                                    <button onclick="Competitions.editEvent('${event.id}')" 
                                        class="px-4 py-3 bg-blue-100 text-blue-600 rounded-xl hover:bg-blue-200 transition" title="Editar evento">
                                        <i data-lucide="pencil" class="w-4 h-4"></i>
                                    </button>
                                    ` : ''}
                                    ${event.link ? `
                                    <a href="${event.link}" target="_blank" 
                                        class="px-4 py-3 bg-slate-100 text-slate-600 rounded-xl hover:bg-slate-200 transition">
                                        <i data-lucide="external-link" class="w-4 h-4"></i>
                                    </a>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html;
                lucide.createIcons();
            },
            
            // Ver detalles completos de una competencia
            viewDetails: (eventId) => {
                const event = Competitions.events.find(e => e.id === eventId);
                if (!event) return;
                
                const categoryIcons = {
                    'combate': { icon: '‚öîÔ∏è', label: 'Robot de Combate' },
                    'sumo': { icon: 'ü§º', label: 'Sumo Bot' },
                    'seguidor': { icon: 'üõ§Ô∏è', label: 'Seguidor de L√≠nea' },
                    'autonomo': { icon: 'ü§ñ', label: 'Robot Aut√≥nomo' },
                    'dron': { icon: 'üöÅ', label: 'Drones' },
                    'innovacion': { icon: 'üí°', label: 'Innovaci√≥n' },
                    'otro': { icon: 'üèÜ', label: 'Otro' }
                };
                const cat = categoryIcons[event.category] || categoryIcons.otro;
                const startDate = new Date(event.dateStart);
                const endDate = event.dateEnd ? new Date(event.dateEnd) : null;
                
                // Obtener lista de inscritos
                const registrations = Competitions.eventRegistrations[eventId] || [];
                let registeredListHtml = '';
                if (registrations.length > 0) {
                    registeredListHtml = `
                        <div class="bg-green-50 p-3 rounded-lg border border-green-200">
                            <p class="text-[10px] text-green-600 uppercase font-bold mb-3">üë• Participantes Inscritos (${registrations.length})</p>
                            <div class="space-y-2 max-h-48 overflow-y-auto">
                                ${registrations.map(user => {
                                    const photo = user.photo || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=1B396A&color=D4AF37&size=32`;
                                    return `
                                        <div class="flex items-center gap-2 bg-white rounded-lg p-2">
                                            <img src="${photo}" class="w-8 h-8 rounded-full object-cover" onerror="this.src='https://ui-avatars.com/api/?name=${user.name.split(' ').map(n => n[0]).slice(0,2).join('')}&background=1B396A&color=D4AF37&size=32'">
                                            <span class="text-sm font-medium text-slate-700">${user.name}</span>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    registeredListHtml = `
                        <div class="bg-slate-50 p-3 rounded-lg border border-slate-200">
                            <p class="text-[10px] text-slate-400 uppercase font-bold mb-1">üë• Participantes</p>
                            <p class="text-sm text-slate-500">Nadie inscrito a√∫n. ¬°S√© el primero!</p>
                        </div>
                    `;
                }
                
                Swal.fire({
                    title: event.name,
                    html: `
                        <div class="text-left space-y-4 mt-4">
                            <div class="flex items-center gap-2 bg-orange-50 text-orange-700 px-3 py-2 rounded-lg">
                                <span class="text-xl">${cat.icon}</span>
                                <span class="font-bold text-sm">${cat.label}</span>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <div class="bg-slate-50 p-3 rounded-lg">
                                    <p class="text-[10px] text-slate-400 uppercase font-bold mb-1">üìÖ Fecha Inicio</p>
                                    <p class="font-bold text-slate-800">${startDate.toLocaleDateString('es-MX', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}</p>
                                </div>
                                ${endDate ? `
                                <div class="bg-slate-50 p-3 rounded-lg">
                                    <p class="text-[10px] text-slate-400 uppercase font-bold mb-1">üìÖ Fecha Fin</p>
                                    <p class="font-bold text-slate-800">${endDate.toLocaleDateString('es-MX', { weekday: 'long', day: 'numeric', month: 'long' })}</p>
                                </div>
                                ` : ''}
                            </div>
                            
                            <div class="bg-slate-50 p-3 rounded-lg">
                                <p class="text-[10px] text-slate-400 uppercase font-bold mb-1">üìç Ubicaci√≥n</p>
                                <p class="font-bold text-slate-800">${event.location}</p>
                            </div>
                            
                            ${event.deadline ? `
                            <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                                <p class="text-[10px] text-yellow-600 uppercase font-bold mb-1">‚è∞ Fecha l√≠mite de inscripci√≥n</p>
                                <p class="font-bold text-yellow-700">${new Date(event.deadline).toLocaleDateString('es-MX', { weekday: 'long', day: 'numeric', month: 'long' })}</p>
                            </div>
                            ` : ''}
                            
                            ${event.description ? `
                            <div class="bg-slate-50 p-3 rounded-lg">
                                <p class="text-[10px] text-slate-400 uppercase font-bold mb-2">üìù Descripci√≥n</p>
                                <p class="text-slate-600 text-sm leading-relaxed">${event.description}</p>
                            </div>
                            ` : ''}
                            
                            ${registeredListHtml}
                            
                            ${event.link ? `
                            <a href="${event.link}" target="_blank" class="flex items-center justify-center gap-2 w-full py-3 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition font-bold text-sm">
                                üîó Ver sitio oficial
                            </a>
                            ` : ''}
                        </div>
                    `,
                    showConfirmButton: true,
                    confirmButtonText: 'Cerrar',
                    confirmButtonColor: '#64748b',
                    width: '500px'
                });
            },
            
            renderPast: () => {
                const container = document.getElementById('past-competitions');
                if (!container) return;
                
                const today = new Date();
                const past = Competitions.events.filter(e => new Date(e.dateStart) < today).reverse();
                
                if (past.length === 0) {
                    container.innerHTML = '<p class="text-slate-400 text-center py-12">No hay historial de competencias</p>';
                    return;
                }
                
                let html = '';
                past.forEach(event => {
                    const startDate = new Date(event.dateStart);
                    html += `
                        <div class="flex items-center justify-between p-4 bg-white rounded-xl border border-slate-100 hover:shadow-sm transition">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-slate-100 rounded-xl flex items-center justify-center">
                                    <i data-lucide="trophy" class="w-6 h-6 text-slate-400"></i>
                                </div>
                                <div>
                                    <p class="font-bold text-tec-dark">${event.name}</p>
                                    <p class="text-xs text-slate-400">${event.location} ‚Ä¢ ${startDate.toLocaleDateString('es-MX')}</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <button onclick="Competitions.viewDetails('${event.id}')" class="px-3 py-2 bg-slate-100 text-slate-500 rounded-lg hover:bg-slate-200 text-xs font-bold transition">
                                    Ver detalles
                                </button>
                                <span class="px-3 py-1 bg-slate-100 text-slate-500 rounded-full text-xs font-bold">Finalizado</span>
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html;
                lucide.createIcons();
            },
            
            loadMyRegistrations: async () => {
                const container = document.getElementById('my-competition-registrations');
                if (!container) return;
                
                if (!STATE.currentUser) {
                    container.innerHTML = '<p class="text-slate-400 text-center py-12">Inicia sesi√≥n para ver tus inscripciones</p>';
                    return;
                }
                
                try {
                    const snap = await db.collection('competition_registrations')
                        .where('userId', '==', STATE.currentUser.uid)
                        .get();
                    
                    if (snap.empty) {
                        container.innerHTML = '<p class="text-slate-400 text-center py-12">No tienes inscripciones a competencias</p>';
                        return;
                    }
                    
                    let html = '';
                    for (const doc of snap.docs) {
                        const reg = doc.data();
                        const event = Competitions.events.find(e => e.id === reg.competitionId);
                        if (!event) continue;
                        
                        const statusConfig = {
                            pending: { bg: 'bg-yellow-100', text: 'text-yellow-700', label: 'Pendiente de aprobaci√≥n', icon: 'clock' },
                            confirmed: { bg: 'bg-green-100', text: 'text-green-700', label: 'Confirmado', icon: 'check-circle' },
                            rejected: { bg: 'bg-red-100', text: 'text-red-700', label: 'Rechazado', icon: 'x-circle' }
                        };
                        const status = statusConfig[reg.status] || statusConfig.pending;
                        
                        html += `
                            <div class="bg-white rounded-xl border border-slate-100 overflow-hidden">
                                <div class="flex items-center justify-between p-4">
                                    <div class="flex items-center gap-4">
                                        <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center">
                                            <i data-lucide="trophy" class="w-6 h-6 text-orange-600"></i>
                                        </div>
                                        <div>
                                            <p class="font-bold text-tec-dark">${event.name}</p>
                                            <p class="text-xs text-slate-400">${event.location} ‚Ä¢ ${new Date(event.dateStart).toLocaleDateString('es-MX')}</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2 px-3 py-1.5 ${status.bg} ${status.text} rounded-full">
                                        <i data-lucide="${status.icon}" class="w-4 h-4"></i>
                                        <span class="text-xs font-bold">${status.label}</span>
                                    </div>
                                </div>
                                ${reg.status === 'pending' ? `
                                <div class="bg-yellow-50 px-4 py-2 border-t border-yellow-100">
                                    <p class="text-xs text-yellow-700">‚è≥ Tu solicitud est√° siendo revisada por un Fundador o L√≠der de √Årea</p>
                                </div>
                                ` : ''}
                                ${reg.status === 'rejected' && reg.rejectionReason ? `
                                <div class="bg-red-50 px-4 py-2 border-t border-red-100">
                                    <p class="text-xs text-red-700">‚ùå Motivo: ${reg.rejectionReason}</p>
                                </div>
                                ` : ''}
                            </div>
                        `;
                    }
                    container.innerHTML = html;
                    lucide.createIcons();
                } catch (e) {
                    console.error(e);
                }
            },
            
            // Inscribirse a una competencia (inscripci√≥n autom√°tica para todos)
            requestRegistration: async (eventId) => {
                if (!STATE.currentUser) {
                    Util.notify('Inicia sesi√≥n para inscribirte', 'warning');
                    Modal.open('auth');
                    return;
                }
                
                const event = Competitions.events.find(e => e.id === eventId);
                if (!event) return;
                
                try {
                    // Verificar si ya est√° inscrito
                    const existing = await db.collection('competition_registrations')
                        .where('userId', '==', STATE.currentUser.uid)
                        .where('competitionId', '==', eventId)
                        .get();
                    
                    if (!existing.empty) {
                        Util.notify('Ya est√°s inscrito en esta competencia', 'info');
                        return;
                    }
                    
                    // Confirmar inscripci√≥n
                    const result = await Swal.fire({
                        title: 'Confirmar Inscripci√≥n',
                        html: `
                            <div class="text-left space-y-4 mt-4">
                                <div class="bg-orange-50 border border-orange-200 rounded-xl p-4">
                                    <p class="font-bold text-orange-800 mb-1">${event.name}</p>
                                    <p class="text-sm text-orange-600">${event.location}</p>
                                    <p class="text-xs text-orange-500 mt-2">üìÖ ${new Date(event.dateStart).toLocaleDateString('es-MX', { day: 'numeric', month: 'long', year: 'numeric' })}</p>
                                </div>
                                <div class="bg-green-50 border border-green-200 rounded-xl p-4">
                                    <p class="text-sm text-green-800">
                                        <strong>‚úì</strong> Tu inscripci√≥n ser√° confirmada inmediatamente.
                                    </p>
                                </div>
                            </div>
                        `,
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonText: '‚úì Inscribirme',
                        cancelButtonText: 'Cancelar',
                        confirmButtonColor: '#22c55e'
                    });
                    
                    if (result.isConfirmed) {
                        Util.loading(true, 'Registrando inscripci√≥n...');
                        
                        await db.collection('competition_registrations').add({
                            userId: STATE.currentUser.uid,
                            userName: STATE.currentUser.displayName || STATE.currentUser.email,
                            competitionId: eventId,
                            status: 'confirmed',
                            registeredAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        // Agregar al calendario
                        await Competitions.addToCalendar(event, STATE.currentUser.uid);
                        
                        // Recargar inscripciones para actualizar la vista
                        await Competitions.loadRegistrationsForEvents();
                        
                        Util.loading(false);
                        
                        Swal.fire({
                            title: '¬°Inscripci√≥n Confirmada!',
                            html: `<p class="text-slate-600">Te has inscrito exitosamente a <strong>${event.name}</strong>.</p>`,
                            icon: 'success',
                            confirmButtonColor: '#22c55e'
                        });
                        
                        Competitions.loadMyRegistrations();
                        Competitions.renderUpcoming();
                        Competitions.updateStats();
                    }
                } catch (e) {
                    console.error(e);
                    Util.loading(false);
                    Util.notify('Error al procesar inscripci√≥n', 'error');
                }
            },
            
            // Agregar competencia al calendario autom√°ticamente
            addToCalendar: async (event, userId) => {
                try {
                    // Verificar si ya existe en el calendario del usuario
                    const existingCheck = await db.collection('calendar_events')
                        .where('competitionId', '==', event.id)
                        .get();
                    
                    // Solo agregar si no existe ya como evento de calendario global
                    if (existingCheck.empty) {
                        await db.collection('calendar_events').add({
                            title: `üèÜ ${event.name}`,
                            date: event.dateStart,
                            type: 'competition',
                            location: event.location,
                            description: event.description || `Competencia: ${event.name}`,
                            competitionId: event.id,
                            createdBy: STATE.currentUser.uid,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        console.log('Competencia agregada al calendario');
                    }
                } catch (e) {
                    console.error('Error agregando al calendario:', e);
                }
            },
            
            // Editar evento (solo el creador)
            editEvent: async (eventId) => {
                const event = Competitions.events.find(e => e.id === eventId);
                if (!event) return;
                
                // Verificar que sea el creador
                if (!Competitions.isEventCreator(event)) {
                    Util.notify('Solo el creador puede editar este evento', 'error');
                    return;
                }
                
                // Cargar proyectos para el selector
                let projectsOptions = '<option value="">Sin proyecto asignado</option>';
                try {
                    const projectsSnap = await db.collection('projects').orderBy('date', 'desc').get();
                    projectsSnap.forEach(doc => {
                        const proj = doc.data();
                        const selected = event.projectId === doc.id ? 'selected' : '';
                        projectsOptions += `<option value="${doc.id}" ${selected}>ü§ñ ${proj.title} (${proj.category || 'General'})</option>`;
                    });
                } catch (e) {
                    console.error('Error cargando proyectos:', e);
                }
                
                const categoryOptions = [
                    { value: 'combate', label: '‚öîÔ∏è Robot de Combate' },
                    { value: 'sumo', label: 'ü§º Sumo Bot' },
                    { value: 'seguidor', label: 'üõ§Ô∏è Seguidor de L√≠nea' },
                    { value: 'autonomo', label: 'ü§ñ Robot Aut√≥nomo' },
                    { value: 'dron', label: 'üöÅ Drones' },
                    { value: 'innovacion', label: 'üí° Innovaci√≥n' },
                    { value: 'otro', label: 'üèÜ Otro' }
                ];
                
                const { value: formValues } = await Swal.fire({
                    title: 'Editar Evento',
                    html: `
                        <div class="text-left space-y-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-600 mb-1">Nombre del evento *</label>
                                <input id="swal-name" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm" value="${event.name}" required>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-bold text-slate-600 mb-1">Fecha inicio *</label>
                                    <input id="swal-date-start" type="date" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm" value="${event.dateStart}" required>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-600 mb-1">Fecha fin</label>
                                    <input id="swal-date-end" type="date" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm" value="${event.dateEnd || ''}">
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-600 mb-1">Ubicaci√≥n *</label>
                                <input id="swal-location" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm" value="${event.location}" required>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-bold text-slate-600 mb-1">Categor√≠a</label>
                                    <select id="swal-category" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm">
                                        ${categoryOptions.map(opt => `<option value="${opt.value}" ${event.category === opt.value ? 'selected' : ''}>${opt.label}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-600 mb-1">Cierre inscripci√≥n</label>
                                    <input id="swal-deadline" type="date" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm" value="${event.deadline || ''}">
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-600 mb-1">Descripci√≥n</label>
                                <textarea id="swal-description" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm" rows="3">${event.description || ''}</textarea>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-600 mb-1">Link externo</label>
                                <input id="swal-link" type="url" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm" value="${event.link || ''}" placeholder="https://...">
                            </div>
                            <div class="bg-gradient-to-br from-tec-blue/5 to-indigo-50 rounded-xl p-4 border border-tec-blue/20">
                                <label class="block text-xs font-bold text-tec-blue mb-2 flex items-center gap-2">
                                    <i data-lucide="folder" class="w-4 h-4"></i>
                                    Proyecto Asociado
                                </label>
                                <select id="swal-project" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm">
                                    ${projectsOptions}
                                </select>
                            </div>
                        </div>
                    `,
                    showCancelButton: true,
                    confirmButtonText: 'üíæ Guardar Cambios',
                    cancelButtonText: 'Cancelar',
                    confirmButtonColor: '#3b82f6',
                    width: '500px',
                    didOpen: () => {
                        lucide.createIcons();
                    },
                    preConfirm: () => {
                        const name = document.getElementById('swal-name').value;
                        const dateStart = document.getElementById('swal-date-start').value;
                        const location = document.getElementById('swal-location').value;
                        
                        if (!name || !dateStart || !location) {
                            Swal.showValidationMessage('Por favor completa los campos requeridos');
                            return false;
                        }
                        
                        return {
                            name,
                            dateStart,
                            dateEnd: document.getElementById('swal-date-end').value || null,
                            location,
                            category: document.getElementById('swal-category').value,
                            deadline: document.getElementById('swal-deadline').value || null,
                            description: document.getElementById('swal-description').value,
                            link: document.getElementById('swal-link').value,
                            projectId: document.getElementById('swal-project').value || null
                        };
                    }
                });
                
                if (formValues) {
                    try {
                        Util.loading(true, 'Guardando cambios...');
                        
                        // Si el proyecto cambi√≥, actualizar las referencias
                        const oldProjectId = event.projectId;
                        const newProjectId = formValues.projectId;
                        
                        // Quitar referencia del proyecto anterior si existe
                        if (oldProjectId && oldProjectId !== newProjectId) {
                            try {
                                await db.collection('projects').doc(oldProjectId).update({
                                    competitionId: null
                                });
                            } catch (e) {
                                console.log('Proyecto anterior no encontrado');
                            }
                        }
                        
                        // Agregar referencia al nuevo proyecto si existe
                        if (newProjectId && newProjectId !== oldProjectId) {
                            await db.collection('projects').doc(newProjectId).update({
                                competitionId: eventId
                            });
                        }
                        
                        await db.collection('competitions').doc(eventId).update({
                            ...formValues,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        // Actualizar tambi√©n en el calendario si existe
                        const calendarSnap = await db.collection('calendar_events')
                            .where('competitionId', '==', eventId)
                            .get();
                        
                        for (const doc of calendarSnap.docs) {
                            await doc.ref.update({
                                title: `üèÜ ${formValues.name}`,
                                date: formValues.dateStart,
                                location: formValues.location,
                                description: formValues.description || `Competencia: ${formValues.name}`
                            });
                        }
                        
                        Util.loading(false);
                        Util.notify('Evento actualizado correctamente', 'success');
                        Competitions.load();
                    } catch (e) {
                        console.error(e);
                        Util.loading(false);
                        Util.notify('Error al actualizar evento', 'error');
                    }
                }
            },
            
            add: async (e) => {
                e.preventDefault();
                
                if (!STATE.currentUser) {
                    Util.notify('Inicia sesi√≥n para crear eventos', 'warning');
                    return;
                }
                
                // Obtener proyecto asociado
                const projectSelect = document.getElementById('comp-project');
                const projectId = projectSelect ? projectSelect.value : '';
                
                const data = {
                    name: document.getElementById('comp-name').value,
                    dateStart: document.getElementById('comp-date-start').value,
                    dateEnd: document.getElementById('comp-date-end').value || null,
                    location: document.getElementById('comp-location').value,
                    category: document.getElementById('comp-category').value,
                    deadline: document.getElementById('comp-deadline').value || null,
                    description: document.getElementById('comp-description').value,
                    link: document.getElementById('comp-link').value,
                    projectId: projectId || null,
                    createdBy: STATE.currentUser.uid,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                try {
                    Util.loading(true, 'Creando evento...');
                    
                    // Crear la competencia
                    const docRef = await db.collection('competitions').add(data);
                    
                    // Si hay un proyecto asociado, actualizar el proyecto con la competencia
                    if (projectId) {
                        await db.collection('projects').doc(projectId).update({
                            competitionId: docRef.id
                        });
                    }
                    
                    // Agregar autom√°ticamente al calendario
                    await db.collection('calendar_events').add({
                        title: `üèÜ ${data.name}`,
                        date: data.dateStart,
                        type: 'competition',
                        location: data.location,
                        description: data.description || `Competencia de rob√≥tica: ${data.name}`,
                        competitionId: docRef.id,
                        createdBy: STATE.currentUser.uid,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    Util.loading(false);
                    Modal.close('add-competition');
                    Util.notify('Competencia agregada y registrada en calendario', 'success');
                    Competitions.load();
                    Database.loadPublicProjects(); // Refrescar proyectos para mostrar la insignia
                    
                    // Recargar calendario si est√° visible
                    if (typeof Calendar !== 'undefined' && Calendar.load) {
                        Calendar.load();
                    }
                } catch (e) {
                    console.error(e);
                    Util.loading(false);
                    Util.notify('Error al crear evento', 'error');
                }
            }
        };

        // Funci√≥n de inicializaci√≥n de Chart.js
        function initTelemetryChart() {
            const ctx = document.getElementById('chart-network');
            if(ctx) {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['0s', '10s', '20s', '30s', '40s', '50s', '60s'],
                        datasets: [{
                            label: 'Ping (ms)',
                            data: [12, 19, 3, 5, 2, 3, 9],
                            borderColor: '#1B396A',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: true,
                            backgroundColor: 'rgba(27, 57, 106, 0.05)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { x: { display: false }, y: { display: false } },
                        animation: { duration: 2000, easing: 'easeOutQuart' }
                    }
                });
            }
        }

        /**
         * ==========================================
         * SISTEMA DE EVENTOS P√öBLICOS
         * ==========================================
         */
        const PublicEvents = {
            events: [],
            currentFilter: 'all',
            currentManagerFilter: 'all',
            currentViewingEvent: null,

            // Cargar eventos p√∫blicos (para la vista p√∫blica)
            load: async () => {
                const grid = document.getElementById('public-events-grid');
                const loading = document.getElementById('public-events-loading');
                const empty = document.getElementById('public-events-empty');
                
                if (loading) loading.classList.remove('hidden');
                if (grid) grid.innerHTML = '';
                if (empty) empty.classList.add('hidden');
                
                try {
                    const snap = await db.collection('publicEvents')
                        .orderBy('date', 'asc')
                        .get();
                    
                    PublicEvents.events = [];
                    let totalRegistrations = 0;
                    
                    snap.forEach(doc => {
                        const data = doc.data();
                        PublicEvents.events.push({ id: doc.id, ...data });
                        totalRegistrations += data.registrationsCount || 0;
                    });
                    
                    // Actualizar contadores
                    const activeEvents = PublicEvents.events.filter(e => e.active && new Date(e.date) >= new Date()).length;
                    document.getElementById('public-events-count').textContent = activeEvents;
                    document.getElementById('public-events-registrations').textContent = totalRegistrations;
                    
                    if (loading) loading.classList.add('hidden');
                    PublicEvents.render();
                    
                } catch (e) {
                    console.error('Error cargando eventos:', e);
                    if (loading) loading.classList.add('hidden');
                    if (empty) {
                        empty.classList.remove('hidden');
                        empty.querySelector('h3').textContent = 'Error al cargar eventos';
                    }
                }
            },

            // Renderizar eventos en la vista p√∫blica
            render: () => {
                const grid = document.getElementById('public-events-grid');
                const empty = document.getElementById('public-events-empty');
                if (!grid) return;
                
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                let filtered = PublicEvents.events.filter(e => e.active); // Solo mostrar activos al p√∫blico
                
                // Aplicar filtros
                switch (PublicEvents.currentFilter) {
                    case 'upcoming':
                        filtered = filtered.filter(e => new Date(e.date) >= today);
                        break;
                    case 'open':
                        filtered = filtered.filter(e => {
                            const deadline = e.registrationDeadline ? new Date(e.registrationDeadline) : new Date(e.date);
                            return new Date(e.date) >= today && deadline >= today;
                        });
                        break;
                    case 'past':
                        filtered = filtered.filter(e => new Date(e.date) < today);
                        break;
                }
                
                if (filtered.length === 0) {
                    grid.innerHTML = '';
                    if (empty) empty.classList.remove('hidden');
                    lucide.createIcons();
                    return;
                }
                
                if (empty) empty.classList.add('hidden');
                
                const categoryIcons = {
                    'combate': '‚öîÔ∏è', 'sumo': 'ü§º', 'seguidor': 'üõ§Ô∏è', 'minisumo': 'üéØ',
                    'autonomo': 'ü§ñ', 'dron': '‚úàÔ∏è', 'innovacion': 'üí°', 'taller': 'üîß',
                    'hackathon': 'üíª', 'exhibicion': 'üé™', 'otro': 'üìã'
                };
                
                const categoryColors = {
                    'combate': 'from-red-500 to-orange-500',
                    'sumo': 'from-amber-500 to-yellow-500',
                    'seguidor': 'from-green-500 to-emerald-500',
                    'minisumo': 'from-purple-500 to-pink-500',
                    'autonomo': 'from-blue-500 to-cyan-500',
                    'dron': 'from-sky-500 to-blue-500',
                    'innovacion': 'from-yellow-500 to-amber-500',
                    'taller': 'from-slate-500 to-slate-600',
                    'hackathon': 'from-violet-500 to-purple-500',
                    'exhibicion': 'from-pink-500 to-rose-500',
                    'otro': 'from-slate-400 to-slate-500'
                };
                
                grid.innerHTML = filtered.map(event => {
                    const eventDate = new Date(event.date);
                    const isPast = eventDate < today;
                    const deadline = event.registrationDeadline ? new Date(event.registrationDeadline) : eventDate;
                    const registrationOpen = deadline >= today && !isPast;
                    const icon = categoryIcons[event.category] || 'üìÖ';
                    const colorClass = categoryColors[event.category] || 'from-tec-gold to-orange-500';
                    
                    const spotsInfo = event.maxParticipants > 0 
                        ? `${event.registrationsCount || 0}/${event.maxParticipants} lugares`
                        : `${event.registrationsCount || 0} inscritos`;
                    
                    return `
                        <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-slate-100 hover:shadow-xl transition-all group ${isPast ? 'opacity-75' : ''}">
                            <!-- Imagen/Banner -->
                            <div class="relative h-40 bg-gradient-to-br ${colorClass} overflow-hidden">
                                ${event.imageUrl ? `<img src="${event.imageUrl}" alt="${event.name}" class="w-full h-full object-cover">` : `
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <span class="text-6xl opacity-30">${icon}</span>
                                    </div>
                                `}
                                <div class="absolute top-3 left-3">
                                    <span class="px-3 py-1 bg-white/90 backdrop-blur-sm rounded-full text-xs font-bold text-slate-700">
                                        ${icon} ${event.category ? event.category.charAt(0).toUpperCase() + event.category.slice(1) : 'Evento'}
                                    </span>
                                </div>
                                ${isPast ? `
                                    <div class="absolute inset-0 bg-black/40 flex items-center justify-center">
                                        <span class="px-4 py-2 bg-slate-800/80 rounded-lg text-white font-bold text-sm">FINALIZADO</span>
                                    </div>
                                ` : registrationOpen ? `
                                    <div class="absolute top-3 right-3">
                                        <span class="px-3 py-1 bg-green-500 text-white rounded-full text-xs font-bold animate-pulse">
                                            Inscripciones Abiertas
                                        </span>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <!-- Contenido -->
                            <div class="p-5">
                                <h3 class="font-bold text-lg text-slate-800 mb-2 line-clamp-2 group-hover:text-tec-gold transition">${event.name}</h3>
                                
                                <div class="space-y-2 mb-4">
                                    <div class="flex items-center gap-2 text-sm text-slate-500">
                                        <i data-lucide="calendar" class="w-4 h-4 text-tec-gold"></i>
                                        <span>${eventDate.toLocaleDateString('es-MX', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}</span>
                                    </div>
                                    <div class="flex items-center gap-2 text-sm text-slate-500">
                                        <i data-lucide="clock" class="w-4 h-4 text-tec-blue"></i>
                                        <span>${event.time || 'Por confirmar'}</span>
                                    </div>
                                    <div class="flex items-center gap-2 text-sm text-slate-500">
                                        <i data-lucide="map-pin" class="w-4 h-4 text-red-400"></i>
                                        <span class="truncate">${event.location}</span>
                                    </div>
                                </div>
                                
                                <p class="text-sm text-slate-600 line-clamp-2 mb-4">${event.description}</p>
                                
                                <div class="flex items-center justify-between pt-4 border-t border-slate-100">
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs text-slate-400">${spotsInfo}</span>
                                        ${event.cost ? `<span class="text-xs font-bold text-green-600">${event.cost}</span>` : '<span class="text-xs font-bold text-green-600">Gratis</span>'}
                                    </div>
                                    ${!isPast && registrationOpen ? `
                                        <button onclick="PublicEvents.openRegistration('${event.id}')" class="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-bold text-xs transition flex items-center gap-1">
                                            <i data-lucide="user-plus" class="w-3 h-3"></i>
                                            Inscribirse
                                        </button>
                                    ` : !isPast ? `
                                        <span class="px-4 py-2 bg-slate-100 text-slate-500 rounded-lg font-bold text-xs">
                                            Inscripciones Cerradas
                                        </span>
                                    ` : `
                                        ${event.rulesLink ? `
                                            <a href="${event.rulesLink}" target="_blank" class="px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-lg font-bold text-xs transition flex items-center gap-1">
                                                <i data-lucide="file-text" class="w-3 h-3"></i>
                                                Ver Resultados
                                            </a>
                                        ` : ''}
                                    `}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                lucide.createIcons();
            },

            // Filtrar eventos p√∫blicos
            filter: (filterType) => {
                PublicEvents.currentFilter = filterType;
                
                document.querySelectorAll('.public-event-filter').forEach(btn => {
                    const isActive = btn.dataset.filter === filterType;
                    btn.classList.toggle('bg-cyan-600', isActive);
                    btn.classList.toggle('text-white', isActive);
                    btn.classList.toggle('shadow-lg', isActive);
                    btn.classList.toggle('shadow-cyan-600/30', isActive);
                    btn.classList.toggle('bg-white', !isActive);
                    btn.classList.toggle('text-slate-600', !isActive);
                    btn.classList.toggle('border', !isActive);
                    btn.classList.toggle('border-slate-200', !isActive);
                });
                
                PublicEvents.render();
            },

            // Abrir modal de registro
            openRegistration: (eventId) => {
                const event = PublicEvents.events.find(e => e.id === eventId);
                if (!event) return;
                
                PublicEvents.currentViewingEvent = event;
                
                document.getElementById('er-event-name').textContent = event.name;
                document.getElementById('er-event-id').value = eventId;
                
                // Reset form
                document.querySelector('input[name="er-type"][value="individual"]').checked = true;
                PublicEvents.toggleTeamFields(false);
                document.getElementById('er-team-name').value = '';
                document.getElementById('er-team-members').value = '';
                document.getElementById('er-contact-name').value = '';
                document.getElementById('er-email').value = '';
                document.getElementById('er-phone').value = '';
                document.getElementById('er-institution').value = '';
                document.getElementById('er-robot-name').value = '';
                document.getElementById('er-comments').value = '';
                document.getElementById('er-terms').checked = false;
                
                // Mostrar/ocultar opciones seg√∫n tipo de participaci√≥n del evento
                const teamOption = document.querySelector('input[name="er-type"][value="team"]').parentElement;
                const indOption = document.querySelector('input[name="er-type"][value="individual"]').parentElement;
                
                if (event.participationType === 'team') {
                    indOption.classList.add('hidden');
                    document.querySelector('input[name="er-type"][value="team"]').checked = true;
                    PublicEvents.toggleTeamFields(true);
                } else if (event.participationType === 'individual') {
                    teamOption.classList.add('hidden');
                } else {
                    teamOption.classList.remove('hidden');
                    indOption.classList.remove('hidden');
                }
                
                Modal.open('event-registration');
            },

            // Toggle campos de equipo
            toggleTeamFields: (show) => {
                const teamFields = document.getElementById('er-team-fields');
                if (teamFields) {
                    teamFields.classList.toggle('hidden', !show);
                    if (show) {
                        document.getElementById('er-team-name').required = true;
                        document.getElementById('er-team-members').required = true;
                    } else {
                        document.getElementById('er-team-name').required = false;
                        document.getElementById('er-team-members').required = false;
                    }
                }
            },

            // Registrar participante
            register: async (e) => {
                e.preventDefault();
                
                const eventId = document.getElementById('er-event-id').value;
                const participationType = document.querySelector('input[name="er-type"]:checked').value;
                
                const registration = {
                    eventId: eventId,
                    type: participationType,
                    teamName: participationType === 'team' ? document.getElementById('er-team-name').value : null,
                    teamMembers: participationType === 'team' ? document.getElementById('er-team-members').value.split('\n').filter(m => m.trim()) : [],
                    contactName: document.getElementById('er-contact-name').value,
                    email: document.getElementById('er-email').value,
                    phone: document.getElementById('er-phone').value,
                    institution: document.getElementById('er-institution').value,
                    robotName: document.getElementById('er-robot-name').value || null,
                    comments: document.getElementById('er-comments').value || null,
                    registeredAt: new Date().toISOString(),
                    status: 'pending'
                };
                
                try {
                    // Guardar inscripci√≥n
                    await db.collection('eventRegistrations').add(registration);
                    
                    // Actualizar contador en el evento
                    const eventRef = db.collection('publicEvents').doc(eventId);
                    await eventRef.update({
                        registrationsCount: firebase.firestore.FieldValue.increment(1)
                    });
                    
                    Modal.close('event-registration');
                    
                    Swal.fire({
                        icon: 'success',
                        title: '¬°Inscripci√≥n Exitosa!',
                        html: `
                            <p class="text-slate-600">Tu inscripci√≥n ha sido registrada correctamente.</p>
                            <p class="text-sm text-slate-500 mt-2">Recibir√°s un correo de confirmaci√≥n en <strong>${registration.email}</strong></p>
                        `,
                        confirmButtonColor: '#D4AF37'
                    });
                    
                    // Recargar eventos
                    PublicEvents.load();
                    
                } catch (error) {
                    console.error('Error al registrar:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'No se pudo completar la inscripci√≥n. Por favor intenta nuevamente.',
                        confirmButtonColor: '#ef4444'
                    });
                }
            },

            // ========== FUNCIONES DE ADMINISTRACI√ìN ==========

            // Abrir gestor de eventos (admin)
            openManager: async () => {
                Modal.open('manage-events');
                await PublicEvents.loadManager();
            },

            // Cargar eventos en el gestor
            loadManager: async () => {
                const list = document.getElementById('me-events-list');
                const loading = document.getElementById('me-loading');
                const empty = document.getElementById('me-empty');
                
                if (loading) loading.classList.remove('hidden');
                if (list) list.innerHTML = '';
                if (empty) empty.classList.add('hidden');
                
                try {
                    const snap = await db.collection('publicEvents')
                        .orderBy('createdAt', 'desc')
                        .get();
                    
                    PublicEvents.events = [];
                    let totalRegistrations = 0;
                    
                    snap.forEach(doc => {
                        const data = doc.data();
                        PublicEvents.events.push({ id: doc.id, ...data });
                        totalRegistrations += data.registrationsCount || 0;
                    });
                    
                    // Actualizar stats
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const activeEvents = PublicEvents.events.filter(e => e.active).length;
                    
                    document.getElementById('me-total-events').textContent = PublicEvents.events.length;
                    document.getElementById('me-active-events').textContent = activeEvents;
                    document.getElementById('me-total-registrations').textContent = totalRegistrations;
                    
                    if (loading) loading.classList.add('hidden');
                    PublicEvents.renderManager();
                    
                } catch (e) {
                    console.error('Error cargando eventos:', e);
                    if (loading) loading.classList.add('hidden');
                    Swal.fire('Error', 'No se pudieron cargar los eventos', 'error');
                }
            },

            // Renderizar eventos en el gestor
            renderManager: () => {
                const list = document.getElementById('me-events-list');
                const empty = document.getElementById('me-empty');
                if (!list) return;
                
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                let filtered = [...PublicEvents.events];
                
                switch (PublicEvents.currentManagerFilter) {
                    case 'active':
                        filtered = filtered.filter(e => e.active);
                        break;
                    case 'upcoming':
                        filtered = filtered.filter(e => new Date(e.date) >= today);
                        break;
                    case 'past':
                        filtered = filtered.filter(e => new Date(e.date) < today);
                        break;
                    case 'draft':
                        filtered = filtered.filter(e => !e.active);
                        break;
                }
                
                if (filtered.length === 0) {
                    list.innerHTML = '';
                    if (empty) empty.classList.remove('hidden');
                    lucide.createIcons();
                    return;
                }
                
                if (empty) empty.classList.add('hidden');
                
                list.innerHTML = filtered.map(event => {
                    const eventDate = new Date(event.date);
                    const isPast = eventDate < today;
                    const statusBadge = !event.active 
                        ? '<span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-bold">Borrador</span>'
                        : isPast 
                            ? '<span class="px-2 py-1 bg-slate-100 text-slate-600 rounded-full text-xs font-bold">Finalizado</span>'
                            : '<span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">Activo</span>';
                    
                    return `
                        <div class="bg-white border border-slate-200 rounded-xl p-4 hover:shadow-md transition">
                            <div class="flex items-start justify-between gap-4">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-2">
                                        ${statusBadge}
                                        <span class="text-xs text-slate-400">${event.category || 'Sin categor√≠a'}</span>
                                    </div>
                                    <h4 class="font-bold text-slate-800 mb-1">${event.name}</h4>
                                    <div class="flex flex-wrap items-center gap-3 text-sm text-slate-500">
                                        <span class="flex items-center gap-1">
                                            <i data-lucide="calendar" class="w-3 h-3"></i>
                                            ${eventDate.toLocaleDateString('es-MX')}
                                        </span>
                                        <span class="flex items-center gap-1">
                                            <i data-lucide="clock" class="w-3 h-3"></i>
                                            ${event.time}
                                        </span>
                                        <span class="flex items-center gap-1">
                                            <i data-lucide="map-pin" class="w-3 h-3"></i>
                                            ${event.location}
                                        </span>
                                        <span class="flex items-center gap-1 font-bold text-cyan-600">
                                            <i data-lucide="users" class="w-3 h-3"></i>
                                            ${event.registrationsCount || 0} inscritos
                                        </span>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button onclick="PublicEvents.viewRegistrations('${event.id}')" class="p-2 bg-emerald-100 text-emerald-600 rounded-lg hover:bg-emerald-200 transition" title="Ver inscripciones">
                                        <i data-lucide="users" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="PublicEvents.toggleActive('${event.id}', ${!event.active})" class="p-2 ${event.active ? 'bg-yellow-100 text-yellow-600 hover:bg-yellow-200' : 'bg-green-100 text-green-600 hover:bg-green-200'} rounded-lg transition" title="${event.active ? 'Despublicar' : 'Publicar'}">
                                        <i data-lucide="${event.active ? 'eye-off' : 'eye'}" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="PublicEvents.delete('${event.id}')" class="p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition" title="Eliminar">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                lucide.createIcons();
            },

            // Filtrar en el gestor
            filterManager: (filterType) => {
                PublicEvents.currentManagerFilter = filterType;
                
                document.querySelectorAll('.me-filter').forEach(btn => {
                    const isActive = btn.dataset.filter === filterType;
                    btn.classList.toggle('bg-cyan-600', isActive);
                    btn.classList.toggle('text-white', isActive);
                    btn.classList.toggle('bg-slate-100', !isActive);
                    btn.classList.toggle('text-slate-600', !isActive);
                });
                
                PublicEvents.renderManager();
            },

            // Crear evento p√∫blico
            create: async (e) => {
                e.preventDefault();
                
                const eventData = {
                    name: document.getElementById('pe-name').value,
                    date: document.getElementById('pe-date').value,
                    time: document.getElementById('pe-time').value,
                    location: document.getElementById('pe-location').value,
                    description: document.getElementById('pe-description').value,
                    category: document.getElementById('pe-category').value,
                    registrationDeadline: document.getElementById('pe-deadline').value || null,
                    participationType: document.getElementById('pe-participation-type').value,
                    maxParticipants: parseInt(document.getElementById('pe-max-participants').value) || 0,
                    cost: document.getElementById('pe-cost').value || 'Gratis',
                    rulesLink: document.getElementById('pe-rules-link').value || null,
                    imageUrl: document.getElementById('pe-image').value || null,
                    active: document.getElementById('pe-active').checked,
                    registrationsCount: 0,
                    createdAt: new Date().toISOString(),
                    createdBy: STATE.currentUser?.uid || 'anonymous'
                };
                
                try {
                    await db.collection('publicEvents').add(eventData);
                    
                    Modal.close('create-public-event');
                    
                    Swal.fire({
                        icon: 'success',
                        title: '¬°Evento Creado!',
                        text: eventData.active ? 'El evento ya est√° visible para el p√∫blico' : 'El evento se guard√≥ como borrador',
                        confirmButtonColor: '#D4AF37'
                    });
                    
                    // Reset form
                    document.getElementById('pe-name').value = '';
                    document.getElementById('pe-date').value = '';
                    document.getElementById('pe-time').value = '';
                    document.getElementById('pe-location').value = '';
                    document.getElementById('pe-description').value = '';
                    document.getElementById('pe-deadline').value = '';
                    document.getElementById('pe-max-participants').value = '0';
                    document.getElementById('pe-cost').value = '';
                    document.getElementById('pe-rules-link').value = '';
                    document.getElementById('pe-image').value = '';
                    document.getElementById('pe-active').checked = true;
                    
                    // Recargar gestor
                    await PublicEvents.loadManager();
                    
                } catch (error) {
                    console.error('Error creando evento:', error);
                    Swal.fire('Error', 'No se pudo crear el evento', 'error');
                }
            },

            // Toggle estado activo
            toggleActive: async (eventId, active) => {
                try {
                    await db.collection('publicEvents').doc(eventId).update({ active });
                    
                    Swal.fire({
                        icon: 'success',
                        title: active ? 'Evento Publicado' : 'Evento Despublicado',
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 2000
                    });
                    
                    await PublicEvents.loadManager();
                } catch (error) {
                    console.error('Error:', error);
                    Swal.fire('Error', 'No se pudo actualizar el evento', 'error');
                }
            },

            // Eliminar evento
            delete: async (eventId) => {
                const result = await Swal.fire({
                    title: '¬øEliminar evento?',
                    text: 'Esta acci√≥n no se puede deshacer. Tambi√©n se eliminar√°n todas las inscripciones.',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#ef4444',
                    cancelButtonColor: '#64748b',
                    confirmButtonText: 'S√≠, eliminar',
                    cancelButtonText: 'Cancelar'
                });
                
                if (result.isConfirmed) {
                    try {
                        // Eliminar inscripciones del evento
                        const regsSnap = await db.collection('eventRegistrations')
                            .where('eventId', '==', eventId)
                            .get();
                        
                        const batch = db.batch();
                        regsSnap.forEach(doc => batch.delete(doc.ref));
                        await batch.commit();
                        
                        // Eliminar evento
                        await db.collection('publicEvents').doc(eventId).delete();
                        
                        Swal.fire({
                            icon: 'success',
                            title: 'Eliminado',
                            text: 'El evento ha sido eliminado',
                            timer: 2000,
                            showConfirmButton: false
                        });
                        
                        await PublicEvents.loadManager();
                    } catch (error) {
                        console.error('Error:', error);
                        Swal.fire('Error', 'No se pudo eliminar el evento', 'error');
                    }
                }
            },

            // Ver inscripciones de un evento
            viewRegistrations: async (eventId) => {
                const event = PublicEvents.events.find(e => e.id === eventId);
                if (!event) return;
                
                PublicEvents.currentViewingEvent = event;
                
                document.getElementById('vr-event-name').textContent = event.name;
                document.getElementById('vr-event-id').value = eventId;
                
                const list = document.getElementById('vr-registrations-list');
                const empty = document.getElementById('vr-empty');
                
                list.innerHTML = '<div class="text-center py-8"><i data-lucide="loader-2" class="w-6 h-6 animate-spin text-cyan-600 mx-auto"></i></div>';
                lucide.createIcons();
                
                Modal.open('view-registrations');
                
                try {
                    const snap = await db.collection('eventRegistrations')
                        .where('eventId', '==', eventId)
                        .orderBy('registeredAt', 'desc')
                        .get();
                    
                    const registrations = [];
                    snap.forEach(doc => registrations.push({ id: doc.id, ...doc.data() }));
                    
                    // Actualizar contadores
                    const teams = registrations.filter(r => r.type === 'team').length;
                    const individuals = registrations.filter(r => r.type === 'individual').length;
                    
                    document.getElementById('vr-total-count').textContent = registrations.length;
                    document.getElementById('vr-teams-count').textContent = teams;
                    document.getElementById('vr-individuals-count').textContent = individuals;
                    
                    if (registrations.length === 0) {
                        list.innerHTML = '';
                        empty.classList.remove('hidden');
                        return;
                    }
                    
                    empty.classList.add('hidden');
                    
                    list.innerHTML = registrations.map(reg => {
                        const regDate = new Date(reg.registeredAt);
                        const isTeam = reg.type === 'team';
                        
                        return `
                            <div class="bg-slate-50 border border-slate-200 rounded-xl p-4">
                                <div class="flex items-start justify-between gap-4">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-2">
                                            <span class="px-2 py-1 ${isTeam ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'} rounded-full text-xs font-bold">
                                                ${isTeam ? 'üë• Equipo' : 'üë§ Individual'}
                                            </span>
                                            <span class="text-xs text-slate-400">${regDate.toLocaleDateString('es-MX')} ${regDate.toLocaleTimeString('es-MX', { hour: '2-digit', minute: '2-digit' })}</span>
                                        </div>
                                        ${isTeam ? `<h4 class="font-bold text-slate-800 mb-1">${reg.teamName}</h4>` : ''}
                                        <p class="text-sm text-slate-600"><strong>Contacto:</strong> ${reg.contactName}</p>
                                        <div class="grid grid-cols-2 gap-2 mt-2 text-xs text-slate-500">
                                            <span><i data-lucide="mail" class="w-3 h-3 inline mr-1"></i>${reg.email}</span>
                                            <span><i data-lucide="phone" class="w-3 h-3 inline mr-1"></i>${reg.phone}</span>
                                            <span><i data-lucide="building" class="w-3 h-3 inline mr-1"></i>${reg.institution}</span>
                                            ${reg.robotName ? `<span><i data-lucide="bot" class="w-3 h-3 inline mr-1"></i>${reg.robotName}</span>` : ''}
                                        </div>
                                        ${isTeam && reg.teamMembers?.length > 0 ? `
                                            <div class="mt-3 p-2 bg-white rounded-lg border border-slate-200">
                                                <p class="text-xs font-bold text-slate-500 mb-1">Integrantes (${reg.teamMembers.length}):</p>
                                                <p class="text-xs text-slate-600">${reg.teamMembers.join(', ')}</p>
                                            </div>
                                        ` : ''}
                                        ${reg.comments ? `
                                            <div class="mt-2 p-2 bg-yellow-50 rounded-lg text-xs text-yellow-700">
                                                <strong>Comentarios:</strong> ${reg.comments}
                                            </div>
                                        ` : ''}
                                    </div>
                                    <button onclick="PublicEvents.deleteRegistration('${reg.id}', '${eventId}')" class="p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition" title="Eliminar inscripci√≥n">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    lucide.createIcons();
                    
                } catch (error) {
                    console.error('Error cargando inscripciones:', error);
                    list.innerHTML = '<p class="text-center text-red-500 py-8">Error al cargar inscripciones</p>';
                }
            },

            // Eliminar inscripci√≥n
            deleteRegistration: async (regId, eventId) => {
                const result = await Swal.fire({
                    title: '¬øEliminar inscripci√≥n?',
                    text: 'Esta acci√≥n no se puede deshacer',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#ef4444',
                    cancelButtonColor: '#64748b',
                    confirmButtonText: 'Eliminar',
                    cancelButtonText: 'Cancelar'
                });
                
                if (result.isConfirmed) {
                    try {
                        await db.collection('eventRegistrations').doc(regId).delete();
                        
                        // Decrementar contador
                        await db.collection('publicEvents').doc(eventId).update({
                            registrationsCount: firebase.firestore.FieldValue.increment(-1)
                        });
                        
                        Swal.fire({
                            icon: 'success',
                            title: 'Eliminado',
                            toast: true,
                            position: 'top-end',
                            showConfirmButton: false,
                            timer: 2000
                        });
                        
                        // Recargar inscripciones
                        await PublicEvents.viewRegistrations(eventId);
                        await PublicEvents.loadManager();
                        
                    } catch (error) {
                        console.error('Error:', error);
                        Swal.fire('Error', 'No se pudo eliminar la inscripci√≥n', 'error');
                    }
                }
            },

            // Exportar inscripciones a CSV
            exportRegistrations: async () => {
                const event = PublicEvents.currentViewingEvent;
                if (!event) return;
                
                try {
                    const snap = await db.collection('eventRegistrations')
                        .where('eventId', '==', event.id)
                        .orderBy('registeredAt', 'desc')
                        .get();
                    
                    const registrations = [];
                    snap.forEach(doc => registrations.push({ id: doc.id, ...doc.data() }));
                    
                    if (registrations.length === 0) {
                        Swal.fire('Sin datos', 'No hay inscripciones para exportar', 'info');
                        return;
                    }
                    
                    // Crear CSV
                    const headers = ['Tipo', 'Equipo/Nombre', 'Contacto', 'Email', 'Tel√©fono', 'Instituci√≥n', 'Robot', 'Integrantes', 'Comentarios', 'Fecha Registro'];
                    const rows = registrations.map(r => [
                        r.type === 'team' ? 'Equipo' : 'Individual',
                        r.type === 'team' ? r.teamName : r.contactName,
                        r.contactName,
                        r.email,
                        r.phone,
                        r.institution,
                        r.robotName || '',
                        r.teamMembers?.join('; ') || '',
                        r.comments || '',
                        new Date(r.registeredAt).toLocaleString('es-MX')
                    ]);
                    
                    const csvContent = [
                        headers.join(','),
                        ...rows.map(row => row.map(cell => `"${(cell || '').replace(/"/g, '""')}"`).join(','))
                    ].join('\n');
                    
                    // Descargar
                    const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `inscripciones_${event.name.replace(/[^a-z0-9]/gi, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
                    link.click();
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Exportado',
                        text: `${registrations.length} inscripciones exportadas`,
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 2000
                    });
                    
                } catch (error) {
                    console.error('Error exportando:', error);
                    Swal.fire('Error', 'No se pudo exportar', 'error');
                }
            }
        };

        /**
         * ==========================================
         * GESTOR DE TAREAS (KANBAN)
         * ==========================================
         */
        const Tasks = {
            currentFilter: 'all',
            currentAreaFilter: 'all',
            draggedTask: null,
            syncedToCalendar: false,
            
            // Funciones auxiliares para detectar roles especiales
            isFounder: () => {
                const title = (STATE.profile?.customTitle || '').toLowerCase();
                return title.includes('fundador') || title.includes('cofundador') || 
                       title.includes('cofundadora') || title.includes('fundadora');
            },
            
            isMentor: () => {
                const title = (STATE.profile?.customTitle || '').toLowerCase();
                const role = (STATE.profile?.role || '').toLowerCase();
                return title.includes('maestro') || title.includes('maestra') || 
                       title.includes('tutor') || title.includes('tutora') ||
                       title.includes('profesor') || title.includes('profesora') ||
                       title.includes('asesor') || title.includes('asesora') ||
                       role.includes('maestro') || role.includes('tutor');
            },
            
            isAreaLeader: (area = null) => {
                const title = (STATE.profile?.customTitle || '').toLowerCase();
                const isLeader = title.includes('l√≠der') || title.includes('lider');
                
                // Si no se especifica √°rea, solo verificar si es l√≠der
                if (!area) return isLeader;
                
                // Si se especifica √°rea, verificar que sea l√≠der de ESA √°rea
                const userArea = STATE.profile?.area || '';
                return isLeader && userArea === area;
            },
            
            // Verificar si puede ver todas las tareas (fundadores, maestros, admins)
            canViewAllTasks: () => {
                return Tasks.isFounder() || Tasks.isMentor() || STATE.isAdmin;
            },
            
            // Verificar si puede completar una tarea espec√≠fica
            canCompleteTasks: (taskArea) => {
                // Fundadores pueden completar cualquier tarea
                if (Tasks.isFounder()) return true;
                // Admins pueden completar cualquier tarea
                if (STATE.isAdmin) return true;
                // L√≠der de √°rea puede completar tareas de su √°rea
                if (Tasks.isAreaLeader(taskArea)) return true;
                return false;
            },

            load: async () => {
                try {
                    // Cargar proyectos para el filtro
                    const projectsSnap = await db.collection('projects').get();
                    const projectFilter = document.getElementById('task-project-filter');
                    const projectSelect = document.getElementById('task-project');
                    
                    // Separar proyectos en proceso de los completados
                    const inProgressProjects = [];
                    const otherProjects = [];
                    
                    projectsSnap.forEach(doc => {
                        const p = doc.data();
                        if (p.status === 'in_progress') {
                            inProgressProjects.push({ id: doc.id, ...p });
                        } else {
                            otherProjects.push({ id: doc.id, ...p });
                        }
                    });
                    
                    if (projectFilter) {
                        projectFilter.innerHTML = '<option value="all" class="text-slate-800">Todos los proyectos</option>';
                        
                        if (inProgressProjects.length > 0) {
                            projectFilter.innerHTML += '<optgroup label="üîÑ En Proceso">';
                            inProgressProjects.forEach(p => {
                                projectFilter.innerHTML += `<option value="${p.id}" class="text-slate-800">${p.title}</option>`;
                            });
                            projectFilter.innerHTML += '</optgroup>';
                        }
                        
                        if (otherProjects.length > 0) {
                            projectFilter.innerHTML += '<optgroup label="üìÅ Otros">';
                            otherProjects.forEach(p => {
                                projectFilter.innerHTML += `<option value="${p.id}" class="text-slate-800">${p.title}</option>`;
                            });
                            projectFilter.innerHTML += '</optgroup>';
                        }
                    }
                    
                    if (projectSelect) {
                        projectSelect.innerHTML = '<option value="">Sin proyecto</option>';
                        
                        if (inProgressProjects.length > 0) {
                            projectSelect.innerHTML += '<optgroup label="üîÑ En Proceso">';
                            inProgressProjects.forEach(p => {
                                projectSelect.innerHTML += `<option value="${p.id}">${p.title}</option>`;
                            });
                            projectSelect.innerHTML += '</optgroup>';
                        }
                        
                        if (otherProjects.length > 0) {
                            projectSelect.innerHTML += '<optgroup label="üìÅ Otros">';
                            otherProjects.forEach(p => {
                                projectSelect.innerHTML += `<option value="${p.id}">${p.title}</option>`;
                            });
                            projectSelect.innerHTML += '</optgroup>';
                        }
                    }

                    // Cargar miembros para asignaci√≥n
                    const membersSnap = await db.collection('users').get();
                    const assigneeSelect = document.getElementById('task-assignee');
                    if (assigneeSelect) {
                        assigneeSelect.innerHTML = '<option value="">Sin asignar</option>';
                        membersSnap.forEach(doc => {
                            const m = doc.data();
                            if (m.name) {
                                assigneeSelect.innerHTML += `<option value="${doc.id}">${m.name}</option>`;
                            }
                        });
                    }

                    // Cargar tareas
                    Tasks.loadTasks();
                    
                    // Sincronizar tareas existentes al calendario (solo una vez por sesi√≥n)
                    if (!Tasks.syncedToCalendar) {
                        Tasks.syncedToCalendar = true;
                        Tasks.syncTasksToCalendar();
                    }
                } catch (e) {
                    console.error('Error loading tasks:', e);
                    // A√∫n as√≠ cargar las tareas
                    Tasks.loadTasks();
                }
            },

            loadTasks: async () => {
                try {
                    let query = db.collection('tasks').orderBy('createdAt', 'desc');
                    
                    if (Tasks.currentFilter !== 'all') {
                        query = query.where('projectId', '==', Tasks.currentFilter);
                    }

                    const snap = await query.get();
                    
                    // Obtener el √°rea del usuario actual
                    const userArea = STATE.profile?.area || '';
                    const canViewAll = Tasks.canViewAllTasks();
                    
                    // Filtrar tareas por √°rea si hay filtro activo Y por permisos del usuario
                    let tasksArray = [];
                    snap.forEach(doc => {
                        const task = { id: doc.id, ...doc.data() };
                        
                        // Primero verificar si el usuario puede ver esta tarea por su rol/√°rea
                        const canViewByRole = canViewAll || !task.area || task.area === userArea;
                        
                        // Luego aplicar el filtro de √°rea seleccionado en la UI
                        const passesAreaFilter = Tasks.currentAreaFilter === 'all' || task.area === Tasks.currentAreaFilter;
                        
                        if (canViewByRole && passesAreaFilter) {
                            tasksArray.push(task);
                        }
                    });
                    
                    // Limpiar columnas y mostrar estado vac√≠o
                    ['todo', 'progress', 'review', 'done'].forEach(col => {
                        const container = document.getElementById(`column-${col}`);
                        if (container) {
                            container.innerHTML = `
                                <div class="empty-state text-center py-8 text-slate-300">
                                    <i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                                    <p class="text-[10px]">Sin tareas</p>
                                </div>
                            `;
                        }
                    });

                    // Contadores
                    const counts = { todo: 0, progress: 0, review: 0, done: 0 };

                    if (tasksArray.length > 0) {
                        // Limpiar estados vac√≠os si hay tareas
                        ['todo', 'progress', 'review', 'done'].forEach(col => {
                            const container = document.getElementById(`column-${col}`);
                            if (container) container.innerHTML = '';
                        });

                        tasksArray.forEach(task => {
                            const column = document.getElementById(`column-${task.status}`);
                            
                            if (column) {
                                counts[task.status]++;
                                column.innerHTML += Tasks.renderCard(task);
                            }
                        });

                        // A√±adir estado vac√≠o solo a columnas sin tareas
                        ['todo', 'progress', 'review', 'done'].forEach(col => {
                            if (counts[col] === 0) {
                                const container = document.getElementById(`column-${col}`);
                                if (container) {
                                    container.innerHTML = `
                                        <div class="empty-state text-center py-8 text-slate-300">
                                            <i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                                            <p class="text-[10px]">Sin tareas</p>
                                        </div>
                                    `;
                                }
                            }
                        });
                    }

                    // Actualizar contadores
                    Object.keys(counts).forEach(key => {
                        const el = document.getElementById(`count-${key}`);
                        if (el) el.textContent = counts[key];
                    });

                    // Actualizar estad√≠sticas
                    const statTodo = document.getElementById('stat-todo');
                    const statProgress = document.getElementById('stat-progress');
                    const statReview = document.getElementById('stat-review');
                    const statDone = document.getElementById('stat-done');
                    
                    if (statTodo) statTodo.textContent = counts.todo;
                    if (statProgress) statProgress.textContent = counts.progress;
                    if (statReview) statReview.textContent = counts.review;
                    if (statDone) statDone.textContent = counts.done;

                    lucide.createIcons();
                } catch (e) {
                    console.error('Error loading tasks:', e);
                    // Mostrar estados vac√≠os en caso de error
                    ['todo', 'progress', 'review', 'done'].forEach(col => {
                        const container = document.getElementById(`column-${col}`);
                        if (container) {
                            container.innerHTML = `
                                <div class="empty-state text-center py-8 text-slate-300">
                                    <i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                                    <p class="text-[10px]">Sin tareas</p>
                                </div>
                            `;
                        }
                    });
                    lucide.createIcons();
                }
            },

            renderCard: (task) => {
                const priorityColors = {
                    low: 'bg-green-100 text-green-700',
                    medium: 'bg-yellow-100 text-yellow-700',
                    high: 'bg-orange-100 text-orange-700',
                    urgent: 'bg-red-100 text-red-700 animate-pulse'
                };
                const priorityLabels = {
                    low: 'Baja',
                    medium: 'Media',
                    high: 'Alta',
                    urgent: 'Urgente'
                };
                
                // Colores y nombres de √°reas
                const areaStyles = {
                    gestion: { bg: 'bg-purple-100', text: 'text-purple-700', icon: 'briefcase', name: 'Gesti√≥n' },
                    telecom: { bg: 'bg-blue-100', text: 'text-blue-700', icon: 'wifi', name: 'Telecom' },
                    software: { bg: 'bg-green-100', text: 'text-green-700', icon: 'code', name: 'Software' },
                    electronica: { bg: 'bg-orange-100', text: 'text-orange-700', icon: 'cpu', name: 'Electr√≥nica' },
                    mecanico: { bg: 'bg-red-100', text: 'text-red-700', icon: 'cog', name: 'Mec√°nico' }
                };
                
                const areaStyle = areaStyles[task.area] || null;

                const dueDate = task.dueDate ? new Date(task.dueDate) : null;
                const isOverdue = dueDate && dueDate < new Date() && task.status !== 'done';
                
                // Verificar si el usuario puede completar esta tarea
                const canComplete = Tasks.canCompleteTasks(task.area);

                // Botones de acci√≥n seg√∫n el estado actual
                let actionButtons = '';
                if (task.status === 'todo') {
                    actionButtons = `
                        <div class="flex gap-1 mt-3 pt-3 border-t border-slate-100">
                            <button onclick="Tasks.moveTask('${task.id}', 'progress')" class="flex-1 text-[10px] font-bold py-1.5 px-2 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 transition flex items-center justify-center gap-1">
                                <i data-lucide="play" class="w-3 h-3"></i> Iniciar
                            </button>
                        </div>
                    `;
                } else if (task.status === 'progress') {
                    actionButtons = `
                        <div class="flex gap-1 mt-3 pt-3 border-t border-slate-100">
                            <button onclick="Tasks.moveTask('${task.id}', 'review')" class="flex-1 text-[10px] font-bold py-1.5 px-2 rounded-lg bg-yellow-50 text-yellow-600 hover:bg-yellow-100 transition flex items-center justify-center gap-1">
                                <i data-lucide="eye" class="w-3 h-3"></i> Revisar
                            </button>
                            ${canComplete ? `
                                <button onclick="Tasks.moveTask('${task.id}', 'done')" class="flex-1 text-[10px] font-bold py-1.5 px-2 rounded-lg bg-green-50 text-green-600 hover:bg-green-100 transition flex items-center justify-center gap-1">
                                    <i data-lucide="check" class="w-3 h-3"></i> Completar
                                </button>
                            ` : `
                                <button disabled title="Solo l√≠deres de √°rea o fundadores pueden completar" class="flex-1 text-[10px] font-bold py-1.5 px-2 rounded-lg bg-slate-100 text-slate-400 cursor-not-allowed flex items-center justify-center gap-1">
                                    <i data-lucide="lock" class="w-3 h-3"></i> Completar
                                </button>
                            `}
                        </div>
                    `;
                } else if (task.status === 'review') {
                    actionButtons = `
                        <div class="flex gap-1 mt-3 pt-3 border-t border-slate-100">
                            <button onclick="Tasks.moveTask('${task.id}', 'progress')" class="flex-1 text-[10px] font-bold py-1.5 px-2 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 transition flex items-center justify-center gap-1">
                                <i data-lucide="rotate-ccw" class="w-3 h-3"></i> Volver
                            </button>
                            ${canComplete ? `
                                <button onclick="Tasks.moveTask('${task.id}', 'done')" class="flex-1 text-[10px] font-bold py-1.5 px-2 rounded-lg bg-green-50 text-green-600 hover:bg-green-100 transition flex items-center justify-center gap-1">
                                    <i data-lucide="check-circle" class="w-3 h-3"></i> Aprobar
                                </button>
                            ` : `
                                <button disabled title="Solo l√≠deres de √°rea o fundadores pueden aprobar" class="flex-1 text-[10px] font-bold py-1.5 px-2 rounded-lg bg-slate-100 text-slate-400 cursor-not-allowed flex items-center justify-center gap-1">
                                    <i data-lucide="lock" class="w-3 h-3"></i> Aprobar
                                </button>
                            `}
                        </div>
                    `;
                } else if (task.status === 'done') {
                    actionButtons = `
                        <div class="flex gap-1 mt-3 pt-3 border-t border-slate-100">
                            <button onclick="Tasks.moveTask('${task.id}', 'todo')" class="flex-1 text-[10px] font-bold py-1.5 px-2 rounded-lg bg-slate-50 text-slate-600 hover:bg-slate-100 transition flex items-center justify-center gap-1">
                                <i data-lucide="rotate-ccw" class="w-3 h-3"></i> Reabrir
                            </button>
                        </div>
                    `;
                }

                return `
                    <div class="task-card bg-white rounded-xl p-4 shadow-sm border border-slate-200 cursor-pointer hover:shadow-md transition group" 
                         draggable="true" 
                         ondragstart="Tasks.dragStart(event, '${task.id}')"
                         ondragend="Tasks.dragEnd(event)"
                         onclick="Tasks.viewDetails('${task.id}')"
                         data-id="${task.id}"
                         data-area="${task.area || ''}">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <span class="text-[10px] font-bold px-2 py-0.5 rounded-full ${priorityColors[task.priority] || priorityColors.medium}">
                                    ${priorityLabels[task.priority] || 'Media'}
                                </span>
                                ${areaStyle ? `
                                    <span class="text-[10px] font-bold px-2 py-0.5 rounded-full ${areaStyle.bg} ${areaStyle.text} flex items-center gap-1">
                                        <i data-lucide="${areaStyle.icon}" class="w-3 h-3"></i>
                                        ${areaStyle.name}
                                    </span>
                                ` : ''}
                            </div>
                            <button onclick="event.stopPropagation(); Tasks.delete('${task.id}')" class="text-slate-300 hover:text-red-500 transition opacity-0 group-hover:opacity-100">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                        <h4 class="font-bold text-slate-800 text-sm mb-2 line-clamp-2">${task.title}</h4>
                        ${task.description ? `<p class="text-xs text-slate-500 mb-3 line-clamp-2">${task.description}</p>` : ''}
                        <div class="flex items-center justify-between text-[10px]">
                            ${task.assigneeName ? `
                                <div class="flex items-center gap-1 text-slate-500">
                                    <i data-lucide="user" class="w-3 h-3"></i>
                                    <span>${task.assigneeName}</span>
                                </div>
                            ` : '<div></div>'}
                            ${dueDate ? `
                                <div class="flex items-center gap-1 ${isOverdue ? 'text-red-500 font-bold' : 'text-slate-400'}">
                                    <i data-lucide="calendar" class="w-3 h-3"></i>
                                    <span>${dueDate.toLocaleDateString('es-MX', { day: 'numeric', month: 'short' })}</span>
                                </div>
                            ` : ''}
                        </div>
                        <div onclick="event.stopPropagation()">
                            ${actionButtons}
                        </div>
                    </div>
                `;
            },
            
            viewDetails: async (taskId) => {
                try {
                    const taskDoc = await db.collection('tasks').doc(taskId).get();
                    if (!taskDoc.exists) {
                        Util.notify('Tarea no encontrada', 'error');
                        return;
                    }
                    
                    const task = { id: taskDoc.id, ...taskDoc.data() };
                    
                    // Obtener nombre del proyecto si existe
                    let projectName = 'Sin proyecto asignado';
                    if (task.projectId) {
                        const projectDoc = await db.collection('projects').doc(task.projectId).get();
                        if (projectDoc.exists) {
                            projectName = projectDoc.data().title || 'Proyecto sin nombre';
                        }
                    }
                    
                    // Configurar badges de prioridad y √°rea
                    const priorityColors = {
                        high: 'bg-red-500 text-white',
                        medium: 'bg-yellow-500 text-white',
                        low: 'bg-green-500 text-white'
                    };
                    const priorityLabels = {
                        high: 'üî• Alta Prioridad',
                        medium: '‚ö° Media Prioridad',
                        low: 'üå± Baja Prioridad'
                    };
                    
                    const areaStyles = {
                        gestion: { name: 'Gesti√≥n y Vinculaci√≥n', bg: 'bg-indigo-500', icon: 'briefcase' },
                        telecom: { name: 'Telecomunicaciones', bg: 'bg-cyan-500', icon: 'radio' },
                        software: { name: 'Software e IA', bg: 'bg-blue-500', icon: 'code' },
                        electronica: { name: 'Electr√≥nica y Control', bg: 'bg-green-500', icon: 'cpu' },
                        mecanico: { name: 'Dise√±o Mec√°nico', bg: 'bg-orange-500', icon: 'settings' },
                        programacion: { name: 'Programaci√≥n', bg: 'bg-blue-500', icon: 'code' },
                        diseno: { name: 'Dise√±o 3D', bg: 'bg-purple-500', icon: 'box' },
                        comunicacion: { name: 'Comunicaci√≥n', bg: 'bg-pink-500', icon: 'megaphone' },
                        general: { name: 'General', bg: 'bg-slate-500', icon: 'users' }
                    };
                    
                    const areaStyle = areaStyles[task.area] || areaStyles.general;
                    
                    // Status styles
                    const statusStyles = {
                        todo: { label: 'Por Hacer', bg: 'bg-slate-100', text: 'text-slate-700', icon: 'circle' },
                        progress: { label: 'En Progreso', bg: 'bg-blue-100', text: 'text-blue-700', icon: 'loader' },
                        review: { label: 'En Revisi√≥n', bg: 'bg-amber-100', text: 'text-amber-700', icon: 'eye' },
                        done: { label: 'Completada', bg: 'bg-green-100', text: 'text-green-700', icon: 'check-circle' }
                    };
                    const statusStyle = statusStyles[task.status] || statusStyles.todo;
                    
                    // Badges
                    document.getElementById('task-details-badges').innerHTML = `
                        <span class="text-xs font-bold px-3 py-1 rounded-full ${priorityColors[task.priority] || priorityColors.medium}">
                            ${priorityLabels[task.priority] || '‚ö° Media Prioridad'}
                        </span>
                        <span class="text-xs font-bold px-3 py-1 rounded-full ${areaStyle.bg} text-white flex items-center gap-1">
                            <i data-lucide="${areaStyle.icon}" class="w-3 h-3"></i>
                            ${areaStyle.name}
                        </span>
                    `;
                    
                    // T√≠tulo
                    document.getElementById('task-details-title').textContent = task.title;
                    
                    // Descripci√≥n
                    const descSection = document.getElementById('task-details-description-section');
                    if (task.description) {
                        descSection.classList.remove('hidden');
                        document.getElementById('task-details-description').textContent = task.description;
                    } else {
                        descSection.classList.add('hidden');
                    }
                    
                    // Proyecto
                    const projectSection = document.getElementById('task-details-project-section');
                    if (task.projectId) {
                        projectSection.classList.remove('hidden');
                        document.getElementById('task-details-project').textContent = projectName;
                    } else {
                        projectSection.classList.add('hidden');
                    }
                    
                    // √Årea
                    document.getElementById('task-details-area').innerHTML = `
                        <span class="inline-flex items-center gap-1 px-2 py-1 rounded-lg ${areaStyle.bg} text-white text-xs font-bold">
                            <i data-lucide="${areaStyle.icon}" class="w-3 h-3"></i>
                            ${areaStyle.name}
                        </span>
                    `;
                    
                    // Asignado
                    document.getElementById('task-details-assignee').textContent = task.assigneeName || 'Sin asignar';
                    
                    // Fecha l√≠mite
                    const dueEl = document.getElementById('task-details-due');
                    if (task.dueDate) {
                        const dueDate = new Date(task.dueDate + 'T00:00:00');
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        const isOverdue = dueDate < today && task.status !== 'done';
                        
                        dueEl.innerHTML = `
                            <span class="${isOverdue ? 'text-red-600 font-bold' : 'text-slate-700'}">
                                ${dueDate.toLocaleDateString('es-MX', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}
                                ${isOverdue ? '<span class="ml-2 text-xs bg-red-100 text-red-600 px-2 py-0.5 rounded-full">‚ö†Ô∏è Vencida</span>' : ''}
                            </span>
                        `;
                    } else {
                        dueEl.textContent = 'Sin fecha l√≠mite';
                    }
                    
                    // Estado
                    document.getElementById('task-details-status').innerHTML = `
                        <div class="flex items-center gap-2 px-4 py-2 rounded-xl ${statusStyle.bg}">
                            <i data-lucide="${statusStyle.icon}" class="w-5 h-5 ${statusStyle.text}"></i>
                            <span class="font-bold ${statusStyle.text}">${statusStyle.label}</span>
                        </div>
                        <div class="flex-1 bg-slate-200 rounded-full h-2">
                            <div class="h-2 rounded-full transition-all ${task.status === 'done' ? 'bg-green-500 w-full' : task.status === 'review' ? 'bg-amber-500 w-3/4' : task.status === 'progress' ? 'bg-blue-500 w-1/2' : 'bg-slate-300 w-1/4'}"></div>
                        </div>
                    `;
                    
                    // Acciones
                    const canComplete = Tasks.canCompleteTasks(task.area);
                    let actionsHtml = '';
                    
                    if (task.status === 'todo') {
                        actionsHtml = `
                            <button onclick="Tasks.moveTask('${task.id}', 'progress'); Modal.close('task-details');" class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-bold text-sm hover:bg-blue-700 transition flex items-center justify-center gap-2">
                                <i data-lucide="play" class="w-4 h-4"></i>
                                Iniciar Tarea
                            </button>
                        `;
                    } else if (task.status === 'progress') {
                        actionsHtml = `
                            <button onclick="Tasks.moveTask('${task.id}', 'todo'); Modal.close('task-details');" class="flex-1 px-4 py-3 border border-slate-200 text-slate-600 rounded-xl font-bold text-sm hover:bg-slate-50 transition flex items-center justify-center gap-2">
                                <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                                Volver a Pendiente
                            </button>
                            <button onclick="Tasks.moveTask('${task.id}', 'review'); Modal.close('task-details');" class="flex-1 px-4 py-3 bg-amber-600 text-white rounded-xl font-bold text-sm hover:bg-amber-700 transition flex items-center justify-center gap-2">
                                <i data-lucide="send" class="w-4 h-4"></i>
                                Enviar a Revisi√≥n
                            </button>
                        `;
                    } else if (task.status === 'review') {
                        actionsHtml = `
                            <button onclick="Tasks.moveTask('${task.id}', 'progress'); Modal.close('task-details');" class="flex-1 px-4 py-3 border border-slate-200 text-slate-600 rounded-xl font-bold text-sm hover:bg-slate-50 transition flex items-center justify-center gap-2">
                                <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                                Devolver
                            </button>
                            ${canComplete ? `
                                <button onclick="Tasks.moveTask('${task.id}', 'done'); Modal.close('task-details');" class="flex-1 px-4 py-3 bg-green-600 text-white rounded-xl font-bold text-sm hover:bg-green-700 transition flex items-center justify-center gap-2">
                                    <i data-lucide="check-circle" class="w-4 h-4"></i>
                                    Aprobar
                                </button>
                            ` : `
                                <button disabled class="flex-1 px-4 py-3 bg-slate-200 text-slate-400 rounded-xl font-bold text-sm cursor-not-allowed flex items-center justify-center gap-2">
                                    <i data-lucide="lock" class="w-4 h-4"></i>
                                    Solo l√≠deres pueden aprobar
                                </button>
                            `}
                        `;
                    } else if (task.status === 'done') {
                        actionsHtml = `
                            <button onclick="Tasks.moveTask('${task.id}', 'todo'); Modal.close('task-details');" class="flex-1 px-4 py-3 border border-slate-200 text-slate-600 rounded-xl font-bold text-sm hover:bg-slate-50 transition flex items-center justify-center gap-2">
                                <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                                Reabrir Tarea
                            </button>
                        `;
                    }
                    
                    // Bot√≥n de editar solo para el creador de la tarea
                    const isCreator = STATE.currentUser && task.createdBy === STATE.currentUser.uid;
                    if (isCreator) {
                        actionsHtml += `
                            <button onclick="Tasks.openEdit('${task.id}'); Modal.close('task-details');" class="px-4 py-3 bg-amber-50 text-amber-600 rounded-xl font-bold text-sm hover:bg-amber-100 transition flex items-center justify-center gap-2">
                                <i data-lucide="edit-3" class="w-4 h-4"></i>
                                Editar
                            </button>
                        `;
                    }
                    
                    actionsHtml += `
                        <button onclick="event.stopPropagation(); Tasks.delete('${task.id}'); Modal.close('task-details');" class="px-4 py-3 bg-red-50 text-red-600 rounded-xl font-bold text-sm hover:bg-red-100 transition flex items-center justify-center gap-2">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                            Eliminar
                        </button>
                    `;
                    
                    document.getElementById('task-details-actions').innerHTML = actionsHtml;
                    
                    Modal.open('task-details');
                    lucide.createIcons();
                    
                } catch (e) {
                    console.error('Error loading task details:', e);
                    Util.notify('Error al cargar detalles de la tarea', 'error');
                }
            },

            create: async (e) => {
                e.preventDefault();
                
                if (!STATE.currentUser) {
                    Util.notify('Inicia sesi√≥n para crear tareas', 'warning');
                    return;
                }
                
                // Validar √°rea requerida
                const area = document.getElementById('task-area').value;
                if (!area) {
                    Util.notify('Por favor selecciona un √°rea responsable', 'warning');
                    return;
                }

                const assigneeId = document.getElementById('task-assignee').value;
                let assigneeName = '';
                
                if (assigneeId) {
                    const userDoc = await db.collection('users').doc(assigneeId).get();
                    if (userDoc.exists) {
                        assigneeName = userDoc.data().name || '';
                    }
                }

                const data = {
                    title: document.getElementById('task-title').value,
                    description: document.getElementById('task-description').value,
                    projectId: document.getElementById('task-project').value,
                    area: area,
                    priority: document.getElementById('task-priority').value,
                    assigneeId: assigneeId,
                    assigneeName: assigneeName,
                    dueDate: document.getElementById('task-due-date').value,
                    status: document.getElementById('task-status').value,
                    createdBy: STATE.currentUser.uid,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                try {
                    Util.loading(true, 'Creando tarea...');
                    const taskRef = await db.collection('tasks').add(data);
                    
                    // Crear evento de calendario autom√°ticamente si hay fecha l√≠mite
                    if (data.dueDate) {
                        let projectName = '';
                        if (data.projectId) {
                            const projectDoc = await db.collection('projects').doc(data.projectId).get();
                            if (projectDoc.exists) {
                                projectName = projectDoc.data().title || '';
                            }
                        }
                        
                        const calendarEvent = {
                            title: `üìã ${data.title}${projectName ? ' - ' + projectName : ''}`,
                            date: data.dueDate,
                            type: 'proyecto',
                            description: data.description || '',
                            taskId: taskRef.id,
                            isAutoGenerated: true,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        };
                        
                        await db.collection('calendar_events').add(calendarEvent);
                    }
                    
                    Util.loading(false);
                    Modal.close('add-task');
                    document.getElementById('task-title').value = '';
                    document.getElementById('task-description').value = '';
                    document.getElementById('task-area').value = '';
                    Util.notify('Tarea creada exitosamente', 'success');
                    Tasks.loadTasks();
                } catch (e) {
                    console.error(e);
                    Util.loading(false);
                    Util.notify('Error al crear tarea', 'error');
                }
            },
            
            openEdit: async (taskId) => {
                try {
                    Util.loading(true, 'Cargando tarea...');
                    
                    const taskDoc = await db.collection('tasks').doc(taskId).get();
                    if (!taskDoc.exists) {
                        Util.loading(false);
                        Util.notify('Tarea no encontrada', 'error');
                        return;
                    }
                    
                    const task = taskDoc.data();
                    
                    // Cargar proyectos para el select
                    const projectsSnap = await db.collection('projects').get();
                    const projectSelect = document.getElementById('edit-task-project');
                    projectSelect.innerHTML = '<option value="">Sin proyecto</option>';
                    projectsSnap.forEach(doc => {
                        const p = doc.data();
                        projectSelect.innerHTML += `<option value="${doc.id}" ${task.projectId === doc.id ? 'selected' : ''}>${p.title}</option>`;
                    });
                    
                    // Cargar miembros para el select
                    const membersSnap = await db.collection('users').get();
                    const assigneeSelect = document.getElementById('edit-task-assignee');
                    assigneeSelect.innerHTML = '<option value="">Sin asignar</option>';
                    membersSnap.forEach(doc => {
                        const m = doc.data();
                        if (m.name) {
                            assigneeSelect.innerHTML += `<option value="${doc.id}" ${task.assigneeId === doc.id ? 'selected' : ''}>${m.name}</option>`;
                        }
                    });
                    
                    // Llenar formulario con datos de la tarea
                    document.getElementById('edit-task-id').value = taskId;
                    document.getElementById('edit-task-title').value = task.title || '';
                    document.getElementById('edit-task-description').value = task.description || '';
                    document.getElementById('edit-task-area').value = task.area || '';
                    document.getElementById('edit-task-priority').value = task.priority || 'medium';
                    document.getElementById('edit-task-due-date').value = task.dueDate || '';
                    document.getElementById('edit-task-status').value = task.status || 'todo';
                    
                    Util.loading(false);
                    Modal.open('edit-task');
                    lucide.createIcons();
                    
                } catch (e) {
                    console.error('Error opening edit:', e);
                    Util.loading(false);
                    Util.notify('Error al cargar la tarea', 'error');
                }
            },
            
            update: async (e) => {
                e.preventDefault();
                
                const taskId = document.getElementById('edit-task-id').value;
                if (!taskId) {
                    Util.notify('Error: ID de tarea no encontrado', 'error');
                    return;
                }
                
                const assigneeId = document.getElementById('edit-task-assignee').value;
                let assigneeName = '';
                
                if (assigneeId) {
                    const userDoc = await db.collection('users').doc(assigneeId).get();
                    if (userDoc.exists) {
                        assigneeName = userDoc.data().name || '';
                    }
                }
                
                const newDueDate = document.getElementById('edit-task-due-date').value;
                const newTitle = document.getElementById('edit-task-title').value;
                const newDescription = document.getElementById('edit-task-description').value;
                const newProjectId = document.getElementById('edit-task-project').value;
                
                const data = {
                    title: newTitle,
                    description: newDescription,
                    projectId: newProjectId,
                    area: document.getElementById('edit-task-area').value,
                    priority: document.getElementById('edit-task-priority').value,
                    assigneeId: assigneeId,
                    assigneeName: assigneeName,
                    dueDate: newDueDate,
                    status: document.getElementById('edit-task-status').value,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                try {
                    Util.loading(true, 'Actualizando tarea...');
                    
                    // Obtener tarea anterior para comparar fecha
                    const oldTaskDoc = await db.collection('tasks').doc(taskId).get();
                    const oldTask = oldTaskDoc.data();
                    
                    await db.collection('tasks').doc(taskId).update(data);
                    
                    // Actualizar evento del calendario si cambi√≥ la fecha o t√≠tulo
                    const calEventsSnap = await db.collection('calendar_events')
                        .where('taskId', '==', taskId)
                        .get();
                    
                    if (!calEventsSnap.empty) {
                        // Actualizar evento existente
                        let projectName = '';
                        if (newProjectId) {
                            const projectDoc = await db.collection('projects').doc(newProjectId).get();
                            if (projectDoc.exists) {
                                projectName = projectDoc.data().title || '';
                            }
                        }
                        
                        for (const doc of calEventsSnap.docs) {
                            if (newDueDate) {
                                await doc.ref.update({
                                    title: `üìã ${newTitle}${projectName ? ' - ' + projectName : ''}`,
                                    date: newDueDate,
                                    description: newDescription || ''
                                });
                            } else {
                                // Si se quit√≥ la fecha, eliminar el evento
                                await doc.ref.delete();
                            }
                        }
                    } else if (newDueDate) {
                        // Crear evento si ahora tiene fecha y antes no ten√≠a
                        let projectName = '';
                        if (newProjectId) {
                            const projectDoc = await db.collection('projects').doc(newProjectId).get();
                            if (projectDoc.exists) {
                                projectName = projectDoc.data().title || '';
                            }
                        }
                        
                        await db.collection('calendar_events').add({
                            title: `üìã ${newTitle}${projectName ? ' - ' + projectName : ''}`,
                            date: newDueDate,
                            type: 'proyecto',
                            description: newDescription || '',
                            taskId: taskId,
                            isAutoGenerated: true,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                    
                    Util.loading(false);
                    Modal.close('edit-task');
                    Util.notify('Tarea actualizada exitosamente', 'success');
                    Tasks.loadTasks();
                    
                } catch (e) {
                    console.error('Error updating task:', e);
                    Util.loading(false);
                    Util.notify('Error al actualizar tarea', 'error');
                }
            },

            filterByProject: (projectId) => {
                Tasks.currentFilter = projectId;
                Tasks.loadTasks();
            },
            
            filterByArea: (area) => {
                Tasks.currentAreaFilter = area;
                
                // Actualizar botones activos
                document.querySelectorAll('#task-area-filters .task-area-btn').forEach(btn => {
                    btn.classList.remove('bg-indigo-600', 'text-white');
                    btn.classList.add('bg-slate-100', 'text-slate-600');
                });
                
                const activeBtn = document.querySelector(`#task-area-filters .task-area-btn[data-area="${area}"]`);
                if (activeBtn) {
                    activeBtn.classList.remove('bg-slate-100', 'text-slate-600');
                    activeBtn.classList.add('bg-indigo-600', 'text-white');
                }
                
                Tasks.loadTasks();
            },

            moveTask: async (taskId, newStatus) => {
                const statusLabels = {
                    todo: 'Por Hacer',
                    progress: 'En Progreso',
                    review: 'En Revisi√≥n',
                    done: 'Completada'
                };

                try {
                    // Verificar permisos si se est√° moviendo a 'done'
                    if (newStatus === 'done') {
                        // Obtener la tarea para verificar su √°rea
                        const taskDoc = await db.collection('tasks').doc(taskId).get();
                        if (taskDoc.exists) {
                            const taskData = taskDoc.data();
                            if (!Tasks.canCompleteTasks(taskData.area)) {
                                Util.notify('Solo l√≠deres de √°rea o fundadores pueden marcar tareas como completadas', 'warning');
                                return;
                            }
                        }
                    }
                    
                    await db.collection('tasks').doc(taskId).update({
                        status: newStatus,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    Util.notify(`Tarea movida a "${statusLabels[newStatus]}"`, 'success');
                    Tasks.loadTasks();
                } catch (e) {
                    console.error(e);
                    Util.notify('Error al mover tarea', 'error');
                }
            },

            dragStart: (e, taskId) => {
                Tasks.draggedTask = taskId;
                e.target.classList.add('opacity-50', 'rotate-2');
            },

            dragEnd: (e) => {
                e.target.classList.remove('opacity-50', 'rotate-2');
            },

            allowDrop: (e) => {
                e.preventDefault();
                e.currentTarget.classList.add('bg-opacity-75');
            },

            drop: async (e, newStatus) => {
                e.preventDefault();
                e.currentTarget.classList.remove('bg-opacity-75');
                
                if (!Tasks.draggedTask) return;

                try {
                    // Verificar permisos si se est√° moviendo a 'done'
                    if (newStatus === 'done') {
                        const taskDoc = await db.collection('tasks').doc(Tasks.draggedTask).get();
                        if (taskDoc.exists) {
                            const taskData = taskDoc.data();
                            if (!Tasks.canCompleteTasks(taskData.area)) {
                                Util.notify('Solo l√≠deres de √°rea o fundadores pueden marcar tareas como completadas', 'warning');
                                Tasks.draggedTask = null;
                                return;
                            }
                        }
                    }
                    
                    await db.collection('tasks').doc(Tasks.draggedTask).update({
                        status: newStatus,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    Tasks.loadTasks();
                } catch (e) {
                    console.error(e);
                    Util.notify('Error al mover tarea', 'error');
                }
            },

            delete: async (taskId) => {
                const result = await Swal.fire({
                    title: '¬øEliminar tarea?',
                    text: 'Esta acci√≥n no se puede deshacer',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#ef4444',
                    confirmButtonText: 'S√≠, eliminar',
                    cancelButtonText: 'Cancelar'
                });

                if (result.isConfirmed) {
                    try {
                        await db.collection('tasks').doc(taskId).delete();
                        
                        // Eliminar evento del calendario asociado a esta tarea
                        const calendarEventsSnapshot = await db.collection('calendar_events')
                            .where('taskId', '==', taskId)
                            .get();
                        
                        const deletePromises = calendarEventsSnapshot.docs.map(doc => doc.ref.delete());
                        await Promise.all(deletePromises);
                        
                        Util.notify('Tarea eliminada', 'success');
                        Tasks.loadTasks();
                    } catch (e) {
                        console.error(e);
                        Util.notify('Error al eliminar', 'error');
                    }
                }
            },

            clearCompleted: async () => {
                const result = await Swal.fire({
                    title: '¬øLimpiar completadas?',
                    text: 'Se eliminar√°n todas las tareas completadas',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'S√≠, limpiar',
                    cancelButtonText: 'Cancelar'
                });

                if (result.isConfirmed) {
                    try {
                        const snap = await db.collection('tasks').where('status', '==', 'done').get();
                        const batch = db.batch();
                        snap.forEach(doc => batch.delete(doc.ref));
                        await batch.commit();
                        Util.notify('Tareas completadas eliminadas', 'success');
                        Tasks.loadTasks();
                    } catch (e) {
                        console.error(e);
                    }
                }
            },
            
            // Migrar tareas existentes al calendario
            syncTasksToCalendar: async () => {
                try {
                    Util.loading(true, 'Sincronizando tareas al calendario...');
                    
                    // Obtener todas las tareas con fecha l√≠mite
                    const tasksSnap = await db.collection('tasks').get();
                    
                    // Obtener todos los eventos de calendario que ya tienen taskId
                    const calEventsSnap = await db.collection('calendar_events')
                        .where('isAutoGenerated', '==', true)
                        .get();
                    
                    // Crear un set de taskIds que ya tienen evento
                    const existingTaskIds = new Set();
                    calEventsSnap.forEach(doc => {
                        const data = doc.data();
                        if (data.taskId) {
                            existingTaskIds.add(data.taskId);
                        }
                    });
                    
                    // Obtener proyectos para nombres
                    const projectsSnap = await db.collection('projects').get();
                    const projectsMap = {};
                    projectsSnap.forEach(doc => {
                        projectsMap[doc.id] = doc.data().title || '';
                    });
                    
                    let syncCount = 0;
                    
                    // Crear eventos para tareas que no tienen evento
                    for (const doc of tasksSnap.docs) {
                        const task = doc.data();
                        const taskId = doc.id;
                        
                        // Solo sincronizar tareas con fecha l√≠mite y que no tengan evento
                        if (task.dueDate && !existingTaskIds.has(taskId)) {
                            const projectName = task.projectId ? projectsMap[task.projectId] : '';
                            
                            const calendarEvent = {
                                title: `üìã ${task.title}${projectName ? ' - ' + projectName : ''}`,
                                date: task.dueDate,
                                type: 'proyecto',
                                description: task.description || '',
                                taskId: taskId,
                                isAutoGenerated: true,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            };
                            
                            await db.collection('calendar_events').add(calendarEvent);
                            syncCount++;
                        }
                    }
                    
                    Util.loading(false);
                    
                    if (syncCount > 0) {
                        Util.notify(`${syncCount} tarea(s) sincronizada(s) al calendario`, 'success');
                    } else {
                        Util.notify('Todas las tareas ya est√°n en el calendario', 'info');
                    }
                    
                    // Recargar calendario si est√° visible
                    if (document.getElementById('calendar-grid')) {
                        Calendar.load();
                    }
                    
                } catch (e) {
                    console.error('Error sincronizando tareas:', e);
                    Util.loading(false);
                    Util.notify('Error al sincronizar tareas', 'error');
                }
            }
        };

        /**
         * ==========================================
         * CALENDARIO DE EVENTOS
         * ==========================================
         */
        const Calendar = {
            currentDate: new Date(),
            events: [],

            load: async () => {
                try {
                    Calendar.events = [];
                    
                    // Cargar eventos del calendario
                    try {
                        const snap = await db.collection('calendar_events').get();
                        snap.forEach(doc => {
                            Calendar.events.push({ id: doc.id, ...doc.data() });
                        });
                    } catch (e) {
                        console.log('No calendar events yet');
                    }

                    // Tambi√©n cargar competencias como eventos
                    try {
                        const compSnap = await db.collection('competitions').get();
                        compSnap.forEach(doc => {
                            const comp = doc.data();
                            if (comp.dateStart) {
                                Calendar.events.push({
                                    id: doc.id,
                                    title: comp.name,
                                    date: comp.dateStart,
                                    type: 'competition',
                                    location: comp.location,
                                    description: comp.description
                                });
                            }
                        });
                    } catch (e) {
                        console.log('No competitions yet');
                    }

                    Calendar.render();
                    Calendar.loadUpcomingWeek();
                } catch (e) {
                    console.error('Error loading calendar:', e);
                    Calendar.render();
                }
            },

            render: () => {
                const grid = document.getElementById('events-calendar-grid');
                const monthYear = document.getElementById('events-calendar-month-year');
                
                if (!grid) {
                    console.error('Calendar grid not found!');
                    return;
                }

                const year = Calendar.currentDate.getFullYear();
                const month = Calendar.currentDate.getMonth();
                
                const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
                
                monthYear.textContent = `${months[month]} ${year}`;

                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const today = new Date();

                // Debug: mostrar eventos cargados
                console.log('Calendar events:', Calendar.events);

                let html = '';

                // D√≠as vac√≠os antes del primer d√≠a
                for (let i = 0; i < firstDay; i++) {
                    html += `<div class="p-2 min-h-[80px] md:min-h-[100px] bg-slate-50 border-r border-b border-slate-100"></div>`;
                }

                // D√≠as del mes
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const isToday = today.getDate() === day && today.getMonth() === month && today.getFullYear() === year;
                    
                    // Filtrar eventos para este d√≠a (normalizar formato de fecha)
                    const dayEvents = Calendar.events.filter(e => {
                        if (!e.date) return false;
                        // Normalizar: si la fecha tiene hora, quitarla
                        const eventDate = String(e.date).split('T')[0];
                        return eventDate === dateStr;
                    });

                    html += `
                        <div onclick="Calendar.selectDay('${dateStr}')" 
                             class="p-2 min-h-[80px] md:min-h-[100px] border-r border-b border-slate-100 hover:bg-slate-50 cursor-pointer transition ${isToday ? 'bg-cyan-50' : ''}">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm font-bold ${isToday ? 'bg-cyan-600 text-white w-7 h-7 rounded-full flex items-center justify-center' : 'text-slate-700'}">${day}</span>
                                ${dayEvents.length > 0 ? `<span class="text-[9px] bg-slate-200 text-slate-600 px-1.5 rounded-full">${dayEvents.length}</span>` : ''}
                            </div>
                            <div class="space-y-1">
                                ${dayEvents.slice(0, 3).map(ev => `
                                    <div class="text-[9px] font-medium px-1.5 py-0.5 rounded truncate ${Calendar.getEventColor(ev.type)}">
                                        ${ev.title}
                                    </div>
                                `).join('')}
                                ${dayEvents.length > 3 ? `<div class="text-[9px] text-slate-400">+${dayEvents.length - 3} m√°s</div>` : ''}
                            </div>
                        </div>
                    `;
                }

                // D√≠as vac√≠os al final
                const totalCells = firstDay + daysInMonth;
                const remainingCells = 7 - (totalCells % 7);
                if (remainingCells < 7) {
                    for (let i = 0; i < remainingCells; i++) {
                        html += `<div class="p-2 min-h-[80px] md:min-h-[100px] bg-slate-50 border-r border-b border-slate-100"></div>`;
                    }
                }

                grid.innerHTML = html;
                lucide.createIcons();
            },

            getEventColor: (type) => {
                const colors = {
                    meeting: 'bg-blue-100 text-blue-700',
                    competition: 'bg-red-100 text-red-700',
                    workshop: 'bg-green-100 text-green-700',
                    deadline: 'bg-purple-100 text-purple-700',
                    social: 'bg-yellow-100 text-yellow-700',
                    proyecto: 'bg-orange-100 text-orange-700'
                };
                return colors[type] || 'bg-slate-100 text-slate-700';
            },

            selectDay: (dateStr) => {
                const container = document.getElementById('selected-day-events');
                const title = document.getElementById('selected-day-title');
                
                // Normalizar comparaci√≥n de fechas
                const dayEvents = Calendar.events.filter(e => {
                    if (!e.date) return false;
                    const eventDate = String(e.date).split('T')[0];
                    return eventDate === dateStr;
                });
                
                const date = new Date(dateStr + 'T12:00:00');
                title.textContent = date.toLocaleDateString('es-MX', { weekday: 'long', day: 'numeric', month: 'long' });

                if (dayEvents.length === 0) {
                    container.innerHTML = '<p class="text-slate-400 text-xs text-center py-6">No hay eventos para este d√≠a</p>';
                    return;
                }

                container.innerHTML = dayEvents.map(ev => `
                    <div class="p-3 rounded-lg border border-slate-200 bg-slate-50 hover:bg-white transition">
                        <div class="flex items-center gap-2 mb-2">
                            <div class="w-2 h-2 rounded-full ${Calendar.getEventDotColor(ev.type)}"></div>
                            <span class="text-xs font-bold text-slate-700">${ev.title}</span>
                        </div>
                        ${ev.time ? `<p class="text-[10px] text-slate-500 flex items-center gap-1"><i data-lucide="clock" class="w-3 h-3"></i> ${ev.time}</p>` : ''}
                        ${ev.location ? `<p class="text-[10px] text-slate-500 flex items-center gap-1"><i data-lucide="map-pin" class="w-3 h-3"></i> ${ev.location}</p>` : ''}
                    </div>
                `).join('');

                lucide.createIcons();
            },

            getEventDotColor: (type) => {
                const colors = {
                    meeting: 'bg-blue-500',
                    competition: 'bg-red-500',
                    workshop: 'bg-green-500',
                    deadline: 'bg-purple-500',
                    social: 'bg-yellow-500',
                    proyecto: 'bg-orange-500'
                };
                return colors[type] || 'bg-slate-500';
            },

            loadUpcomingWeek: () => {
                const container = document.getElementById('upcoming-week-events');
                const today = new Date();
                today.setHours(0, 0, 0, 0); // Resetear a inicio del d√≠a
                const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
                
                const upcoming = Calendar.events.filter(ev => {
                    if (!ev.date) return false;
                    const evDate = new Date(ev.date + 'T00:00:00');
                    return evDate >= today && evDate <= nextWeek;
                }).sort((a, b) => new Date(a.date) - new Date(b.date));

                if (upcoming.length === 0) {
                    container.innerHTML = '<p class="text-slate-400 text-xs text-center py-4">No hay eventos en los pr√≥ximos 7 d√≠as</p>';
                    return;
                }

                container.innerHTML = upcoming.map(ev => {
                    const date = new Date(ev.date + 'T12:00:00');
                    const isToday = ev.date === new Date().toISOString().split('T')[0];
                    return `
                        <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-slate-50 transition ${isToday ? 'bg-cyan-50 border border-cyan-200' : ''}">
                            <div class="w-2 h-2 rounded-full ${Calendar.getEventDotColor(ev.type)} flex-shrink-0"></div>
                            <div class="flex-1 min-w-0">
                                <p class="text-xs font-bold text-slate-700 truncate">${ev.title}</p>
                                <p class="text-[10px] text-slate-400">${isToday ? 'Hoy' : date.toLocaleDateString('es-MX', { weekday: 'short', day: 'numeric', month: 'short' })}${ev.time ? ' ‚Ä¢ ' + ev.time : ''}</p>
                            </div>
                        </div>
                    `;
                }).join('');
                
                lucide.createIcons();
            },

            prevMonth: () => {
                Calendar.currentDate.setMonth(Calendar.currentDate.getMonth() - 1);
                Calendar.render();
            },

            nextMonth: () => {
                Calendar.currentDate.setMonth(Calendar.currentDate.getMonth() + 1);
                Calendar.render();
            },

            today: () => {
                Calendar.currentDate = new Date();
                Calendar.render();
            },

            createEvent: async (e) => {
                e.preventDefault();

                if (!STATE.currentUser) {
                    Util.notify('Inicia sesi√≥n para crear eventos', 'warning');
                    return;
                }

                const data = {
                    title: document.getElementById('cal-event-title').value,
                    date: document.getElementById('cal-event-date').value,
                    time: document.getElementById('cal-event-time').value,
                    type: document.getElementById('cal-event-type').value,
                    duration: document.getElementById('cal-event-duration').value,
                    location: document.getElementById('cal-event-location').value,
                    description: document.getElementById('cal-event-description').value,
                    createdBy: STATE.currentUser.uid,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                try {
                    Util.loading(true, 'Creando evento...');
                    const docRef = await db.collection('calendar_events').add(data);
                    
                    // A√±adir localmente para actualizaci√≥n inmediata (sin serverTimestamp)
                    const localEvent = {
                        id: docRef.id,
                        title: data.title,
                        date: data.date,
                        time: data.time,
                        type: data.type,
                        duration: data.duration,
                        location: data.location,
                        description: data.description,
                        createdBy: data.createdBy
                    };
                    Calendar.events.push(localEvent);
                    
                    console.log('Evento creado:', localEvent);
                    console.log('Total eventos:', Calendar.events.length);
                    console.log('Todos los eventos:', Calendar.events);
                    
                    Util.loading(false);
                    Modal.close('add-calendar-event');
                    
                    // Limpiar formulario
                    document.getElementById('cal-event-title').value = '';
                    document.getElementById('cal-event-date').value = '';
                    document.getElementById('cal-event-time').value = '';
                    document.getElementById('cal-event-location').value = '';
                    document.getElementById('cal-event-description').value = '';
                    
                    Util.notify('Evento creado exitosamente', 'success');
                    
                    // Navegar al mes del evento creado
                    const eventDate = new Date(data.date + 'T12:00:00');
                    Calendar.currentDate = new Date(eventDate.getFullYear(), eventDate.getMonth(), 1);
                    
                    // Re-renderizar calendario y panel lateral
                    Calendar.render();
                    Calendar.loadUpcomingWeek();
                    
                } catch (e) {
                    console.error(e);
                    Util.loading(false);
                    Util.notify('Error al crear evento: ' + e.message, 'error');
                }
            }
        };

        /**
         * ==========================================
         * CENTRO DE COMUNICACIONES
         * ==========================================
         */
        const Communications = {
            currentChannel: 'general',
            unsubscribeChat: null,
            unsubscribeOnlineMembers: null,

            load: () => {
                Communications.loadAnnouncements();
                Communications.connectChat();
                Communications.checkAnnouncementPermission();
                Communications.loadOnlineMembers();
                Communications.updatePresence();
            },

            // Sistema de presencia - marca al usuario como online
            updatePresence: async () => {
                if (!STATE.currentUser) return;
                
                try {
                    const userRef = db.collection('presence').doc(STATE.currentUser.uid);
                    
                    // Marcar como online
                    await userRef.set({
                        online: true,
                        lastSeen: firebase.firestore.FieldValue.serverTimestamp(),
                        displayName: STATE.currentUser.displayName || 'Usuario',
                        photoURL: STATE.currentUser.photoURL || null,
                        uid: STATE.currentUser.uid
                    }, { merge: true });

                    // Actualizar cada 2 minutos para mantener presencia
                    setInterval(async () => {
                        if (STATE.currentUser) {
                            await userRef.update({
                                lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                            }).catch(() => {});
                        }
                    }, 120000);

                    // Marcar como offline cuando cierre la pesta√±a
                    window.addEventListener('beforeunload', async () => {
                        await userRef.update({ online: false }).catch(() => {});
                    });

                } catch (e) {
                    console.error('Error updating presence:', e);
                }
            },

            // Cargar miembros online en tiempo real
            loadOnlineMembers: () => {
                const container = document.getElementById('online-members');
                const countEl = document.getElementById('chat-online-count');
                if (!container) return;

                // Desuscribirse del listener anterior
                if (Communications.unsubscribeOnlineMembers) {
                    Communications.unsubscribeOnlineMembers();
                }

                // Escuchar usuarios online (activos en los √∫ltimos 3 minutos)
                const threeMinutesAgo = new Date(Date.now() - 3 * 60 * 1000);

                Communications.unsubscribeOnlineMembers = db.collection('presence')
                    .where('online', '==', true)
                    .where('lastSeen', '>=', threeMinutesAgo)
                    .onSnapshot(snapshot => {
                        if (snapshot.empty) {
                            container.innerHTML = `<p class="text-slate-400 text-xs">No hay miembros conectados</p>`;
                            if (countEl) countEl.textContent = '0';
                            return;
                        }

                        container.innerHTML = '';
                        let onlineCount = 0;

                        snapshot.forEach(doc => {
                            const member = doc.data();
                            onlineCount++;
                            
                            const avatarUrl = member.photoURL || 
                                `https://ui-avatars.com/api/?name=${encodeURIComponent(member.displayName || 'U')}&background=1B396A&color=fff`;
                            
                            container.innerHTML += `
                                <div class="relative group cursor-pointer" title="${member.displayName || 'Usuario'}">
                                    <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-white shadow-md hover:scale-110 transition-transform">
                                        <img src="${avatarUrl}" alt="${member.displayName}" class="w-full h-full object-cover">
                                    </div>
                                    <span class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></span>
                                    <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-slate-800 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap pointer-events-none z-10">
                                        ${member.displayName || 'Usuario'}
                                    </div>
                                </div>
                            `;
                        });

                        if (countEl) countEl.textContent = onlineCount;
                    }, error => {
                        console.error('Error loading online members:', error);
                        container.innerHTML = `<p class="text-slate-400 text-xs">Error al cargar</p>`;
                    });
            },

            checkAnnouncementPermission: () => {
                const btn = document.getElementById('btn-new-announcement');
                if (btn && STATE.currentUser) {
                    btn.classList.remove('hidden');
                }
            },

            loadAnnouncements: async () => {
                const container = document.getElementById('announcements-list');
                if (!container) return;

                try {
                    const snap = await db.collection('announcements')
                        .orderBy('createdAt', 'desc')
                        .limit(10)
                        .get();

                    if (snap.empty) {
                        container.innerHTML = `
                            <div class="text-center py-8">
                                <i data-lucide="megaphone" class="w-12 h-12 text-slate-200 mx-auto mb-2"></i>
                                <p class="text-xs text-slate-400">No hay anuncios recientes</p>
                                <p class="text-[10px] text-slate-300 mt-1">Crea el primer anuncio</p>
                            </div>
                        `;
                        lucide.createIcons();
                        return;
                    }

                    container.innerHTML = '';
                    snap.forEach(doc => {
                        const ann = doc.data();
                        const priorityStyles = {
                            normal: 'border-l-blue-500 bg-blue-50',
                            important: 'border-l-yellow-500 bg-yellow-50',
                            urgent: 'border-l-red-500 bg-red-50 animate-pulse'
                        };
                        const priorityIcons = {
                            normal: 'üì¢',
                            important: '‚ö†Ô∏è',
                            urgent: 'üö®'
                        };

                        const createdAt = ann.createdAt?.toDate?.() || new Date();

                        container.innerHTML += `
                            <div class="border-l-4 ${priorityStyles[ann.priority] || priorityStyles.normal} rounded-r-lg p-4">
                                <div class="flex items-start justify-between gap-2 mb-2">
                                    <h4 class="font-bold text-slate-800 text-sm flex items-center gap-2">
                                        <span>${priorityIcons[ann.priority] || 'üì¢'}</span>
                                        ${ann.title}
                                    </h4>
                                </div>
                                <p class="text-xs text-slate-600 mb-3">${ann.content}</p>
                                <div class="flex items-center justify-between text-[10px] text-slate-400">
                                    <span>${ann.authorName || 'Admin'}</span>
                                    <span>${createdAt.toLocaleDateString('es-MX', { day: 'numeric', month: 'short' })}</span>
                                </div>
                            </div>
                        `;
                    });

                    const unreadBadge = document.getElementById('unread-announcements');
                    if (unreadBadge) {
                        unreadBadge.textContent = snap.size;
                    }

                    lucide.createIcons();
                } catch (e) {
                    console.error('Error loading announcements:', e);
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i data-lucide="megaphone" class="w-12 h-12 text-slate-200 mx-auto mb-2"></i>
                            <p class="text-xs text-slate-400">No hay anuncios a√∫n</p>
                        </div>
                    `;
                    lucide.createIcons();
                }
            },

            createAnnouncement: async (e) => {
                e.preventDefault();

                if (!STATE.currentUser) {
                    Util.notify('Inicia sesi√≥n para crear anuncios', 'warning');
                    return;
                }

                const data = {
                    title: document.getElementById('announcement-title').value,
                    content: document.getElementById('announcement-content').value,
                    priority: document.getElementById('announcement-priority').value,
                    expiryDays: parseInt(document.getElementById('announcement-expiry').value),
                    authorId: STATE.currentUser.uid,
                    authorName: STATE.currentUser.displayName || 'Admin',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                try {
                    Util.loading(true, 'Publicando anuncio...');
                    await db.collection('announcements').add(data);
                    Util.loading(false);
                    Modal.close('add-announcement');
                    document.getElementById('announcement-title').value = '';
                    document.getElementById('announcement-content').value = '';
                    Util.notify('Anuncio publicado', 'success');
                    Communications.loadAnnouncements();
                } catch (e) {
                    console.error(e);
                    Util.loading(false);
                    Util.notify('Error al publicar anuncio', 'error');
                }
            },

            switchChatTab: (channel) => {
                Communications.currentChannel = channel;
                
                document.querySelectorAll('.chat-tab-btn').forEach(btn => {
                    btn.classList.remove('active', 'text-tec-blue', 'border-tec-blue');
                    btn.classList.add('text-slate-500', 'border-transparent');
                });
                event.target.classList.add('active', 'text-tec-blue', 'border-tec-blue');
                event.target.classList.remove('text-slate-500', 'border-transparent');

                Communications.connectChat();
            },

            connectChat: () => {
                const container = document.getElementById('comm-chat-messages');
                const input = document.getElementById('comm-chat-input');
                
                if (!container) return;

                // Desconectar listener anterior
                if (Communications.unsubscribeChat) {
                    Communications.unsubscribeChat();
                }

                // Activar input si hay usuario
                if (input && STATE.currentUser) {
                    input.disabled = false;
                }

                // Usar chat_logs (colecci√≥n existente con reglas)
                Communications.unsubscribeChat = db.collection('chat_logs')
                    .orderBy('ts', 'asc')
                    .limitToLast(100)
                    .onSnapshot(snapshot => {
                        container.innerHTML = '';
                        
                        if (snapshot.empty) {
                            container.innerHTML = `
                                <div class="text-center py-10">
                                    <i data-lucide="message-circle" class="w-12 h-12 text-slate-200 mx-auto mb-2"></i>
                                    <p class="text-xs text-slate-400">No hay mensajes a√∫n. ¬°S√© el primero!</p>
                                </div>
                            `;
                            lucide.createIcons();
                            return;
                        }

                        snapshot.forEach(doc => {
                            const msg = doc.data();
                            const isMe = STATE.currentUser && msg.uid === STATE.currentUser.uid;
                            
                            container.innerHTML += `
                                <div class="flex gap-3 ${isMe ? 'flex-row-reverse' : ''} animate-fade-in">
                                    <div class="w-10 h-10 rounded-full bg-slate-200 flex-shrink-0 overflow-hidden border-2 border-white shadow-sm">
                                        <img src="${msg.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(msg.author || 'U')}&background=${isMe ? 'D4AF37' : '1B396A'}&color=fff`}" 
                                             class="w-full h-full object-cover" alt="${msg.author}">
                                    </div>
                                    <div class="flex flex-col ${isMe ? 'items-end' : 'items-start'} max-w-[70%]">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="text-[10px] text-slate-500 font-bold">${msg.author || 'Usuario'}</span>
                                            <span class="text-[9px] text-slate-300">${msg.ts?.toDate?.().toLocaleTimeString('es-MX', { hour: '2-digit', minute: '2-digit' }) || ''}</span>
                                        </div>
                                        <div class="${isMe ? 'bg-gradient-to-r from-tec-blue to-indigo-600 text-white rounded-br-sm' : 'bg-white border border-slate-200 text-slate-700 rounded-bl-sm'} px-4 py-3 rounded-2xl text-sm shadow-sm">
                                            ${msg.text}
                                        </div>
                                    </div>
                                </div>
                            `;
                        });

                        container.scrollTop = container.scrollHeight;
                        lucide.createIcons();
                    }, error => {
                        console.error('Chat error:', error);
                        container.innerHTML = `
                            <div class="text-center py-10">
                                <i data-lucide="message-circle" class="w-12 h-12 text-slate-200 mx-auto mb-2"></i>
                                <p class="text-xs text-slate-400">Chat disponible. ¬°Inicia la conversaci√≥n!</p>
                            </div>
                        `;
                        lucide.createIcons();
                    });
            },

            sendMessage: async (e) => {
                e.preventDefault();
                const input = document.getElementById('comm-chat-input');
                const text = input.value.trim();
                
                if (!text || !STATE.currentUser) {
                    if (!STATE.currentUser) {
                        Util.notify('Inicia sesi√≥n para enviar mensajes', 'warning');
                    }
                    return;
                }

                input.value = '';

                try {
                    // Usar chat_logs (colecci√≥n existente)
                    await db.collection('chat_logs').add({
                        text: text,
                        uid: STATE.currentUser.uid,
                        author: STATE.currentUser.displayName || 'Usuario',
                        avatar: STATE.currentUser.photoURL || null,
                        ts: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (e) {
                    console.error('Error sending message:', e);
                    Util.notify('Error al enviar mensaje', 'error');
                }
            },

            toggleEmoji: () => {
                Util.notify('Selector de emojis pr√≥ximamente', 'info');
            },

            attachFile: () => {
                Util.notify('Compartir archivos pr√≥ximamente', 'info');
            }
        };
    </script>
</body>
</html>